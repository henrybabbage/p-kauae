import{bg as ge,r as ee,d6 as km,a as Lt,C as Xt,K as Vt,O as or,cm as Hc,cH as pa,b8 as Vc,e as Te,j as B,B as Dr,T as Tt,g as Rm,l as Wt,d7 as to,d8 as Kc,bN as qc,I as ji,bm as Im,L as Lm,cV as Dm,ba as Cm,c4 as jc,cl as xm,d9 as Wc,a8 as $c,da as fd,db as nu,dc as Mm,dd as Yc,b9 as Pm,de as Om,df as Fm,cu as ro,a7 as pd,dg as kl,F as Ri,dh as Nm,di as Um,dj as Bm,u as Gm,dk as Hm,c3 as Vm,cU as zc,aN as Km,G as Rl,dl as qm,a5 as jm,dm as Qc,dn as Xc,Z as Wm,f as md,Q as $m,bL as js,ak as Il,ac as wi,cj as Zc,aa as au,ab as Cs,ad as Si,bM as Ym,a1 as zm,dp as Qm,dq as su,dr as Xm,ds as Zm,dt as Jm,c as ev,du as tv}from"./sanity-3c473299.js";import{V as Ws,A as rv,g as ou,a as Xr,u as iv,_ as vd,b as Jc,c as eh,d as nv,T as av,C as sv}from"./VideoSource.styled-81ae8d6c-b2d1809c.js";const Ai=()=>{},gr=Ai(),al=Object,Ze=o=>o===gr,ui=o=>typeof o=="function",Ii=(o,n)=>({...o,...n}),ov=o=>ui(o.then),hs=new WeakMap;let lv=0;const _a=o=>{const n=typeof o,u=o&&o.constructor,p=u==Date;let v,T;if(al(o)===o&&!p&&u!=RegExp){if(v=hs.get(o),v)return v;if(v=++lv+"~",hs.set(o,v),u==Array){for(v="@",T=0;T<o.length;T++)v+=_a(o[T])+",";hs.set(o,v)}if(u==al){v="#";const L=al.keys(o).sort();for(;!Ze(T=L.pop());)Ze(o[T])||(v+=T+":"+_a(o[T])+",");hs.set(o,v)}}else v=p?o.toJSON():n=="symbol"?o.toString():n=="string"?JSON.stringify(o):""+o;return v},li=new WeakMap,sl={},fs={},lu="undefined",io=typeof window!=lu,Ll=typeof document!=lu,uv=()=>io&&typeof window.requestAnimationFrame!=lu,th=(o,n)=>{const u=li.get(o);return[()=>!Ze(n)&&o.get(n)||sl,p=>{if(!Ze(n)){const v=o.get(n);n in fs||(fs[n]=v),u[5](n,Ii(v,p),v||sl)}},u[6],()=>!Ze(n)&&n in fs?fs[n]:!Ze(n)&&o.get(n)||sl]};let Dl=!0;const dv=()=>Dl,[Cl,xl]=io&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[Ai,Ai],cv=()=>{const o=Ll&&document.visibilityState;return Ze(o)||o!=="hidden"},hv=o=>(Ll&&document.addEventListener("visibilitychange",o),Cl("focus",o),()=>{Ll&&document.removeEventListener("visibilitychange",o),xl("focus",o)}),fv=o=>{const n=()=>{Dl=!0,o()},u=()=>{Dl=!1};return Cl("online",n),Cl("offline",u),()=>{xl("online",n),xl("offline",u)}},pv={isOnline:dv,isVisible:cv},mv={initFocus:hv,initReconnect:fv},gd=!ge.useId,Ta=!io||"Deno"in window,vv=o=>uv()?window.requestAnimationFrame(o):setTimeout(o,1),ol=Ta?ee.useEffect:ee.useLayoutEffect,ll=typeof navigator<"u"&&navigator.connection,yd=!Ta&&ll&&(["slow-2g","2g"].includes(ll.effectiveType)||ll.saveData),uu=o=>{if(ui(o))try{o=o()}catch{o=""}const n=o;return o=typeof o=="string"?o:(Array.isArray(o)?o.length:o)?_a(o):"",[o,n]};let gv=0;const Ml=()=>++gv,rh=0,ih=1,nh=2,yv=3;var ea={__proto__:null,ERROR_REVALIDATE_EVENT:yv,FOCUS_EVENT:rh,MUTATE_EVENT:nh,RECONNECT_EVENT:ih};async function ah(...o){const[n,u,p,v]=o,T=Ii({populateCache:!0,throwOnError:!0},typeof v=="boolean"?{revalidate:v}:v||{});let L=T.populateCache;const C=T.rollbackOnError;let M=T.optimisticData;const V=T.revalidate!==!1,G=j=>typeof C=="function"?C(j):C!==!1,Y=T.throwOnError;if(ui(u)){const j=u,re=[],ae=n.keys();for(const ue of ae)!/^\$(inf|sub)\$/.test(ue)&&j(n.get(ue)._k)&&re.push(ue);return Promise.all(re.map(Z))}return Z(u);async function Z(j){const[re]=uu(j);if(!re)return;const[ae,ue]=th(n,re),[ce,pe,xe,le]=li.get(n),w=ce[re],se=()=>V&&(delete xe[re],delete le[re],w&&w[0])?w[0](nh).then(()=>ae().data):ae().data;if(o.length<3)return se();let W=p,z;const ke=Ml();pe[re]=[ke,0];const ye=!Ze(M),Ee=ae(),Ke=Ee.data,Je=Ee._c,H=Ze(Je)?Ke:Je;if(ye&&(M=ui(M)?M(H,Ke):M,ue({data:M,_c:H})),ui(W))try{W=W(H)}catch(nt){z=nt}if(W&&ov(W))if(W=await W.catch(nt=>{z=nt}),ke!==pe[re][0]){if(z)throw z;return W}else z&&ye&&G(z)&&(L=!0,W=H,ue({data:W,_c:gr}));L&&(z||(ui(L)&&(W=L(W,H)),ue({data:W,error:gr,_c:gr}))),pe[re][1]=Ml();const Ie=await se();if(ue({_c:gr}),z){if(Y)throw z;return}return L?Ie:W}}const Ed=(o,n)=>{for(const u in o)o[u][0]&&o[u][0](n)},Ev=(o,n)=>{if(!li.has(o)){const u=Ii(mv,n),p={},v=ah.bind(gr,o);let T=Ai;const L={},C=(G,Y)=>{const Z=L[G]||[];return L[G]=Z,Z.push(Y),()=>Z.splice(Z.indexOf(Y),1)},M=(G,Y,Z)=>{o.set(G,Y);const j=L[G];if(j)for(const re of j)re(Y,Z)},V=()=>{if(!li.has(o)&&(li.set(o,[p,{},{},{},v,M,C]),!Ta)){const G=u.initFocus(setTimeout.bind(gr,Ed.bind(gr,p,rh))),Y=u.initReconnect(setTimeout.bind(gr,Ed.bind(gr,p,ih)));T=()=>{G&&G(),Y&&Y(),li.delete(o)}}};return V(),[o,v,V,T]}return[o,li.get(o)[4]]},bv=(o,n,u,p,v)=>{const T=u.errorRetryCount,L=v.retryCount,C=~~((Math.random()+.5)*(1<<(L<8?L:8)))*u.errorRetryInterval;!Ze(T)&&L>T||setTimeout(p,C,v)},_v=(o,n)=>_a(o)==_a(n),[sh,Tv]=Ev(new Map),Sv=Ii({onLoadingSlow:Ai,onSuccess:Ai,onError:Ai,onErrorRetry:bv,onDiscarded:Ai,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:yd?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:yd?5e3:3e3,compare:_v,isPaused:()=>!1,cache:sh,mutate:Tv,fallback:{}},pv),Av=(o,n)=>{const u=Ii(o,n);if(n){const{use:p,fallback:v}=o,{use:T,fallback:L}=n;p&&T&&(u.use=p.concat(T)),v&&L&&(u.fallback=Ii(v,L))}return u},wv=ee.createContext({}),oh=io&&window.__SWR_DEVTOOLS_USE__,kv=oh?window.__SWR_DEVTOOLS_USE__:[],Rv=()=>{oh&&(window.__SWR_DEVTOOLS_REACT__=ge)},Iv=o=>ui(o[1])?[o[0],o[1],o[2]||{}]:[o[0],null,(o[1]===null?o[2]:o[1])||{}],Lv=()=>Ii(Sv,ee.useContext(wv)),Dv=o=>(n,u,p)=>o(n,u&&((...T)=>{const[L]=uu(n),[,,,C]=li.get(sh),M=C[L];return Ze(M)?u(...T):(delete C[L],M)}),p),Cv=kv.concat(Dv),xv=o=>function(...u){const p=Lv(),[v,T,L]=Iv(u),C=Av(p,L);let M=o;const{use:V}=C,G=(V||[]).concat(Cv);for(let Y=G.length;Y--;)M=G[Y](M);return M(v,T||C.fetcher||null,C)},Mv=(o,n,u)=>{const p=n[o]||(n[o]=[]);return p.push(u),()=>{const v=p.indexOf(u);v>=0&&(p[v]=p[p.length-1],p.pop())}};Rv();const bd=ge.use||(o=>{if(o.status==="pending")throw o;if(o.status==="fulfilled")return o.value;throw o.status==="rejected"?o.reason:(o.status="pending",o.then(n=>{o.status="fulfilled",o.value=n},n=>{o.status="rejected",o.reason=n}),o)}),ul={dedupe:!0},Pv=(o,n,u)=>{const{cache:p,compare:v,suspense:T,fallbackData:L,revalidateOnMount:C,revalidateIfStale:M,refreshInterval:V,refreshWhenHidden:G,refreshWhenOffline:Y,keepPreviousData:Z}=u,[j,re,ae,ue]=li.get(p),[ce,pe]=uu(o),xe=ee.useRef(!1),le=ee.useRef(!1),w=ee.useRef(ce),se=ee.useRef(n),W=ee.useRef(u),z=()=>W.current,ke=()=>z().isVisible()&&z().isOnline(),[ye,Ee,Ke,Je]=th(p,ce),H=ee.useRef({}).current,Ie=Ze(L)?u.fallback[ce]:L,nt=(et,tt)=>{for(const ft in H){const ut=ft;if(ut==="data"){if(!v(et[ut],tt[ut])&&(!Ze(et[ut])||!v(Mr,tt[ut])))return!1}else if(tt[ut]!==et[ut])return!1}return!0},Qe=ee.useMemo(()=>{const et=(()=>!ce||!n?!1:Ze(C)?z().isPaused()||T?!1:Ze(M)?!0:M:C)(),tt=gt=>{const jt=Ii(gt);return delete jt._k,et?{isValidating:!0,isLoading:!0,...jt}:jt},ft=ye(),ut=Je(),qt=tt(ft),br=ft===ut?qt:tt(ut);let pt=qt;return[()=>{const gt=tt(ye());return nt(gt,pt)?(pt.data=gt.data,pt.isLoading=gt.isLoading,pt.isValidating=gt.isValidating,pt.error=gt.error,pt):(pt=gt,gt)},()=>br]},[p,ce]),Mt=km.useSyncExternalStore(ee.useCallback(et=>Ke(ce,(tt,ft)=>{nt(ft,tt)||et()}),[p,ce]),Qe[0],Qe[1]),xr=!xe.current,Zt=j[ce]&&j[ce].length>0,Re=Mt.data,st=Ze(Re)?Ie:Re,Kt=Mt.error,Zr=ee.useRef(st),Mr=Z?Ze(Re)?Zr.current:Re:st,Ci=(()=>Zt&&!Ze(Kt)?!1:xr&&!Ze(C)?C:z().isPaused()?!1:T?Ze(st)?!1:M:Ze(st)||M)(),Wi=!!(ce&&n&&xr&&Ci),xi=Ze(Mt.isValidating)?Wi:Mt.isValidating,Cn=Ze(Mt.isLoading)?Wi:Mt.isLoading,Pr=ee.useCallback(async et=>{const tt=se.current;if(!ce||!tt||le.current||z().isPaused())return!1;let ft,ut,qt=!0;const br=et||{},pt=!ae[ce]||!br.dedupe,gt=()=>gd?!le.current&&ce===w.current&&xe.current:ce===w.current,jt={isValidating:!1,isLoading:!1},ur=()=>{Ee(jt)},Jr=()=>{const Pt=ae[ce];Pt&&Pt[1]===ut&&delete ae[ce]},hi={isValidating:!0};Ze(ye().data)&&(hi.isLoading=!0);try{if(pt&&(Ee(hi),u.loadingTimeout&&Ze(ye().data)&&setTimeout(()=>{qt&&gt()&&z().onLoadingSlow(ce,u)},u.loadingTimeout),ae[ce]=[tt(pe),Ml()]),[ft,ut]=ae[ce],ft=await ft,pt&&setTimeout(Jr,u.dedupingInterval),!ae[ce]||ae[ce][1]!==ut)return pt&&gt()&&z().onDiscarded(ce),!1;jt.error=gr;const Pt=re[ce];if(!Ze(Pt)&&(ut<=Pt[0]||ut<=Pt[1]||Pt[1]===0))return ur(),pt&&gt()&&z().onDiscarded(ce),!1;const Nt=ye().data;jt.data=v(Nt,ft)?Nt:ft,pt&&gt()&&z().onSuccess(ft,ce,u)}catch(Pt){Jr();const Nt=z(),{shouldRetryOnError:Or}=Nt;Nt.isPaused()||(jt.error=Pt,pt&&gt()&&(Nt.onError(Pt,ce,Nt),(Or===!0||ui(Or)&&Or(Pt))&&ke()&&Nt.onErrorRetry(Pt,ce,Nt,xn=>{const fi=j[ce];fi&&fi[0]&&fi[0](ea.ERROR_REVALIDATE_EVENT,xn)},{retryCount:(br.retryCount||0)+1,dedupe:!0})))}return qt=!1,ur(),!0},[ce,p]),ot=ee.useCallback((...et)=>ah(p,w.current,...et),[]);if(ol(()=>{se.current=n,W.current=u,Ze(Re)||(Zr.current=Re)}),ol(()=>{if(!ce)return;const et=Pr.bind(gr,ul);let tt=0;const ut=Mv(ce,j,(qt,br={})=>{if(qt==ea.FOCUS_EVENT){const pt=Date.now();z().revalidateOnFocus&&pt>tt&&ke()&&(tt=pt+z().focusThrottleInterval,et())}else if(qt==ea.RECONNECT_EVENT)z().revalidateOnReconnect&&ke()&&et();else{if(qt==ea.MUTATE_EVENT)return Pr();if(qt==ea.ERROR_REVALIDATE_EVENT)return Pr(br)}});return le.current=!1,w.current=ce,xe.current=!0,Ee({_k:pe}),Ci&&(Ze(st)||Ta?et():vv(et)),()=>{le.current=!0,ut()}},[ce]),ol(()=>{let et;function tt(){const ut=ui(V)?V(ye().data):V;ut&&et!==-1&&(et=setTimeout(ft,ut))}function ft(){!ye().error&&(G||z().isVisible())&&(Y||z().isOnline())?Pr(ul).then(tt):tt()}return tt(),()=>{et&&(clearTimeout(et),et=-1)}},[V,G,Y,ce]),ee.useDebugValue(Mr),T&&Ze(st)&&ce){if(!gd&&Ta)throw new Error("Fallback data is required when using suspense in SSR.");se.current=n,W.current=u,le.current=!1;const et=ue[ce];if(!Ze(et)){const tt=ot(et);bd(tt)}if(Ze(Kt)){const tt=Pr(ul);Ze(Mr)||(tt.status="fulfilled",tt.value=!0),bd(tt)}else throw Kt}return{mutate:ot,get data(){return H.data=!0,Mr},get error(){return H.error=!0,Kt},get isValidating(){return H.isValidating=!0,xi},get isLoading(){return H.isLoading=!0,Cn}}},Ov=xv(Pv);var Fv=Object.create,lh=Object.defineProperty,Nv=Object.getOwnPropertyDescriptor,Uv=Object.getOwnPropertyNames,Bv=Object.getPrototypeOf,Gv=Object.prototype.hasOwnProperty,wa=(o,n)=>()=>(n||o((n={exports:{}}).exports,n),n.exports),Hv=(o,n,u,p)=>{if(n&&typeof n=="object"||typeof n=="function")for(let v of Uv(n))!Gv.call(o,v)&&v!==u&&lh(o,v,{get:()=>n[v],enumerable:!(p=Nv(n,v))||p.enumerable});return o},Vv=(o,n,u)=>(u=o!=null?Fv(Bv(o)):{},Hv(n||!o||!o.__esModule?lh(u,"default",{value:o,enumerable:!0}):u,o)),Kv=wa((o,n)=>{var u;typeof window<"u"?u=window:typeof global<"u"?u=global:typeof self<"u"?u=self:u={},n.exports=u}),qv=wa((o,n)=>{n.exports=p;var u=Object.prototype.toString;function p(v){if(!v)return!1;var T=u.call(v);return T==="[object Function]"||typeof v=="function"&&T!=="[object RegExp]"||typeof window<"u"&&(v===window.setTimeout||v===window.alert||v===window.confirm||v===window.prompt)}}),jv=wa((o,n)=>{var u=function(v){return v.replace(/^\s+|\s+$/g,"")},p=function(v){return Object.prototype.toString.call(v)==="[object Array]"};n.exports=function(v){if(!v)return{};for(var T={},L=u(v).split(`
`),C=0;C<L.length;C++){var M=L[C],V=M.indexOf(":"),G=u(M.slice(0,V)).toLowerCase(),Y=u(M.slice(V+1));typeof T[G]>"u"?T[G]=Y:p(T[G])?T[G].push(Y):T[G]=[T[G],Y]}return T}}),Wv=wa((o,n)=>{n.exports=p;var u=Object.prototype.hasOwnProperty;function p(){for(var v={},T=0;T<arguments.length;T++){var L=arguments[T];for(var C in L)u.call(L,C)&&(v[C]=L[C])}return v}}),$v=wa((o,n)=>{var u=Kv(),p=qv(),v=jv(),T=Wv();n.exports=V,n.exports.default=V,V.XMLHttpRequest=u.XMLHttpRequest||Z,V.XDomainRequest="withCredentials"in new V.XMLHttpRequest?V.XMLHttpRequest:u.XDomainRequest,L(["get","put","post","patch","head","delete"],function(j){V[j==="delete"?"del":j]=function(re,ae,ue){return ae=M(re,ae,ue),ae.method=j.toUpperCase(),G(ae)}});function L(j,re){for(var ae=0;ae<j.length;ae++)re(j[ae])}function C(j){for(var re in j)if(j.hasOwnProperty(re))return!1;return!0}function M(j,re,ae){var ue=j;return p(re)?(ae=re,typeof j=="string"&&(ue={uri:j})):ue=T(re,{uri:j}),ue.callback=ae,ue}function V(j,re,ae){return re=M(j,re,ae),G(re)}function G(j){if(typeof j.callback>"u")throw new Error("callback argument missing");var re=!1,ae=function(Ie,nt,Qe){re||(re=!0,j.callback(Ie,nt,Qe))};function ue(){le.readyState===4&&setTimeout(xe,0)}function ce(){var Ie=void 0;if(le.response?Ie=le.response:Ie=le.responseText||Y(le),Ke)try{Ie=JSON.parse(Ie)}catch{}return Ie}function pe(Ie){return clearTimeout(Je),Ie instanceof Error||(Ie=new Error(""+(Ie||"Unknown XMLHttpRequest Error"))),Ie.statusCode=0,ae(Ie,H)}function xe(){if(!se){var Ie;clearTimeout(Je),j.useXDR&&le.status===void 0?Ie=200:Ie=le.status===1223?204:le.status;var nt=H,Qe=null;return Ie!==0?(nt={body:ce(),statusCode:Ie,method:z,headers:{},url:W,rawRequest:le},le.getAllResponseHeaders&&(nt.headers=v(le.getAllResponseHeaders()))):Qe=new Error("Internal XMLHttpRequest Error"),ae(Qe,nt,nt.body)}}var le=j.xhr||null;le||(j.cors||j.useXDR?le=new V.XDomainRequest:le=new V.XMLHttpRequest);var w,se,W=le.url=j.uri||j.url,z=le.method=j.method||"GET",ke=j.body||j.data,ye=le.headers=j.headers||{},Ee=!!j.sync,Ke=!1,Je,H={body:void 0,headers:{},statusCode:0,method:z,url:W,rawRequest:le};if("json"in j&&j.json!==!1&&(Ke=!0,ye.accept||ye.Accept||(ye.Accept="application/json"),z!=="GET"&&z!=="HEAD"&&(ye["content-type"]||ye["Content-Type"]||(ye["Content-Type"]="application/json"),ke=JSON.stringify(j.json===!0?ke:j.json))),le.onreadystatechange=ue,le.onload=xe,le.onerror=pe,le.onprogress=function(){},le.onabort=function(){se=!0},le.ontimeout=pe,le.open(z,W,!Ee,j.username,j.password),Ee||(le.withCredentials=!!j.withCredentials),!Ee&&j.timeout>0&&(Je=setTimeout(function(){if(!se){se=!0,le.abort("timeout");var Ie=new Error("XMLHttpRequest timeout");Ie.code="ETIMEDOUT",pe(Ie)}},j.timeout)),le.setRequestHeader)for(w in ye)ye.hasOwnProperty(w)&&le.setRequestHeader(w,ye[w]);else if(j.headers&&!C(j.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in j&&(le.responseType=j.responseType),"beforeSend"in j&&typeof j.beforeSend=="function"&&j.beforeSend(le),le.send(ke||null),le}function Y(j){try{if(j.responseType==="document")return j.responseXML;var re=j.responseXML&&j.responseXML.documentElement.nodeName==="parsererror";if(j.responseType===""&&!re)return j.responseXML}catch{}return null}function Z(){}});function du(o,n,...u){if(!o)throw new TypeError(uh(n,u))}function uh(o,n){let u=0;return o.replace(/%[os]/gu,()=>dh(n[u++]))}function dh(o){return typeof o!="object"||o===null?String(o):Object.prototype.toString.call(o)}var Yv;function zv(o){try{let n=o instanceof Error?o:new Error(dh(o));if(typeof dispatchEvent=="function"&&typeof ErrorEvent=="function")dispatchEvent(new ErrorEvent("error",{error:n,message:n.message}));else if(typeof process<"u"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)}catch{}}var Lr=typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:typeof globalThis<"u"?globalThis:void 0,Qv,Di=class{constructor(n,u){this.code=n,this.message=u}warn(...n){var u;try{let p=((u=new Error().stack)!==null&&u!==void 0?u:"").replace(/^(?:.+?\n){2}/gu,`
`);console.warn(this.message,...n,p)}catch{}}},Xv=new Di("W01","Unable to initialize event under dispatching."),Zv=new Di("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),Jv=new Di("W03","Assigning any truthy value to 'returnValue' property has no effect."),eg=new Di("W04","Unable to preventDefault on non-cancelable events."),tg=new Di("W05","Unable to preventDefault inside passive event listener invocation."),rg=new Di("W06","An event listener wasn't added because it has been added already: %o, %o"),dl=new Di("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),_d=new Di("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),ci=class{static get NONE(){return Td}static get CAPTURING_PHASE(){return Sd}static get AT_TARGET(){return Ad}static get BUBBLING_PHASE(){return wd}constructor(n,u){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let p=u??{};Pl.set(this,{type:String(n),bubbles:!!p.bubbles,cancelable:!!p.cancelable,composed:!!p.composed,target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return _t(this).type}get target(){return _t(this).target}get srcElement(){return _t(this).target}get currentTarget(){return _t(this).currentTarget}composedPath(){let n=_t(this).currentTarget;return n?[n]:[]}get NONE(){return Td}get CAPTURING_PHASE(){return Sd}get AT_TARGET(){return Ad}get BUBBLING_PHASE(){return wd}get eventPhase(){return _t(this).dispatchFlag?2:0}stopPropagation(){_t(this).stopPropagationFlag=!0}get cancelBubble(){return _t(this).stopPropagationFlag}set cancelBubble(n){n?_t(this).stopPropagationFlag=!0:Zv.warn()}stopImmediatePropagation(){let n=_t(this);n.stopPropagationFlag=n.stopImmediatePropagationFlag=!0}get bubbles(){return _t(this).bubbles}get cancelable(){return _t(this).cancelable}get returnValue(){return!_t(this).canceledFlag}set returnValue(n){n?Jv.warn():kd(_t(this))}preventDefault(){kd(_t(this))}get defaultPrevented(){return _t(this).canceledFlag}get composed(){return _t(this).composed}get isTrusted(){return!1}get timeStamp(){return _t(this).timeStamp}initEvent(n,u=!1,p=!1){let v=_t(this);if(v.dispatchFlag){Xv.warn();return}Pl.set(this,{...v,type:String(n),bubbles:!!u,cancelable:!!p,target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}},Td=0,Sd=1,Ad=2,wd=3,Pl=new WeakMap;function _t(o,n="this"){let u=Pl.get(o);return du(u!=null,"'%s' must be an object that Event constructor created, but got another one: %o",n,o),u}function kd(o){if(o.inPassiveListenerFlag){tg.warn();return}if(!o.cancelable){eg.warn();return}o.canceledFlag=!0}Object.defineProperty(ci,"NONE",{enumerable:!0});Object.defineProperty(ci,"CAPTURING_PHASE",{enumerable:!0});Object.defineProperty(ci,"AT_TARGET",{enumerable:!0});Object.defineProperty(ci,"BUBBLING_PHASE",{enumerable:!0});var cl=Object.getOwnPropertyNames(ci.prototype);for(let o=0;o<cl.length;++o)cl[o]!=="constructor"&&Object.defineProperty(ci.prototype,cl[o],{enumerable:!0});typeof Lr<"u"&&typeof Lr.Event<"u"&&Object.setPrototypeOf(ci.prototype,Lr.Event.prototype);function ig(o){return Lr.DOMException?new Lr.DOMException(o,"InvalidStateError"):(gn==null&&(gn=class ch extends Error{constructor(u){super(u),Error.captureStackTrace&&Error.captureStackTrace(this,ch)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(gn.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),Id(gn),Id(gn.prototype)),new gn(o))}var gn,Rd={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function Id(o){let n=Object.keys(Rd);for(let u=0;u<n.length;++u){let p=n[u],v=Rd[p];Object.defineProperty(o,p,{get(){return v},configurable:!0,enumerable:!0})}}var no=class extends ci{static wrap(n){return new(fh(n))(n)}constructor(n){super(n.type,{bubbles:n.bubbles,cancelable:n.cancelable,composed:n.composed}),n.cancelBubble&&super.stopPropagation(),n.defaultPrevented&&super.preventDefault(),hh.set(this,{original:n});let u=Object.keys(n);for(let p=0;p<u.length;++p){let v=u[p];v in this||Object.defineProperty(this,v,ph(n,v))}}stopPropagation(){super.stopPropagation();let{original:n}=_i(this);"stopPropagation"in n&&n.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(n){super.cancelBubble=n;let{original:u}=_i(this);"cancelBubble"in u&&(u.cancelBubble=n)}stopImmediatePropagation(){super.stopImmediatePropagation();let{original:n}=_i(this);"stopImmediatePropagation"in n&&n.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(n){super.returnValue=n;let{original:u}=_i(this);"returnValue"in u&&(u.returnValue=n)}preventDefault(){super.preventDefault();let{original:n}=_i(this);"preventDefault"in n&&n.preventDefault()}get timeStamp(){let{original:n}=_i(this);return"timeStamp"in n?n.timeStamp:super.timeStamp}},hh=new WeakMap;function _i(o){let n=hh.get(o);return du(n!=null,"'this' is expected an Event object, but got",o),n}var $s=new WeakMap;$s.set(Object.prototype,no);typeof Lr<"u"&&typeof Lr.Event<"u"&&$s.set(Lr.Event.prototype,no);function fh(o){let n=Object.getPrototypeOf(o);if(n==null)return no;let u=$s.get(n);return u==null&&(u=ng(fh(n),n),$s.set(n,u)),u}function ng(o,n){class u extends o{}let p=Object.keys(n);for(let v=0;v<p.length;++v)Object.defineProperty(u.prototype,p[v],ph(n,p[v]));return u}function ph(o,n){let u=Object.getOwnPropertyDescriptor(o,n);return{get(){let p=_i(this).original,v=p[n];return typeof v=="function"?v.bind(p):v},set(p){let v=_i(this).original;v[n]=p},configurable:u.configurable,enumerable:u.enumerable}}function ag(o,n,u,p,v,T){return{callback:o,flags:(n?1:0)|(u?2:0)|(p?4:0),signal:v,signalListener:T}}function sg(o){o.flags|=8}function mh(o){return(o.flags&1)===1}function vh(o){return(o.flags&2)===2}function gh(o){return(o.flags&4)===4}function og(o){return(o.flags&8)===8}function lg({callback:o},n,u){try{typeof o=="function"?o.call(n,u):typeof o.handleEvent=="function"&&o.handleEvent(u)}catch(p){zv(p)}}function yh({listeners:o},n,u){for(let p=0;p<o.length;++p)if(o[p].callback===n&&mh(o[p])===u)return p;return-1}function ug(o,n,u,p,v,T){let L;T&&(L=Eh.bind(null,o,n,u),T.addEventListener("abort",L));let C=ag(n,u,p,v,T,L);return o.cow?(o.cow=!1,o.listeners=[...o.listeners,C]):o.listeners.push(C),C}function Eh(o,n,u){let p=yh(o,n,u);return p!==-1?bh(o,p):!1}function bh(o,n,u=!1){let p=o.listeners[n];return sg(p),p.signal&&p.signal.removeEventListener("abort",p.signalListener),o.cow&&!u?(o.cow=!1,o.listeners=o.listeners.filter((v,T)=>T!==n),!1):(o.listeners.splice(n,1),!0)}function dg(){return Object.create(null)}function cg(o,n){var u;return(u=o[n])!==null&&u!==void 0?u:o[n]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}var ao=class{constructor(){_h.set(this,dg())}addEventListener(n,u,p){let v=hl(this),{callback:T,capture:L,once:C,passive:M,signal:V,type:G}=hg(n,u,p);if(T==null||V!=null&&V.aborted)return;let Y=cg(v,G),Z=yh(Y,T,L);if(Z!==-1){pg(Y.listeners[Z],M,C,V);return}ug(Y,T,L,M,C,V)}removeEventListener(n,u,p){let v=hl(this),{callback:T,capture:L,type:C}=fg(n,u,p),M=v[C];T!=null&&M&&Eh(M,T,L)}dispatchEvent(n){let u=hl(this)[String(n.type)];if(u==null)return!0;let p=n instanceof ci?n:no.wrap(n),v=_t(p,"event");if(v.dispatchFlag)throw ig("This event has been in dispatching.");if(v.dispatchFlag=!0,v.target=v.currentTarget=this,!v.stopPropagationFlag){let{cow:T,listeners:L}=u;u.cow=!0;for(let C=0;C<L.length;++C){let M=L[C];if(!og(M)&&(gh(M)&&bh(u,C,!T)&&(C-=1),v.inPassiveListenerFlag=vh(M),lg(M,this,p),v.inPassiveListenerFlag=!1,v.stopImmediatePropagationFlag))break}T||(u.cow=!1)}return v.target=null,v.currentTarget=null,v.stopImmediatePropagationFlag=!1,v.stopPropagationFlag=!1,v.dispatchFlag=!1,!v.canceledFlag}},_h=new WeakMap;function hl(o,n="this"){let u=_h.get(o);return du(u!=null,"'%s' must be an object that EventTarget constructor created, but got another one: %o",n,o),u}function hg(o,n,u){var p;return Th(n),typeof u=="object"&&u!==null?{type:String(o),callback:n??void 0,capture:!!u.capture,passive:!!u.passive,once:!!u.once,signal:(p=u.signal)!==null&&p!==void 0?p:void 0}:{type:String(o),callback:n??void 0,capture:!!u,passive:!1,once:!1,signal:void 0}}function fg(o,n,u){return Th(n),typeof u=="object"&&u!==null?{type:String(o),callback:n??void 0,capture:!!u.capture}:{type:String(o),callback:n??void 0,capture:!!u}}function Th(o){if(!(typeof o=="function"||typeof o=="object"&&o!==null&&typeof o.handleEvent=="function")){if(o==null||typeof o=="object"){_d.warn(o);return}throw new TypeError(uh(_d.message,[o]))}}function pg(o,n,u,p){rg.warn(mh(o)?"capture":"bubble",o.callback),vh(o)!==n&&dl.warn("passive"),gh(o)!==u&&dl.warn("once"),o.signal!==p&&dl.warn("signal")}var fl=Object.getOwnPropertyNames(ao.prototype);for(let o=0;o<fl.length;++o)fl[o]!=="constructor"&&Object.defineProperty(ao.prototype,fl[o],{enumerable:!0});typeof Lr<"u"&&typeof Lr.EventTarget<"u"&&Object.setPrototypeOf(ao.prototype,Lr.EventTarget.prototype);var mg=Vv($v()),Sh=30720,so=512e3,oo=256,Ol=(o,{minChunkSize:n=oo,maxChunkSize:u=so}={})=>o==null||typeof o=="number"&&o>=256&&o%256===0&&o>=n&&o<=u,Fl=(o,{minChunkSize:n=oo,maxChunkSize:u=so}={})=>new TypeError(`chunkSize ${o} must be a positive number in multiples of 256, between ${n} and ${u}`),vg=class{constructor(n,u={}){this.readableStream=n;var p,v,T;if(!Ol(u.defaultChunkSize,u))throw Fl(u.defaultChunkSize,u);this.defaultChunkSize=(p=u.defaultChunkSize)!=null?p:Sh,this.minChunkSize=(v=u.minChunkSize)!=null?v:oo,this.maxChunkSize=(T=u.maxChunkSize)!=null?T:so}get chunkSize(){var n;return(n=this._chunkSize)!=null?n:this.defaultChunkSize}set chunkSize(n){if(!Ol(n,this))throw Fl(n,this);this._chunkSize=n}get chunkByteSize(){return this.chunkSize*1024}async*[Symbol.asyncIterator](){let n,u=this.readableStream.getReader();try{for(;;){let{done:p,value:v}=await u.read();if(p){if(n){let L=n;n=void 0,yield L}break}let T=v instanceof Uint8Array?new Blob([v],{type:"application/octet-stream"}):v;for(n=n?new Blob([n,T]):T;n;)if(n.size===this.chunkByteSize){let L=n;n=void 0,yield L;break}else{if(n.size<this.chunkByteSize)break;{let L=n.slice(0,this.chunkByteSize);n=n.slice(this.chunkByteSize),yield L}}}}finally{if(n){let p=n;n=void 0,yield p}u.releaseLock();return}}},gg=[200,201,202,204,308],Ah=[408,502,503,504],wh=(o,n)=>!!o&&gg.includes(o.statusCode),yg=(o,{retryCodes:n=Ah})=>!o||n.includes(o.statusCode),Eg=(o,n)=>n.attemptCount>=n.attempts||!(wh(o)||yg(o,n)),kh=class{static createUpload(n){return new kh(n)}constructor(n){this.endpoint=n.endpoint,this.file=n.file,this.headers=n.headers||{},this.method=n.method||"PUT",this.attempts=n.attempts||5,this.delayBeforeAttempt=n.delayBeforeAttempt||1,this.retryCodes=n.retryCodes||Ah,this.dynamicChunkSize=n.dynamicChunkSize||!1,this.maxFileBytes=(n.maxFileSize||0)*1024,this.chunkCount=0,this.attemptCount=0,this.offline=!1,this._paused=!1,this.success=!1,this.nextChunkRangeStart=0,this.chunkedStreamIterable=new vg(this.file.stream(),{...n,defaultChunkSize:n.chunkSize}),this.chunkedStreamIterator=this.chunkedStreamIterable[Symbol.asyncIterator](),this.totalChunks=Math.ceil(this.file.size/this.chunkByteSize),this.eventTarget=new ao,this.validateOptions(),this.getEndpoint().then(()=>this.sendChunks()),typeof window<"u"&&(window.addEventListener("online",()=>{!this.offline||(this.offline=!1,this.dispatch("online"),this.sendChunks())}),window.addEventListener("offline",()=>{this.offline=!0,this.dispatch("offline")}))}get maxChunkSize(){var n,u;return(u=(n=this.chunkedStreamIterable)==null?void 0:n.maxChunkSize)!=null?u:so}get minChunkSize(){var n,u;return(u=(n=this.chunkedStreamIterable)==null?void 0:n.minChunkSize)!=null?u:oo}get chunkSize(){var n,u;return(u=(n=this.chunkedStreamIterable)==null?void 0:n.chunkSize)!=null?u:Sh}set chunkSize(n){this.chunkedStreamIterable.chunkSize=n}get chunkByteSize(){return this.chunkedStreamIterable.chunkByteSize}get totalChunkSize(){return Math.ceil(this.file.size/this.chunkByteSize)}on(n,u){this.eventTarget.addEventListener(n,u)}once(n,u){this.eventTarget.addEventListener(n,u,{once:!0})}off(n,u){this.eventTarget.removeEventListener(n,u)}get paused(){return this._paused}abort(){var n;this.pause(),(n=this.currentXhr)==null||n.abort()}pause(){this._paused=!0}resume(){this._paused&&(this._paused=!1,this.sendChunks())}dispatch(n,u){let p=new CustomEvent(n,{detail:u});this.eventTarget.dispatchEvent(p)}validateOptions(){if(!this.endpoint||typeof this.endpoint!="function"&&typeof this.endpoint!="string")throw new TypeError("endpoint must be defined as a string or a function that returns a promise");if(!(this.file instanceof File))throw new TypeError("file must be a File object");if(this.headers&&typeof this.headers!="function"&&typeof this.headers!="object")throw new TypeError("headers must be null, an object, or a function that returns an object or a promise");if(!Ol(this.chunkSize,{maxChunkSize:this.maxChunkSize,minChunkSize:this.minChunkSize}))throw Fl(this.chunkSize,{maxChunkSize:this.maxChunkSize,minChunkSize:this.minChunkSize});if(this.maxChunkSize&&(typeof this.maxChunkSize!="number"||this.maxChunkSize<256||this.maxChunkSize%256!==0||this.maxChunkSize<this.chunkSize||this.maxChunkSize<this.minChunkSize))throw new TypeError(`maxChunkSize must be a positive number in multiples of 256, and larger than or equal to both ${this.minChunkSize} and ${this.chunkSize}`);if(this.minChunkSize&&(typeof this.minChunkSize!="number"||this.minChunkSize<256||this.minChunkSize%256!==0||this.minChunkSize>this.chunkSize||this.minChunkSize>this.maxChunkSize))throw new TypeError(`minChunkSize must be a positive number in multiples of 256, and smaller than ${this.chunkSize} and ${this.maxChunkSize}`);if(this.maxFileBytes>0&&this.maxFileBytes<this.file.size)throw new Error(`file size exceeds maximum (${this.file.size} > ${this.maxFileBytes})`);if(this.attempts&&(typeof this.attempts!="number"||this.attempts<=0))throw new TypeError("retries must be a positive number");if(this.delayBeforeAttempt&&(typeof this.delayBeforeAttempt!="number"||this.delayBeforeAttempt<0))throw new TypeError("delayBeforeAttempt must be a positive number")}getEndpoint(){return typeof this.endpoint=="string"?(this.endpointValue=this.endpoint,Promise.resolve(this.endpoint)):this.endpoint(this.file).then(n=>(this.endpointValue=n,this.endpointValue))}xhrPromise(n){let u=p=>{p.upload.onprogress=v=>{var T;let L=this.totalChunks-this.chunkCount,C=(this.file.size-this.nextChunkRangeStart)/this.file.size/L,M=this.nextChunkRangeStart/this.file.size,V=v.loaded/((T=v.total)!=null?T:this.chunkByteSize)*C;this.dispatch("progress",Math.min((M+V)*100,100))}};return new Promise((p,v)=>{this.currentXhr=(0,mg.default)({...n,beforeSend:u},(T,L)=>(this.currentXhr=void 0,T?v(T):p(L)))})}async sendChunk(n){let u=this.nextChunkRangeStart,p=u+n.size-1,v={...await(typeof this.headers=="function"?this.headers():this.headers),"Content-Type":this.file.type,"Content-Range":`bytes ${u}-${p}/${this.file.size}`};return this.dispatch("attempt",{chunkNumber:this.chunkCount,totalChunks:this.totalChunks,chunkSize:this.chunkSize}),this.xhrPromise({headers:v,url:this.endpointValue,method:this.method,body:n})}async sendChunkWithRetries(n){let u=async(C,M)=>{var V;let G=(new Date().getTime()-this.lastChunkStart.getTime())/1e3;if(this.dispatch("chunkSuccess",{chunk:this.chunkCount,chunkSize:this.chunkSize,attempts:this.attemptCount,timeInterval:G,response:C}),this.attemptCount=0,this.chunkCount=((V=this.chunkCount)!=null?V:0)+1,this.nextChunkRangeStart=this.nextChunkRangeStart+this.chunkByteSize,this.dynamicChunkSize){let Y=this.chunkSize;G<10?Y=Math.min(this.chunkSize*2,this.maxChunkSize):G>30&&(Y=Math.max(this.chunkSize/2,this.minChunkSize)),this.chunkSize=Math.ceil(Y/256)*256;let Z=(this.file.size-this.nextChunkRangeStart)/this.chunkByteSize;this.totalChunks=Math.ceil(this.chunkCount+Z)}return!0},p=async(C,M)=>(this.dispatch("error",{message:`Server responded with ${C.statusCode}. Stopping upload.`,chunk:this.chunkCount,attempts:this.attemptCount}),!1),v=async(C,M)=>(this.dispatch("attemptFailure",{message:`An error occured uploading chunk ${this.chunkCount}. ${this.attempts-this.attemptCount} retries left.`,chunkNumber:this.chunkCount,attemptsLeft:this.attempts-this.attemptCount}),new Promise(V=>{setTimeout(async()=>{if(this._paused||this.offline){this.pendingChunk=n,V(!1);return}let G=await this.sendChunkWithRetries(n);V(G)},this.delayBeforeAttempt*1e3)})),T;try{this.attemptCount=this.attemptCount+1,this.lastChunkStart=new Date,T=await this.sendChunk(n)}catch{}let L={retryCodes:this.retryCodes,attemptCount:this.attemptCount,attempts:this.attempts};return wh(T)?u(T):Eg(T,L)?p(T):v()}async sendChunks(){if(this.pendingChunk&&!(this._paused||this.offline)){let n=this.pendingChunk;this.pendingChunk=void 0;let u=await this.sendChunkWithRetries(n);this.success&&u&&this.dispatch("success")}for(;!(this.success||this._paused||this.offline);){let{value:n,done:u}=await this.chunkedStreamIterator.next(),p=!n&&u;if(n&&(p=await this.sendChunkWithRetries(n)),this.success=!!u,this.success&&p&&this.dispatch("success"),!p)return}}},bg=kh.createUpload;function _g(o,n){o.indexOf(n)===-1&&o.push(n)}const Rh=(o,n,u)=>Math.min(Math.max(u,o),n),yr={duration:.3,delay:0,endDelay:0,repeat:0,easing:"ease"},Ys=o=>typeof o=="number",wn=o=>Array.isArray(o)&&!Ys(o[0]),Tg=(o,n,u)=>{const p=n-o;return((u-o)%p+p)%p+o};function Sg(o,n){return wn(o)?o[Tg(0,o.length,n)]:o}const Ih=(o,n,u)=>-u*o+u*n+o,Lh=()=>{},ki=o=>o,cu=(o,n,u)=>n-o===0?1:(u-o)/(n-o);function Dh(o,n){const u=o[o.length-1];for(let p=1;p<=n;p++){const v=cu(0,n,p);o.push(Ih(u,1,v))}}function Ag(o){const n=[0];return Dh(n,o-1),n}function wg(o,n=Ag(o.length),u=ki){const p=o.length,v=p-n.length;return v>0&&Dh(n,v),T=>{let L=0;for(;L<p-2&&!(T<n[L+1]);L++);let C=Rh(0,1,cu(n[L],n[L+1],T));return C=Sg(u,L)(C),Ih(o[L],o[L+1],C)}}const Ch=o=>Array.isArray(o)&&Ys(o[0]),Nl=o=>typeof o=="object"&&!!o.createAnimation,In=o=>typeof o=="function",kg=o=>typeof o=="string",ma={ms:o=>o*1e3,s:o=>o/1e3},xh=(o,n,u)=>(((1-3*u+3*n)*o+(3*u-6*n))*o+3*n)*o,Rg=1e-7,Ig=12;function Lg(o,n,u,p,v){let T,L,C=0;do L=n+(u-n)/2,T=xh(L,p,v)-o,T>0?u=L:n=L;while(Math.abs(T)>Rg&&++C<Ig);return L}function na(o,n,u,p){if(o===n&&u===p)return ki;const v=T=>Lg(T,0,1,o,u);return T=>T===0||T===1?T:xh(v(T),n,p)}const Dg=(o,n="end")=>u=>{u=n==="end"?Math.min(u,.999):Math.max(u,.001);const p=u*o,v=n==="end"?Math.floor(p):Math.ceil(p);return Rh(0,1,v/o)},Ld={ease:na(.25,.1,.25,1),"ease-in":na(.42,0,1,1),"ease-in-out":na(.42,0,.58,1),"ease-out":na(0,0,.58,1)},Cg=/\((.*?)\)/;function Dd(o){if(In(o))return o;if(Ch(o))return na(...o);if(Ld[o])return Ld[o];if(o.startsWith("steps")){const n=Cg.exec(o);if(n){const u=n[1].split(",");return Dg(parseFloat(u[0]),u[1].trim())}}return ki}class Mh{constructor(n,u=[0,1],{easing:p,duration:v=yr.duration,delay:T=yr.delay,endDelay:L=yr.endDelay,repeat:C=yr.repeat,offset:M,direction:V="normal"}={}){if(this.startTime=null,this.rate=1,this.t=0,this.cancelTimestamp=null,this.easing=ki,this.duration=0,this.totalDuration=0,this.repeat=0,this.playState="idle",this.finished=new Promise((Y,Z)=>{this.resolve=Y,this.reject=Z}),p=p||yr.easing,Nl(p)){const Y=p.createAnimation(u);p=Y.easing,u=Y.keyframes||u,v=Y.duration||v}this.repeat=C,this.easing=wn(p)?ki:Dd(p),this.updateDuration(v);const G=wg(u,M,wn(p)?p.map(Dd):ki);this.tick=Y=>{var Z;T=T;let j=0;this.pauseTime!==void 0?j=this.pauseTime:j=(Y-this.startTime)*this.rate,this.t=j,j/=1e3,j=Math.max(j-T,0),this.playState==="finished"&&this.pauseTime===void 0&&(j=this.totalDuration);const re=j/this.duration;let ae=Math.floor(re),ue=re%1;!ue&&re>=1&&(ue=1),ue===1&&ae--;const ce=ae%2;(V==="reverse"||V==="alternate"&&ce||V==="alternate-reverse"&&!ce)&&(ue=1-ue);const pe=j>=this.totalDuration?1:Math.min(ue,1),xe=G(this.easing(pe));n(xe),this.pauseTime===void 0&&(this.playState==="finished"||j>=this.totalDuration+L)?(this.playState="finished",(Z=this.resolve)===null||Z===void 0||Z.call(this,xe)):this.playState!=="idle"&&(this.frameRequestId=requestAnimationFrame(this.tick))},this.play()}play(){const n=performance.now();this.playState="running",this.pauseTime!==void 0?this.startTime=n-this.pauseTime:this.startTime||(this.startTime=n),this.cancelTimestamp=this.startTime,this.pauseTime=void 0,this.frameRequestId=requestAnimationFrame(this.tick)}pause(){this.playState="paused",this.pauseTime=this.t}finish(){this.playState="finished",this.tick(0)}stop(){var n;this.playState="idle",this.frameRequestId!==void 0&&cancelAnimationFrame(this.frameRequestId),(n=this.reject)===null||n===void 0||n.call(this,!1)}cancel(){this.stop(),this.tick(this.cancelTimestamp)}reverse(){this.rate*=-1}commitStyles(){}updateDuration(n){this.duration=n,this.totalDuration=n*(this.repeat+1)}get currentTime(){return this.t}set currentTime(n){this.pauseTime!==void 0||this.rate===0?this.pauseTime=n:this.startTime=performance.now()-n/this.rate}get playbackRate(){return this.rate}set playbackRate(n){this.rate=n}}class xg{setAnimation(n){this.animation=n,n==null||n.finished.then(()=>this.clearAnimation()).catch(()=>{})}clearAnimation(){this.animation=this.generator=void 0}}const pl=new WeakMap;function Ph(o){return pl.has(o)||pl.set(o,{transforms:[],values:new Map}),pl.get(o)}function Mg(o,n){return o.has(n)||o.set(n,new xg),o.get(n)}const Pg=["","X","Y","Z"],Og=["translate","scale","rotate","skew"],zs={x:"translateX",y:"translateY",z:"translateZ"},Cd={syntax:"<angle>",initialValue:"0deg",toDefaultUnit:o=>o+"deg"},Fg={translate:{syntax:"<length-percentage>",initialValue:"0px",toDefaultUnit:o=>o+"px"},rotate:Cd,scale:{syntax:"<number>",initialValue:1,toDefaultUnit:ki},skew:Cd},Sa=new Map,hu=o=>`--motion-${o}`,Qs=["x","y","z"];Og.forEach(o=>{Pg.forEach(n=>{Qs.push(o+n),Sa.set(hu(o+n),Fg[o])})});const Ng=(o,n)=>Qs.indexOf(o)-Qs.indexOf(n),Ug=new Set(Qs),Oh=o=>Ug.has(o),Bg=(o,n)=>{zs[n]&&(n=zs[n]);const{transforms:u}=Ph(o);_g(u,n),o.style.transform=Gg(u)},Gg=o=>o.sort(Ng).reduce(Hg,"").trim(),Hg=(o,n)=>`${o} ${n}(var(${hu(n)}))`,Ul=o=>o.startsWith("--"),xd=new Set;function Vg(o){if(!xd.has(o)){xd.add(o);try{const{syntax:n,initialValue:u}=Sa.has(o)?Sa.get(o):{};CSS.registerProperty({name:o,inherits:!1,syntax:n,initialValue:u})}catch{}}}const ml=(o,n)=>document.createElement("div").animate(o,n),Md={cssRegisterProperty:()=>typeof CSS<"u"&&Object.hasOwnProperty.call(CSS,"registerProperty"),waapi:()=>Object.hasOwnProperty.call(Element.prototype,"animate"),partialKeyframes:()=>{try{ml({opacity:[1]})}catch{return!1}return!0},finished:()=>!!ml({opacity:[0,1]},{duration:.001}).finished,linearEasing:()=>{try{ml({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0}},vl={},Tn={};for(const o in Md)Tn[o]=()=>(vl[o]===void 0&&(vl[o]=Md[o]()),vl[o]);const Kg=.015,qg=(o,n)=>{let u="";const p=Math.round(n/Kg);for(let v=0;v<p;v++)u+=o(cu(0,p-1,v))+", ";return u.substring(0,u.length-2)},Pd=(o,n)=>In(o)?Tn.linearEasing()?`linear(${qg(o,n)})`:yr.easing:Ch(o)?jg(o):o,jg=([o,n,u,p])=>`cubic-bezier(${o}, ${n}, ${u}, ${p})`;function Wg(o,n){for(let u=0;u<o.length;u++)o[u]===null&&(o[u]=u?o[u-1]:n());return o}const $g=o=>Array.isArray(o)?o:[o];function Bl(o){return zs[o]&&(o=zs[o]),Oh(o)?hu(o):o}const ps={get:(o,n)=>{n=Bl(n);let u=Ul(n)?o.style.getPropertyValue(n):getComputedStyle(o)[n];if(!u&&u!==0){const p=Sa.get(n);p&&(u=p.initialValue)}return u},set:(o,n,u)=>{n=Bl(n),Ul(n)?o.style.setProperty(n,u):o.style[n]=u}};function Fh(o,n=!0){if(!(!o||o.playState==="finished"))try{o.stop?o.stop():(n&&o.commitStyles(),o.cancel())}catch{}}function Yg(o,n){var u;let p=(n==null?void 0:n.toDefaultUnit)||ki;const v=o[o.length-1];if(kg(v)){const T=((u=v.match(/(-?[\d.]+)([a-z%]*)/))===null||u===void 0?void 0:u[2])||"";T&&(p=L=>L+T)}return p}function zg(){return window.__MOTION_DEV_TOOLS_RECORD}function Qg(o,n,u,p={},v){const T=zg(),L=p.record!==!1&&T;let C,{duration:M=yr.duration,delay:V=yr.delay,endDelay:G=yr.endDelay,repeat:Y=yr.repeat,easing:Z=yr.easing,persist:j=!1,direction:re,offset:ae,allowWebkitAcceleration:ue=!1}=p;const ce=Ph(o),pe=Oh(n);let xe=Tn.waapi();pe&&Bg(o,n);const le=Bl(n),w=Mg(ce.values,le),se=Sa.get(le);return Fh(w.animation,!(Nl(Z)&&w.generator)&&p.record!==!1),()=>{const W=()=>{var ye,Ee;return(Ee=(ye=ps.get(o,le))!==null&&ye!==void 0?ye:se==null?void 0:se.initialValue)!==null&&Ee!==void 0?Ee:0};let z=Wg($g(u),W);const ke=Yg(z,se);if(Nl(Z)){const ye=Z.createAnimation(z,n!=="opacity",W,le,w);Z=ye.easing,z=ye.keyframes||z,M=ye.duration||M}if(Ul(le)&&(Tn.cssRegisterProperty()?Vg(le):xe=!1),pe&&!Tn.linearEasing()&&(In(Z)||wn(Z)&&Z.some(In))&&(xe=!1),xe){se&&(z=z.map(Ke=>Ys(Ke)?se.toDefaultUnit(Ke):Ke)),z.length===1&&(!Tn.partialKeyframes()||L)&&z.unshift(W());const ye={delay:ma.ms(V),duration:ma.ms(M),endDelay:ma.ms(G),easing:wn(Z)?void 0:Pd(Z,M),direction:re,iterations:Y+1,fill:"both"};C=o.animate({[le]:z,offset:ae,easing:wn(Z)?Z.map(Ke=>Pd(Ke,M)):void 0},ye),C.finished||(C.finished=new Promise((Ke,Je)=>{C.onfinish=Ke,C.oncancel=Je}));const Ee=z[z.length-1];C.finished.then(()=>{j||(ps.set(o,le,Ee),C.cancel())}).catch(Lh),ue||(C.playbackRate=1.000001)}else if(v&&pe)z=z.map(ye=>typeof ye=="string"?parseFloat(ye):ye),z.length===1&&z.unshift(parseFloat(W())),C=new v(ye=>{ps.set(o,le,ke?ke(ye):ye)},z,Object.assign(Object.assign({},p),{duration:M,easing:Z}));else{const ye=z[z.length-1];ps.set(o,le,se&&Ys(ye)?se.toDefaultUnit(ye):ye)}return L&&T(o,n,z,{duration:M,delay:V,easing:Z,repeat:Y,offset:ae},"motion-one"),w.setAnimation(C),C}}const Xg=(o,n)=>o[n]?Object.assign(Object.assign({},o),o[n]):Object.assign({},o);function Zg(o,n){var u;return typeof o=="string"?n?((u=n[o])!==null&&u!==void 0||(n[o]=document.querySelectorAll(o)),o=n[o]):o=document.querySelectorAll(o):o instanceof Element&&(o=[o]),Array.from(o||[])}const Jg=o=>o(),Nh=(o,n,u=yr.duration)=>new Proxy({animations:o.map(Jg).filter(Boolean),duration:u,options:n},ty),ey=o=>o.animations[0],ty={get:(o,n)=>{const u=ey(o);switch(n){case"duration":return o.duration;case"currentTime":return ma.s((u==null?void 0:u[n])||0);case"playbackRate":case"playState":return u==null?void 0:u[n];case"finished":return o.finished||(o.finished=Promise.all(o.animations.map(ry)).catch(Lh)),o.finished;case"stop":return()=>{o.animations.forEach(p=>Fh(p))};case"forEachNative":return p=>{o.animations.forEach(v=>p(v,o))};default:return typeof(u==null?void 0:u[n])>"u"?void 0:()=>o.animations.forEach(p=>p[n]())}},set:(o,n,u)=>{switch(n){case"currentTime":u=ma.ms(u);case"currentTime":case"playbackRate":for(let p=0;p<o.animations.length;p++)o.animations[p][n]=u;return!0}return!1}},ry=o=>o.finished;function iy(o,n,u){return In(o)?o(n,u):o}function ny(o){return function(u,p,v={}){u=Zg(u);const T=u.length,L=[];for(let C=0;C<T;C++){const M=u[C];for(const V in p){const G=Xg(v,V);G.delay=iy(G.delay,C,T);const Y=Qg(M,V,p[V],G,o);L.push(Y)}}return Nh(L,v,v.duration)}}const ay=ny(Mh);function sy(o,n={}){return Nh([()=>{const u=new Mh(o,[0,1],n);return u.finished.catch(()=>{}),u}],n,n.duration)}function Od(o,n,u){return(In(o)?sy:ay)(o,n,u)}const Ve={MEDIA_PLAY_REQUEST:"mediaplayrequest",MEDIA_PAUSE_REQUEST:"mediapauserequest",MEDIA_MUTE_REQUEST:"mediamuterequest",MEDIA_UNMUTE_REQUEST:"mediaunmuterequest",MEDIA_VOLUME_REQUEST:"mediavolumerequest",MEDIA_SEEK_REQUEST:"mediaseekrequest",MEDIA_AIRPLAY_REQUEST:"mediaairplayrequest",MEDIA_ENTER_FULLSCREEN_REQUEST:"mediaenterfullscreenrequest",MEDIA_EXIT_FULLSCREEN_REQUEST:"mediaexitfullscreenrequest",MEDIA_PREVIEW_REQUEST:"mediapreviewrequest",MEDIA_ENTER_PIP_REQUEST:"mediaenterpiprequest",MEDIA_EXIT_PIP_REQUEST:"mediaexitpiprequest",MEDIA_ENTER_CAST_REQUEST:"mediaentercastrequest",MEDIA_EXIT_CAST_REQUEST:"mediaexitcastrequest",MEDIA_SHOW_TEXT_TRACKS_REQUEST:"mediashowtexttracksrequest",MEDIA_HIDE_TEXT_TRACKS_REQUEST:"mediahidetexttracksrequest",MEDIA_SHOW_CAPTIONS_REQUEST:"mediashowcaptionsrequest",MEDIA_SHOW_SUBTITLES_REQUEST:"mediashowsubtitlesrequest",MEDIA_DISABLE_CAPTIONS_REQUEST:"mediadisablecaptionsrequest",MEDIA_DISABLE_SUBTITLES_REQUEST:"mediadisablesubtitlesrequest",MEDIA_PLAYBACK_RATE_REQUEST:"mediaplaybackraterequest",MEDIA_SEEK_TO_LIVE_REQUEST:"mediaseektoliverequest",REGISTER_MEDIA_STATE_RECEIVER:"registermediastatereceiver",UNREGISTER_MEDIA_STATE_RECEIVER:"unregistermediastatereceiver"},Xs={MEDIA_AIRPLAY_UNAVAILABLE:"mediaairplayunavailablechange",MEDIA_PIP_UNAVAILABLE:"mediapipunavailablechange",MEDIA_PAUSED:"mediapausedchange",MEDIA_HAS_PLAYED:"mediahasplayedchange",MEDIA_MUTED:"mediamutedchange",MEDIA_VOLUME_LEVEL:"mediavolumelevelchange",MEDIA_VOLUME:"mediavolumechange",MEDIA_VOLUME_UNAVAILABLE:"mediavolumeunavailablechange",MEDIA_IS_PIP:"mediaispipchange",MEDIA_IS_CASTING:"mediaiscastingchange",MEDIA_CAPTIONS_LIST:"mediacaptionslistchange",MEDIA_SUBTITLES_LIST:"mediasubtitleslistchange",MEDIA_CAPTIONS_SHOWING:"mediacaptionsshowingchange",MEDIA_SUBTITLES_SHOWING:"mediasubtitlesshowingchange",MEDIA_IS_FULLSCREEN:"mediaisfullscreenchange",MEDIA_PLAYBACK_RATE:"mediaplaybackratechange",MEDIA_CURRENT_TIME:"mediacurrenttimechange",MEDIA_DURATION:"mediadurationchange",MEDIA_SEEKABLE:"mediaseekablechange",MEDIA_PREVIEW_IMAGE:"mediapreviewimagechange",MEDIA_PREVIEW_COORDS:"mediapreviewcoordschange",MEDIA_LOADING:"medialoadingchange",USER_INACTIVE:"userinactivechange"},ht={MEDIA_CHROME_ATTRIBUTES:"media-chrome-attributes",MEDIA_CONTROLLER:"media-controller"},N={MEDIA_AIRPLAY_UNAVAILABLE:"media-airplay-unavailable",MEDIA_FULLSCREEN_UNAVAILABLE:"media-fullscreen-unavailable",MEDIA_PIP_UNAVAILABLE:"media-pip-unavailable",MEDIA_CAST_UNAVAILABLE:"media-cast-unavailable",MEDIA_PAUSED:"media-paused",MEDIA_HAS_PLAYED:"media-has-played",MEDIA_MUTED:"media-muted",MEDIA_VOLUME_LEVEL:"media-volume-level",MEDIA_VOLUME:"media-volume",MEDIA_VOLUME_UNAVAILABLE:"media-volume-unavailable",MEDIA_IS_PIP:"media-is-pip",MEDIA_IS_CASTING:"media-is-casting",MEDIA_CAPTIONS_LIST:"media-captions-list",MEDIA_SUBTITLES_LIST:"media-subtitles-list",MEDIA_CAPTIONS_SHOWING:"media-captions-showing",MEDIA_SUBTITLES_SHOWING:"media-subtitles-showing",MEDIA_IS_FULLSCREEN:"media-is-fullscreen",MEDIA_PLAYBACK_RATE:"media-playback-rate",MEDIA_CURRENT_TIME:"media-current-time",MEDIA_DURATION:"media-duration",MEDIA_SEEKABLE:"media-seekable",MEDIA_PREVIEW_TIME:"media-preview-time",MEDIA_PREVIEW_IMAGE:"media-preview-image",MEDIA_PREVIEW_COORDS:"media-preview-coords",MEDIA_LOADING:"media-loading",MEDIA_BUFFERED:"media-buffered",MEDIA_STREAM_TYPE:"media-stream-type",MEDIA_TARGET_LIVE_WINDOW:"media-target-live-window",MEDIA_TIME_IS_LIVE:"media-time-is-live"};Object.entries(Xs).reduce((o,[n,u])=>{const p=N[n];return p&&(o[u]=p),o},{userinactivechange:"user-inactive"});const oy=Object.entries(N).reduce((o,[n,u])=>{const p=Xs[n];return p&&(o[u]=p),o},{"user-inactive":"userinactivechange"}),ka={SUBTITLES:"subtitles",CAPTIONS:"captions",DESCRIPTIONS:"descriptions",CHAPTERS:"chapters",METADATA:"metadata"},Sn={DISABLED:"disabled",HIDDEN:"hidden",SHOWING:"showing"},Fd={MOUSE:"mouse",PEN:"pen",TOUCH:"touch"},Vr={UNAVAILABLE:"unavailable",UNSUPPORTED:"unsupported"},zr={LIVE:"live",ON_DEMAND:"on-demand",UNKNOWN:"unknown"},Li={AUDIO_PLAYER:()=>"audio player",VIDEO_PLAYER:()=>"video player",VOLUME:()=>"volume",SEEK:()=>"seek",CLOSED_CAPTIONS:()=>"closed captions",PLAYBACK_RATE:({playbackRate:o=1}={})=>`current playback rate ${o}`,PLAYBACK_TIME:()=>"playback time",MEDIA_LOADING:()=>"media loading"},lr={PLAY:()=>"play",PAUSE:()=>"pause",MUTE:()=>"mute",UNMUTE:()=>"unmute",AIRPLAY:()=>"air play",ENTER_CAST:()=>"start casting",EXIT_CAST:()=>"stop casting",ENTER_FULLSCREEN:()=>"enter fullscreen mode",EXIT_FULLSCREEN:()=>"exit fullscreen mode",ENTER_PIP:()=>"enter picture in picture mode",EXIT_PIP:()=>"exit picture in picture mode",SEEK_FORWARD_N_SECS:({seekOffset:o=30}={})=>`seek forward ${o} seconds`,SEEK_BACK_N_SECS:({seekOffset:o=30}={})=>`seek back ${o} seconds`};function gl(o,n=!1){return o.split("_").map(function(u,p){return(p||n?u[0].toUpperCase():u[0].toLowerCase())+u.slice(1).toLowerCase()}).join("")}function ly(o){return typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o)}const Nd=[{singular:"hour",plural:"hours"},{singular:"minute",plural:"minutes"},{singular:"second",plural:"seconds"}],uy=(o,n)=>{const u=o===1?Nd[n].singular:Nd[n].plural;return`${o} ${u}`},va=o=>{if(!ly(o))return"";const n=Math.abs(o),u=n!==o,p=new Date(0,0,0,0,0,n,0);return`${[p.getHours(),p.getMinutes(),p.getSeconds()].map((C,M)=>C&&uy(C,M)).filter(C=>C).join(", ")}${u?" remaining":""}`};function di(o,n){let u=!1;o<0&&(u=!0,o=0-o),o=o<0?0:o;let p=Math.floor(o%60),v=Math.floor(o/60%60),T=Math.floor(o/3600);const L=Math.floor(n/60%60),C=Math.floor(n/3600);return(isNaN(o)||o===1/0)&&(T=v=p="-"),T=T>0||C>0?T+":":"",v=((T||L>=10)&&v<10?"0"+v:v)+":",p=p<10?"0"+p:p,(u?"-":"")+T+v+p}const Uh=(o,n,u=".value")=>{const p=o.querySelector(u);p&&(p.textContent=n)},dy=(o,n)=>{const u=`slot[name="${n}"]`,p=o.shadowRoot.querySelector(u);return p?p.children:[]},Bh=(o,n)=>dy(o,n)[0],xs=(o,n)=>!o||!n?!1:o.contains(n)?!0:xs(o,n.getRootNode().host),fu=(o,n)=>{if(!o)return null;const u=o.closest(n);return u||fu(o.getRootNode().host,n)};function Er(o,n){var u;let p;for(p of o.querySelectorAll("style")){let v;try{v=(u=p.sheet)==null?void 0:u.cssRules}catch{continue}for(let T of v??[])if(T.selectorText===n)return T}return p!=null&&p.sheet?(p.sheet.insertRule(`${n}{}`,p.sheet.cssRules.length),p.sheet.cssRules[p.sheet.cssRules.length-1]):{style:{setProperty:()=>{},removeProperty:()=>{}}}}class Ud{addEventListener(){}removeEventListener(){}dispatchEvent(){return!0}}let cy=class{observe(){}};const Gh={ResizeObserver:cy,HTMLElement:class extends Ud{},DocumentFragment:class extends Ud{},customElements:{get:function(){},define:function(){},whenDefined:function(){}},CustomEvent:function(){},getComputedStyle:function(){}},hy={createElement:function(){return new Gh.HTMLElement},addEventListener(){},removeEventListener(){}},Hh=typeof window>"u"||typeof window.customElements>"u",ne=Hh?Gh:window,We=Hh?hy:window.document;var fy=Object.defineProperty,py=(o,n,u)=>n in o?fy(o,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):o[n]=u,my=(o,n,u)=>(py(o,typeof n!="symbol"?n+"":n,u),u),Vh=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},vr=(o,n,u)=>(Vh(o,n,"read from private field"),u?u.call(o):n.get(o)),ms=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},vs=(o,n,u,p)=>(Vh(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),Kr,Ms,yn,Ps;const Kh=We.createElement("template");Kh.innerHTML=`
<style>
  :host {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    box-sizing: border-box;
    background: var(--media-control-background, rgba(20,20,30, 0.7));

    padding: var(--media-control-padding, 10px);

    
    font-size: 14px;
    line-height: var(--media-text-content-height, var(--media-control-height, 24px));
    font-weight: bold;
    color: #fff;

    transition: background 0.15s linear;

    pointer-events: auto;
    cursor: pointer;
    font-family: Arial, sans-serif;
  }

  
  :host(:focus-visible) {
    box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    outline: 0;
  }
  
  :host(:where(:focus)) {
    box-shadow: none;
    outline: 0;
  }

  :host(:hover) {
    background: var(--media-control-hover-background, rgba(50,50,70, 0.7));
  }

  svg, img, ::slotted(svg), ::slotted(img) {
    width: var(--media-button-icon-width);
    height: var(--media-button-icon-height, var(--media-control-height, 24px));
    transform: var(--media-button-icon-transform);
    transition: var(--media-button-icon-transition);
    fill: var(--media-icon-color, #eee);
    vertical-align: middle;
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
  }
</style>
`;class qh extends ne.HTMLElement{constructor(n={}){super(),ms(this,Kr,void 0),my(this,"preventClick",!1),ms(this,Ms,T=>{this.preventClick||this.handleClick(T)}),ms(this,yn,T=>{const{key:L}=T;if(!this.keysUsed.includes(L)){this.removeEventListener("keyup",vr(this,yn));return}this.preventClick||this.handleClick(T)}),ms(this,Ps,T=>{const{metaKey:L,altKey:C,key:M}=T;if(L||C||!this.keysUsed.includes(M)){this.removeEventListener("keyup",vr(this,yn));return}this.addEventListener("keyup",vr(this,yn),{once:!0})}),this.attachShadow({mode:"open"});const u=Kh.content.cloneNode(!0);this.nativeEl=u;let p=n.slotTemplate;p||(p=We.createElement("template"),p.innerHTML=`<slot>${n.defaultContent||""}</slot>`),this.nativeEl.appendChild(p.content.cloneNode(!0)),this.shadowRoot.appendChild(u);const{style:v}=Er(this.shadowRoot,":host");v.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-flex))`)}static get observedAttributes(){return["disabled",ht.MEDIA_CONTROLLER]}enable(){this.addEventListener("click",vr(this,Ms)),this.addEventListener("keydown",vr(this,Ps)),this.setAttribute("tabindex","0")}disable(){this.removeEventListener("click",vr(this,Ms)),this.removeEventListener("keydown",vr(this,Ps)),this.removeEventListener("keyup",vr(this,yn)),this.removeAttribute("tabindex")}attributeChangedCallback(n,u,p){var v,T,L,C,M;n===ht.MEDIA_CONTROLLER?(u&&((T=(v=vr(this,Kr))==null?void 0:v.unassociateElement)==null||T.call(v,this),vs(this,Kr,null)),p&&(vs(this,Kr,(L=this.getRootNode())==null?void 0:L.getElementById(p)),(M=(C=vr(this,Kr))==null?void 0:C.associateElement)==null||M.call(C,this))):n==="disabled"&&p!==u&&(p==null?this.enable():this.disable())}connectedCallback(){var n,u,p;this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","button");const v=this.getAttribute(ht.MEDIA_CONTROLLER);v&&(vs(this,Kr,(n=this.getRootNode())==null?void 0:n.getElementById(v)),(p=(u=vr(this,Kr))==null?void 0:u.associateElement)==null||p.call(u,this))}disconnectedCallback(){var n,u;this.disable(),(u=(n=vr(this,Kr))==null?void 0:n.unassociateElement)==null||u.call(n,this),vs(this,Kr,null)}get keysUsed(){return["Enter"," "]}handleClick(n){}}Kr=new WeakMap;Ms=new WeakMap;yn=new WeakMap;Ps=new WeakMap;ne.customElements.get("media-chrome-button")||ne.customElements.define("media-chrome-button",qh);var Cr=qh;const vy=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.13 3H3.87a.87.87 0 0 0-.87.87v13.26a.87.87 0 0 0 .87.87h3.4L9 16H5V5h16v11h-4l1.72 2h3.4a.87.87 0 0 0 .87-.87V3.87a.87.87 0 0 0-.86-.87Zm-8.75 11.44a.5.5 0 0 0-.76 0l-4.91 5.73a.5.5 0 0 0 .38.83h9.82a.501.501 0 0 0 .38-.83l-4.91-5.73Z"/>
</svg>
`,jh=We.createElement("template");jh.innerHTML=`
  <slot name="airplay">${vy}</slot>
`;class gy extends Cr{static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_AIRPLAY_UNAVAILABLE]}constructor(n={}){super({slotTemplate:jh,...n})}connectedCallback(){this.setAttribute("aria-label",lr.AIRPLAY()),super.connectedCallback()}handleClick(){const n=new ne.CustomEvent(Ve.MEDIA_AIRPLAY_REQUEST,{composed:!0,bubbles:!0});this.dispatchEvent(n)}}ne.customElements.get("media-airplay-button")||ne.customElements.define("media-airplay-button",gy);const yy='<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/></g></svg>',Ey='<svg aria-hidden="true" viewBox="0 0 24 24"><g><path class="cast_caf_icon_arch0" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"/><path class="cast_caf_icon_arch1" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"/><path class="cast_caf_icon_arch2" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"/><path class="cast_caf_icon_box" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"/><path class="cast_caf_icon_boxfill" d="M5,7 L5,8.63 C8,8.6 13.37,14 13.37,17 L19,17 L19,7 Z"/></g></svg>',Wh=We.createElement("template");Wh.innerHTML=`
  <style>
  :host([${N.MEDIA_IS_CASTING}]) slot:not([name=exit]) > *,
  :host([${N.MEDIA_IS_CASTING}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${N.MEDIA_IS_CASTING}])) slot:not([name=enter]) > *,
  :host(:not([${N.MEDIA_IS_CASTING}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${yy}</slot>
  <slot name="exit">${Ey}</slot>
`;const Bd=o=>{const u=o.getAttribute(N.MEDIA_IS_CASTING)!=null?lr.EXIT_CAST():lr.ENTER_CAST();o.setAttribute("aria-label",u)};class by extends Cr{static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_IS_CASTING,N.MEDIA_CAST_UNAVAILABLE]}constructor(n={}){super({slotTemplate:Wh,...n})}connectedCallback(){Bd(this),super.connectedCallback()}attributeChangedCallback(n,u,p){n===N.MEDIA_IS_CASTING&&Bd(this),super.attributeChangedCallback(n,u,p)}handleClick(){const n=this.getAttribute(N.MEDIA_IS_CASTING)!=null?Ve.MEDIA_EXIT_CAST_REQUEST:Ve.MEDIA_ENTER_CAST_REQUEST;this.dispatchEvent(new ne.CustomEvent(n,{composed:!0,bubbles:!0}))}}ne.customElements.get("media-cast-button")||ne.customElements.define("media-cast-button",by);var $h=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},Ei=(o,n,u)=>($h(o,n,"read from private field"),u?u.call(o):n.get(o)),_y=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},gs=(o,n,u,p)=>($h(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),Qt;const Yh=We.createElement("template");Yh.innerHTML=`
<style>
  :host {
    display: var(--media-control-display, var(--media-gesture-receiver-display, inline-block));
    box-sizing: border-box;
  }
</style>
`;class Ty extends ne.HTMLElement{constructor(n={}){super(),_y(this,Qt,void 0);const u=this.attachShadow({mode:"open"}),p=Yh.content.cloneNode(!0);this.nativeEl=p;let v=n.slotTemplate;v||(v=We.createElement("template"),v.innerHTML=`<slot>${n.defaultContent||""}</slot>`),this.nativeEl.appendChild(v.content.cloneNode(!0)),u.appendChild(p)}static get observedAttributes(){return[ht.MEDIA_CONTROLLER,N.MEDIA_PAUSED]}attributeChangedCallback(n,u,p){var v,T,L,C,M;n===ht.MEDIA_CONTROLLER&&(u&&((T=(v=Ei(this,Qt))==null?void 0:v.unassociateElement)==null||T.call(v,this),gs(this,Qt,null)),p&&(gs(this,Qt,(L=this.getRootNode())==null?void 0:L.getElementById(p)),(M=(C=Ei(this,Qt))==null?void 0:C.associateElement)==null||M.call(C,this)))}connectedCallback(){var n,u,p,v;this.setAttribute("tabindex",-1),this.setAttribute("aria-hidden",!0),gs(this,Qt,Sy(this)),this.getAttribute(ht.MEDIA_CONTROLLER)&&((u=(n=Ei(this,Qt))==null?void 0:n.associateElement)==null||u.call(n,this)),(p=Ei(this,Qt))==null||p.addEventListener("pointerdown",this),(v=Ei(this,Qt))==null||v.addEventListener("click",this)}disconnectedCallback(){var n,u,p,v;this.getAttribute(ht.MEDIA_CONTROLLER)&&((u=(n=Ei(this,Qt))==null?void 0:n.unassociateElement)==null||u.call(n,this)),(p=Ei(this,Qt))==null||p.removeEventListener("pointerdown",this),(v=Ei(this,Qt))==null||v.removeEventListener("click",this),gs(this,Qt,null)}handleEvent(n){var u;const p=(u=n.composedPath())==null?void 0:u[0];if(["video","media-controller"].includes(p==null?void 0:p.localName)){if(n.type==="pointerdown")this._pointerType=n.pointerType;else if(n.type==="click"){const{clientX:T,clientY:L}=n,{left:C,top:M,width:V,height:G}=this.getBoundingClientRect(),Y=T-C,Z=L-M;if(Y<0||Z<0||Y>V||Z>G||V===0&&G===0)return;const{pointerType:j=this._pointerType}=n;if(this._pointerType=void 0,j===Fd.TOUCH){this.handleTap(n);return}else if(j===Fd.MOUSE){this.handleMouseClick(n);return}}}}handleTap(n){}handleMouseClick(n){const u=this.getAttribute(N.MEDIA_PAUSED)!=null?Ve.MEDIA_PLAY_REQUEST:Ve.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ne.CustomEvent(u,{composed:!0,bubbles:!0}))}}Qt=new WeakMap;function Sy(o){var n;const u=o.getAttribute(ht.MEDIA_CONTROLLER);return u?(n=o.getRootNode())==null?void 0:n.getElementById(u):fu(o,"media-controller")}ne.customElements.get("media-gesture-receiver")||ne.customElements.define("media-gesture-receiver",Ty);const zh=We.createElement("template");zh.innerHTML=`
  <style>
    
    :host([media-is-fullscreen])  ::slotted([slot=media]) {
      outline: none;
    }

    :host {
      box-sizing: border-box;
      position: relative;
      display: inline-block;
      line-height: 0;
      background-color: var(--media-background-color, #000);
    }

    :host(:not([audio])) [part~=layer]:not([part~=media-layer]) {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      display: flex;
      flex-flow: column nowrap;
      align-items: start;
      pointer-events: none;
      background: none;
    }

    
    :host([audio]) [part~=layer][part~=gesture-layer] {
      height: 0;
      display: block;
    }

    
    :host(:not([audio])[gestures-disabled]) ::slotted([slot=gestures-chrome]),
    :host(:not([audio])[gestures-disabled]) media-gesture-receiver[slot=gestures-chrome] {
      display: none;
    }

    
    ::slotted(:not([slot=media]):not([slot=poster]):not(media-loading-indicator)) {
      pointer-events: auto;
    }

    :host(:not([audio])) *[part~=layer][part~=centered-layer] {
      align-items: center;
      justify-content: center;
    }

    :host(:not([audio])) ::slotted(media-gesture-receiver[slot=gestures-chrome]),
    :host(:not([audio])) media-gesture-receiver[slot=gestures-chrome] {
      align-self: stretch;
      flex-grow: 1;
    }

    slot[name=middle-chrome] {
      display: inline;
      flex-grow: 1;
      pointer-events: none;
      background: none;
    }

    
    ::slotted([slot=media]),
    ::slotted([slot=poster]) {
      width: 100%;
      height: 100%;
    }

    
    :host(:not([audio])) .spacer {
      flex-grow: 1;
    }

    
    :host(:-webkit-full-screen) {
      
      width: 100% !important;
      height: 100% !important;
    }

    
    ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 1;
      transition: opacity 0.25s;
    }

    
    :host([user-inactive]:not([${N.MEDIA_PAUSED}]):not([${N.MEDIA_IS_CASTING}]):not([audio])) ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 0;
      transition: opacity 1s;
    }

    ::slotted(media-control-bar)  {
      align-self: stretch;
    }

    :host([${N.MEDIA_HAS_PLAYED}]) ::slotted([slot=poster]) {
      display: none;
    }
  </style>

  <slot name="media" part="layer media-layer"></slot>
  <slot name="poster" part="layer poster-layer"></slot>
  <slot name="gestures-chrome" part="layer gesture-layer">
    <media-gesture-receiver slot="gestures-chrome"></media-gesture-receiver>
  </slot>
  <span part="layer vertical-layer">
    <slot name="top-chrome" part="top chrome"></slot>
    <slot name="middle-chrome" part="middle chrome"></slot>
    <slot name="centered-chrome" part="layer centered-layer center centered chrome"></slot>
    
    <slot part="bottom chrome"></slot>
  </span>
`;const Ay=Object.values(N),wy="sm:384 md:576 lg:768 xl:960",ky=o=>{var n;for(const u of o){const p=u.target;if(!p.isConnected)continue;const v=(n=p.getAttribute("breakpoints"))!=null?n:wy,T=Ry(v),L=Iy(T,u.contentRect);Object.keys(T).forEach(C=>{if(L.includes(C)){p.hasAttribute(`breakpoint-${C}`)||p.setAttribute(`breakpoint-${C}`,"");return}p.removeAttribute(`breakpoint-${C}`)})}};function Ry(o){const n=o.split(/\s+/);return Object.fromEntries(n.map(u=>u.split(":")))}function Iy(o,n){return Object.keys(o).filter(u=>n.width>=o[u])}let Qh=class extends ne.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(zh.content.cloneNode(!0));const n=L=>{const C=this.media;for(let M of L)M.type==="childList"&&(M.removedNodes.forEach(V=>{if(V.slot=="media"&&M.target==this){let G=M.previousSibling&&M.previousSibling.previousElementSibling;if(!G||!C)this.mediaUnsetCallback(V);else{let Y=G.slot!=="media";for(;(G=G.previousSibling)!==null;)G.slot=="media"&&(Y=!1);Y&&this.mediaUnsetCallback(V)}}}),C&&M.addedNodes.forEach(V=>{V==C&&this.handleMediaUpdated(C).then(G=>this.mediaSetCallback(G))}))};new MutationObserver(n).observe(this,{childList:!0,subtree:!0});const p=new ResizeObserver(ky);this.resizeObserver=p,p.observe(this);let v=this.media,T=this.querySelector(":scope > slot[slot=media]");T&&T.addEventListener("slotchange",()=>{if(!T.assignedElements({flatten:!0}).length){this.mediaUnsetCallback(v);return}this.media&&(v=this.media,this.handleMediaUpdated(this.media).then(C=>this.mediaSetCallback(C)))})}static get observedAttributes(){return["autohide","gestures-disabled"].concat(Ay)}attributeChangedCallback(n,u,p){n.toLowerCase()=="autohide"&&(this.autohide=p)}get media(){let n=this.querySelector(":scope > [slot=media]");return(n==null?void 0:n.nodeName)=="SLOT"&&(n=n.assignedElements({flatten:!0})[0]),n}mediaSetCallback(n){this._mediaClickPlayToggle=()=>{const u=n.paused?Ve.MEDIA_PLAY_REQUEST:Ve.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ne.CustomEvent(u,{composed:!0,bubbles:!0}))}}handleMediaUpdated(n){const u=T=>Promise.resolve(T),p=T=>(console.error('<media-chrome>: Media element set with slot="media" does not appear to be compatible.',T),Promise.reject(T));if(!n)return p(n);const v=n.nodeName.toLowerCase();return v.includes("-")?ne.customElements.whenDefined(v).then(()=>u(n)):u(n)}mediaUnsetCallback(n){}connectedCallback(){const u=this.getAttribute("audio")!=null?Li.AUDIO_PLAYER():Li.VIDEO_PLAYER();this.setAttribute("role","region"),this.setAttribute("aria-label",u),this.media&&this.handleMediaUpdated(this.media).then(L=>this.mediaSetCallback(L)),this.setAttribute("user-inactive","user-inactive");const p=()=>{if(this.autohide<0||this.hasAttribute("user-inactive"))return;this.setAttribute("user-inactive","");const L=new ne.CustomEvent(Xs.USER_INACTIVE,{composed:!0,bubbles:!0,detail:!0});this.dispatchEvent(L)},v=()=>{if(!this.hasAttribute("user-inactive"))return;this.removeAttribute("user-inactive");const L=new ne.CustomEvent(Xs.USER_INACTIVE,{composed:!0,bubbles:!0,detail:!1});this.dispatchEvent(L)},T=()=>{v(),ne.clearTimeout(this._inactiveTimeout),!(this.autohide<0)&&(this._inactiveTimeout=ne.setTimeout(()=>{p()},this.autohide*1e3))};this.addEventListener("keyup",()=>{T()}),this.addEventListener("pointerup",L=>{L.pointerType==="touch"?[this,this.media].includes(L.target)&&!this.hasAttribute("user-inactive")?p():T():L.composedPath().some(C=>{var M;return["media-play-button","media-fullscreen-button"].includes((M=C==null?void 0:C.nodeName)==null?void 0:M.toLowerCase())})&&T()}),this.addEventListener("pointermove",L=>{L.pointerType==="mouse"&&L.target!==this&&(v(),ne.clearTimeout(this._inactiveTimeout),[this,this.media].includes(L.target)&&T())}),this.addEventListener("mouseleave",()=>{p()}),this.addEventListener("keyup",()=>{this.setAttribute("media-keyboard-control","")}),ne.addEventListener("mouseup",()=>{this.removeAttribute("media-keyboard-control")})}set autohide(n){n=Number(n),this._autohide=isNaN(n)?0:n}get autohide(){return this._autohide===void 0?2:this._autohide}};ne.customElements.get("media-container-temp")||ne.customElements.define("media-container-temp",Qh);var Ly=Qh,Xh=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},Ht=(o,n,u)=>(Xh(o,n,"read from private field"),u?u.call(o):n.get(o)),yl=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},El=(o,n,u,p)=>(Xh(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),En,bn,ir;class Dy{constructor(n,u){yl(this,En,void 0),yl(this,bn,void 0),yl(this,ir,new Set),El(this,En,n),El(this,bn,u)}[Symbol.iterator](){return Ht(this,ir).values()}get length(){return Ht(this,ir).size}get value(){var n;return(n=[...Ht(this,ir)].join(" "))!=null?n:""}set value(n){var u;n!==this.value&&(El(this,ir,new Set),this.add(...(u=n==null?void 0:n.split(" "))!=null?u:[]))}toString(){return this.value}item(n){return[...Ht(this,ir)][n]}values(){return Ht(this,ir).values()}keys(){return Ht(this,ir).keys()}forEach(n){Ht(this,ir).forEach(n)}add(...n){var u,p;n.forEach(v=>Ht(this,ir).add(v)),!(this.value===""&&!((u=Ht(this,En))!=null&&u.hasAttribute(`${Ht(this,bn)}`)))&&((p=Ht(this,En))==null||p.setAttribute(`${Ht(this,bn)}`,`${this.value}`))}remove(...n){var u;n.forEach(p=>Ht(this,ir).delete(p)),(u=Ht(this,En))==null||u.setAttribute(`${Ht(this,bn)}`,`${this.value}`)}contains(n){return Ht(this,ir).has(n)}toggle(n,u){return typeof u<"u"?u?(this.add(n),!0):(this.remove(n),!1):this.contains(n)?(this.remove(n),!1):(this.add(n),!0)}replace(n,u){this.remove(n),this.add(u)}}En=new WeakMap;bn=new WeakMap;ir=new WeakMap;const xt={enter:"requestFullscreen",exit:"exitFullscreen",event:"fullscreenchange",element:"fullscreenElement",error:"fullscreenerror",enabled:"fullscreenEnabled"};We.fullscreenElement===void 0&&(xt.enter="webkitRequestFullScreen",xt.exit=We.webkitExitFullscreen!=null?"webkitExitFullscreen":"webkitCancelFullScreen",xt.event="webkitfullscreenchange",xt.element="webkitFullscreenElement",xt.error="webkitfullscreenerror",xt.enabled="webkitFullscreenEnabled");const Gl=(o="")=>o.split(/\s+/),Zh=(o="")=>{const[n,u]=o.split(":"),p=u?decodeURIComponent(u):void 0;return{language:n,label:p}},Cy=(o="",n={})=>Gl(o).map(u=>{const p=Zh(u);return{...n,...p}}),xy=o=>Array.isArray(o)?o.map(n=>typeof n=="string"?Zh(n):n):typeof o=="string"?Cy(o):[o],My=({label:o,language:n}={})=>o?`${n}:${encodeURIComponent(o)}`:n,Qr=(o=[])=>Array.prototype.map.call(o,My).join(" "),Py=(o,n)=>u=>u[o]===n,Jh=o=>{const n=Object.entries(o).map(([u,p])=>Py(u,p));return u=>n.every(p=>p(u))},ys=(o,n=[],u=[])=>{const p=xy(u).map(Jh),v=T=>p.some(L=>L(T));Array.from(n).filter(v).forEach(T=>{T.mode=o})},Ra=(o,n=()=>!0)=>{if(!(o!=null&&o.textTracks))return[];const u=typeof n=="function"?n:Jh(n);return Array.from(o.textTracks).filter(u)},ef=o=>{const n=!!o.getAttribute(N.MEDIA_CAPTIONS_SHOWING),u=!o.hasAttribute("no-subtitles-fallback")&&!!o.getAttribute(N.MEDIA_SUBTITLES_SHOWING);return n||u},Hl=o=>{var n,u,p,v;if(ef(o)){const L=o.getAttribute(N.MEDIA_CAPTIONS_SHOWING);if(L){const M=new window.CustomEvent(Ve.MEDIA_DISABLE_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:L});o.dispatchEvent(M)}const C=o.getAttribute(N.MEDIA_SUBTITLES_SHOWING);if(C&&!o.hasAttribute("no-subtitles-fallback")){const M=new window.CustomEvent(Ve.MEDIA_DISABLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:C});o.dispatchEvent(M)}}else{const[L]=(u=Gl((n=o.getAttribute(N.MEDIA_CAPTIONS_LIST))!=null?n:""))!=null?u:[];if(L){const C=new window.CustomEvent(Ve.MEDIA_SHOW_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:L});o.dispatchEvent(C)}else if(o.hasAttribute("no-subtitles-fallback"))console.error("Attempting to enable closed captions but none are available! Please verify your media content if this is unexpected.");else{const[C]=(v=Gl((p=o.getAttribute(N.MEDIA_SUBTITLES_LIST))!=null?p:""))!=null?v:[];if(C){const M=new window.CustomEvent(Ve.MEDIA_SHOW_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:C});o.dispatchEvent(M)}}}};var pu=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},Ki=(o,n,u)=>(pu(o,n,"read from private field"),u?u.call(o):n.get(o)),Es=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},Gd=(o,n,u,p)=>(pu(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),kn=(o,n,u)=>(pu(o,n,"access private method"),u),Ti,aa,Ln,Aa,Os,Vl;const Oy=Object.values(zr),tf=["ArrowLeft","ArrowRight","Enter"," ","f","m","k","c"],Fy=10,Hd=0;let rf=class extends Ly{constructor(){super(),Es(this,Ln),Es(this,Os),Es(this,Ti,new Dy(this,"hotkeys")),Es(this,aa,void 0),Wy||(this._airplayUnavailable=Vr.UNSUPPORTED),Kd||(this._fullscreenUnavailable=Vr.UNAVAILABLE),$y||(this._castUnavailable=Vr.UNSUPPORTED),qy||(this._pipUnavailable=Vr.UNSUPPORTED),ya!==void 0?ya||(this._volumeUnavailable=Vr.UNSUPPORTED):jy.then(()=>{ya||(this._volumeUnavailable=Vr.UNSUPPORTED,this.propagateMediaState(N.MEDIA_VOLUME_UNAVAILABLE,this._volumeUnavailable))}),this.mediaStateReceivers=[],this.associatedElementSubscriptions=new Map,this.associateElement(this);const n={MEDIA_PLAY_REQUEST:(u,p)=>{const v=ta[N.MEDIA_STREAM_TYPE](this),T=this.getAttribute("noautoseektolive")===null;v==zr.LIVE&&T&&n.MEDIA_SEEK_TO_LIVE_REQUEST(u,p),this.media.play().catch(()=>{})},MEDIA_PAUSE_REQUEST:()=>this.media.pause(),MEDIA_MUTE_REQUEST:()=>this.media.muted=!0,MEDIA_UNMUTE_REQUEST:()=>{const u=this.media;u.muted=!1,u.volume===0&&(u.volume=.25)},MEDIA_VOLUME_REQUEST:u=>{const p=this.media,v=u.detail;p.volume=v,v>0&&p.muted&&(p.muted=!1);try{ne.localStorage.setItem("media-chrome-pref-volume",v.toString())}catch{}},MEDIA_ENTER_FULLSCREEN_REQUEST:()=>{if(!Kd){console.warn("Fullscreen support is unavailable; not entering fullscreen");return}const u=this.media;We.pictureInPictureElement&&We.exitPictureInPicture(),super[xt.enter]?this.fullscreenElement[xt.enter]():u.webkitEnterFullscreen?u.webkitEnterFullscreen():u.requestFullscreen?u.requestFullscreen():console.warn("MediaChrome: Fullscreen not supported")},MEDIA_EXIT_FULLSCREEN_REQUEST:()=>{We[xt.exit]()},MEDIA_ENTER_PIP_REQUEST:()=>{const u=this.media;if(!We.pictureInPictureEnabled){console.warn("MediaChrome: Picture-in-picture is not enabled");return}if(!u.requestPictureInPicture){console.warn("MediaChrome: The current media does not support picture-in-picture");return}We[xt.element]&&We[xt.exit]();const p=()=>{console.warn("MediaChrome: The media is not ready for picture-in-picture. It must have a readyState > 0.")};u.requestPictureInPicture().catch(v=>{if(v.code===11)if(u.readyState===0&&u.preload==="none"){const T=()=>{u.removeEventListener("loadedmetadata",L),u.preload="none"},L=()=>{u.requestPictureInPicture().catch(p),T()};u.addEventListener("loadedmetadata",L),u.preload="metadata",setTimeout(()=>{u.readyState===0&&p(),T()},1e3)}else throw v;else throw v})},MEDIA_EXIT_PIP_REQUEST:()=>{We.pictureInPictureElement&&We.exitPictureInPicture()},MEDIA_ENTER_CAST_REQUEST:()=>{var u;const p=this.media;(u=globalThis.CastableVideoElement)!=null&&u.castEnabled&&(We[xt.element]&&We[xt.exit](),p.requestCast())},MEDIA_EXIT_CAST_REQUEST:async()=>{var u;(u=globalThis.CastableVideoElement)!=null&&u.castElement&&globalThis.CastableVideoElement.exitCast()},MEDIA_SEEK_REQUEST:u=>{const p=this.media,v=u.detail;(p.readyState>0||p.readyState===void 0)&&(p.currentTime=v)},MEDIA_PLAYBACK_RATE_REQUEST:u=>{this.media.playbackRate=u.detail},MEDIA_PREVIEW_REQUEST:u=>{var p;const v=this.media;if(!v)return;const T=u.detail;T===null&&this.propagateMediaState(N.MEDIA_PREVIEW_TIME,void 0),this.propagateMediaState(N.MEDIA_PREVIEW_TIME,T);const[L]=Ra(v,{kind:ka.METADATA,label:"thumbnails"});if(!(L&&L.cues))return;if(T===null){this.propagateMediaState(N.MEDIA_PREVIEW_IMAGE,void 0),this.propagateMediaState(N.MEDIA_PREVIEW_COORDS,void 0);return}const C=Array.prototype.find.call(L.cues,Y=>Y.startTime>=T);if(!C)return;const M=/'^(?:[a-z]+:)?\/\//i.test(C.text)||(p=v.querySelector('track[label="thumbnails"]'))==null?void 0:p.src,V=new URL(C.text,M),G=new URLSearchParams(V.hash).get("#xywh");this.propagateMediaState(N.MEDIA_PREVIEW_IMAGE,V.href),this.propagateMediaState(N.MEDIA_PREVIEW_COORDS,G.split(",").join(" "))},MEDIA_SHOW_CAPTIONS_REQUEST:u=>{const p=Fs(this),{detail:v=[]}=u;ys(Sn.SHOWING,p,v)},MEDIA_DISABLE_CAPTIONS_REQUEST:u=>{const p=Fs(this),{detail:v=[]}=u;ys(Sn.DISABLED,p,v)},MEDIA_SHOW_SUBTITLES_REQUEST:u=>{const p=ga(this),{detail:v=[]}=u;ys(Sn.SHOWING,p,v)},MEDIA_DISABLE_SUBTITLES_REQUEST:u=>{const p=ga(this),{detail:v=[]}=u;ys(Sn.DISABLED,p,v)},MEDIA_AIRPLAY_REQUEST:()=>{const{media:u}=this;if(u){if(!(u.webkitShowPlaybackTargetPicker&&ne.WebKitPlaybackTargetAvailabilityEvent)){console.warn("received a request to select AirPlay but AirPlay is not supported in this environment");return}u.webkitShowPlaybackTargetPicker()}},MEDIA_SEEK_TO_LIVE_REQUEST:(u,p)=>{const v=p.seekable;if(!v){console.warn("MediaController: Media element does not support seeking to live.");return}if(!v.length){console.warn("MediaController: Media is unable to seek to live.");return}p.currentTime=v.end(v.length-1)}};if(Object.keys(n).forEach(u=>{const p=`_handle${gl(u,!0)}`;this[p]=v=>{if(v.stopPropagation(),!this.media){console.warn("MediaController: No media available.");return}n[u](v,this.media)},this.addEventListener(Ve[u],this[p])}),this._mediaStatePropagators={"play,pause,emptied":()=>{this.propagateMediaState(N.MEDIA_PAUSED,nf(this))},"playing,emptied":()=>{var u;this.propagateMediaState(N.MEDIA_HAS_PLAYED,!((u=this.media)!=null&&u.paused))},volumechange:()=>{this.propagateMediaState(N.MEDIA_MUTED,af(this)),this.propagateMediaState(N.MEDIA_VOLUME,sf(this)),this.propagateMediaState(N.MEDIA_VOLUME_LEVEL,of(this))},[xt.event]:u=>{const v=!!We[xt.element]&&(u==null?void 0:u.target),T=xs(this.fullscreenElement,v);this.propagateMediaState(N.MEDIA_IS_FULLSCREEN,T)},"enterpictureinpicture,leavepictureinpicture":u=>{var p;let v;if(u)v=u.type=="enterpictureinpicture";else{const T=(p=this.getRootNode().pictureInPictureElement)!=null?p:We.pictureInPictureElement;v=this.media&&xs(this.media,T)}this.propagateMediaState(N.MEDIA_IS_PIP,v)},"entercast,leavecast,castchange":u=>{var p;const v=(p=globalThis.CastableVideoElement)==null?void 0:p.castElement;let T=this.media&&xs(this.media,v);(u==null?void 0:u.type)==="castchange"&&(u==null?void 0:u.detail)==="CONNECTING"&&(T="connecting"),this.propagateMediaState(N.MEDIA_IS_CASTING,T)},"timeupdate,loadedmetadata":()=>{this.propagateMediaState(N.MEDIA_CURRENT_TIME,lf(this))},"durationchange,loadedmetadata,emptied":()=>{this.propagateMediaState(N.MEDIA_DURATION,uf(this))},"emptied,durationchange,loadedmetadata,streamtypechange":()=>{this.propagateMediaState(N.MEDIA_STREAM_TYPE)},"emptied,durationchange,loadedmetadata,streamtypechange,targetlivewindowchange":()=>{this.propagateMediaState(N.MEDIA_TARGET_LIVE_WINDOW)},"loadedmetadata,emptied,progress":()=>{var u;this.propagateMediaState(N.MEDIA_SEEKABLE,(u=df(this))==null?void 0:u.join(":"))},"progress,emptied":()=>{var u;this.propagateMediaState(N.MEDIA_BUFFERED,Qy((u=this.media)==null?void 0:u.buffered))},"ratechange,loadstart":()=>{this.propagateMediaState(N.MEDIA_PLAYBACK_RATE,cf(this))},"waiting,playing,emptied":()=>{var u;const p=((u=this.media)==null?void 0:u.readyState)<3;this.propagateMediaState(N.MEDIA_LOADING,p)},"playing,timeupdate,progress,waiting,emptied":()=>{this.propagateMediaState(N.MEDIA_TIME_IS_LIVE)}},this._airplayUnavailable!==Vr.UNSUPPORTED){const u=p=>{(p==null?void 0:p.availability)==="available"?this._airplayUnavailable=void 0:(p==null?void 0:p.availability)==="not-available"&&(this._airplayUnavailable=Vr.UNAVAILABLE),this.propagateMediaState(N.MEDIA_AIRPLAY_UNAVAILABLE,this._airplayUnavailable)};this._mediaStatePropagators.webkitplaybacktargetavailabilitychanged=u}if(this._castUnavailable!==Vr.UNSUPPORTED){const u=()=>{var p;const v=(p=globalThis.CastableVideoElement)==null?void 0:p.castState;v!=null&&v.includes("CONNECT")?this._castUnavailable=void 0:this._castUnavailable=Vr.UNAVAILABLE,this.propagateMediaState(N.MEDIA_CAST_UNAVAILABLE,this._castUnavailable)};this._mediaStatePropagators.castchange=u}this._textTrackMediaStatePropagators={"addtrack,removetrack,loadstart":()=>{this.propagateMediaState(N.MEDIA_CAPTIONS_LIST,Qr(Fs(this))||void 0),this.propagateMediaState(N.MEDIA_SUBTITLES_LIST,Qr(ga(this))||void 0),this.propagateMediaState(N.MEDIA_CAPTIONS_SHOWING,Qr(Kl(this))||void 0),this.propagateMediaState(N.MEDIA_SUBTITLES_SHOWING,Qr(Vd(this))||void 0)},change:()=>{this.propagateMediaState(N.MEDIA_CAPTIONS_SHOWING,Qr(Kl(this))||void 0),this.propagateMediaState(N.MEDIA_SUBTITLES_SHOWING,Qr(Vd(this))||void 0)}},this.enableHotkeys()}static get observedAttributes(){return super.observedAttributes.concat("nohotkeys","hotkeys","default-stream-type")}get fullscreenElement(){var n;return(n=Ki(this,aa))!=null?n:this}set fullscreenElement(n){this.hasAttribute("fullscreen-element")&&this.removeAttribute("fullscreen-element"),Gd(this,aa,n)}attributeChangedCallback(n,u,p){var v;if(n==="nohotkeys")p!==u&&p===""?(this.hasAttribute("hotkeys")&&console.warn("Both `hotkeys` and `nohotkeys` have been set. All hotkeys will be disabled."),this.disableHotkeys()):p!==u&&p===null&&this.enableHotkeys();else if(n==="hotkeys")Ki(this,Ti).value=p;else if(n==="default-stream-type")this.propagateMediaState(N.MEDIA_STREAM_TYPE);else if(n==="fullscreen-element"){const T=p?(v=this.getRootNode())==null?void 0:v.getElementById(p):void 0;Gd(this,aa,T)}super.attributeChangedCallback(n,u,p)}mediaSetCallback(n){super.mediaSetCallback(n),n.hasAttribute("tabindex")||n.setAttribute("tabindex",-1),Object.keys(this._mediaStatePropagators).forEach(u=>{const p=u.split(","),v=this._mediaStatePropagators[u];p.forEach(T=>{(T==xt.event?this.getRootNode():n).addEventListener(T,v)}),v()}),Object.entries(this._textTrackMediaStatePropagators).forEach(([u,p])=>{u.split(",").forEach(T=>{n.textTracks&&n.textTracks.addEventListener(T,p)}),p()});try{const u=ne.localStorage.getItem("media-chrome-pref-volume");u!==null&&(n.volume=u)}catch(u){console.debug("Error getting volume pref",u)}}mediaUnsetCallback(n){super.mediaUnsetCallback(n),Object.keys(this._mediaStatePropagators).forEach(u=>{const p=u.split(","),v=this._mediaStatePropagators[u];p.forEach(T=>{(T==xt.event?this.getRootNode():n).removeEventListener(T,v)})}),Object.entries(this._textTrackMediaStatePropagators).forEach(([u,p])=>{u.split(",").forEach(T=>{n.textTracks&&n.textTracks.removeEventListener(T,p)}),p()}),this.propagateMediaState(N.MEDIA_PAUSED,!0)}propagateMediaState(n,u){arguments.length===1&&(u=ta[n](this));const p=this.getAttribute(n);if(Vi(this.mediaStateReceivers,n,u),p===this.getAttribute(n))return;const v=oy[n];if(!v)return;const T=new ne.CustomEvent(v,{composed:!0,bubbles:!0,detail:u});this.dispatchEvent(T)}associateElement(n){if(!n)return;const{associatedElementSubscriptions:u}=this;if(u.has(n))return;const p=this.registerMediaStateReceiver.bind(this),v=this.unregisterMediaStateReceiver.bind(this),T=Hy(n,p,v);Object.keys(Ve).forEach(L=>{n.addEventListener(Ve[L],this[`_handle${gl(L,!0)}`])}),u.set(n,T)}unassociateElement(n){if(!n)return;const{associatedElementSubscriptions:u}=this;if(!u.has(n))return;u.get(n)(),u.delete(n),Object.keys(Ve).forEach(v=>{n.removeEventListener(Ve[v],this[`_handle${gl(v,!0)}`])})}registerMediaStateReceiver(n){if(!n)return;const u=this.mediaStateReceivers;u.indexOf(n)>-1||(u.push(n),Vi([n],N.MEDIA_VOLUME_UNAVAILABLE,this._volumeUnavailable),Vi([n],N.MEDIA_AIRPLAY_UNAVAILABLE,this._airplayUnavailable),Vi([n],N.MEDIA_FULLSCREEN_UNAVAILABLE,this._fullscreenUnavailable),Vi([n],N.MEDIA_CAST_UNAVAILABLE,this._castUnavailable),Vi([n],N.MEDIA_PIP_UNAVAILABLE,this._pipUnavailable),this.media&&Object.keys(N).forEach(v=>{v.includes("UNAVAILABLE")||Vi([n],N[v],ta[N[v]]?ta[N[v]](this):ta.default(this,N[v]))}))}unregisterMediaStateReceiver(n){const u=this.mediaStateReceivers,p=u.indexOf(n);p<0||u.splice(p,1)}enableHotkeys(){this.addEventListener("keydown",kn(this,Os,Vl))}disableHotkeys(){this.removeEventListener("keydown",kn(this,Os,Vl)),this.removeEventListener("keyup",kn(this,Ln,Aa))}get hotkeys(){return Ki(this,Ti)}keyboardShortcutHandler(n){var u,p,v,T;if(((T=(v=(u=n.target.getAttribute("keysused"))==null?void 0:u.split(" "))!=null?v:(p=n.target)==null?void 0:p.keysUsed)!=null?T:[]).map(j=>j==="Space"?" ":j).filter(Boolean).includes(n.key))return;let C,M,V,G,Y;const Z=Fy;if(!Ki(this,Ti).contains(`no${n.key.toLowerCase()}`)&&!(n.key===" "&&Ki(this,Ti).contains("nospace")))switch(n.key){case" ":case"k":C=this.getAttribute(N.MEDIA_PAUSED)!=null?Ve.MEDIA_PLAY_REQUEST:Ve.MEDIA_PAUSE_REQUEST,this.dispatchEvent(new ne.CustomEvent(C,{composed:!0,bubbles:!0}));break;case"m":C=this.getAttribute(N.MEDIA_VOLUME_LEVEL)==="off"?Ve.MEDIA_UNMUTE_REQUEST:Ve.MEDIA_MUTE_REQUEST,this.dispatchEvent(new ne.CustomEvent(C,{composed:!0,bubbles:!0}));break;case"f":C=this.getAttribute(N.MEDIA_IS_FULLSCREEN)!=null?Ve.MEDIA_EXIT_FULLSCREEN_REQUEST:Ve.MEDIA_ENTER_FULLSCREEN_REQUEST,this.dispatchEvent(new ne.CustomEvent(C,{composed:!0,bubbles:!0}));break;case"c":Hl(this);break;case"ArrowLeft":M=this.getAttribute(N.MEDIA_CURRENT_TIME),V=M&&!Number.isNaN(+M)?+M:Hd,G=Math.max(V-Z,0),Y=new ne.CustomEvent(Ve.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:G}),this.dispatchEvent(Y);break;case"ArrowRight":M=this.getAttribute(N.MEDIA_CURRENT_TIME),V=M&&!Number.isNaN(+M)?+M:Hd,G=Math.max(V+Z,0),Y=new ne.CustomEvent(Ve.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:G}),this.dispatchEvent(Y);break}}};Ti=new WeakMap;aa=new WeakMap;Ln=new WeakSet;Aa=function(o){const{key:n}=o;if(!tf.includes(n)){this.removeEventListener("keyup",kn(this,Ln,Aa));return}this.keyboardShortcutHandler(o)};Os=new WeakSet;Vl=function(o){const{metaKey:n,altKey:u,key:p}=o;if(n||u||!tf.includes(p)){this.removeEventListener("keyup",kn(this,Ln,Aa));return}[" ","ArrowLeft","ArrowRight"].includes(p)&&!(Ki(this,Ti).contains(`no${p.toLowerCase()}`)||p===" "&&Ki(this,Ti).contains("nospace"))&&o.preventDefault(),this.addEventListener("keyup",kn(this,Ln,Aa),{once:!0})};const ta={default(o,n){return o.getAttribute(n)},[N.MEDIA_CAPTIONS_LIST](o){return Qr(Fs(o))||void 0},[N.MEDIA_SUBTITLES_LIST](o){return Qr(ga(o))||void 0},[N.MEDIA_SUBTITLES_LIST](o){return Qr(ga(o))||void 0},[N.MEDIA_CAPTIONS_SHOWING](o){return Qr(Kl(o))||void 0},[N.MEDIA_PAUSED](o){return nf(o)},[N.MEDIA_MUTED](o){return af(o)},[N.MEDIA_VOLUME](o){return sf(o)},[N.MEDIA_VOLUME_LEVEL](o){return of(o)},[N.MEDIA_CURRENT_TIME](o){return lf(o)},[N.MEDIA_DURATION](o){return uf(o)},[N.MEDIA_SEEKABLE](o){var n;return(n=df(o))==null?void 0:n.join(":")},[N.MEDIA_PLAYBACK_RATE](o){return cf(o)},[N.MEDIA_STREAM_TYPE](o){return ql(o)},[N.MEDIA_TARGET_LIVE_WINDOW](o){return Ny(o)},[N.MEDIA_TIME_IS_LIVE](o){const n=o.media;if(!n)return!1;if(typeof n.liveEdgeStart=="number")return Number.isNaN(n.liveEdgeStart)?!1:n.currentTime>=n.liveEdgeStart;if(!(ql(o)==="live"))return!1;const p=n.seekable;if(!p)return!0;if(!p.length)return!1;const v=o.hasAttribute("liveedgeoffset")?Number(o.getAttribute("liveedgeoffset")):10,T=p.end(p.length-1)-v;return n.currentTime>=T}},nf=o=>o.media?o.media.paused:!0,af=o=>!!(o.media&&o.media.muted),sf=o=>{const n=o.media;return n?n.volume:1},of=o=>{let n="high";if(!o.media)return n;const{muted:u,volume:p}=o.media;return p===0||u?n="off":p<.5?n="low":p<.75&&(n="medium"),n},lf=o=>{const n=o.media;return n?n.currentTime:0},uf=o=>{const n=o==null?void 0:o.media;return Number.isFinite(n==null?void 0:n.duration)?n.duration:NaN},df=o=>{var n;const u=o==null?void 0:o.media;if(!((n=u==null?void 0:u.seekable)!=null&&n.length))return;const p=u.seekable.start(0),v=u.seekable.end(u.seekable.length-1);if(!(!p&&!v))return[Number(p.toFixed(3)),Number(v.toFixed(3))]},cf=o=>{const n=o.media;return n?n.playbackRate:1},ga=o=>Ra(o.media,{kind:ka.SUBTITLES}),Fs=o=>Ra(o.media,{kind:ka.CAPTIONS}),Vd=o=>Ra(o.media,{kind:ka.SUBTITLES,mode:Sn.SHOWING}),Kl=o=>Ra(o.media,{kind:ka.CAPTIONS,mode:Sn.SHOWING}),ql=o=>{const{media:n}=o;if(!n)return;const{streamType:u}=n;if(Oy.includes(u)){if(u===zr.UNKNOWN){const v=o.getAttribute("default-stream-type");return[zr.LIVE,zr.ON_DEMAND].includes(v)?v:void 0}return u}const p=n.duration;if(p===1/0)return zr.LIVE;if(Number.isFinite(p))return zr.ON_DEMAND;{const v=o.getAttribute("default-stream-type");if([zr.LIVE,zr.ON_DEMAND].includes(v))return v}},Ny=o=>{const{media:n}=o;if(!n)return Number.NaN;const{targetLiveWindow:u}=n;return(u==null||Number.isNaN(u))&&ql(o)===zr.LIVE?0:u},Uy=Object.values(N),hf=o=>{var n,u,p,v;let{observedAttributes:T}=o.constructor;!T&&((n=o.nodeName)!=null&&n.includes("-"))&&(ne.customElements.upgrade(o),{observedAttributes:T}=o.constructor);const L=(v=(p=(u=o==null?void 0:o.getAttribute)==null?void 0:u.call(o,ht.MEDIA_CHROME_ATTRIBUTES))==null?void 0:p.split)==null?void 0:v.call(p,/\s+/);return Array.isArray(T||L)?(T||L).filter(C=>Uy.includes(C)):[]},jl=o=>!!hf(o).length,By=async(o,n,u)=>(o.isConnected||await ff(0),u==null?o.removeAttribute(n):typeof u=="boolean"?u?o.setAttribute(n,""):o.removeAttribute(n):Number.isNaN(u)?o.removeAttribute(n):o.setAttribute(n,u)),Gy=o=>{var n;return!!((n=o.closest)!=null&&n.call(o,'*[slot="media"]'))},sa=(o,n)=>{if(Gy(o))return;const u=(v,T)=>{var L,C;jl(v)&&T(v);const{children:M=[]}=v??{},V=(C=(L=v==null?void 0:v.shadowRoot)==null?void 0:L.children)!=null?C:[];[...M,...V].forEach(Y=>sa(Y,T))},p=o==null?void 0:o.nodeName.toLowerCase();if(p.includes("-")&&!jl(o)){ne.customElements.whenDefined(p).then(()=>{u(o,n)});return}u(o,n)},Vi=(o,n,u)=>{o.forEach(p=>{hf(p).includes(n)&&By(p,n,u)})},Hy=(o,n,u)=>{sa(o,n);const p=M=>{var V;const G=(V=M==null?void 0:M.composedPath()[0])!=null?V:M.target;n(G)},v=M=>{var V;const G=(V=M==null?void 0:M.composedPath()[0])!=null?V:M.target;u(G)};o.addEventListener(Ve.REGISTER_MEDIA_STATE_RECEIVER,p),o.addEventListener(Ve.UNREGISTER_MEDIA_STATE_RECEIVER,v);const T=M=>{M.forEach(V=>{const{addedNodes:G=[],removedNodes:Y=[],type:Z,target:j,attributeName:re}=V;Z==="childList"?(Array.prototype.forEach.call(G,ae=>sa(ae,n)),Array.prototype.forEach.call(Y,ae=>sa(ae,u))):Z==="attributes"&&re===ht.MEDIA_CHROME_ATTRIBUTES&&(jl(j)?n(j):u(j))})},L=new MutationObserver(T);return L.observe(o,{childList:!0,attributes:!0,subtree:!0}),()=>{sa(o,u),L.disconnect(),o.removeEventListener(Ve.REGISTER_MEDIA_STATE_RECEIVER,p),o.removeEventListener(Ve.UNREGISTER_MEDIA_STATE_RECEIVER,v)}};let bs;const mu=()=>{var o,n;return bs||(bs=(n=(o=We)==null?void 0:o.createElement)==null?void 0:n.call(o,"video"),bs)},Vy=async(o=mu())=>{if(!o)return!1;const n=o.volume;return o.volume=n/2+.1,await ff(0),o.volume!==n},ff=o=>new Promise(n=>setTimeout(n,o)),Ky=(o=mu())=>typeof(o==null?void 0:o.requestPictureInPicture)=="function",qy=Ky();let ya;const jy=Vy().then(o=>(ya=o,ya)),Wy=!!ne.WebKitPlaybackTargetAvailabilityEvent,$y=!!ne.chrome,Yy=(o=mu())=>{let n=We[xt.enabled];return!n&&o&&(n="webkitSupportsFullscreen"in o),n},Kd=Yy(),zy=Object.freeze({length:0,start(o){const n=o>>>0;if(n>=this.length)throw new DOMException(`Failed to execute 'start' on 'TimeRanges': The index provided (${n}) is greater than or equal to the maximum bound (${this.length}).`);return 0},end(o){const n=o>>>0;if(n>=this.length)throw new DOMException(`Failed to execute 'end' on 'TimeRanges': The index provided (${n}) is greater than or equal to the maximum bound (${this.length}).`);return 0}});function Qy(o=zy){return Array.from(o).map((n,u)=>[Number(o.start(u).toFixed(3)),Number(o.end(u).toFixed(3))].join(":")).join(" ")}ne.customElements.get("media-controller")||ne.customElements.define("media-controller",rf);var pf=rf,mf=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},oi=(o,n,u)=>(mf(o,n,"read from private field"),u?u.call(o):n.get(o)),_s=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},ra=(o,n,u,p)=>(mf(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),Ns,qr,Us,Bs;const vf=We.createElement("template"),qd=`
  height: var(--thumb-height);
  width: var(--media-range-thumb-width, 10px);
  border: var(--media-range-thumb-border, none);
  border-radius: var(--media-range-thumb-border-radius, 10px);
  background: var(--media-range-thumb-background, #fff);
  box-shadow: var(--media-range-thumb-box-shadow, 1px 1px 1px transparent);
  cursor: pointer;
  transition: var(--media-range-thumb-transition, none);
  transform: var(--media-range-thumb-transform, none);
  opacity: var(--media-range-thumb-opacity, 1);
`,bl=`
  min-width: 40px;
  height: var(--track-height);
  border: var(--media-range-track-border, none);
  outline: var(--media-range-track-outline);
  outline-offset: var(--media-range-track-outline-offset);
  border-radius: var(--media-range-track-border-radius, 0);
  background: var(--media-range-track-progress-internal, var(--media-range-track-background, #eee));
  box-shadow: var(--media-range-track-box-shadow, none);
  transition: var(--media-range-track-transition, none);
  transform: translate(var(--media-range-track-translate-x, 0), var(--media-range-track-translate-y, 0));
  cursor: pointer;
`;vf.innerHTML=`
  <style>
    :host {
      --thumb-height: var(--media-range-thumb-height, 10px);
      --track-height: var(--media-range-track-height, 4px);
      --_focus-box-shadow: var(--media-focus-box-shadow, inset 0 0 0 2px rgba(27, 127, 204, 0.9));
      --_media-range-padding: var(--media-range-padding, var(--media-control-padding, 10px));

      vertical-align: middle;
      box-sizing: border-box;
      display: inline-block;
      position: relative;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
      transition: background 0.15s linear;
      width: 100px;
      height: calc(var(--media-control-height, 24px) + 2 * var(--_media-range-padding));
      padding-left: var(--media-range-padding-left, var(--_media-range-padding));
      padding-right: var(--media-range-padding-right, var(--_media-range-padding));
      pointer-events: auto;
      
      font-size: 0;
      box-shadow: var(--_focus-visible-box-shadow, none);
    }

    
    input[type=range]:focus {
      outline: 0;
    }
    input[type=range]:focus::-webkit-slider-runnable-track {
      outline: 0;
    }

    :host(:hover) {
      background: var(--media-control-hover-background, rgba(50,50,60, 0.7));
    }

    #container {
      position: relative;
      height: 100%;
    }

    input[type=range] {
      
      -webkit-appearance: none; 
      background: transparent; 

      
      min-height: 100%;
      width: var(--media-range-track-width, 100%); 

      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      ${qd}
      
      margin-top: calc(calc(0px - var(--thumb-height) + var(--track-height)) / 2);
    }

    
    input[type=range]::-moz-range-thumb {
      ${qd}
      translate: var(--media-range-track-translate-x, 0) var(--media-range-track-translate-y, 0);
    }

    input[type=range]::-webkit-slider-runnable-track { ${bl} }
    input[type=range]::-moz-range-track { ${bl} }
    input[type=range]::-ms-track {
      
      width: 100%;
      cursor: pointer;
      
      background: transparent;
      border-color: transparent;
      color: transparent;

      ${bl}
    }

    #background,
    #pointer {
      min-width: 40px;
      width: var(--media-range-track-width, 100%);
      height: var(--track-height);
      border-radius: var(--media-range-track-border-radius, 0);
      position: absolute;
      top: 50%;
      transform: translate(var(--media-range-track-translate-x, 0px), calc(var(--media-range-track-translate-y, 0px) - 50%));
      background: var(--media-range-track-background, #333);
    }

    #pointer {
      min-width: auto;
      background: var(--media-range-track-pointer-background);
      border-right: var(--media-range-track-pointer-border-right);
      transition: visibility .25s, opacity .25s;
      visibility: hidden;
      opacity: 0;
    }

    :host(:hover) #pointer {
      transition: visibility .5s, opacity .5s;
      visibility: visible;
      opacity: 1;
    }

    #hoverzone {
      
      z-index: 1;
      display: var(--media-time-range-hover-display, none);
      position: absolute;
      width: 100%;
      bottom: var(--media-time-range-hover-bottom, -5px);
      height: var(--media-time-range-hover-height, max(calc(100% + 5px), 20px));
    }

    #range {
      z-index: 2;
      position: relative;
      height: var(--media-range-track-height, 4px);
    }

    input[type=range]:disabled::-webkit-slider-thumb {
      background-color: #777;
    }

    input[type=range]:disabled::-webkit-slider-runnable-track {
      background-color: #777;
    }
  </style>
  <div id="container">
    <div id="background"></div>
    <div id="pointer"></div>
    <div id="hoverzone"></div>
    <input id="range" type="range" min="0" max="1000" step="any" value="0">
  </div>
`;class gf extends ne.HTMLElement{constructor(){super(),_s(this,Ns,void 0),_s(this,qr,void 0),_s(this,Us,()=>{if(this.range.matches(":focus-visible")){const{style:u}=Er(this.shadowRoot,":host");u.setProperty("--_focus-visible-box-shadow","var(--_focus-box-shadow)")}}),_s(this,Bs,()=>{const{style:u}=Er(this.shadowRoot,":host");u.removeProperty("--_focus-visible-box-shadow")}),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(vf.content.cloneNode(!0));const{style:n}=Er(this.shadowRoot,":host");n.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-block))`),this.container=this.shadowRoot.querySelector("#container"),this.range=this.shadowRoot.querySelector("#range"),this.range.addEventListener("input",this.updateBar.bind(this)),ra(this,Ns,parseInt(getComputedStyle(this).getPropertyValue("--media-range-thumb-width")||"10",10))}static get observedAttributes(){return["disabled","aria-disabled",ht.MEDIA_CONTROLLER]}attributeChangedCallback(n,u,p){var v,T,L,C,M;n===ht.MEDIA_CONTROLLER?(u&&((T=(v=oi(this,qr))==null?void 0:v.unassociateElement)==null||T.call(v,this),ra(this,qr,null)),p&&(ra(this,qr,(L=this.getRootNode())==null?void 0:L.getElementById(p)),(M=(C=oi(this,qr))==null?void 0:C.associateElement)==null||M.call(C,this))):(n==="disabled"||n==="aria-disabled"&&u!==p)&&(p==null?this.range.removeAttribute(n):this.range.setAttribute(n,p))}connectedCallback(){var n,u,p;const v=this.getAttribute(ht.MEDIA_CONTROLLER);v&&(ra(this,qr,(n=this.getRootNode())==null?void 0:n.getElementById(v)),(p=(u=oi(this,qr))==null?void 0:u.associateElement)==null||p.call(u,this)),this.updateBar(),this.shadowRoot.addEventListener("focusin",oi(this,Us)),this.shadowRoot.addEventListener("focusout",oi(this,Bs))}disconnectedCallback(){var n,u;(u=(n=oi(this,qr))==null?void 0:n.unassociateElement)==null||u.call(n,this),ra(this,qr,null),this.shadowRoot.removeEventListener("focusin",oi(this,Us)),this.shadowRoot.removeEventListener("focusout",oi(this,Bs))}updatePointerBar(n){const u=this.range.getBoundingClientRect();let p=(n.clientX-u.left)/u.width;p=Math.max(0,Math.min(1,p));const{style:v}=Er(this.shadowRoot,"#pointer");v.setProperty("width",`${p*u.width}px`)}updateBar(){const n=this.getBarColors();let u="linear-gradient(to right, ",p=0;n.forEach(T=>{T[1]<p||(u=u+`${T[0]} ${p}%, ${T[0]} ${T[1]}%,`,p=T[1])}),u=u.slice(0,u.length-1)+")";const{style:v}=Er(this.shadowRoot,"#range");v.setProperty("--media-range-track-progress-internal",u)}getBarColors(){const n=this.range,u=n.value-n.min,p=n.max-n.min,v=u/p*100;let T=0;return n.value>n.min&&n.value<n.max&&(T=oi(this,Ns)*(.5-v/100)/n.offsetWidth*100),[["var(--media-range-bar-color, #fff)",v+T],["var(--media-range-track-color, transparent)",100]]}get keysUsed(){return["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"]}}Ns=new WeakMap;qr=new WeakMap;Us=new WeakMap;Bs=new WeakMap;ne.customElements.get("media-chrome-range")||ne.customElements.define("media-chrome-range",gf);var yf=gf,Ef=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},Ts=(o,n,u)=>(Ef(o,n,"read from private field"),u?u.call(o):n.get(o)),Xy=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},Ss=(o,n,u,p)=>(Ef(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),jr;const bf=We.createElement("template");bf.innerHTML=`
  <style>
    :host {
      
      box-sizing: border-box;
      display: var(--media-control-display, var(--media-control-bar-display, inline-flex));
      color: var(--media-icon-color, #eee);
      --media-loading-icon-width: 44px;
    }

    media-time-range,
    ::slotted(media-time-range),
    ::slotted(media-progress-range),
    ::slotted(media-clip-selector) {
      flex-grow: 1;
    }
  </style>

  <slot></slot>
`;let Zy=class extends ne.HTMLElement{constructor(){super(),Xy(this,jr,void 0),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(bf.content.cloneNode(!0))}static get observedAttributes(){return[ht.MEDIA_CONTROLLER]}attributeChangedCallback(n,u,p){var v,T,L,C,M;n===ht.MEDIA_CONTROLLER&&(u&&((T=(v=Ts(this,jr))==null?void 0:v.unassociateElement)==null||T.call(v,this),Ss(this,jr,null)),p&&(Ss(this,jr,(L=this.getRootNode())==null?void 0:L.getElementById(p)),(M=(C=Ts(this,jr))==null?void 0:C.associateElement)==null||M.call(C,this)))}connectedCallback(){var n,u,p;const v=this.getAttribute(ht.MEDIA_CONTROLLER);v&&(Ss(this,jr,(n=this.getRootNode())==null?void 0:n.getElementById(v)),(p=(u=Ts(this,jr))==null?void 0:u.associateElement)==null||p.call(u,this))}disconnectedCallback(){var n,u;(u=(n=Ts(this,jr))==null?void 0:n.unassociateElement)==null||u.call(n,this),Ss(this,jr,null)}};jr=new WeakMap;ne.customElements.get("media-control-bar")||ne.customElements.define("media-control-bar",Zy);var _f=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},As=(o,n,u)=>(_f(o,n,"read from private field"),u?u.call(o):n.get(o)),Jy=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},ws=(o,n,u,p)=>(_f(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),Wr;const Tf=We.createElement("template");Tf.innerHTML=`
  <style>
    :host {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      vertical-align: middle;
      box-sizing: border-box;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
  
      padding: var(--media-control-padding, 10px);

      font-size: 14px;
      line-height: var(--media-text-content-height, var(--media-control-height, 24px));
      font-family: Arial, sans-serif;
      text-align: center;
      color: #ffffff;
      pointer-events: auto;
    }

    
    :host(:focus-visible) {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
      outline: 0;
    }

    
    :host(:where(:focus)) {
      box-shadow: none;
      outline: 0;
    }
  </style>
  <slot></slot>
`;class Sf extends ne.HTMLElement{constructor(){super(),Jy(this,Wr,void 0),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Tf.content.cloneNode(!0));const{style:n}=Er(this.shadowRoot,":host");n.setProperty("display",`var(--media-control-display, var(--${this.localName}-display, inline-flex))`)}static get observedAttributes(){return[ht.MEDIA_CONTROLLER]}attributeChangedCallback(n,u,p){var v,T,L,C,M;n===ht.MEDIA_CONTROLLER&&(u&&((T=(v=As(this,Wr))==null?void 0:v.unassociateElement)==null||T.call(v,this),ws(this,Wr,null)),p&&(ws(this,Wr,(L=this.getRootNode())==null?void 0:L.getElementById(p)),(M=(C=As(this,Wr))==null?void 0:C.associateElement)==null||M.call(C,this)))}connectedCallback(){var n,u,p;const v=this.getAttribute(ht.MEDIA_CONTROLLER);v&&(ws(this,Wr,(n=this.getRootNode())==null?void 0:n.getElementById(v)),(p=(u=As(this,Wr))==null?void 0:u.associateElement)==null||p.call(u,this))}disconnectedCallback(){var n,u;(u=(n=As(this,Wr))==null?void 0:n.unassociateElement)==null||u.call(n,this),ws(this,Wr,null)}}Wr=new WeakMap;ne.customElements.get("media-text-display")||ne.customElements.define("media-text-display",Sf);var lo=Sf,Af=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},jd=(o,n,u)=>(Af(o,n,"read from private field"),u?u.call(o):n.get(o)),e0=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},t0=(o,n,u,p)=>(Af(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),oa;class r0 extends lo{constructor(){super(),e0(this,oa,void 0),t0(this,oa,this.shadowRoot.querySelector("slot")),jd(this,oa).textContent=di(0)}static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_CURRENT_TIME]}attributeChangedCallback(n,u,p){n===N.MEDIA_CURRENT_TIME&&(jd(this,oa).textContent=di(p)),super.attributeChangedCallback(n,u,p)}}oa=new WeakMap;ne.customElements.get("media-current-time-display")||ne.customElements.define("media-current-time-display",r0);var wf=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},Wd=(o,n,u)=>(wf(o,n,"read from private field"),u?u.call(o):n.get(o)),i0=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},n0=(o,n,u,p)=>(wf(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),la;let a0=class extends lo{constructor(){super(),i0(this,la,void 0),n0(this,la,this.shadowRoot.querySelector("slot")),Wd(this,la).textContent=di(0)}static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_DURATION]}attributeChangedCallback(n,u,p){n===N.MEDIA_DURATION&&(Wd(this,la).textContent=di(p)),super.attributeChangedCallback(n,u,p)}};la=new WeakMap;ne.customElements.get("media-duration-display")||ne.customElements.define("media-duration-display",a0);var kf=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},_l=(o,n,u)=>(kf(o,n,"read from private field"),u?u.call(o):n.get(o)),s0=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},o0=(o,n,u,p)=>(kf(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),_n;const $d=["Enter"," "],l0="&nbsp;/&nbsp;",Yd=(o,{timesSep:n=l0}={})=>{var u,p,v;const T=o.getAttribute("remaining")!=null,L=o.getAttribute("show-duration")!=null,C=(u=o.mediaCurrentTime)!=null?u:0,M=(v=(p=o.mediaDuration)!=null?p:o.mediaSeekableEnd)!=null?v:0,V=di(T?0-(M-C):C);return L?`${V}${n}${di(M)}`:V},u0="video not loaded, unknown time.",d0=o=>{const n=o.mediaCurrentTime,u=o.mediaDuration||o.mediaSeekableEnd;if(n==null||u==null){o.setAttribute("aria-valuetext",u0);return}const p=o.hasAttribute("remaining"),v=o.hasAttribute("show-duration"),T=va(p?0-(u-n):n);if(!v){o.setAttribute("aria-valuetext",T);return}const L=va(u),C=`${T} of ${L}`;o.setAttribute("aria-valuetext",C)};let c0=class extends lo{constructor(){super(),s0(this,_n,void 0),o0(this,_n,this.shadowRoot.querySelector("slot")),_l(this,_n).innerHTML=`${Yd(this)}`;const{style:n}=Er(this.shadowRoot,":host");n.setProperty("cursor","pointer")}static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_CURRENT_TIME,N.MEDIA_DURATION,N.MEDIA_SEEKABLE,"remaining","show-duration","disabled"]}connectedCallback(){this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","progressbar"),this.setAttribute("aria-label",Li.PLAYBACK_TIME());const n=u=>{const{key:p}=u;if(!$d.includes(p)){this.removeEventListener("keyup",n);return}this.toggleTimeDisplay()};this.addEventListener("keydown",u=>{const{metaKey:p,altKey:v,key:T}=u;if(p||v||!$d.includes(T)){this.removeEventListener("keyup",n);return}this.addEventListener("keyup",n)}),this.addEventListener("click",this.toggleTimeDisplay),super.connectedCallback()}toggleTimeDisplay(){this.hasAttribute("remaining")?this.removeAttribute("remaining"):this.setAttribute("remaining","")}disconnectedCallback(){this.disable(),super.disconnectedCallback()}attributeChangedCallback(n,u,p){if([N.MEDIA_CURRENT_TIME,N.MEDIA_DURATION,N.MEDIA_SEEKABLE,"remaining","show-duration"].includes(n)){const v=Yd(this);d0(this),v!==_l(this,_n).innerHTML&&(_l(this,_n).innerHTML=v)}else n==="disabled"&&p!==u&&(p==null?this.enable():this.disable());super.attributeChangedCallback(n,u,p)}enable(){this.setAttribute("tabindex",0)}disable(){this.removeAttribute("tabindex")}get mediaDuration(){const n=this.getAttribute(N.MEDIA_DURATION);return n!=null?+n:void 0}get mediaCurrentTime(){const n=this.getAttribute(N.MEDIA_CURRENT_TIME);return n!=null?+n:void 0}get mediaSeekable(){const n=this.getAttribute(N.MEDIA_SEEKABLE);if(n)return n.split(":").map(u=>+u)}get mediaSeekableEnd(){var n;const[,u]=(n=this.mediaSeekable)!=null?n:[];return u}get mediaSeekableStart(){var n;const[u]=(n=this.mediaSeekable)!=null?n:[];return u}};_n=new WeakMap;ne.customElements.get("media-time-display")||ne.customElements.define("media-time-display",c0);const h0=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M22.83 5.68a2.58 2.58 0 0 0-2.3-2.5c-3.62-.24-11.44-.24-15.06 0a2.58 2.58 0 0 0-2.3 2.5c-.23 4.21-.23 8.43 0 12.64a2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5c.23-4.21.23-8.43 0-12.64Zm-11.39 9.45a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.92 3.92 0 0 1 .92-2.77 3.18 3.18 0 0 1 2.43-1 2.94 2.94 0 0 1 2.13.78c.364.359.62.813.74 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.17 1.61 1.61 0 0 0-1.29.58 2.79 2.79 0 0 0-.5 1.89 3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.48 1.48 0 0 0 1-.37 2.1 2.1 0 0 0 .59-1.14l1.4.44a3.23 3.23 0 0 1-1.07 1.69Zm7.22 0a3.07 3.07 0 0 1-1.91.57 3.06 3.06 0 0 1-2.34-1 3.75 3.75 0 0 1-.92-2.67 3.88 3.88 0 0 1 .93-2.77 3.14 3.14 0 0 1 2.42-1 3 3 0 0 1 2.16.82 2.8 2.8 0 0 1 .73 1.31l-1.43.35a1.49 1.49 0 0 0-1.51-1.21 1.61 1.61 0 0 0-1.29.58A2.79 2.79 0 0 0 15 12a3 3 0 0 0 .49 1.93 1.61 1.61 0 0 0 1.27.58 1.44 1.44 0 0 0 1-.37 2.1 2.1 0 0 0 .6-1.15l1.4.44a3.17 3.17 0 0 1-1.1 1.7Z"/>
</svg>`,f0=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M17.73 14.09a1.4 1.4 0 0 1-1 .37 1.579 1.579 0 0 1-1.27-.58A3 3 0 0 1 15 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34A2.89 2.89 0 0 0 19 9.07a3 3 0 0 0-2.14-.78 3.14 3.14 0 0 0-2.42 1 3.91 3.91 0 0 0-.93 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.17 3.17 0 0 0 1.07-1.74l-1.4-.45c-.083.43-.3.822-.62 1.12Zm-7.22 0a1.43 1.43 0 0 1-1 .37 1.58 1.58 0 0 1-1.27-.58A3 3 0 0 1 7.76 12a2.8 2.8 0 0 1 .5-1.85 1.63 1.63 0 0 1 1.29-.57 1.47 1.47 0 0 1 1.51 1.2l1.43-.34a2.81 2.81 0 0 0-.74-1.32 2.94 2.94 0 0 0-2.13-.78 3.18 3.18 0 0 0-2.43 1 4 4 0 0 0-.92 2.78 3.74 3.74 0 0 0 .92 2.66 3.07 3.07 0 0 0 2.34 1 3.07 3.07 0 0 0 1.91-.57 3.23 3.23 0 0 0 1.07-1.74l-1.4-.45a2.06 2.06 0 0 1-.6 1.07Zm12.32-8.41a2.59 2.59 0 0 0-2.3-2.51C18.72 3.05 15.86 3 13 3c-2.86 0-5.72.05-7.53.17a2.59 2.59 0 0 0-2.3 2.51c-.23 4.207-.23 8.423 0 12.63a2.57 2.57 0 0 0 2.3 2.5c1.81.13 4.67.19 7.53.19 2.86 0 5.72-.06 7.53-.19a2.57 2.57 0 0 0 2.3-2.5c.23-4.207.23-8.423 0-12.63Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18-2.98 0-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11c-.21-4.14-.21-8.29 0-12.43a1.11 1.11 0 0 1 .91-1.11C7.24 4.56 10 4.49 13 4.49s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11c.21 4.14.21 8.29 0 12.43Z"/>
</svg>`,Rf=We.createElement("template");Rf.innerHTML=`
  <style>
  :host([aria-checked="true"]) slot:not([name=on]) > *,
  :host([aria-checked="true"]) ::slotted(:not([slot=on])) {
    display: none !important;
  }

  
  :host(:not([aria-checked="true"])) slot:not([name=off]) > *, 
  :host(:not([aria-checked="true"])) ::slotted(:not([slot=off])) {
    display: none !important;
  }
  </style>

  <slot name="on">${h0}</slot>
  <slot name="off">${f0}</slot>
`;const zd=o=>{o.setAttribute("aria-checked",ef(o))};class p0 extends Cr{static get observedAttributes(){return[...super.observedAttributes,"no-subtitles-fallback","default-showing",N.MEDIA_CAPTIONS_LIST,N.MEDIA_CAPTIONS_SHOWING,N.MEDIA_SUBTITLES_LIST,N.MEDIA_SUBTITLES_SHOWING]}constructor(n={}){super({slotTemplate:Rf,...n}),this._captionsReady=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","switch"),this.setAttribute("aria-label",Li.CLOSED_CAPTIONS()),zd(this)}attributeChangedCallback(n,u,p){if([N.MEDIA_CAPTIONS_SHOWING,N.MEDIA_SUBTITLES_SHOWING].includes(n)&&zd(this),this.hasAttribute("default-showing")&&this.getAttribute("aria-checked")!=="true"){const v=!this.hasAttribute("no-subtitles-fallback");if((v?[N.MEDIA_CAPTIONS_LIST,N.MEDIA_SUBTITLES_LIST]:[N.MEDIA_CAPTIONS_LIST]).includes(n)){const L=!!this.getAttribute(N.MEDIA_CAPTIONS_LIST)||!!(v&&this.getAttribute(N.MEDIA_SUBTITLES_LIST));this._captionsReady!==L&&(this._captionsReady=L,this._captionsReady&&Hl(this))}}super.attributeChangedCallback(n,u,p)}handleClick(){Hl(this)}}ne.customElements.get("media-captions-button")||ne.customElements.define("media-captions-button",p0);const Wl="30",m0=`<svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(8.9 19.87)">${Wl}</text><path d="M10 6V3l5.61 4L10 10.94V8a5.54 5.54 0 0 0-1.9 10.48v2.12A7.5 7.5 0 0 1 10 6Z"/></svg>`,If=We.createElement("template");If.innerHTML=`  
  <slot name="forward">${m0}</slot>
`;const v0=0,Qd=o=>{const n=Math.abs(+o.getAttribute("seek-offset")),u=lr.SEEK_FORWARD_N_SECS({seekOffset:n});o.setAttribute("aria-label",u)},Xd=o=>{const n=Bh(o,"forward"),u=o.getAttribute("seek-offset");Uh(n,u)};class g0 extends Cr{static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_CURRENT_TIME,"seek-offset"]}constructor(n={}){super({slotTemplate:If,...n})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",Wl),Qd(this),Xd(this),super.connectedCallback()}attributeChangedCallback(n,u,p){n==="seek-offset"&&(p==null&&this.setAttribute("seek-offset",Wl),Xd(this),Qd(this)),super.attributeChangedCallback(n,u,p)}handleClick(){const n=this.getAttribute(N.MEDIA_CURRENT_TIME),u=+this.getAttribute("seek-offset"),v=(n&&!Number.isNaN(+n)?+n:v0)+u,T=new ne.CustomEvent(Ve.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:v});this.dispatchEvent(T)}}ne.customElements.get("media-seek-forward-button")||ne.customElements.define("media-seek-forward-button",g0);const y0=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M16 3v2.5h3.5V9H22V3h-6ZM4 9h2.5V5.5H10V3H4v6Zm15.5 9.5H16V21h6v-6h-2.5v3.5ZM6.5 15H4v6h6v-2.5H6.5V15Z"/>
</svg>`,E0=`<svg aria-hidden="true" viewBox="0 0 26 24">
  <path d="M18.5 6.5V3H16v6h6V6.5h-3.5ZM16 21h2.5v-3.5H22V15h-6v6ZM4 17.5h3.5V21H10v-6H4v2.5Zm3.5-11H4V9h6V3H7.5v3.5Z"/>
</svg>`,Lf=We.createElement("template");Lf.innerHTML=`
  <style>
  :host([${N.MEDIA_IS_FULLSCREEN}]) slot:not([name=exit]) > *,
  :host([${N.MEDIA_IS_FULLSCREEN}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${N.MEDIA_IS_FULLSCREEN}])) slot:not([name=enter]) > *,
  :host(:not([${N.MEDIA_IS_FULLSCREEN}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${y0}</slot>
  <slot name="exit">${E0}</slot>
`;const Zd=o=>{const u=o.getAttribute(N.MEDIA_IS_FULLSCREEN)!=null?lr.EXIT_FULLSCREEN():lr.ENTER_FULLSCREEN();o.setAttribute("aria-label",u)};let b0=class extends Cr{static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_IS_FULLSCREEN,N.MEDIA_FULLSCREEN_UNAVAILABLE]}constructor(n={}){super({slotTemplate:Lf,...n})}connectedCallback(){Zd(this),super.connectedCallback()}attributeChangedCallback(n,u,p){n===N.MEDIA_IS_FULLSCREEN&&Zd(this),super.attributeChangedCallback(n,u,p)}handleClick(){const n=this.getAttribute(N.MEDIA_IS_FULLSCREEN)!=null?Ve.MEDIA_EXIT_FULLSCREEN_REQUEST:Ve.MEDIA_ENTER_FULLSCREEN_REQUEST;this.dispatchEvent(new ne.CustomEvent(n,{composed:!0,bubbles:!0}))}};ne.customElements.get("media-fullscreen-button")||ne.customElements.define("media-fullscreen-button",b0);const{MEDIA_TIME_IS_LIVE:Ea,MEDIA_PAUSED:Rn}=N,{MEDIA_SEEK_TO_LIVE_REQUEST:_0,MEDIA_PLAY_REQUEST:T0}=Ve,S0='<svg viewBox="0 0 6 12"><circle cx="3" cy="6" r="2"></circle></svg>',Df=We.createElement("template");Df.innerHTML=`
  <style>

  slot[name=indicator] > *,
  :host ::slotted([slot=indicator]) {
    
    min-width: auto;
    fill: var(--media-live-button-icon-color, rgb(140, 140, 140));
    color: var(--media-live-button-icon-color, rgb(140, 140, 140));
  }

  :host([${Ea}]:not([${Rn}])) slot[name=indicator] > *,
  :host([${Ea}]:not([${Rn}])) ::slotted([slot=indicator]) {
    fill: var(--media-live-indicator-color, rgb(255, 0, 0));
    color: var(--media-live-indicator-color, rgb(255, 0, 0));
  }

  :host([${Ea}]:not([${Rn}])) {
    cursor: not-allowed;
  }

  </style>

  <slot name="indicator">${S0}</slot>
  
  <slot name="spacer">&nbsp;</slot><slot name="text">LIVE</slot>
`;class A0 extends Cr{static get observedAttributes(){return[...super.observedAttributes,Rn,Ea]}constructor(n={}){super({slotTemplate:Df,...n}),this.setAttribute("aria-label","Seek to Live")}attributeChangedCallback(n,u,p){super.attributeChangedCallback(n,u,p)}handleClick(){!this.hasAttribute(Rn)&&this.hasAttribute(Ea)||(this.dispatchEvent(new ne.CustomEvent(_0,{composed:!0,bubbles:!0})),this.hasAttribute(Rn)&&this.dispatchEvent(new ne.CustomEvent(T0,{composed:!0,bubbles:!0})))}}ne.customElements.get("media-live-button")||ne.customElements.define("media-live-button",A0);const w0=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M16.5 12A4.5 4.5 0 0 0 14 8v2.18l2.45 2.45a4.22 4.22 0 0 0 .05-.63Zm2.5 0a6.84 6.84 0 0 1-.54 2.64L20 16.15A8.8 8.8 0 0 0 21 12a9 9 0 0 0-7-8.77v2.06A7 7 0 0 1 19 12ZM4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25A6.92 6.92 0 0 1 14 18.7v2.06A9 9 0 0 0 17.69 19l2 2.05L21 19.73l-9-9L4.27 3ZM12 4 9.91 6.09 12 8.18V4Z"/>
</svg>`,Jd=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4Z"/>
</svg>`,k0=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M3 9v6h4l5 5V4L7 9H3Zm13.5 3A4.5 4.5 0 0 0 14 8v8a4.47 4.47 0 0 0 2.5-4ZM14 3.23v2.06a7 7 0 0 1 0 13.42v2.06a9 9 0 0 0 0-17.54Z"/>
</svg>`,Cf=We.createElement("template");Cf.innerHTML=`
  <style>
  
  :host(:not([${N.MEDIA_VOLUME_LEVEL}])) slot:not([name=high]) > *, 
  :host(:not([${N.MEDIA_VOLUME_LEVEL}])) ::slotted(:not([slot=high])),
  :host([${N.MEDIA_VOLUME_LEVEL}=high]) slot:not([name=high]) > *, 
  :host([${N.MEDIA_VOLUME_LEVEL}=high]) ::slotted(:not([slot=high])) {
    display: none !important;
  }

  :host([${N.MEDIA_VOLUME_LEVEL}=off]) slot:not([name=off]) > *, 
  :host([${N.MEDIA_VOLUME_LEVEL}=off]) ::slotted(:not([slot=off])) {
    display: none !important;
  }

  :host([${N.MEDIA_VOLUME_LEVEL}=low]) slot:not([name=low]) > *, 
  :host([${N.MEDIA_VOLUME_LEVEL}=low]) ::slotted(:not([slot=low])) {
    display: none !important;
  }

  :host([${N.MEDIA_VOLUME_LEVEL}=medium]) slot:not([name=medium]) > *, 
  :host([${N.MEDIA_VOLUME_LEVEL}=medium]) ::slotted(:not([slot=medium])) {
    display: none !important;
  }
  </style>

  <slot name="off">${w0}</slot>
  <slot name="low">${Jd}</slot>
  <slot name="medium">${Jd}</slot>
  <slot name="high">${k0}</slot>
`;const ec=o=>{const u=o.getAttribute(N.MEDIA_VOLUME_LEVEL)==="off"?lr.UNMUTE():lr.MUTE();o.setAttribute("aria-label",u)};let R0=class extends Cr{static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_VOLUME_LEVEL]}constructor(n={}){super({slotTemplate:Cf,...n})}connectedCallback(){ec(this),super.connectedCallback()}attributeChangedCallback(n,u,p){n===N.MEDIA_VOLUME_LEVEL&&ec(this),super.attributeChangedCallback(n,u,p)}handleClick(){const n=this.getAttribute(N.MEDIA_VOLUME_LEVEL)==="off"?Ve.MEDIA_UNMUTE_REQUEST:Ve.MEDIA_MUTE_REQUEST;this.dispatchEvent(new ne.CustomEvent(n,{composed:!0,bubbles:!0}))}};ne.customElements.get("media-mute-button")||ne.customElements.define("media-mute-button",R0);const tc=`<svg aria-hidden="true" viewBox="0 0 28 24">
  <path d="M24 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h20a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1Zm-1 16H5V5h18v14Zm-3-8h-7v5h7v-5Z"/>
</svg>`,xf=We.createElement("template");xf.innerHTML=`
  <style>
  :host([${N.MEDIA_IS_PIP}]) slot:not([name=exit]) > *, 
  :host([${N.MEDIA_IS_PIP}]) ::slotted(:not([slot=exit])) {
    display: none !important;
  }

  
  :host(:not([${N.MEDIA_IS_PIP}])) slot:not([name=enter]) > *, 
  :host(:not([${N.MEDIA_IS_PIP}])) ::slotted(:not([slot=enter])) {
    display: none !important;
  }
  </style>

  <slot name="enter">${tc}</slot>
  <slot name="exit">${tc}</slot>
`;const rc=o=>{const u=o.getAttribute(N.MEDIA_IS_PIP)!=null?lr.EXIT_PIP():lr.ENTER_PIP();o.setAttribute("aria-label",u)};class I0 extends Cr{static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_IS_PIP,N.MEDIA_PIP_UNAVAILABLE]}constructor(n={}){super({slotTemplate:xf,...n})}connectedCallback(){rc(this),super.connectedCallback()}attributeChangedCallback(n,u,p){n===N.MEDIA_IS_PIP&&rc(this),super.attributeChangedCallback(n,u,p)}handleClick(){const n=this.getAttribute(N.MEDIA_IS_PIP)!=null?Ve.MEDIA_EXIT_PIP_REQUEST:Ve.MEDIA_ENTER_PIP_REQUEST;this.dispatchEvent(new ne.CustomEvent(n,{composed:!0,bubbles:!0}))}}ne.customElements.get("media-pip-button")||ne.customElements.define("media-pip-button",I0);const L0=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="m6 21 15-9L6 3v18Z"/>
</svg>`,D0=`<svg aria-hidden="true" viewBox="0 0 24 24">
  <path d="M6 20h4V4H6v16Zm8-16v16h4V4h-4Z"/>
</svg>`,Mf=We.createElement("template");Mf.innerHTML=`
  <style>
  :host([${N.MEDIA_PAUSED}]) slot[name=pause] > *, 
  :host([${N.MEDIA_PAUSED}]) ::slotted([slot=pause]) {
    display: none !important;
  }

  :host(:not([${N.MEDIA_PAUSED}])) slot[name=play] > *, 
  :host(:not([${N.MEDIA_PAUSED}])) ::slotted([slot=play]) {
    display: none !important;
  }
  </style>

  <slot name="play">${L0}</slot>
  <slot name="pause">${D0}</slot>
`;const ic=o=>{const u=o.getAttribute(N.MEDIA_PAUSED)!=null?lr.PLAY():lr.PAUSE();o.setAttribute("aria-label",u)};let C0=class extends Cr{static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_PAUSED]}constructor(n={}){super({slotTemplate:Mf,...n})}connectedCallback(){ic(this),super.connectedCallback()}attributeChangedCallback(n,u,p){n===N.MEDIA_PAUSED&&ic(this),super.attributeChangedCallback(n,u,p)}handleClick(){const n=this.getAttribute(N.MEDIA_PAUSED)!=null?Ve.MEDIA_PLAY_REQUEST:Ve.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ne.CustomEvent(n,{composed:!0,bubbles:!0}))}};ne.customElements.get("media-play-button")||ne.customElements.define("media-play-button",C0);const nc=[1,1.25,1.5,1.75,2],ks=1,Pf=We.createElement("template");Pf.innerHTML=`
  <span id="container"></span>
`;class x0 extends Cr{static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_PLAYBACK_RATE,"rates"]}constructor(n={}){super({slotTemplate:Pf,...n}),this._rates=nc,this.container=this.shadowRoot.querySelector("#container"),this.container.innerHTML=`${ks}x`}attributeChangedCallback(n,u,p){if(n==="rates"){const v=(p??"").trim().split(/\s*,?\s+/).map(T=>Number(T)).filter(T=>!Number.isNaN(T)).sort((T,L)=>T-L);this._rates=v.length?v:nc;return}if(n===N.MEDIA_PLAYBACK_RATE){const v=p?+p:Number.NaN,T=Number.isNaN(v)?ks:v;this.container.innerHTML=`${T}x`,this.setAttribute("aria-label",Li.PLAYBACK_RATE({playbackRate:T}));return}super.attributeChangedCallback(n,u,p)}handleClick(){var n,u;const p=+this.getAttribute(N.MEDIA_PLAYBACK_RATE)||ks,v=(u=(n=this._rates.find(L=>L>p))!=null?n:this._rates[0])!=null?u:ks,T=new ne.CustomEvent(Ve.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:v});this.dispatchEvent(T)}}ne.customElements.get("media-playback-rate-button")||ne.customElements.define("media-playback-rate-button",x0);const Of=We.createElement("template");Of.innerHTML=`
  <style>
    :host {
      pointer-events: none;
      display: var(--media-poster-image-display, inline-block);
      box-sizing: border-box;
    }

    img {
      max-width: 100%;
      max-height: 100%;
      min-width: 100%;
      min-height: 100%;
      background-repeat: no-repeat;
      background-position: var(--media-background-position, var(--media-object-position, center));
      background-size: var(--media-background-size, var(--media-object-fit, contain));
      object-fit: var(--media-object-fit, contain);
      object-position: var(--media-object-position, center);
    }
  </style>

  <img aria-hidden="true" id="image"/>
`;const M0=o=>{o.style.removeProperty("background-image")},P0=(o,n)=>{o.style["background-image"]=`url('${n}')`};let O0=class extends ne.HTMLElement{static get observedAttributes(){return["placeholder-src","src"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Of.content.cloneNode(!0)),this.image=this.shadowRoot.querySelector("#image")}attributeChangedCallback(n,u,p){n==="src"&&(p==null?this.image.removeAttribute("src"):this.image.setAttribute("src",p)),n==="placeholder-src"&&(p==null?M0(this.image):P0(this.image,p))}};ne.customElements.get("media-poster-image")||ne.customElements.define("media-poster-image",O0);var vu=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},Ct=(o,n,u)=>(vu(o,n,"read from private field"),u?u.call(o):n.get(o)),zt=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},bi=(o,n,u,p)=>(vu(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),ia=(o,n,u)=>(vu(o,n,"access private method"),u),ua,Gs,da,Zs,Js,Hs,$l,Vs,An,ba,Yl,eo,uo,Ks,zl,Ql,Ff;const F0="video not loaded, unknown time.",Tl=o=>{const n=o.range,u=va(+n.value),p=va(+n.max),v=u&&p?`${u} of ${p}`:F0;n.setAttribute("aria-valuetext",v)},Nf=We.createElement("template");Nf.innerHTML=`
  <style>
    :host {
      --media-preview-background-color: rgba(20,20,30, .5);
      --media-preview-background: var(--media-control-background,
        var(--media-preview-background-color));
      --media-preview-border-radius: 3px;
      --media-box-padding-left: 10px;
      --media-box-padding-right: 10px;
      color: #fff;
    }

    #preview-rail,
    #current-rail {
      
      width: 1%;
      position: absolute;
      left: 0;
      bottom: 100%;
      pointer-events: none;
    }

    [part~="box"] {
      
      position: absolute;
      bottom: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      transform: translateX(-50%);
    }

    [part~="preview-box"] {
      transition-property: var(--media-preview-transition-property, visibility, opacity);
      transition-duration: var(--media-preview-transition-duration-out, .25s);
      transition-delay: var(--media-preview-transition-delay-out, 0s);
      visibility: hidden;
      opacity: 0;
    }

    :host([${N.MEDIA_PREVIEW_IMAGE}]:hover) [part~="preview-box"],
    :host([${N.MEDIA_PREVIEW_TIME}]:hover) [part~="preview-box"] {
      transition-duration: var(--media-preview-transition-duration-in, .5s);
      transition-delay: var(--media-preview-transition-delay-in, .25s);
      visibility: visible;
      opacity: 1;
    }

    media-preview-thumbnail,
    ::slotted(media-preview-thumbnail) {
      visibility: hidden;
      
      transition: visibility 0s .25s;
      transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));
      background: var(--media-preview-time-background, var(--media-preview-background));
      box-shadow: var(--media-preview-thumbnail-box-shadow, 0 0 4px rgba(0,0,0, .2));
      max-width: var(--media-preview-thumbnail-max-width, 180px);
      max-height: var(--media-preview-thumbnail-max-height, 160px);
      min-width: var(--media-preview-thumbnail-min-width, 120px);
      min-height: var(--media-preview-thumbnail-min-height, 80px);
      border: var(--media-preview-thumbnail-border);
      border-radius: var(--media-preview-thumbnail-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius) 0 0);
    }

    :host([${N.MEDIA_PREVIEW_IMAGE}]:hover) media-preview-thumbnail,
    :host([${N.MEDIA_PREVIEW_IMAGE}]:hover) ::slotted(media-preview-thumbnail) {
      transition-delay: var(--media-preview-transition-delay-in, .25s);
      visibility: visible;
    }

    media-preview-time-display,
    ::slotted(media-preview-time-display) {
      color: unset;
      min-width: 0;
      
      transition: min-width 0s, border-radius 0s;
      transition-delay: calc(var(--media-preview-transition-delay-out, 0s) + var(--media-preview-transition-duration-out, .25s));
      background: var(--media-preview-time-background, var(--media-preview-background));
      border-radius: var(--media-preview-time-border-radius,
        var(--media-preview-border-radius) var(--media-preview-border-radius)
        var(--media-preview-border-radius) var(--media-preview-border-radius));
      padding: var(--media-preview-time-padding, 1px 10px 0);
      margin: var(--media-preview-time-margin, 0 0 10px);
      text-shadow: var(--media-preview-time-text-shadow, 0 0 4px rgba(0,0,0, .75));
    }

    :host([${N.MEDIA_PREVIEW_IMAGE}]) media-preview-time-display,
    :host([${N.MEDIA_PREVIEW_IMAGE}]) ::slotted(media-preview-time-display) {
      transition-delay: var(--media-preview-transition-delay-in, .25s);
      min-width: 100%;
      border-radius: var(--media-preview-time-border-radius,
        0 0 var(--media-preview-border-radius) var(--media-preview-border-radius));
    }

    :host([${N.MEDIA_PREVIEW_TIME}]:hover) {
      --media-time-range-hover-display: block;
    }
  </style>
  <div id="preview-rail">
    <slot name="preview" part="box preview-box">
      <media-preview-thumbnail></media-preview-thumbnail>
      <media-preview-time-display></media-preview-time-display>
    </slot>
  </div>
  <div id="current-rail">
    <slot name="current" part="box current-box">
      
    </slot>
  </div>
`;let Uf=class extends yf{constructor(){super(),zt(this,Hs),zt(this,Ks),zt(this,Ql),zt(this,ua,void 0),zt(this,Gs,void 0),zt(this,da,void 0),zt(this,Zs,void 0),zt(this,Js,void 0),zt(this,Vs,u=>{if([...Ct(this,ua)].some(G=>u.composedPath().includes(G)))return;this.updatePointerBar(u);const p=+this.getAttribute(N.MEDIA_DURATION);if(!p)return;const v=this.range.getBoundingClientRect();let T=(u.clientX-v.left)/v.width;T=Math.max(0,Math.min(1,T));const L=ia(this,Hs,$l).call(this,Ct(this,Gs),T),{style:C}=Er(this.shadowRoot,"#preview-rail");C.transform=`translateX(${L})`;const M=T*p,V=new ne.CustomEvent(Ve.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:M});this.dispatchEvent(V)}),zt(this,An,!1),zt(this,ba,u=>{(!u.composedPath().includes(this)||[...Ct(this,ua)].some(p=>u.composedPath().includes(p)))&&(ne.removeEventListener("pointermove",Ct(this,ba)),bi(this,An,!1),Ct(this,eo).call(this))}),zt(this,Yl,()=>{ne.addEventListener("pointermove",Ct(this,Vs),!1)}),zt(this,eo,()=>{ne.removeEventListener("pointermove",Ct(this,Vs));const u=new ne.CustomEvent(Ve.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:null});this.dispatchEvent(u)}),zt(this,uo,()=>{const u=this.getAttribute(N.MEDIA_DURATION);!Ct(this,An)&&u&&(bi(this,An,!0),Ct(this,Yl).call(this),ne.addEventListener("pointermove",Ct(this,ba),!1))}),this.container.appendChild(Nf.content.cloneNode(!0)),this.range.addEventListener("input",()=>{cancelAnimationFrame(this._refreshId);const p=this.range.value,v=new ne.CustomEvent(Ve.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:p});this.dispatchEvent(v)}),this._refreshBar=()=>{const u=(performance.now()-this._updateTimestamp)/1e3;this.range.value=this.mediaCurrentTime+u*this.mediaPlaybackRate,this.updateBar(),this.updateCurrentBox(),this._refreshId=requestAnimationFrame(this._refreshBar)},bi(this,ua,this.shadowRoot.querySelectorAll('[part~="box"]')),bi(this,Gs,this.shadowRoot.querySelector('[part~="preview-box"]')),bi(this,da,this.shadowRoot.querySelector('[part~="current-box"]'));const n=getComputedStyle(this);bi(this,Zs,parseInt(n.getPropertyValue("--media-box-padding-left"))),bi(this,Js,parseInt(n.getPropertyValue("--media-box-padding-right"))),ia(this,Ks,zl).call(this)}static get observedAttributes(){return[...super.observedAttributes,"thumbnails","disabled",N.MEDIA_PAUSED,N.MEDIA_DURATION,N.MEDIA_SEEKABLE,N.MEDIA_CURRENT_TIME,N.MEDIA_PREVIEW_IMAGE,N.MEDIA_PREVIEW_TIME,N.MEDIA_BUFFERED,N.MEDIA_PLAYBACK_RATE,N.MEDIA_LOADING]}connectedCallback(){this.range.setAttribute("aria-label",Li.SEEK()),super.connectedCallback()}disconnectedCallback(){cancelAnimationFrame(this._refreshId),super.disconnectedCallback()}attributeChangedCallback(n,u,p){var v,T,L,C,M;(n===N.MEDIA_CURRENT_TIME||n===N.MEDIA_PAUSED||n===N.MEDIA_LOADING)&&(this._updateTimestamp=performance.now(),this.range.value=this.mediaCurrentTime,Tl(this),this.updateBar(),this.updateCurrentBox(),cancelAnimationFrame(this._refreshId),!this.mediaPaused&&!this.mediaLoading&&(this._refreshId=requestAnimationFrame(this._refreshBar))),n===N.MEDIA_DURATION&&(this.range.max=(T=(v=this.mediaSeekableEnd)!=null?v:this.mediaDuration)!=null?T:1e3,Tl(this),this.updateBar(),this.updateCurrentBox()),n===N.MEDIA_SEEKABLE&&(this.range.min=(L=this.mediaSeekableStart)!=null?L:0,this.range.max=(M=(C=this.mediaSeekableEnd)!=null?C:this.mediaDuration)!=null?M:1e3,Tl(this),this.updateBar()),n===N.MEDIA_BUFFERED&&this.updateBar(),n==="disabled"&&(p==null?ia(this,Ks,zl).call(this):ia(this,Ql,Ff).call(this)),super.attributeChangedCallback(n,u,p)}get mediaPaused(){return this.hasAttribute(N.MEDIA_PAUSED)}get mediaLoading(){return this.hasAttribute(N.MEDIA_LOADING)}get mediaDuration(){const n=this.getAttribute(N.MEDIA_DURATION);return n!=null?+n:void 0}get mediaCurrentTime(){const n=this.getAttribute(N.MEDIA_CURRENT_TIME);return n!=null?+n:void 0}get mediaPlaybackRate(){const n=this.getAttribute(N.MEDIA_PLAYBACK_RATE);return n!=null?+n:1}get mediaBuffered(){const n=this.getAttribute(N.MEDIA_BUFFERED);return n?n.split(" ").map(u=>u.split(":").map(p=>+p)):[]}get mediaSeekable(){const n=this.getAttribute(N.MEDIA_SEEKABLE);if(n)return n.split(":").map(u=>+u)}get mediaSeekableEnd(){var n;const[,u]=(n=this.mediaSeekable)!=null?n:[];return u}get mediaSeekableStart(){var n;const[u]=(n=this.mediaSeekable)!=null?n:[];return u}getBarColors(){var n;let u=super.getBarColors();const{range:p}=this,v=p.max-p.min,T=this.mediaBuffered;if(!T.length||!Number.isFinite(v)||v<=0)return u;const L=this.mediaCurrentTime,[,C=p.min]=(n=T.find(([G,Y])=>G<=L&&L<=Y))!=null?n:[],V=(C-p.min)/v*100;return u.splice(1,0,["var(--media-time-buffered-color, rgba(255,255,255, .4))",V]),u}updateCurrentBox(){if(!Ct(this,da).assignedElements().length)return;const n=this.range.value/(this.range.max-this.range.min),u=ia(this,Hs,$l).call(this,Ct(this,da),n),{style:p}=Er(this.shadowRoot,"#current-rail");p.transform=`translateX(${u})`}};ua=new WeakMap;Gs=new WeakMap;da=new WeakMap;Zs=new WeakMap;Js=new WeakMap;Hs=new WeakSet;$l=function(o,n){var u;let p=`${n*100*100}%`;const v=o.offsetWidth;if(!v)return p;const T=(u=this.getAttribute("bounds")?fu(this,`#${this.getAttribute("bounds")}`):this.parentElement)!=null?u:this,L=this.range.getBoundingClientRect(),C=T.getBoundingClientRect(),M=(Ct(this,Zs)-(L.left-C.left-v/2))/L.width*100,V=(C.right-L.left-v/2-Ct(this,Js))/L.width*100;return Number.isNaN(M)||(p=`max(${M*100}%, ${p})`),Number.isNaN(V)||(p=`min(${p}, ${V*100}%)`),p};Vs=new WeakMap;An=new WeakMap;ba=new WeakMap;Yl=new WeakMap;eo=new WeakMap;uo=new WeakMap;Ks=new WeakSet;zl=function(){this.addEventListener("pointermove",Ct(this,uo),!1)};Ql=new WeakSet;Ff=function(){ne.removeEventListener("pointermove",Ct(this,ba)),this.removeEventListener("pointermove",Ct(this,uo)),bi(this,An,!1),Ct(this,eo).call(this)};ne.customElements.get("media-time-range")||ne.customElements.define("media-time-range",Uf);var N0=Uf;class U0 extends N0{constructor(){super(),console.warn("MediaChrome: <media-progress-range> is deprecated. Use <media-time-range> instead.")}}ne.customElements.get("media-progress-range")||ne.customElements.define("media-progress-range",U0);const Xl="30",B0=`<svg aria-hidden="true" viewBox="0 0 20 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(2.18 19.87)">${Xl}</text><path d="M10 6V3L4.37 7 10 10.94V8a5.54 5.54 0 0 1 1.9 10.48v2.12A7.5 7.5 0 0 0 10 6Z"/></svg>`,Bf=We.createElement("template");Bf.innerHTML=`  
  <slot name="backward">${B0}</slot>
`;const G0=0,ac=o=>{const n=Math.abs(+o.getAttribute("seek-offset")),u=lr.SEEK_BACK_N_SECS({seekOffset:n});o.setAttribute("aria-label",u)},sc=o=>{const n=Bh(o,"backward"),u=o.getAttribute("seek-offset");Uh(n,u)};class H0 extends Cr{static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_CURRENT_TIME]}constructor(n={}){super({slotTemplate:Bf,...n})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",Xl),ac(this),sc(this),super.connectedCallback()}attributeChangedCallback(n,u,p){n==="seek-offset"&&(p==null&&this.setAttribute("seek-offset",Xl),sc(this),ac(this)),super.attributeChangedCallback(n,u,p)}handleClick(){const n=this.getAttribute(N.MEDIA_CURRENT_TIME),u=+this.getAttribute("seek-offset"),p=n&&!Number.isNaN(+n)?+n:G0,v=Math.max(p-u,0),T=new ne.CustomEvent(Ve.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:v});this.dispatchEvent(T)}}ne.customElements.get("media-seek-backward-button")||ne.customElements.define("media-seek-backward-button",H0);var Gf=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},oc=(o,n,u)=>(Gf(o,n,"read from private field"),u?u.call(o):n.get(o)),V0=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},K0=(o,n,u,p)=>(Gf(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),ca;class q0 extends lo{constructor(){super(),V0(this,ca,void 0),K0(this,ca,this.shadowRoot.querySelector("slot")),oc(this,ca).textContent=di(0)}static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_PREVIEW_TIME]}attributeChangedCallback(n,u,p){n===N.MEDIA_PREVIEW_TIME&&p!=null&&(oc(this,ca).textContent=di(p)),super.attributeChangedCallback(n,u,p)}}ca=new WeakMap;ne.customElements.get("media-preview-time-display")||ne.customElements.define("media-preview-time-display",q0);var Hf=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},Rs=(o,n,u)=>(Hf(o,n,"read from private field"),u?u.call(o):n.get(o)),j0=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},Is=(o,n,u,p)=>(Hf(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),$r;const Vf=We.createElement("template");Vf.innerHTML=`
  <style>
    :host {
      box-sizing: border-box;
      display: var(--media-control-display, var(--media-preview-thumbnail-display, inline-block));
      overflow: hidden;
    }

    img {
      display: none;
      position: relative;
    }
  </style>
  <img crossorigin loading="eager" decoding="async" />
`;class W0 extends ne.HTMLElement{constructor(){super(),j0(this,$r,void 0),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Vf.content.cloneNode(!0))}static get observedAttributes(){return[ht.MEDIA_CONTROLLER,"time",N.MEDIA_PREVIEW_IMAGE,N.MEDIA_PREVIEW_COORDS]}connectedCallback(){var n,u,p;const v=this.getAttribute(ht.MEDIA_CONTROLLER);v&&(Is(this,$r,(n=this.getRootNode())==null?void 0:n.getElementById(v)),(p=(u=Rs(this,$r))==null?void 0:u.associateElement)==null||p.call(u,this))}disconnectedCallback(){var n,u;(u=(n=Rs(this,$r))==null?void 0:n.unassociateElement)==null||u.call(n,this),Is(this,$r,null)}attributeChangedCallback(n,u,p){var v,T,L,C,M;["time",N.MEDIA_PREVIEW_IMAGE,N.MEDIA_PREVIEW_COORDS].includes(n)&&this.update(),n===ht.MEDIA_CONTROLLER&&(u&&((T=(v=Rs(this,$r))==null?void 0:v.unassociateElement)==null||T.call(v,this),Is(this,$r,null)),p&&(Is(this,$r,(L=this.getRootNode())==null?void 0:L.getElementById(p)),(M=(C=Rs(this,$r))==null?void 0:C.associateElement)==null||M.call(C,this)))}update(){const n=this.getAttribute(N.MEDIA_PREVIEW_COORDS),u=this.getAttribute(N.MEDIA_PREVIEW_IMAGE);if(!(n&&u))return;const[p,v,T,L]=n.split(/\s+/).map(se=>+se),C=u.split("#")[0],M=getComputedStyle(this),{maxWidth:V,maxHeight:G,minWidth:Y,minHeight:Z}=M,j=Math.min(parseInt(V)/T,parseInt(G)/L),re=Math.max(parseInt(Y)/T,parseInt(Z)/L),ae=j<1,ue=ae?j:re>1?re:1,{style:ce}=Er(this.shadowRoot,":host"),pe=Er(this.shadowRoot,"img").style,xe=this.shadowRoot.querySelector("img"),le=ae?"min":"max";ce.setProperty(`${le}-width`,"initial","important"),ce.setProperty(`${le}-height`,"initial","important"),ce.width=`${T*ue}px`,ce.height=`${L*ue}px`;const w=()=>{pe.width=`${this.imgWidth*ue}px`,pe.height=`${this.imgHeight*ue}px`,pe.display="block"};xe.src!==C&&(xe.onload=()=>{this.imgWidth=xe.naturalWidth,this.imgHeight=xe.naturalHeight,w()},xe.src=C,w()),w(),pe.transform=`translate(-${p*ue}px, -${v*ue}px)`}}$r=new WeakMap;ne.customElements.get("media-preview-thumbnail")||ne.customElements.define("media-preview-thumbnail",W0);var Kf=(o,n,u)=>{if(!n.has(o))throw TypeError("Cannot "+u)},Ls=(o,n,u)=>(Kf(o,n,"read from private field"),u?u.call(o):n.get(o)),$0=(o,n,u)=>{if(n.has(o))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(o):n.set(o,u)},Ds=(o,n,u,p)=>(Kf(o,n,"write to private field"),p?p.call(o,u):n.set(o,u),u),Yr;const qf=We.createElement("template"),Y0=`
<svg aria-hidden="true" viewBox="0 0 100 100">
  <path d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
    <animateTransform
       attributeName="transform"
       attributeType="XML"
       type="rotate"
       dur="1s"
       from="0 50 50"
       to="360 50 50"
       repeatCount="indefinite" />
  </path>
</svg>
`;qf.innerHTML=`
<style>
:host {
  display: var(--media-control-display, var(--media-loading-indicator-display, inline-block));
  vertical-align: middle;
  box-sizing: border-box;
}

#status {
  color: rgba(0,0,0,0);
  width: 0px;
  height: 0px;
}

:host slot[name=loading] > *,
:host ::slotted([slot=loading]) {
  opacity: 1;
  transition: opacity 0.15s;
}

:host(:not([is-loading])) slot[name=loading] > *, 
:host(:not([is-loading])) ::slotted([slot=loading]) {
  opacity: 0;
}

:host(:not([is-loading])) #status {
  display: none;
}

svg, img, ::slotted(svg), ::slotted(img) {
  width: var(--media-loading-icon-width, 100px);
  height: var(--media-loading-icon-height);
  fill: var(--media-icon-color, #fff);
  vertical-align: middle;
}
</style>

<slot name="loading">${Y0}</slot>
<div id="status" role="status" aria-live="polite">${Li.MEDIA_LOADING()}</div>
`;const z0=500;let Q0=class extends ne.HTMLElement{constructor(){super(),$0(this,Yr,void 0);const n=this.attachShadow({mode:"open"}),u=qf.content.cloneNode(!0);n.appendChild(u)}static get observedAttributes(){return[ht.MEDIA_CONTROLLER,N.MEDIA_PAUSED,N.MEDIA_LOADING,"loading-delay"]}attributeChangedCallback(n,u,p){var v,T,L,C,M,V;if(n===N.MEDIA_LOADING||n===N.MEDIA_PAUSED){const G=this.getAttribute(N.MEDIA_PAUSED)!=null,Y=this.getAttribute(N.MEDIA_LOADING)!=null,Z=!G&&Y;if(!Z)this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0),this.removeAttribute("is-loading");else if(!this.loadingDelayHandle&&Z){const j=+((v=this.getAttribute("loading-delay"))!=null?v:z0);this.loadingDelayHandle=setTimeout(()=>{this.setAttribute("is-loading",""),this.loadingDelayHandle=void 0},j)}}else n===ht.MEDIA_CONTROLLER&&(u&&((L=(T=Ls(this,Yr))==null?void 0:T.unassociateElement)==null||L.call(T,this),Ds(this,Yr,null)),p&&(Ds(this,Yr,(C=this.getRootNode())==null?void 0:C.getElementById(p)),(V=(M=Ls(this,Yr))==null?void 0:M.associateElement)==null||V.call(M,this)))}connectedCallback(){var n,u,p;const v=this.getAttribute(ht.MEDIA_CONTROLLER);v&&(Ds(this,Yr,(n=this.getRootNode())==null?void 0:n.getElementById(v)),(p=(u=Ls(this,Yr))==null?void 0:u.associateElement)==null||p.call(u,this))}disconnectedCallback(){var n,u;this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0),(u=(n=Ls(this,Yr))==null?void 0:n.unassociateElement)==null||u.call(n,this),Ds(this,Yr,null)}};Yr=new WeakMap;ne.customElements.get("media-loading-indicator")||ne.customElements.define("media-loading-indicator",Q0);const jf=We.createElement("template");jf.innerHTML=`
  <style>
    :host {
    }
  </style>
  <slot></slot>
`;class X0 extends ne.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(jf.content.cloneNode(!0))}}ne.customElements.get("media-title-bar")||ne.customElements.define("media-title-bar",X0);const Z0=100,J0=o=>{var n;if(o.getAttribute(N.MEDIA_MUTED)!=null)return 0;const p=+((n=o.getAttribute(N.MEDIA_VOLUME))!=null?n:1);return Math.round(p*o.range.max)},eE=({value:o,max:n})=>`${Math.round(o/n*100)}%`;class tE extends yf{static get observedAttributes(){return[...super.observedAttributes,N.MEDIA_VOLUME,N.MEDIA_MUTED,N.MEDIA_VOLUME_UNAVAILABLE]}constructor(){super(),this.range.max=Z0,this.range.addEventListener("input",()=>{const u=this.range.value/this.range.max,p=new ne.CustomEvent(Ve.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:u});this.dispatchEvent(p)})}connectedCallback(){this.range.setAttribute("aria-label",Li.VOLUME()),super.connectedCallback()}attributeChangedCallback(n,u,p){if(n===N.MEDIA_VOLUME||n===N.MEDIA_MUTED){const v=J0(this);this.range.value=v,this.range.setAttribute("aria-valuetext",eE(this.range)),this.updateBar()}super.attributeChangedCallback(n,u,p)}}ne.customElements.get("media-volume-range")||ne.customElements.define("media-volume-range",tE);class rE extends pf{}ne.customElements.get("media-chrome")||ne.customElements.define("media-chrome",rE);class iE extends pf{constructor(){super(),console.warn("MediaChrome: <media-container> is deprecated. Use <media-controller>.")}}ne.customElements.get("media-container")||ne.customElements.define("media-container",iE);const lc={className:"class",classname:"class",htmlFor:"for",crossOrigin:"crossorigin",viewBox:"viewBox"},nE=o=>o.replace(/[A-Z]/g,n=>`-${n.toLowerCase()}`),aE=(o,n)=>{if(lc[o])return lc[o];if(typeof n!=null&&!(typeof n=="boolean"&&!n))return/[A-Z]/.test(o)?nE(o):o},sE=(o,n)=>typeof o=="boolean"?"":o,it=(o={})=>Object.entries(o).reduce((n,[u,p])=>{const v=aE(u,p);if(!v)return n;const T=sE(p);return n[v]=T,n},{});ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-chrome-button",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-airplay-button",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-cast-button",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-gesture-receiver",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-container-temp",it({...n,ref:u}),o));const oE=ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-controller",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-chrome-range",it({...n,ref:u}),o));const Wf=ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-control-bar",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-text-display",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-current-time-display",it({...n,ref:u}),o));const lE=ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-duration-display",it({...n,ref:u}),o)),uE=ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-time-display",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-captions-button",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-seek-forward-button",it({...n,ref:u}),o));const dE=ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-fullscreen-button",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-live-button",it({...n,ref:u}),o));const cE=ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-mute-button",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-pip-button",it({...n,ref:u}),o));const hE=ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-play-button",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-playback-rate-button",it({...n,ref:u}),o));const fE=ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-poster-image",it({...n,ref:u}),o)),pE=ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-time-range",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-progress-range",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-seek-backward-button",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-preview-time-display",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-preview-thumbnail",it({...n,ref:u}),o));const mE=ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-loading-indicator",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-title-bar",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-volume-range",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-chrome",it({...n,ref:u}),o));ge.forwardRef(({children:o,...n},u)=>ge.createElement("media-container",it({...n,ref:u}),o));var uc,dc,cc,hc,fc,pc,mc,vc,gc,yc,Ec,bc,_c,Tc,Sc,Ac,wc,kc,Rc;function Dt(o,n){return n||(n=o.slice(0)),Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(n)}}))}function vE(){return ee.useState(!1)}const gE=o=>{var n,u;const p=Xr(),v=Um(),T=Bm(),L=ee.useMemo(()=>{var C,M;return!!(o!=null&&o.assetId)&&((o==null?void 0:o.status)==="preparing"||((M=(C=o==null?void 0:o.data)==null?void 0:C.static_renditions)==null?void 0:M.status)==="preparing")},[o==null?void 0:o.assetId,(u=(n=o==null?void 0:o.data)==null?void 0:n.static_renditions)==null?void 0:u.status,o==null?void 0:o.status]);return Ov(L?"/".concat(v,"/addons/mux/assets/").concat(T,"/data/").concat(o==null?void 0:o.assetId):null,async()=>{const{data:C}=await p.request({url:"/addons/mux/assets/".concat(T,"/data/").concat(o.assetId),withCredentials:!0,method:"GET"});p.patch(o._id).set({status:C.status,data:C}).commit({returnDocuments:!1})},{refreshInterval:2e3,refreshWhenHidden:!0,dedupingInterval:1e3})},yE=["token","secretKey","enableSignedUrls","signingKeyId","signingKeyPrivate"],EE=()=>{const{error:o,isLoading:n,value:u}=Gm(Hm,yE),p=ee.useMemo(()=>{const v=!!u,T={token:(u==null?void 0:u.token)||null,secretKey:(u==null?void 0:u.secretKey)||null,enableSignedUrls:(u==null?void 0:u.enableSignedUrls)||!1,signingKeyId:(u==null?void 0:u.signingKeyId)||null,signingKeyPrivate:(u==null?void 0:u.signingKeyPrivate)||null};return{isInitialSetup:!v,needsSetup:!(T!=null&&T.token)||!(T!=null&&T.secretKey),secrets:T}},[u]);return{error:o,isLoading:n,value:p}};function bE(o,n,u){return new Jm(p=>{const v=bg({endpoint:n,file:u,dynamicChunkSize:!0}),T=()=>{p.next({type:"success",id:o}),p.complete()},L=G=>p.error(new Error(G.detail.message)),C=G=>p.next({type:"progress",percent:G.detail}),M=()=>{v.pause(),p.next({type:"pause",id:o})},V=()=>{v.resume(),p.next({type:"resume",id:o})};return v.on("success",T),v.on("error",L),v.on("progress",C),v.on("offline",M),v.on("online",V),()=>v.abort()})}function $f(o,n){const{dataset:u}=o.config();return o.request({url:"/addons/mux/assets/".concat(u,"/").concat(n),withCredentials:!0,method:"DELETE"})}function _E(o,n){const{dataset:u}=o.config();return o.request({url:"/addons/mux/assets/".concat(u,"/data/").concat(n),withCredentials:!0,method:"GET"})}function Ic(o,n,u,p,v,T){const L={_id:"secrets.mux",_type:"mux.apiKey",token:n,secretKey:u,enableSignedUrls:p,signingKeyId:v,signingKeyPrivate:T};return o.createOrReplace(L)}function TE(o){const{dataset:n}=o.config();return o.request({url:"/addons/mux/signing-keys/".concat(n),withCredentials:!0,method:"POST"})}function SE(o){const{dataset:n}=o.config();return o.request({url:"/addons/mux/secrets/".concat(n,"/test"),withCredentials:!0,method:"GET"})}async function AE(o,n,u){if(!(n&&u))return!1;const{dataset:p}=o.config();try{const v=await o.request({url:"/addons/mux/signing-keys/".concat(p,"/").concat(n),withCredentials:!0,method:"GET"});return!!(v.data&&v.data.id)}catch{return console.error("Error fetching signingKeyId",n,"assuming it is not valid"),!1}}function Yf(o){const{dataset:n}=o.config();return au(()=>o.observable.request({url:"/addons/mux/secrets/".concat(n,"/test"),withCredentials:!0,method:"GET"}))}function wE(o,n){return o.observable.request({url:"/addons/mux/uploads/".concat(o.config().dataset,"/").concat(n),withCredentials:!0,method:"DELETE"})}function kE(o,n,u){let p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return xE(u).pipe(js(v=>Il(Si({type:"url",url:v}),Yf(n).pipe(js(T=>{if(!T||!T.status)return wi(new Error("Invalid credentials"));const L=Zc(),{enableSignedUrls:C}=p,M={input:v,playback_policy:[C?"signed":"public"],mp4_support:o.mp4_support},V={muxBody:JSON.stringify(M),filename:v.split("/").slice(-1)[0]},G=n.config().dataset;return au(()=>n.observable.request({url:"/addons/mux/assets/".concat(G),withCredentials:!0,method:"POST",headers:{"MUX-Proxy-UUID":L,"Content-Type":"application/json"},query:V})).pipe(Cs(Y=>{const Z=Y&&Y.results&&Y.results[0]&&Y.results[0].document||null;return Z?Si({type:"success",id:L,asset:Z}):wi(new Error("No asset document returned"))}))})))))}function RE(o,n,u){let p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return CE(u).pipe(js(v=>Il(Si({type:"file",file:v}),Yf(n).pipe(js(T=>{if(!T||!T.status)return wi(new Error("Invalid credentials"));const L=Zc(),{enableSignedUrls:C}=p,M={mp4_support:o.mp4_support,playback_policy:[C?"signed":"public"]};return Il(Si({type:"uuid",uuid:L}),au(()=>n.observable.request({url:"/addons/mux/uploads/".concat(n.config().dataset),withCredentials:!0,method:"POST",headers:{"MUX-Proxy-UUID":L,"Content-Type":"application/json"},body:M})).pipe(Cs(V=>bE(L,V.upload.url,u).pipe(Cs(G=>G.type!=="success"?Si(G):Ym(DE(n,L)).pipe(Cs(Y=>Si({...G,asset:Y})))),zm(G=>wE(n,L).pipe(Qm(wi(G))))))))})))))}function IE(o,n){const{dataset:u}=o.config();return o.request({url:"/addons/mux/uploads/".concat(u,"/").concat(n),withCredentials:!0,method:"GET"})}function LE(o,n){let p,v=0,T,L;return new Promise((C,M)=>{p=setInterval(async()=>{try{L=await IE(o,n)}catch(V){M(V);return}T=L&&L.data&&L.data.asset_id,T&&(clearInterval(p),C(L)),v>10&&(clearInterval(p),M(new Error("Upload did not finish"))),v++},2e3)})}async function DE(o,n){let u,p;try{u=await LE(o,n)}catch(T){return Promise.reject(T)}try{p=await _E(o,u.data.asset_id)}catch(T){return Promise.reject(T)}const v={_id:n,_type:"mux.videoAsset",status:p.data.status,data:p.data,assetId:p.data.id,playbackId:p.data.playback_ids[0].id,uploadId:u.data.id};return o.createOrReplace(v).then(()=>v)}function CE(o){if(typeof window<"u"&&o instanceof window.File){const n=ME({},o);return Si(n)}return wi(new Error("Invalid file"))}function xE(o){const n=new Error("Invalid URL");if(typeof o!="string")return wi(n);let u;try{u=new URL(o)}catch{return wi(n)}return u&&!u.protocol.match(/http:|https:/)?wi(n):Si(o)}function ME(o,n){return typeof window>"u"||!(n instanceof window.File)?o:{name:o.preserveFilename===!1?void 0:n.name,type:n.type}}function PE(o){const n=Array.from(o.files||[]),u=Array.from(o.items||[]);return n&&n.length>0?Promise.resolve(n):OE(u).then(p=>p.flat())}function OE(o){return Promise.all(o.map(n=>{if(n.kind==="file"&&n.webkitGetAsEntry){let u;try{u=n.webkitGetAsEntry()}catch{return[n.getAsFile()]}return u?u.isDirectory?zf(u):[n.getAsFile()]:[]}if(n.kind==="file"){const u=n.getAsFile();return Promise.resolve(u?[u]:[])}return new Promise(u=>n.getAsString(u)).then(u=>u?[new File([u],"unknown.txt",{type:n.type})]:[])}))}function FE(o){return o.isFile}function NE(o){return o.isDirectory}function zf(o){if(FE(o))return new Promise(n=>o.file(n)).then(n=>[n]);if(NE(o)){const n=o.createReader();return new Promise(u=>n.readEntries(u)).then(u=>u.filter(p=>!p.name.startsWith("."))).then(u=>Promise.all(u.map(zf)).then(p=>p.flat()))}return Promise.resolve([])}function UE(o){const{asset:n}=o,u=ee.useId(),[p,v]=ee.useState(),[T,L]=ee.useState(!1),[C,M]=ee.useState(null),V=ee.useCallback(()=>v("confirm-delete"),[]),G=ee.useCallback(()=>{v(!1),L(!0)},[v]),Y=ee.useCallback(()=>{v(!1),L(!1)},[v]);return ee.useEffect(()=>{T&&p&&L(!1)},[p,T]),qc(ee.useCallback(()=>L(!1),[]),[C]),Te(Ri,{children:[B(Vm,{id:"".concat(u,"-asset-menu"),button:B(Wt,{icon:Yc,mode:"ghost",onClick:G,padding:2}),menu:B(jc,{ref:M,children:B(pa,{tone:"critical",icon:zc,text:"Delete",onClick:V})}),portal:!0,placement:"right"}),p==="confirm-delete"&&B(BE,{asset:n,onClose:Y})]})}function BE(o){const{asset:n,onClose:u}=o,p=Xr(),{push:v}=Km(),[T,L]=ee.useState(!1),[C,M]=ee.useState(!1),V=ee.useId(),G=200*su({maxDpr:2}),Y=ee.useCallback(async()=>{var Z,j,re;L(!0);try{n!=null&&n._id&&await p.delete(n._id),C&&(n!=null&&n.assetId)&&await $f(p,n.assetId),(re=(j=(Z=document.querySelector('[data-id="'.concat(n._id,'"]')))==null?void 0:Z.parentElement)==null?void 0:j.setAttribute)==null||re.call(j,"hidden","true")}catch(ae){console.error("Failed during delete",ae),v({closable:!0,description:ae==null?void 0:ae.message,duration:5e3,title:"Uncaught error",status:"error"})}finally{L(!1),u()}},[n._id,n.assetId,p,C,u,v]);return B(ro,{onClose:u,id:"".concat(V,"-confirm-delete"),header:"Delete video",footer:Te(Rl,{padding:2,gap:2,columns:2,children:[B(Wt,{mode:"bleed",text:"Cancel",onClick:u}),B(Wt,{text:"Delete",tone:"critical",icon:zc,onClick:Y,loading:T})]}),width:1,children:B(or,{paddingX:0,paddingY:0,space:1,children:B(Xt,{paddingX:[2,3,4],paddingY:[3,3,3,4],children:Te(Rl,{columns:3,gap:3,children:[B(Vt,{style:{gridColumn:"span 2"},align:"center",children:B(Dr,{padding:4,children:Te(or,{space:4,children:[Te(Vt,{align:"center",as:"label",children:[B(kl,{checked:C,onChange:()=>M(Z=>!Z)}),B(Tt,{style:{margin:"0 10px"},children:"Delete asset on Mux"})]}),Te(Vt,{align:"center",as:"label",children:[B(kl,{disabled:!0,checked:!0}),B(Tt,{style:{margin:"0 10px"},children:"Delete video from dataset"})]})]})})}),B(Ws,{asset:n,width:G,showTip:!0})]})})})})}function GE(o){let{assets:n,isLoading:u,isLastPage:p,onSelect:v,onLoadMore:T}=o;const L=ee.useCallback(V=>v(V.currentTarget.dataset.id),[v]),C=ee.useCallback(V=>{V.key==="Enter"&&v(V.currentTarget.dataset.id)},[v]),M=200*su({maxDpr:2});return Te(Ri,{children:[Te(Dr,{padding:4,children:[B(av,{gap:2,children:n.map(V=>B(VE,{asset:V,onClick:L,onKeyPress:C,width:M},V._id))}),u&&n.length===0&&B(Vt,{justify:"center",children:B(ev,{muted:!0})}),!u&&n.length===0&&B(Tt,{align:"center",muted:!0,children:"No videos"})]}),n.length>0&&!p&&B(sv,{tone:"default",padding:4,children:B(Vt,{direction:"column",children:B(Wt,{type:"button",icon:tv,loading:u,onClick:T,text:"Load more",tone:"primary"})})})]})}const HE=o=>{let{asset:n,onClick:u,onKeyPress:p,width:v}=o;const[T,L]=ee.useState(null),C=ee.useRef(null);return ee.useLayoutEffect(()=>{!C.current||T===null||(T?Od(C.current,{opacity:1}):Od(C.current,{opacity:0}))},[T]),Te(Dr,{height:"fill",style:{position:"relative"},children:[Te(Xt,{as:"button","data-id":n._id,onClick:u,onKeyPress:p,tabIndex:0,radius:2,padding:1,style:{lineHeight:0,position:"relative"},__unstable_focusRing:!0,onMouseEnter:()=>L(!0),onMouseLeave:()=>L(!1),children:[B(Ws,{asset:n,width:v,showTip:!0}),(n==null?void 0:n.playbackId)&&B(KE,{tone:"transparent",ref:C,margin:1,radius:1,children:T!==null&&B(rv,{asset:n,width:v})})]}),B(qE,{children:B(UE,{asset:n})})]})},VE=ee.memo(HE),KE=Lt(Xt)(uc||(uc=Dt([`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  will-change: opacity;
  background: transparent;
  background-color: hsl(0deg 0% 0% / 33%);
  opacity: 0;
  pointer-events: none;
`]))),qE=Lt.div(dc||(dc=Dt([`
  box-sizing: border-box;
  position: absolute;
  z-index: 300;
  opacity: 0;
  top: 7px;
  right: 7px;

  button:hover + &,
  button:focus-visible + &,
  &:hover,
  &:focus-visible {
    opacity: 1;
  }
`]))),qs=200;function jE(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qs;return'*[_type == "mux.videoAsset"] | order(_updatedAt desc) ['.concat(o,"...").concat(n,"]")}function WE(o){let{asset:n,onChange:u,setDialogState:p}=o;const v=Xr(),T=ee.useRef(0),[L,C]=ee.useState(!1),[M,V]=ee.useState(!1),[G,Y]=ee.useState([]),Z=ee.useCallback(ae=>{const ue=ae*qs,ce=ue+qs;return V(!0),v.fetch(jE(ue,ce)).then(pe=>{C(pe.length<qs),Y(xe=>xe.concat(pe))}).finally(()=>V(!1))},[v]),j=ee.useCallback(ae=>{const ue=G.find(ce=>ce._id===ae);if(!ue)throw new TypeError("Failed to find video asset with id: ".concat(ae));u(to.from([Qc({asset:{}}),Xc({_type:"reference",_weak:!0,_ref:ue._id},["asset"])])),p(!1)},[G,u,p]),re=ee.useCallback(()=>{Z(++T.current)},[Z]);return ee.useEffect(()=>void Z(T.current),[Z]),B(GE,{onSelect:j,assets:G,isLastPage:L,isLoading:M,onLoadMore:re})}function $E(o){let{setDialogState:n,asset:u,onChange:p}=o;const v="InputBrowser".concat(ee.useId()),T=ee.useCallback(()=>n(!1),[n]);return B(ro,{scheme:"dark",__unstable_autoFocus:!0,header:"Select video",id:v,onClose:T,width:2,children:B(WE,{asset:u,onChange:p,setDialogState:n})})}function YE(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var nr={},zE={get exports(){return nr},set exports(o){nr=o}},Sl,Lc;function QE(){if(Lc)return Sl;Lc=1;var o="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Sl=o,Sl}var Al,Dc;function XE(){if(Dc)return Al;Dc=1;var o=QE();function n(){}function u(){}return u.resetWarningCache=n,Al=function(){function p(L,C,M,V,G,Y){if(Y!==o){var Z=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw Z.name="Invariant Violation",Z}}p.isRequired=p;function v(){return p}var T={array:p,bigint:p,bool:p,func:p,number:p,object:p,string:p,symbol:p,any:p,arrayOf:v,element:p,elementType:p,instanceOf:v,node:p,objectOf:v,oneOf:v,oneOfType:v,shape:v,exact:v,checkPropTypes:u,resetWarningCache:n};return T.PropTypes=T,T},Al}zE.exports=XE()();var Zl={},ZE={get exports(){return Zl},set exports(o){Zl=o}};/*!
* mux-embed
* @version 4.24.0
* @copyright 2023 Mux, Inc
*/(function(o,n){(function(){var u;u=function(){return function(){var p={80:function(L,C,M){L.exports=M(728).default},728:function(L,C,M){M.d(C,{default:function(){return un}});var V=M(48),G=M.n(V),Y=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(S){var y=16*Math.random()|0;return(S==="x"?y:3&y|8).toString(16)})},Z=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)},j=function(S){return S&&S.nodeName!==void 0?(S.muxId||(S.muxId=S.id||Z()),S.muxId):S},re=function(S){var y;S&&S.nodeName!==void 0?S=j(y=S):y=document.querySelector(S);var _=y&&y.nodeName?y.nodeName.toLowerCase():"";return[y,S,_]},ae=M(640),ue=M.n(ae),ce=ue().methodFactory;ue().methodFactory=function(S,y,_){var b=ce(S,y,_);return function(){for(var x=["[mux]"],U=0;U<arguments.length;U++)x.push(arguments[U]);b.apply(void 0,x)}},ue().setLevel(ue().getLevel());var pe=ue();function xe(){return(G().doNotTrack||G().navigator&&G().navigator.doNotTrack)==="1"}var le={now:function(){var S=G().performance,y=S&&S.timing,_=y&&y.navigationStart,b=typeof _=="number"&&typeof S.now=="function"?_+S.now():Date.now();return Math.round(b)}},w=function(S){return se(S)[0]},se=function(S){if(typeof S!="string"||S==="")return["localhost"];var y,_=(S.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4];return _&&(y=(_.match(/[^\.]+\.[^\.]+$/)||[])[0]),[_,y]},W={exists:function(){var S=G().performance;return(S&&S.timing)!==void 0},domContentLoadedEventEnd:function(){var S=G().performance,y=S&&S.timing;return y&&y.domContentLoadedEventEnd},navigationStart:function(){var S=G().performance,y=S&&S.timing;return y&&y.navigationStart}};function z(S,y,_){_=_===void 0?1:_,S[y]=S[y]||0,S[y]+=_}var ke=["x-request-id","cf-ray","x-amz-cf-id","x-akamai-request-id"],ye=["x-cdn","content-type"].concat(ke);function Ee(S){var y={};return(S=S||"").trim().split(/[\r\n]+/).forEach(function(_){if(_){var b=_.split(": "),x=b.shift();x&&(ye.indexOf(x.toLowerCase())>=0||x.toLowerCase().indexOf("x-litix-")===0)&&(y[x]=b.join(": "))}}),y}function Ke(S){if(S){var y=ke.find(function(_){return S[_]!==void 0});return y?S[y]:void 0}}var Je=function(S){var y={};for(var _ in S){var b=S[_];b["DATA-ID"].search("io.litix.data.")!==-1&&(y[b["DATA-ID"].replace("io.litix.data.","")]=b.VALUE)}return y};function H(S,y){var _=Object.keys(S);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(S);y&&(b=b.filter(function(x){return Object.getOwnPropertyDescriptor(S,x).enumerable})),_.push.apply(_,b)}return _}function Ie(S){for(var y=1;y<arguments.length;y++){var _=arguments[y]!=null?arguments[y]:{};y%2?H(Object(_),!0).forEach(function(b){nt(S,b,_[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(_)):H(Object(_)).forEach(function(b){Object.defineProperty(S,b,Object.getOwnPropertyDescriptor(_,b))})}return S}function nt(S,y,_){return y in S?Object.defineProperty(S,y,{value:_,enumerable:!0,configurable:!0,writable:!0}):S[y]=_,S}var Qe=function(S){if(!S)return{};var y=W.navigationStart(),_=S.loading,b=_?_.start:S.trequest,x=_?_.first:S.tfirst,U=_?_.end:S.tload;return{bytesLoaded:S.total,requestStart:Math.round(y+b),responseStart:Math.round(y+x),responseEnd:Math.round(y+U)}},Mt=function(S){if(S&&typeof S.getAllResponseHeaders=="function")return Ee(S.getAllResponseHeaders())};function xr(S,y){var _=Object.keys(S);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(S);y&&(b=b.filter(function(x){return Object.getOwnPropertyDescriptor(S,x).enumerable})),_.push.apply(_,b)}return _}function Zt(S){for(var y=1;y<arguments.length;y++){var _=arguments[y]!=null?arguments[y]:{};y%2?xr(Object(_),!0).forEach(function(b){Re(S,b,_[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(_)):xr(Object(_)).forEach(function(b){Object.defineProperty(S,b,Object.getOwnPropertyDescriptor(_,b))})}return S}function Re(S,y,_){return y in S?Object.defineProperty(S,y,{value:_,enumerable:!0,configurable:!0,writable:!0}):S[y]=_,S}var st=function(S,y){if(!S||typeof S.getRequests!="function")return{};var _=S.getRequests({state:"executed"});if(_.length===0)return{};var b,x=_[_.length-1],U=w(x.url),P=x.url,$=x.bytesLoaded,K=new Date(x.requestStartDate).getTime(),ie=new Date(x.firstByteDate).getTime(),be=new Date(x.requestEndDate).getTime(),Le=isNaN(x.duration)?0:x.duration,De=typeof y.getMetricsFor=="function"?y.getMetricsFor(x.mediaType).HttpList:y.getDashMetrics().getHttpRequests(x.mediaType);return De.length>0&&(b=Ee(De[De.length-1]._responseHeaders||"")),{requestStart:K,requestResponseStart:ie,requestResponseEnd:be,requestBytesLoaded:$,requestResponseHeaders:b,requestMediaDuration:Le,requestHostname:U,requestUrl:P,requestId:b?Ke(b):void 0}},Kt=function(S,y){var _=y.getQualityFor(S),b=y.getCurrentTrackFor(S).bitrateList;return b?{currentLevel:_,renditionWidth:b[_].width||null,renditionHeight:b[_].height||null,renditionBitrate:b[_].bandwidth}:{}},Zr=function(S){var y;return(y=S.match(/.*codecs\*?="(.*)"/))===null||y===void 0?void 0:y[1]};function Mr(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}var Ci=0,Wi=function(){function S(){(function(b,x){if(!(b instanceof x))throw new TypeError("Cannot call a class as a function")})(this,S)}var y,_;return y=S,_=[{key:"on",value:function(b,x,U){return x._eventEmitterGuid=x._eventEmitterGuid||++Ci,this._listeners=this._listeners||{},this._listeners[b]=this._listeners[b]||[],U&&(x=x.bind(U)),this._listeners[b].push(x),x}},{key:"off",value:function(b,x){var U=this._listeners&&this._listeners[b];U&&U.forEach(function(P,$){P._eventEmitterGuid===x._eventEmitterGuid&&U.splice($,1)})}},{key:"one",value:function(b,x,U){var P=this;x._eventEmitterGuid=x._eventEmitterGuid||++Ci;var $=function K(){P.off(b,K),x.apply(U||this,arguments)};$._eventEmitterGuid=x._eventEmitterGuid,this.on(b,$)}},{key:"emit",value:function(b,x){var U=this;if(this._listeners){x=x||{};var P=this._listeners["before*"]||[],$=this._listeners[b]||[],K=this._listeners["after"+b]||[],ie=function(be,Le){(be=be.slice()).forEach(function(De){De.call(U,{type:b},Le)})};ie(P,x),ie($,x),ie(K,x)}}}],_&&Mr(y.prototype,_),Object.defineProperty(y,"prototype",{writable:!1}),S}(),xi=Wi;function Cn(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}var Pr=function(){function S(b){var x=this;(function(U,P){if(!(U instanceof P))throw new TypeError("Cannot call a class as a function")})(this,S),this.pm=b,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,b.on("playing",function(){x._playheadShouldBeProgressing=!0}),b.on("play",this._startPlaybackHeartbeatInterval.bind(this)),b.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),b.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),b.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),b.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),b.on("seeking",this._startPlaybackHeartbeatInterval.bind(this)),b.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),b.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),b.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),b.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),b.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),b.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),b.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),b.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),b.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),b.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),b.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),b.on("seeked",function(){b.data.player_is_paused?x._stopPlaybackHeartbeatInterval():x._startPlaybackHeartbeatInterval()}),b.on("timeupdate",function(){x._playbackHeartbeatInterval!==null&&b.emit("playbackheartbeat")}),b.on("devicesleep",function(U,P){x._playbackHeartbeatInterval!==null&&(G().clearInterval(x._playbackHeartbeatInterval),b.emit("playbackheartbeatend",{viewer_time:P.viewer_time}),x._playbackHeartbeatInterval=null)})}var y,_;return y=S,(_=[{key:"_startPlaybackHeartbeatInterval",value:function(){var b=this;this._playbackHeartbeatInterval===null&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=G().setInterval(function(){b.pm.emit("playbackheartbeat")},this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(G().clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}])&&Cn(y.prototype,_),Object.defineProperty(y,"prototype",{writable:!1}),S}();function ot(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}function et(S,y,_){return y&&ot(S.prototype,y),_&&ot(S,_),Object.defineProperty(S,"prototype",{writable:!1}),S}var tt=et(function S(y){var _=this;(function(b,x){if(!(b instanceof x))throw new TypeError("Cannot call a class as a function")})(this,S),y.on("viewinit",function(){_.viewErrored=!1}),y.on("error",function(b,x){try{var U=y.errorTranslator({player_error_code:x.player_error_code,player_error_message:x.player_error_message,player_error_context:x.player_error_context});U?(y.data.player_error_code=U.player_error_code||x.player_error_code,y.data.player_error_message=U.player_error_message||x.player_error_message,y.data.player_error_context=U.player_error_context||x.player_error_context,_.viewErrored=!0):(delete y.data.player_error_code,delete y.data.player_error_message,delete y.data.player_error_context)}catch(P){y.mux.log.warn("Exception in error translator callback.",P),_.viewErrored=!0}})});function ft(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}var ut=function(){function S(b){(function(x,U){if(!(x instanceof U))throw new TypeError("Cannot call a class as a function")})(this,S),this.pm=b,this._watchTimeTrackerLastCheckedTime=null,b.on("playbackheartbeat",this._updateWatchTime.bind(this)),b.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}var y,_;return y=S,(_=[{key:"_updateWatchTime",value:function(b,x){var U=x.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=U),z(this.pm.data,"view_watch_time",U-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=U}},{key:"_clearWatchTimeState",value:function(b,x){this._updateWatchTime(b,x),this._watchTimeTrackerLastCheckedTime=null}}])&&ft(y.prototype,_),Object.defineProperty(y,"prototype",{writable:!1}),S}();function qt(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}var br=function(){function S(b){(function(x,U){if(!(x instanceof U))throw new TypeError("Cannot call a class as a function")})(this,S),this.pm=b,this._playbackTimeTrackerLastPlayheadPosition=-1,b.on("playbackheartbeat",this._updatePlaybackTime.bind(this)),b.on("playbackheartbeatend",this._clearPlaybackTimeState.bind(this)),b.on("seeking",this._clearPlaybackTimeState.bind(this))}var y,_;return y=S,(_=[{key:"_updatePlaybackTime",value:function(){var b=this.pm.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&b>this._playbackTimeTrackerLastPlayheadPosition){var x=b-this._playbackTimeTrackerLastPlayheadPosition;x<=1e3&&z(this.pm.data,"view_content_playback_time",x)}this._playbackTimeTrackerLastPlayheadPosition=b}},{key:"_clearPlaybackTimeState",value:function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1}}])&&qt(y.prototype,_),Object.defineProperty(y,"prototype",{writable:!1}),S}();function pt(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}var gt=function(){function S(b){(function(U,P){if(!(U instanceof P))throw new TypeError("Cannot call a class as a function")})(this,S),this.pm=b;var x=this._updatePlayheadTime.bind(this);b.on("playbackheartbeat",x),b.on("playbackheartbeatend",x),b.on("timeupdate",x),b.on("destroy",function(){b.off("timeupdate",x)})}var y,_;return y=S,(_=[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=this.pm.data.view_max_playhead_position===void 0?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(b,x){var U=this,P=function(){U.pm.currentFragmentPDT&&U.pm.currentFragmentStart&&(U.pm.data.player_program_time=U.pm.currentFragmentPDT+U.pm.data.player_playhead_time-U.pm.currentFragmentStart)};if(x&&x.player_playhead_time)this.pm.data.player_playhead_time=x.player_playhead_time,P(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var $=this.pm.getPlayheadTime();$!==void 0&&(this.pm.data.player_playhead_time=$,P(),this._updateMaxPlayheadPosition())}}}])&&pt(y.prototype,_),Object.defineProperty(y,"prototype",{writable:!1}),S}();function jt(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}function ur(S,y,_){return y&&jt(S.prototype,y),_&&jt(S,_),Object.defineProperty(S,"prototype",{writable:!1}),S}var Jr=3e5,hi=ur(function S(y){if(function(U,P){if(!(U instanceof P))throw new TypeError("Cannot call a class as a function")}(this,S),!y.disableRebufferTracking){var _,b=function(U,P){x(P),_=void 0},x=function(U){if(_){var P=U.viewer_time-_;z(y.data,"view_rebuffer_duration",P),_=U.viewer_time,y.data.view_rebuffer_duration>Jr&&(y.emit("viewend"),y.send("viewend"),y.mux.log.warn("Ending view after rebuffering for longer than ".concat(Jr,"ms, future events will be ignored unless a programchange or videochange occurs.")))}y.data.view_watch_time>=0&&y.data.view_rebuffer_count>0&&(y.data.view_rebuffer_frequency=y.data.view_rebuffer_count/y.data.view_watch_time,y.data.view_rebuffer_percentage=y.data.view_rebuffer_duration/y.data.view_watch_time)};y.on("playbackheartbeat",function(U,P){return x(P)}),y.on("rebufferstart",function(U,P){_||(z(y.data,"view_rebuffer_count",1),_=P.viewer_time,y.one("rebufferend",b))}),y.on("viewinit",function(){_=void 0,y.off("rebufferend",b)})}});function Pt(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}var Nt=function(){function S(b){var x=this;(function(U,P){if(!(U instanceof P))throw new TypeError("Cannot call a class as a function")})(this,S),this.pm=b,b.disableRebufferTracking||b.disablePlayheadRebufferTracking||(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,b.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),b.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),b.on("seeking",function(){x._cleanupRebufferTracker(null,{viewer_time:le.now()})}))}var y,_;return y=S,_=[{key:"_checkIfRebuffering",value:function(b,x){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing)this._cleanupRebufferTracker(b,x);else if(this._lastCheckedTime!==null)if(this._lastPlayheadTime===this.pm.data.player_playhead_time){var U=x.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.sustainedRebufferThreshold=="number"&&U>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=x.viewer_time}else this._cleanupRebufferTracker(b,x,!0);else this._prepareRebufferTrackerState(x.viewer_time)}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(b){this._lastCheckedTime=b,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=b}},{key:"_cleanupRebufferTracker",value:function(b,x){var U=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:x.viewer_time});else{if(this._lastCheckedTime===null)return;var P=this.pm.data.player_playhead_time-this._lastPlayheadTime,$=x.viewer_time-this._lastPlayheadTimeUpdatedTime;typeof this.pm.minimumRebufferDuration=="number"&&P>0&&$-P>this.pm.minimumRebufferDuration&&(this._lastCheckedTime=null,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+$-P}))}U?this._prepareRebufferTrackerState(x.viewer_time):this._clearRebufferTrackerState()}}],_&&Pt(y.prototype,_),Object.defineProperty(y,"prototype",{writable:!1}),S}(),Or=Nt;function xn(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}var fi=function(){function S(b){var x=this;(function(U,P){if(!(U instanceof P))throw new TypeError("Cannot call a class as a function")})(this,S),this.pm=b,b.on("viewinit",function(){var U=b.data,P=U.view_id;if(!U.view_program_changed){var $=function(K,ie){var be=ie.viewer_time;K.type==="playing"&&b.data.view_time_to_first_frame===void 0?x.calculateTimeToFirstFrame(be||le.now(),P):K.type!=="adplaying"||b.data.view_time_to_first_frame!==void 0&&!x._inPrerollPosition()||x.calculateTimeToFirstFrame(be||le.now(),P)};b.one("playing",$),b.one("adplaying",$),b.one("viewend",function(){b.off("playing",$),b.off("adplaying",$)})}})}var y,_;return y=S,(_=[{key:"_inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(b,x){x===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:b}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.NAVIGATION_START))}}])&&xn(y.prototype,_),Object.defineProperty(y,"prototype",{writable:!1}),S}();function La(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}function Da(S,y,_){return y&&La(S.prototype,y),_&&La(S,_),Object.defineProperty(S,"prototype",{writable:!1}),S}var ho=Da(function S(y){var _=this;(function(b,x){if(!(b instanceof x))throw new TypeError("Cannot call a class as a function")})(this,S),y.on("viewinit",function(){_._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach(function(b){y.on(b,function(){if(_._lastPlayheadPosition>=0&&y.data.player_playhead_time>=0&&_._lastPlayerWidth>=0&&_._lastSourceWidth>0&&_._lastPlayerHeight>=0&&_._lastSourceHeight>0){var x=y.data.player_playhead_time-_._lastPlayheadPosition;if(x<0)return void(_._lastPlayheadPosition=-1);var U=Math.min(_._lastPlayerWidth/_._lastSourceWidth,_._lastPlayerHeight/_._lastSourceHeight),P=Math.max(0,U-1),$=Math.max(0,1-U);y.data.view_max_upscale_percentage=Math.max(y.data.view_max_upscale_percentage||0,P),y.data.view_max_downscale_percentage=Math.max(y.data.view_max_downscale_percentage||0,$),z(y.data,"view_total_content_playback_time",x),z(y.data,"view_total_upscaling",P*x),z(y.data,"view_total_downscaling",$*x)}_._lastPlayheadPosition=-1})}),["playing","hb"].forEach(function(b){y.on(b,function(){_._lastPlayheadPosition=y.data.player_playhead_time,_._lastPlayerWidth=y.data.player_width,_._lastPlayerHeight=y.data.player_height,_._lastSourceWidth=y.data.video_source_width,_._lastSourceHeight=y.data.video_source_height})})});function Ca(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}function fo(S,y,_){return y&&Ca(S.prototype,y),_&&Ca(S,_),Object.defineProperty(S,"prototype",{writable:!1}),S}var po=fo(function S(y){var _=this;(function(b,x){if(!(b instanceof x))throw new TypeError("Cannot call a class as a function")})(this,S),this.isSeeking=!1,y.on("seeking",function(b,x){Object.assign(y.data,x),_._lastSeekingTime=le.now(),_.isSeeking===!1&&(_.isSeeking=!0,y.send("seeking"))}),y.on("seeked",function(){_.isSeeking=!1;var b=_._lastSeekingTime||le.now(),x=le.now()-b;z(y.data,"view_seek_count",1),z(y.data,"view_seek_duration",x);var U=y.data.view_max_seek_time||0;y.data.view_max_seek_time=Math.max(U,x)}),y.on("viewend",function(){_.isSeeking=!1})});function xa(S,y){return function(_){if(Array.isArray(_))return _}(S)||function(_,b){var x=_==null?null:typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(x!=null){var U,P,$=[],K=!0,ie=!1;try{for(x=x.call(_);!(K=(U=x.next()).done)&&($.push(U.value),!b||$.length!==b);K=!0);}catch(be){ie=!0,P=be}finally{try{K||x.return==null||x.return()}finally{if(ie)throw P}}return $}}(S,y)||function(_,b){if(_){if(typeof _=="string")return Jt(_,b);var x=Object.prototype.toString.call(_).slice(8,-1);return x==="Object"&&_.constructor&&(x=_.constructor.name),x==="Map"||x==="Set"?Array.from(_):x==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(x)?Jt(_,b):void 0}}(S,y)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Jt(S,y){(y==null||y>S.length)&&(y=S.length);for(var _=0,b=new Array(y);_<y;_++)b[_]=S[_];return b}function mo(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}var er=function(S,y){S.push(y),S.sort(function(_,b){return _.viewer_time-b.viewer_time})},$i=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],vo=function(){function S(b){var x=this;(function(P,$){if(!(P instanceof $))throw new TypeError("Cannot call a class as a function")})(this,S),this.pm=b,b.on("viewinit",function(){x.isAdBreak=!1,x._currentAdRequestNumber=0,x._currentAdResponseNumber=0,x._adRequests=[],x._adResponses=[],x._adHasPlayed=!1,x._wouldBeNewAdPlay=!0,x._prerollPlayTime=void 0}),$i.forEach(function(P){return b.on(P,x._updateAdData.bind(x))});var U=function(){x.isAdBreak=!1};b.on("adbreakstart",function(){x.isAdBreak=!0}),b.on("play",U),b.on("playing",U),b.on("viewend",U),b.on("adrequest",function(P,$){$=Object.assign({ad_request_id:"generatedAdRequestId"+x._currentAdRequestNumber++},$),er(x._adRequests,$),z(b.data,"view_ad_request_count"),x.inPrerollPosition()&&(b.data.view_preroll_requested=!0,x._adHasPlayed||z(b.data,"view_preroll_request_count"))}),b.on("adresponse",function(P,$){$=Object.assign({ad_request_id:"generatedAdRequestId"+x._currentAdResponseNumber++},$),er(x._adResponses,$);var K=x.findAdRequest($.ad_request_id);K&&z(b.data,"view_ad_request_time",Math.max(0,$.viewer_time-K.viewer_time))}),b.on("adplay",function(P,$){x._adHasPlayed=!0,x._wouldBeNewAdPlay&&(x._wouldBeNewAdPlay=!1,z(b.data,"view_ad_played_count")),x.inPrerollPosition()&&!b.data.view_preroll_played&&(b.data.view_preroll_played=!0,x._adRequests.length>0&&(b.data.view_preroll_request_time=Math.max(0,$.viewer_time-x._adRequests[0].viewer_time)),b.data.view_start&&(b.data.view_startup_preroll_request_time=Math.max(0,$.viewer_time-b.data.view_start)),x._prerollPlayTime=$.viewer_time)}),b.on("adplaying",function(P,$){x.inPrerollPosition()&&b.data.view_preroll_load_time===void 0&&x._prerollPlayTime!==void 0&&(b.data.view_preroll_load_time=$.viewer_time-x._prerollPlayTime,b.data.view_startup_preroll_load_time=$.viewer_time-x._prerollPlayTime)}),b.on("adended",function(){x._wouldBeNewAdPlay=!0}),b.on("aderror",function(){x._wouldBeNewAdPlay=!0})}var y,_;return y=S,(_=[{key:"inPrerollPosition",value:function(){return this.pm.data.view_content_playback_time===void 0||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(b){for(var x=0;x<this._adRequests.length;x++)if(this._adRequests[x].ad_request_id===b)return this._adRequests[x]}},{key:"_updateAdData",value:function(b,x){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&x.ad_tag_url){var U=xa(se(x.ad_tag_url),2),P=U[0],$=U[1];this.pm.data.view_preroll_ad_tag_domain=$,this.pm.data.view_preroll_ad_tag_hostname=P}if(!this.pm.data.view_preroll_ad_asset_hostname&&x.ad_asset_url){var K=xa(se(x.ad_asset_url),2),ie=K[0],be=K[1];this.pm.data.view_preroll_ad_asset_domain=be,this.pm.data.view_preroll_ad_asset_hostname=ie}}this.pm.data.ad_asset_url=x==null?void 0:x.ad_asset_url,this.pm.data.ad_tag_url=x==null?void 0:x.ad_tag_url,this.pm.data.ad_creative_id=x==null?void 0:x.ad_creative_id,this.pm.data.ad_id=x==null?void 0:x.ad_id,this.pm.data.ad_universal_id=x==null?void 0:x.ad_universal_id}}])&&mo(y.prototype,_),Object.defineProperty(y,"prototype",{writable:!1}),S}();function Mn(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}function St(S,y,_){return y&&Mn(S.prototype,y),_&&Mn(S,_),Object.defineProperty(S,"prototype",{writable:!1}),S}var Ma=St(function S(y){var _,b;(function($,K){if(!($ instanceof K))throw new TypeError("Cannot call a class as a function")})(this,S);var x=function(){y.disableRebufferTracking||_&&(z(y.data,"view_waiting_rebuffer_duration",le.now()-_),_=!1,G().clearInterval(b))},U=!1,P=function(){U=!1,x()};y.on("waiting",function(){U&&(y.disableRebufferTracking||(z(y.data,"view_waiting_rebuffer_count",1),_=le.now(),b=G().setInterval(function(){if(_){var $=le.now();z(y.data,"view_waiting_rebuffer_duration",$-_),_=$}},250)))}),y.on("playing",function(){x(),U=!0}),y.on("pause",P),y.on("seeking",P)});function Fe(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}function Pa(S,y,_){return y&&Fe(S.prototype,y),_&&Fe(S,_),Object.defineProperty(S,"prototype",{writable:!1}),S}var Pn=Pa(function S(y){var _=this;(function(U,P){if(!(U instanceof P))throw new TypeError("Cannot call a class as a function")})(this,S);var b=function(){_.lastWallClockTime=le.now(),y.on("before*",x)},x=function(U){var P=le.now(),$=_.lastWallClockTime;_.lastWallClockTime=P,P-$>3e4&&(y.emit("devicesleep",{viewer_time:$}),Object.assign(y.data,{viewer_time:$}),y.send("devicesleep"),y.emit("devicewake",{viewer_time:P}),Object.assign(y.data,{viewer_time:P}),y.send("devicewake"))};y.one("playbackheartbeat",b),y.on("playbackheartbeatend",function(){y.off("before*",x),y.one("playbackheartbeat",b)})}),Xe=M(375),go=M(655),On=M.n(go),Fn="muxData",Oa=function(){var S;try{S=Xe.parse(On().get(Fn)||"")}catch{S={}}return S},Fr=function(S){try{On().set(Fn,Xe.stringify(S),{expires:7300})}catch{}},Fa=function(){var S=Oa();return S.mux_viewer_id=S.mux_viewer_id||Y(),S.msn=S.msn||Math.random(),Fr(S),{mux_viewer_id:S.mux_viewer_id,mux_sample_number:S.msn}};function yo(S,y){var _=y.beaconCollectionDomain,b=y.beaconDomain;if(_)return"https://"+_;var x=b||"litix.io";return(S=S||"inferred").match(/^[a-z0-9]+$/)?"https://"+S+"."+x:"https://img.litix.io/a.gif"}var Nn=function(){var S;switch(Un()){case"cellular":S="cellular";break;case"ethernet":S="wired";break;case"wifi":S="wifi";break;case void 0:break;default:S="other"}return S},Un=function(){var S=G().navigator,y=S&&(S.connection||S.mozConnection||S.webkitConnection);return y&&y.type};Nn.getConnectionFromAPI=Un;var Eo=Nn,Yi=Bn({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),zi=Bn({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cc:"codec",cd:"code",cg:"category",ch:"changed",cl:"canceled",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",cz:"context",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",dr:"drm",dp:"dropped",du:"duration",dv:"device",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ep:"experiments",fa:"failed",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",ha:"has",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",un:"universal",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"});function Bn(S){var y={};for(var _ in S)S.hasOwnProperty(_)&&(y[S[_]]=_);return y}function Qi(S){var y={},_={};return Object.keys(S).forEach(function(b){var x=!1;if(S.hasOwnProperty(b)&&S[b]!==void 0){var U=b.split("_"),P=U[0],$=Yi[P];$||(pe.info("Data key word `"+U[0]+"` not expected in "+b),$=P+"_"),U.splice(1).forEach(function(K){K==="url"&&(x=!0),zi[K]?$+=zi[K]:Number(K)&&Math.floor(Number(K))===Number(K)?$+=K:(pe.info("Data key word `"+K+"` not expected in "+b),$+="_"+K+"_")}),x?_[$]=S[b]:y[$]=S[b]}}),Object.assign(y,_)}var Ut={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},Gn=["hb","requestcompleted","requestfailed","requestcanceled"],Na="https://img.litix.io",_r=function(S){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._beaconUrl=S||Na,this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=Object.assign({},Ut,y)};_r.prototype.queueEvent=function(S,y){var _=Object.assign({},y);return(this._eventQueue.length<=this._options.maxQueueLength||S==="eventrateexceeded")&&(this._eventQueue.push(_),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength)},_r.prototype.flushEvents=function(){var S=arguments.length>0&&arguments[0]!==void 0&&arguments[0];S&&this._eventQueue.length===1?this._eventQueue.pop():(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},_r.prototype.destroy=function(){var S=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.destroyed=!0,S?this._clearBeaconQueue():this.flushEvents(),G().clearTimeout(this._sendTimeout)},_r.prototype._clearBeaconQueue=function(){var S=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,y=this._eventQueue.slice(S);S>0&&Object.assign(y[y.length-1],Qi({mux_view_message:"event queue truncated"}));var _=this._createPayload(y);Xi(this._beaconUrl,_,!0,function(){})},_r.prototype._sendBeaconQueue=function(){var S=this;if(!this._postInFlight){var y=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var _=this._createPayload(y),b=le.now();Xi(this._beaconUrl,_,!1,function(x,U){U?(S._eventQueue=y.concat(S._eventQueue),S._failureCount+=1,pe.info("Error sending beacon: "+U)):S._failureCount=0,S._roundTripTime=le.now()-b,S._postInFlight=!1})}},_r.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var S=Math.pow(2,this._failureCount-1);return(1+(S*=Math.random()))*this._options.baseTimeBetweenBeacons},_r.prototype._startBeaconSending=function(){var S=this;G().clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=G().setTimeout(function(){S._eventQueue.length&&S._sendBeaconQueue(),S._startBeaconSending()},this._getNextBeaconTime()))},_r.prototype._createPayload=function(S){var y,_,b,x=this,U={transmission_timestamp:Math.round(le.now())};this._roundTripTime&&(U.rtt_ms=Math.round(this._roundTripTime));var P=function(){y=JSON.stringify({metadata:U,events:_||S}),b=y.length/1024},$=function(){return b<=x._options.maxPayloadKBSize};return P(),$()||(pe.info("Payload size is too big ("+b+" kb). Removing unnecessary events."),_=S.filter(function(K){return Gn.indexOf(K.e)===-1}),P()),$()||(pe.info("Payload size still too big ("+b+" kb). Cropping fields.."),_.forEach(function(K){for(var ie in K){var be=K[ie];typeof be=="string"&&be.length>51200&&(K[ie]=be.substring(0,51200))}}),P()),y};var bo=function(S){return S.length<=57344},Xi=function(S,y,_,b){if(_&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(S,y))b();else if(G().fetch)G().fetch(S,{method:"POST",body:y,headers:{"Content-Type":"text/plain"},keepalive:bo(y)}).then(function(U){return b(null,U.ok?null:"Error")}).catch(function(U){return b(null,U)});else{if(G().XMLHttpRequest){var x=new(G()).XMLHttpRequest;return x.onreadystatechange=function(){if(x.readyState===4)return b(null,x.status!==200?"error":void 0)},x.open("POST",S),x.setRequestHeader("Content-Type","text/plain"),void x.send(y)}b()}},Ua=_r;function Ba(S,y){return function(_){if(Array.isArray(_))return _}(S)||function(_,b){var x=_==null?null:typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(x!=null){var U,P,$=[],K=!0,ie=!1;try{for(x=x.call(_);!(K=(U=x.next()).done)&&($.push(U.value),!b||$.length!==b);K=!0);}catch(be){ie=!0,P=be}finally{try{K||x.return==null||x.return()}finally{if(ie)throw P}}return $}}(S,y)||function(_,b){if(_){if(typeof _=="string")return Ga(_,b);var x=Object.prototype.toString.call(_).slice(8,-1);return x==="Object"&&_.constructor&&(x=_.constructor.name),x==="Map"||x==="Set"?Array.from(_):x==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(x)?Ga(_,b):void 0}}(S,y)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ga(S,y){(y==null||y>S.length)&&(y=S.length);for(var _=0,b=new Array(y);_<y;_++)b[_]=S[_];return b}function Hn(S,y){var _=Object.keys(S);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(S);y&&(b=b.filter(function(x){return Object.getOwnPropertyDescriptor(S,x).enumerable})),_.push.apply(_,b)}return _}function pi(S){for(var y=1;y<arguments.length;y++){var _=arguments[y]!=null?arguments[y]:{};y%2?Hn(Object(_),!0).forEach(function(b){Zi(S,b,_[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(_)):Hn(Object(_)).forEach(function(b){Object.defineProperty(S,b,Object.getOwnPropertyDescriptor(_,b))})}return S}function Tr(S){return Tr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},Tr(S)}function Ha(S,y){if(!(S instanceof y))throw new TypeError("Cannot call a class as a function")}function Va(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}function Zi(S,y,_){return y in S?Object.defineProperty(S,y,{value:_,enumerable:!0,configurable:!0,writable:!0}):S[y]=_,S}var Ka=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],qa=["adplay","adplaying","adpause","adfirstquartile","admidpoint","adthirdquartile","adended","adresponse"],ja=["viewstart","error","ended","viewend"],Wa=function(){function S(b,x){var U,P,$,K,ie,be,Le,De,me,Me,Ue,yt,dt,At,Bt,Ye=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Ha(this,S),Zi(this,"previousBeaconData",null),Zi(this,"lastEventTime",0),Zi(this,"rateLimited",!1),this.mux=b,this.envKey=x,this.options=Ye,this.eventQueue=new Ua(yo(this.envKey,this.options)),this.sampleRate=(U=this.options.sampleRate)!==null&&U!==void 0?U:1,this.disableCookies=(P=this.options.disableCookies)!==null&&P!==void 0&&P,this.respectDoNotTrack=($=this.options.respectDoNotTrack)!==null&&$!==void 0&&$,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:(K=this.options.platform)===null||K===void 0?void 0:K.name,viewer_application_version:(ie=this.options.platform)===null||ie===void 0?void 0:ie.version,viewer_application_engine:(be=this.options.platform)===null||be===void 0?void 0:be.layout,viewer_device_name:(Le=this.options.platform)===null||Le===void 0?void 0:Le.product,viewer_device_category:"",viewer_device_manufacturer:(De=this.options.platform)===null||De===void 0?void 0:De.manufacturer,viewer_os_family:(me=this.options.platform)===null||me===void 0||(Me=me.os)===null||Me===void 0?void 0:Me.family,viewer_os_architecture:(Ue=this.options.platform)===null||Ue===void 0||(yt=Ue.os)===null||yt===void 0?void 0:yt.architecture,viewer_os_version:(dt=this.options.platform)===null||dt===void 0||(At=dt.os)===null||At===void 0?void 0:At.version,viewer_connection_type:Eo(),page_url:G()===null||G()===void 0||(Bt=G().location)===null||Bt===void 0?void 0:Bt.href},this.viewerData=this.disableCookies?{}:Fa()}var y,_;return y=S,(_=[{key:"send",value:function(b,x){var U;if(b&&x!=null&&x.view_id){if(this.respectDoNotTrack&&xe())return pe.info("Not sending `"+b+"` because Do Not Track is enabled");if(!x||Tr(x)!=="object")return pe.error("A data object was expected in send() but was not provided");var P,$,K=this.disableCookies?{}:(P=Oa(),$=le.now(),P.session_start&&(P.sst=P.session_start,delete P.session_start),P.session_id&&(P.sid=P.session_id,delete P.session_id),P.session_expires&&(P.sex=P.session_expires,delete P.session_expires),(!P.sex||P.sex<$)&&(P.sid=Y(),P.sst=$),P.sex=$+15e5,Fr(P),{session_id:P.sid,session_start:P.sst,session_expires:P.sex}),ie=pi(pi(pi(pi(pi({},this.pageLevelData),x),K),this.viewerData),{},{event:b,env_key:this.envKey});ie.user_id&&(ie.viewer_user_id=ie.user_id,delete ie.user_id);var be=((U=ie.mux_sample_number)!==null&&U!==void 0?U:0)>=this.sampleRate,Le=Qi(this._deduplicateBeaconData(b,ie));if(this.lastEventTime=this.mux.utils.now(),be)return pe.info("Not sending event due to sample rate restriction",b,ie,Le);if(this.envKey||pe.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",b,ie,Le),!this.rateLimited){if(pe.info("Sending event",b,ie,Le),this.rateLimited=!this.eventQueue.queueEvent(b,Le),this.mux.WINDOW_UNLOADING&&b==="viewend")this.eventQueue.destroy(!0);else if(this.mux.WINDOW_HIDDEN&&b==="hb"?this.eventQueue.flushEvents(!0):ja.indexOf(b)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return ie.event="eventrateexceeded",Le=Qi(ie),this.eventQueue.queueEvent(ie.event,Le),pe.error("Beaconing disabled due to rate limit.")}}}},{key:"destroy",value:function(){this.eventQueue.destroy(!1)}},{key:"_deduplicateBeaconData",value:function(b,x){var U=this,P={},$=x.view_id;if($==="-1"||b==="viewstart"||b==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)P=pi({},x),$&&(this.previousBeaconData=P),$&&b==="viewend"&&(this.previousBeaconData=null);else{var K=b.indexOf("request")===0;Object.entries(x).forEach(function(ie){var be=Ba(ie,2),Le=be[0],De=be[1];U.previousBeaconData&&(De!==U.previousBeaconData[Le]||Ka.indexOf(Le)>-1||U.objectHasChanged(K,Le,De,U.previousBeaconData[Le])||U.eventRequiresKey(b,Le))&&(P[Le]=De,U.previousBeaconData[Le]=De)})}return P}},{key:"objectHasChanged",value:function(b,x,U,P){return!(!b||x.indexOf("request_")!==0||x!=="request_response_headers"&&Tr(U)==="object"&&Tr(P)==="object"&&Object.keys(U||{}).length===Object.keys(P||{}).length)}},{key:"eventRequiresKey",value:function(b,x){return b==="renditionchange"&&x.indexOf("video_source_")===0||!(x.indexOf("ad_id")!==0||!qa.includes(b))}}])&&Va(y.prototype,_),Object.defineProperty(y,"prototype",{writable:!1}),S}();function ei(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}function ti(S,y,_){return y&&ei(S.prototype,y),_&&ei(S,_),Object.defineProperty(S,"prototype",{writable:!1}),S}var dr=ti(function S(y){(function(ie,be){if(!(ie instanceof be))throw new TypeError("Cannot call a class as a function")})(this,S);var _=0,b=0,x=0,U=0,P=0,$=0,K=0;y.on("requestcompleted",function(ie,be){var Le,De,me=be.request_start,Me=be.request_response_start,Ue=be.request_response_end,yt=be.request_bytes_loaded;if(U++,Me?(Le=Me-(me??0),De=(Ue??0)-Me):De=(Ue??0)-(me??0),De>0&&yt&&yt>0){var dt=yt/De*8e3;P++,b+=yt,x+=De,y.data.view_min_request_throughput=Math.min(y.data.view_min_request_throughput||1/0,dt),y.data.view_average_request_throughput=b/x*8e3,y.data.view_request_count=U,Le>0&&(_+=Le,y.data.view_max_request_latency=Math.max(y.data.view_max_request_latency||0,Le),y.data.view_average_request_latency=_/P)}}),y.on("requestfailed",function(ie,be){U++,$++,y.data.view_request_count=U,y.data.view_request_failed_count=$}),y.on("requestcanceled",function(ie,be){U++,K++,y.data.view_request_count=U,y.data.view_request_canceled_count=K})});function cr(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}function at(S,y,_){return y&&cr(S.prototype,y),_&&cr(S,_),Object.defineProperty(S,"prototype",{writable:!1}),S}var Sr=at(function S(y){var _=this;(function(b,x){if(!(b instanceof x))throw new TypeError("Cannot call a class as a function")})(this,S),y.on("before*",function(b,x){var U=x.viewer_time,P=le.now(),$=_._lastEventTime;if(_._lastEventTime=P,$&&P-$>36e5){var K=Object.keys(y.data).reduce(function(ie,be){return be.indexOf("video_")===0?Object.assign(ie,function(Le,De,me){return De in Le?Object.defineProperty(Le,De,{value:me,enumerable:!0,configurable:!0,writable:!0}):Le[De]=me,Le}({},be,y.data[be])):ie},{});y.mux.log.info("Received event after at least an hour inactivity, creating a new view"),y.emit("viewinit",Object.assign({viewer_time:U},K)),y.playbackHeartbeat._playheadShouldBeProgressing&&b.type!=="play"&&b.type!=="adbreakstart"&&(y.emit("play",{viewer_time:U}),b.type!=="playing"&&y.emit("playing",{viewer_time:U}))}})});function Ar(S){return Ar=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},Ar(S)}function $a(S,y){return function(_){if(Array.isArray(_))return _}(S)||function(_,b){var x=_==null?null:typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(x!=null){var U,P,$=[],K=!0,ie=!1;try{for(x=x.call(_);!(K=(U=x.next()).done)&&($.push(U.value),!b||$.length!==b);K=!0);}catch(be){ie=!0,P=be}finally{try{K||x.return==null||x.return()}finally{if(ie)throw P}}return $}}(S,y)||function(_,b){if(_){if(typeof _=="string")return Ji(_,b);var x=Object.prototype.toString.call(_).slice(8,-1);return x==="Object"&&_.constructor&&(x=_.constructor.name),x==="Map"||x==="Set"?Array.from(_):x==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(x)?Ji(_,b):void 0}}(S,y)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ji(S,y){(y==null||y>S.length)&&(y=S.length);for(var _=0,b=new Array(y);_<y;_++)b[_]=S[_];return b}function _o(S,y){for(var _=0;_<y.length;_++){var b=y[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(S,b.key,b)}}function en(S,y){return en=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,b){return _.__proto__=b,_},en(S,y)}function Ya(S){var y=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _,b=Nr(S);if(y){var x=Nr(this).constructor;_=Reflect.construct(b,arguments,x)}else _=b.apply(this,arguments);return mi(this,_)}}function mi(S,y){if(y&&(Ar(y)==="object"||typeof y=="function"))return y;if(y!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mt(S)}function mt(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}function Nr(S){return Nr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(y){return y.__proto__||Object.getPrototypeOf(y)},Nr(S)}var To=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],Mi=function(S){(function(U,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function");U.prototype=Object.create(P&&P.prototype,{constructor:{value:U,writable:!0,configurable:!0}}),Object.defineProperty(U,"prototype",{writable:!1}),P&&en(U,P)})(x,S);var y,_,b=Ya(x);function x(U,P,$){var K;(function(me,Me){if(!(me instanceof Me))throw new TypeError("Cannot call a class as a function")})(this,x),(K=b.call(this)).DOM_CONTENT_LOADED_EVENT_END=W.domContentLoadedEventEnd(),K.NAVIGATION_START=W.navigationStart(),K.mux=U,K.id=P,($=Object.assign({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(me){return me}},$)).data=$.data||{},$.data.property_key&&($.data.env_key=$.data.property_key,delete $.data.property_key),pe.setLevel($.debug?"debug":"warn"),K.getPlayheadTime=$.getPlayheadTime,K.getStateData=$.getStateData||function(){return{}},K.getAdData=$.getAdData||function(){},K.minimumRebufferDuration=$.minimumRebufferDuration,K.sustainedRebufferThreshold=$.sustainedRebufferThreshold,K.playbackHeartbeatTime=$.playbackHeartbeatTime,K.disableRebufferTracking=$.disableRebufferTracking,K.disableRebufferTracking&&K.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),K.disablePlayheadRebufferTracking=$.disablePlayheadRebufferTracking,K.errorTranslator=$.errorTranslator,K.playbackEventDispatcher=new Wa(U,$.data.env_key,$),K.data={player_instance_id:Y(),mux_sample_rate:$.sampleRate,beacon_domain:$.beaconCollectionDomain?$.beaconCollectionDomain:$.beaconDomain},K.data.view_sequence_number=1,K.data.player_sequence_number=1,K.oldEmit=K.emit,K.emit=function(me,Me){Me=Object.assign({viewer_time:this.mux.utils.now()},Me),this.oldEmit(me,Me)};var ie=function(){this.data.view_start===void 0&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(mt(K));K.on("viewinit",function(me,Me){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),Object.assign(this.data,Me),this._initializeViewData(),this.one("play",ie),this.one("adbreakstart",ie)});var be=function(me){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",me)}.bind(mt(K));if(K.on("videochange",function(me,Me){be(Me)}),K.on("programchange",function(me,Me){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),be(Object.assign(Me,{view_program_changed:!0})),ie(),this.emit("play"),this.emit("playing")}),K.on("fragmentchange",function(me,Me){this.currentFragmentPDT=Me.currentFragmentPDT,this.currentFragmentStart=Me.currentFragmentStart}),K.on("destroy",K.destroy),typeof window<"u"&&typeof window.addEventListener=="function"&&typeof window.removeEventListener=="function"){var Le=function(){var me=K.data.view_start!==void 0;K.mux.WINDOW_HIDDEN=document.visibilityState==="hidden",me&&K.mux.WINDOW_HIDDEN&&(K.data.player_is_paused||K.emit("hb"))};window.addEventListener("visibilitychange",Le,!1);var De=function(me){me.persisted||K.destroy()};window.addEventListener("pagehide",De,!1),K.on("destroy",function(){window.removeEventListener("visibilitychange",Le),window.removeEventListener("pagehide",De)})}return K.on("playerready",function(me,Me){Object.assign(this.data,Me)}),To.forEach(function(me){K.on(me,function(Me,Ue){me.indexOf("ad")!==0&&this._updateStateData(),Object.assign(this.data,Ue),this._sanitizeData()}),K.on("after"+me,function(){(me!=="error"||this.errorTracker.viewErrored)&&this.send(me)})}),K.on("viewend",function(me,Me){Object.assign(K.data,Me)}),K.one("playerready",function(me){var Me=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=Me-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),K.longResumeTracker=new Sr(mt(K)),K.errorTracker=new tt(mt(K)),new Pn(mt(K)),K.seekingTracker=new po(mt(K)),K.playheadTime=new gt(mt(K)),K.playbackHeartbeat=new Pr(mt(K)),new ho(mt(K)),K.watchTimeTracker=new ut(mt(K)),new br(mt(K)),K.adTracker=new vo(mt(K)),new Or(mt(K)),new hi(mt(K)),new fi(mt(K)),new Ma(mt(K)),new dr(mt(K)),$.hlsjs&&K.addHLSJS($),$.dashjs&&K.addDashJS($),K.emit("viewinit",$.data),K}return y=x,_=[{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.data.view_start!==void 0&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(U){if(this.data.view_id){var P=Object.assign({},this.data);if(P.video_source_is_live===void 0&&(P.player_source_duration===1/0||P.video_source_duration===1/0?P.video_source_is_live=!0:(P.player_source_duration>0||P.video_source_duration>0)&&(P.video_source_is_live=!1)),P.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach(function(be){P[be]=void 0}),P.video_source_url=P.video_source_url||P.player_source_url,P.video_source_url){var $=$a(se(P.video_source_url),2),K=$[0],ie=$[1];P.video_source_domain=ie,P.video_source_hostname=K}delete P.ad_request_id,this.playbackEventDispatcher.send(U,P),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat(),U==="viewend"&&delete this.data.view_id}}},{key:"_updateStateData",value:function(){Object.assign(this.data,this.getStateData()),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var U=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(P){var $=parseInt(U.data[P],10);U.data[P]=isNaN($)?void 0:$}),["player_source_url","video_source_url"].forEach(function(P){if(U.data[P]){var $=U.data[P].toLowerCase();$.indexOf("data:")!==0&&$.indexOf("blob:")!==0||(U.data[P]="MSE style URL")}})}},{key:"_resetVideoData",value:function(U,P){var $=this;Object.keys(this.data).forEach(function(K){K.indexOf("video_")===0&&delete $.data[K]})}},{key:"_resetViewData",value:function(){var U=this;Object.keys(this.data).forEach(function(P){P.indexOf("view_")===0&&delete U.data[P]}),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(U,P){delete this.data.player_error_code,delete this.data.player_error_message}},{key:"_initializeViewData",value:function(){var U=this,P=this.data.view_id=Y(),$=function(){P===U.data.view_id&&z(U.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",$):$()}},{key:"_restartHeartBeat",value:function(){var U=this;window.clearTimeout(this._heartBeatTimeout),this.errorTracker.viewErrored||(this._heartBeatTimeout=window.setTimeout(function(){U.data.player_is_paused||U.emit("hb")},1e4))}},{key:"addHLSJS",value:function(U){U.hlsjs?this.hlsjs?this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=U.hlsjs,function(P,$,K){var ie=arguments.length>4?arguments[4]:void 0,be=P.log,Le=P.utils.secondsToMs,De=function(ze){var he,we=parseInt(ie.version);return we===1&&ze.programDateTime!==null&&(he=ze.programDateTime),we===0&&ze.pdt!==null&&(he=ze.pdt),he};if(W.exists()){var me=function(ze,he){return P.emit($,ze,he)},Me=function(ze,he){var we=he.levels,ve=he.audioTracks,Ne=he.url,je=he.stats,vt=he.networkDetails,Gt=he.sessionData,wt={},kt={};we.forEach(function(ct,wr){wt[wr]={width:ct.width,height:ct.height,bitrate:ct.bitrate,attrs:ct.attrs}}),ve.forEach(function(ct,wr){kt[wr]={name:ct.name,language:ct.lang,bitrate:ct.bitrate}});var bt=Qe(je),rt=bt.bytesLoaded,Be=bt.requestStart,ii=bt.responseStart,$t=bt.responseEnd;me("requestcompleted",Ie(Ie({},Je(Gt)),{},{request_event_type:ze,request_bytes_loaded:rt,request_start:Be,request_response_start:ii,request_response_end:$t,request_type:"manifest",request_hostname:w(Ne),request_response_headers:Mt(vt),request_rendition_lists:{media:wt,audio:kt,video:{}}}))};K.on(ie.Events.MANIFEST_LOADED,Me);var Ue=function(ze,he){var we=he.details,ve=he.level,Ne=he.networkDetails,je=he.stats,vt=Qe(je),Gt=vt.bytesLoaded,wt=vt.requestStart,kt=vt.responseStart,bt=vt.responseEnd,rt=we.fragments[we.fragments.length-1],Be=De(rt)+Le(rt.duration);me("requestcompleted",{request_event_type:ze,request_bytes_loaded:Gt,request_start:wt,request_response_start:kt,request_response_end:bt,request_current_level:ve,request_type:"manifest",request_hostname:w(we.url),request_response_headers:Mt(Ne),video_holdback:we.holdBack&&Le(we.holdBack),video_part_holdback:we.partHoldBack&&Le(we.partHoldBack),video_part_target_duration:we.partTarget&&Le(we.partTarget),video_target_duration:we.targetduration&&Le(we.targetduration),video_source_is_live:we.live,player_manifest_newest_program_time:isNaN(Be)?void 0:Be})};K.on(ie.Events.LEVEL_LOADED,Ue);var yt=function(ze,he){var we=he.details,ve=he.networkDetails,Ne=he.stats,je=Qe(Ne),vt=je.bytesLoaded,Gt=je.requestStart,wt=je.responseStart,kt=je.responseEnd;me("requestcompleted",{request_event_type:ze,request_bytes_loaded:vt,request_start:Gt,request_response_start:wt,request_response_end:kt,request_type:"manifest",request_hostname:w(we.url),request_response_headers:Mt(ve)})};K.on(ie.Events.AUDIO_TRACK_LOADED,yt);var dt=function(ze,he){var we=he.stats,ve=he.networkDetails,Ne=he.frag;we=we||Ne.stats;var je=Qe(we),vt=je.bytesLoaded,Gt=je.requestStart,wt=je.responseStart,kt=je.responseEnd,bt=ve?Mt(ve):void 0,rt={request_event_type:ze,request_bytes_loaded:vt,request_start:Gt,request_response_start:wt,request_response_end:kt,request_hostname:ve?w(ve.responseURL):void 0,request_id:bt?Ke(bt):void 0,request_response_headers:bt,request_media_duration:Ne.duration,request_url:ve==null?void 0:ve.responseURL};Ne.type==="main"?(rt.request_type="media",rt.request_current_level=Ne.level,rt.request_video_width=(K.levels[Ne.level]||{}).width,rt.request_video_height=(K.levels[Ne.level]||{}).height,rt.request_labeled_bitrate=(K.levels[Ne.level]||{}).bitrate):rt.request_type=Ne.type,me("requestcompleted",rt)};K.on(ie.Events.FRAG_LOADED,dt);var At=function(ze,he){var we=he.frag,ve=we.start,Ne={currentFragmentPDT:De(we),currentFragmentStart:Le(ve)};me("fragmentchange",Ne)};K.on(ie.Events.FRAG_CHANGED,At);var Bt=function(ze,he){var we=he.type,ve=he.details,Ne=he.response,je=he.fatal,vt=he.frag,Gt=he.networkDetails,wt=(vt==null?void 0:vt.url)||he.url||"",kt=Gt?Mt(Gt):void 0;if(ve!==ie.ErrorDetails.MANIFEST_LOAD_ERROR&&ve!==ie.ErrorDetails.MANIFEST_LOAD_TIMEOUT&&ve!==ie.ErrorDetails.FRAG_LOAD_ERROR&&ve!==ie.ErrorDetails.FRAG_LOAD_TIMEOUT&&ve!==ie.ErrorDetails.LEVEL_LOAD_ERROR&&ve!==ie.ErrorDetails.LEVEL_LOAD_TIMEOUT&&ve!==ie.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&ve!==ie.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT&&ve!==ie.ErrorDetails.SUBTITLE_LOAD_ERROR&&ve!==ie.ErrorDetails.SUBTITLE_LOAD_TIMEOUT&&ve!==ie.ErrorDetails.KEY_LOAD_ERROR&&ve!==ie.ErrorDetails.KEY_LOAD_TIMEOUT||me("requestfailed",{request_error:ve,request_url:wt,request_hostname:w(wt),request_id:kt?Ke(kt):void 0,request_type:ve===ie.ErrorDetails.FRAG_LOAD_ERROR||ve===ie.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":ve===ie.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||ve===ie.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT?"audio":ve===ie.ErrorDetails.SUBTITLE_LOAD_ERROR||ve===ie.ErrorDetails.SUBTITLE_LOAD_TIMEOUT?"subtitle":ve===ie.ErrorDetails.KEY_LOAD_ERROR||ve===ie.ErrorDetails.KEY_LOAD_TIMEOUT?"encryption":"manifest",request_error_code:Ne==null?void 0:Ne.code,request_error_text:Ne==null?void 0:Ne.text}),je){var bt,rt="".concat(wt?"url: ".concat(wt,`
`):"")+"".concat(Ne&&(Ne.code||Ne.text)?"response: ".concat(Ne.code,", ").concat(Ne.text,`
`):"")+"".concat(he.reason?"failure reason: ".concat(he.reason,`
`):"")+"".concat(he.level?"level: ".concat(he.level,`
`):"")+"".concat(he.parent?"parent stream controller: ".concat(he.parent,`
`):"")+"".concat(he.buffer?"buffer length: ".concat(he.buffer,`
`):"")+"".concat(he.error?"error: ".concat(he.error,`
`):"")+"".concat(he.event?"event: ".concat(he.event,`
`):"")+"".concat(he.err?"error message: ".concat((bt=he.err)===null||bt===void 0?void 0:bt.message,`
`):"");me("error",{player_error_code:we,player_error_message:ve,player_error_context:rt})}};K.on(ie.Events.ERROR,Bt);var Ye=function(ze,he){var we=he.frag,ve=we&&we._url||"";me("requestcanceled",{request_event_type:ze,request_url:ve,request_type:"media",request_hostname:w(ve)})};K.on(ie.Events.FRAG_LOAD_EMERGENCY_ABORTED,Ye);var Ge=function(ze,he){var we=he.level,ve=K.levels[we];if(ve&&ve.attrs&&ve.attrs.BANDWIDTH){var Ne,je=ve.attrs.BANDWIDTH,vt=parseFloat(ve.attrs["FRAME-RATE"]);isNaN(vt)||(Ne=vt),je?me("renditionchange",{video_source_fps:Ne,video_source_bitrate:je,video_source_width:ve.width,video_source_height:ve.height,video_source_rendition_name:ve.name,video_source_codec:ve==null?void 0:ve.videoCodec}):be.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};K.on(ie.Events.LEVEL_SWITCHED,Ge),K._stopMuxMonitor=function(){K.off(ie.Events.MANIFEST_LOADED,Me),K.off(ie.Events.LEVEL_LOADED,Ue),K.off(ie.Events.AUDIO_TRACK_LOADED,yt),K.off(ie.Events.FRAG_LOADED,dt),K.off(ie.Events.FRAG_CHANGED,At),K.off(ie.Events.ERROR,Bt),K.off(ie.Events.FRAG_LOAD_EMERGENCY_ABORTED,Ye),K.off(ie.Events.LEVEL_SWITCHED,Ge),K.off(ie.Events.DESTROYING,K._stopMuxMonitor),delete K._stopMuxMonitor},K.on(ie.Events.DESTROYING,K._stopMuxMonitor)}else be.warn("performance timing not supported. Not tracking HLS.js.")}(this.mux,this.id,U.hlsjs,{},U.Hls||window.Hls)):this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")}},{key:"removeHLSJS",value:function(){var U;this.hlsjs&&((U=this.hlsjs)&&typeof U._stopMuxMonitor=="function"&&U._stopMuxMonitor(),this.hlsjs=void 0)}},{key:"addDashJS",value:function(U){U.dashjs?this.dashjs?this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=U.dashjs,function(P,$,K){var ie=P.log;if(K&&K.on){var be=function(Ye,Ge){return P.emit($,Ye,Ge)},Le=function(Ye){var Ge=Ye.type,ze=(Ye.data||{}).url;be("requestcompleted",{request_event_type:Ge,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:w(ze),request_url:ze})};K.on("manifestLoaded",Le);var De={},me=function(Ye){var Ge=Ye.type,ze=Ye.fragmentModel,he=(Ye.chunk||{}).mediaInfo||{},we=he.type,ve=he.bitrateList,Ne={};(ve=ve||[]).forEach(function($t,ct){Ne[ct]={},Ne[ct].width=$t.width,Ne[ct].height=$t.height,Ne[ct].bitrate=$t.bandwidth,Ne[ct].attrs={}}),we==="video"?De.video=Ne:we==="audio"?De.audio=Ne:De.media=Ne;var je=st(ze,K),vt=je.requestStart,Gt=je.requestResponseStart,wt=je.requestResponseEnd,kt=je.requestResponseHeaders,bt=je.requestMediaDuration,rt=je.requestHostname,Be=je.requestUrl,ii=je.requestId;be("requestcompleted",{request_event_type:Ge,request_start:vt,request_response_start:Gt,request_response_end:wt,request_bytes_loaded:-1,request_type:we+"_init",request_response_headers:kt,request_hostname:rt,request_id:ii,request_url:Be,request_media_duration:bt,request_rendition_lists:De})};K.on("initFragmentLoaded",me);var Me=function(Ye){var Ge=Ye.type,ze=Ye.fragmentModel,he=Ye.chunk||{},we=he.mediaInfo,ve=he.start,Ne=(we||{}).type,je=st(ze,K),vt=je.requestStart,Gt=je.requestResponseStart,wt=je.requestResponseEnd,kt=je.requestBytesLoaded,bt=je.requestResponseHeaders,rt=je.requestMediaDuration,Be=je.requestHostname,ii=je.requestUrl,$t=je.requestId,ct=Kt(Ne,K),wr=ct.currentLevel,kr=ct.renditionWidth,dn=ct.renditionHeight,Ni=ct.renditionBitrate;be("requestcompleted",{request_event_type:Ge,request_start:vt,request_response_start:Gt,request_response_end:wt,request_bytes_loaded:kt,request_type:Ne,request_response_headers:bt,request_hostname:Be,request_id:$t,request_url:ii,request_media_start_time:ve,request_media_duration:rt,request_current_level:wr,request_labeled_bitrate:Ni,request_video_width:kr,request_video_height:dn})};K.on("mediaFragmentLoaded",Me);var Ue={video:void 0,audio:void 0,totalBitrate:void 0},yt=function(){if(Ue.video&&typeof Ue.video.bitrate=="number"){if(Ue.video.width&&Ue.video.height){var Ye=Ue.video.bitrate;return Ue.audio&&typeof Ue.audio.bitrate=="number"&&(Ye+=Ue.audio.bitrate),Ye!==Ue.totalBitrate?(Ue.totalBitrate=Ye,{video_source_bitrate:Ye,video_source_height:Ue.video.height,video_source_width:Ue.video.width,video_source_codec:Zr(Ue.video.codec)}):void 0}ie.warn("have bitrate info for video but missing width/height")}},dt=function(Ye,Ge,ze){if(typeof Ye.newQuality=="number"){var he=Ye.mediaType;if(he==="audio"||he==="video"){var we=K.getBitrateInfoListFor(he).find(function(Ne){return Ne.qualityIndex===Ye.newQuality});if(we&&typeof we.bitrate=="number"){Ue[he]=Zt(Zt({},we),{},{codec:K.getCurrentTrackFor(he).codec});var ve=yt();ve&&be("renditionchange",ve)}else ie.warn("missing bitrate info for ".concat(he))}}else ie.warn("missing evt.newQuality in qualityChangeRendered event",Ye)};K.on("qualityChangeRendered",dt);var At=function(Ye){var Ge=Ye.request,ze=Ye.mediaType;be("requestcanceled",{request_event_type:(Ge=Ge||{}).type+"_"+Ge.action,request_url:Ge.url,request_type:ze,request_hostname:w(Ge.url)})};K.on("fragmentLoadingAbandoned",At);var Bt=function(Ye){var Ge,ze,he=Ye.error,we=(he==null||(Ge=he.data)===null||Ge===void 0?void 0:Ge.request)||{},ve=(he==null||(ze=he.data)===null||ze===void 0?void 0:ze.response)||{};(he==null?void 0:he.code)===27&&be("requestfailed",{request_error:we.type+"_"+we.action,request_url:we.url,request_hostname:w(we.url),request_type:we.mediaType,request_error_code:ve.status,request_error_text:ve.statusText});var Ne="".concat(we!=null&&we.url?"url: ".concat(we.url,`
`):"")+"".concat(ve!=null&&ve.status||ve!=null&&ve.statusText?"response: ".concat(ve==null?void 0:ve.status,", ").concat(ve==null?void 0:ve.statusText,`
`):"");be("error",{player_error_code:he==null?void 0:he.code,player_error_message:he==null?void 0:he.message,player_error_context:Ne})};K.on("error",Bt),K._stopMuxMonitor=function(){K.off("manifestLoaded",Le),K.off("initFragmentLoaded",me),K.off("mediaFragmentLoaded",Me),K.off("qualityChangeRendered",dt),K.off("error",Bt),K.off("fragmentLoadingAbandoned",At),delete K._stopMuxMonitor}}else ie.warn("Invalid dash.js player reference. Monitoring blocked.")}(this.mux,this.id,U.dashjs)):this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")}},{key:"removeDashJS",value:function(){var U;this.dashjs&&((U=this.dashjs)&&typeof U._stopMuxMonitor=="function"&&U._stopMuxMonitor(),this.dashjs=void 0)}}],_&&_o(y.prototype,_),Object.defineProperty(y,"prototype",{writable:!1}),x}(xi),Vn=Mi,tn=M(153),ri=M.n(tn);function Kn(S){return Kn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},Kn(S)}function za(S,y){return function(_){if(Array.isArray(_))return _}(S)||function(_,b){var x=_==null?null:typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(x!=null){var U,P,$=[],K=!0,ie=!1;try{for(x=x.call(_);!(K=(U=x.next()).done)&&($.push(U.value),!b||$.length!==b);K=!0);}catch(be){ie=!0,P=be}finally{try{K||x.return==null||x.return()}finally{if(ie)throw P}}return $}}(S,y)||function(_,b){if(_){if(typeof _=="string")return rn(_,b);var x=Object.prototype.toString.call(_).slice(8,-1);return x==="Object"&&_.constructor&&(x=_.constructor.name),x==="Map"||x==="Set"?Array.from(_):x==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(x)?rn(_,b):void 0}}(S,y)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function rn(S,y){(y==null||y>S.length)&&(y=S.length);for(var _=0,b=new Array(y);_<y;_++)b[_]=S[_];return b}var Ur,So=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],Ao={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"};G()&&G().WeakMap&&(Ur=new WeakMap);var Qa="#EXT-X-TARGETDURATION",nn="#EXT-X-PART-INF",qn="#EXT-X-SERVER-CONTROL",Xa="#EXTINF",wo="#EXT-X-PROGRAM-DATE-TIME",Za="#EXT-X-VERSION",jn="#EXT-X-SESSION-DATA",Pi=function(S){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(S),this.manifest};Pi.prototype.process=function(S){var y;for(this.buffer+=S,y=this.buffer.indexOf(`
`);y>-1;y=this.buffer.indexOf(`
`))this.processLine(this.buffer.substring(0,y)),this.buffer=this.buffer.substring(y+1)},Pi.prototype.processLine=function(S){var y=S.indexOf(":"),_=es(S,y),b=_[0],x=_.length===2?sn(_[1]):void 0;if(b[0]!=="#")this.currentUri.uri=b,this.manifest.segments.push(this.currentUri),this.manifest.targetDuration&&!("duration"in this.currentUri)&&(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(b){case Qa:if(!isFinite(x)||x<0)return;this.manifest.targetDuration=x,this.setHoldBack();break;case nn:an(this.manifest,_),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case qn:an(this.manifest,_),this.setHoldBack();break;case Xa:x===0?this.currentUri.duration=.01:x>0&&(this.currentUri.duration=x);break;case wo:var U=x,P=new Date(U);this.manifest.dateTimeString||(this.manifest.dateTimeString=U,this.manifest.dateTimeObject=P),this.currentUri.dateTimeString=U,this.currentUri.dateTimeObject=P;break;case Za:an(this.manifest,_);break;case jn:var $=Fi(_[1]),K=Je($);Object.assign(this.manifest.sessionData,K)}},Pi.prototype.setHoldBack=function(){var S=this.manifest,y=S.serverControl,_=S.targetDuration,b=S.partTargetDuration;if(y){var x="holdBack",U="partHoldBack",P=_&&3*_,$=b&&2*b;_&&!y.hasOwnProperty(x)&&(y[x]=P),P&&y[x]<P&&(y[x]=P),b&&!y.hasOwnProperty(U)&&(y[U]=3*b),b&&y[U]<$&&(y[U]=$)}};var an=function(S,y){var _,b=Oi(y[0].replace("#EXT-X-",""));on(y[1])?(_={},_=Object.assign(Ja(y[1]),_)):_=sn(y[1]),S[b]=_},Oi=function(S){return S.toLowerCase().replace(/-(\w)/g,function(y){return y[1].toUpperCase()})},sn=function(S){if(S.toLowerCase()==="yes"||S.toLowerCase()==="no")return S.toLowerCase()==="yes";var y=S.indexOf(":")!==-1?S:parseFloat(S);return isNaN(y)?S:y},Wn=function(S){var y={},_=S.split("=");return _.length>1&&(y[Oi(_[0])]=sn(_[1])),y},Ja=function(S){for(var y=S.split(","),_={},b=0;y.length>b;b++){var x=y[b],U=Wn(x);_=Object.assign(U,_)}return _},on=function(S){return S.indexOf("=")>-1},es=function(S,y){return y===-1?[S]:[S.substring(0,y),S.substring(y+1)]},Fi=function(S){var y={};if(S){var _=S.search(",");return[S.slice(0,_),S.slice(_+1)].forEach(function(b,x){for(var U=b.replace(/['"]+/g,"").split("="),P=0;P<U.length;P++)U[P]==="DATA-ID"&&(y["DATA-ID"]=U[1-P]),U[P]==="VALUE"&&(y.VALUE=U[1-P])}),{data:y}}},$n=Pi,ko={safeCall:function(S,y,_,b){var x=b;if(S&&typeof S[y]=="function")try{x=S[y].apply(S,_)}catch(U){pe.info("safeCall error",U)}return x},safeIncrement:z,getComputedStyle:function(S,y){var _;if(S&&y&&G()&&typeof G().getComputedStyle=="function")return Ur&&Ur.has(S)&&(_=Ur.get(S)),_||(_=G().getComputedStyle(S,null),Ur&&Ur.set(S,_)),_.getPropertyValue(y)},secondsToMs:function(S){return Math.floor(1e3*S)},assign:Object.assign,headersStringToObject:Ee,cdnHeadersToRequestId:Ke,extractHostnameAndDomain:se,extractHostname:w,manifestParser:$n,generateShortID:Z,generateUUID:Y,now:le.now},Yn={PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled"};function Ro(S,y){return function(_){if(Array.isArray(_))return _}(S)||function(_,b){var x=_==null?null:typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(x!=null){var U,P,$=[],K=!0,ie=!1;try{for(x=x.call(_);!(K=(U=x.next()).done)&&($.push(U.value),!b||$.length!==b);K=!0);}catch(be){ie=!0,P=be}finally{try{K||x.return==null||x.return()}finally{if(ie)throw P}}return $}}(S,y)||function(_,b){if(_){if(typeof _=="string")return ln(_,b);var x=Object.prototype.toString.call(_).slice(8,-1);return x==="Object"&&_.constructor&&(x=_.constructor.name),x==="Map"||x==="Set"?Array.from(_):x==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(x)?ln(_,b):void 0}}(S,y)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ln(S,y){(y==null||y>S.length)&&(y=S.length);for(var _=0,b=new Array(y);_<y;_++)b[_]=S[_];return b}var Et={},Br=function S(y){var _=arguments;typeof y=="string"?S.hasOwnProperty(y)?G().setTimeout(function(){_=Array.prototype.splice.call(_,1),S[y].apply(null,_)},0):pe.warn("`"+y+"` is an unknown task"):typeof y=="function"?G().setTimeout(function(){y(S)},0):pe.warn("`"+y+"` is invalid.")},vi={loaded:le.now(),NAME:"mux-embed",VERSION:"4.24.0",API_VERSION:"2.1",PLAYER_TRACKED:!1,monitor:function(S,y){return function(_,b,x){var U=za(re(b),3),P=U[0],$=U[1],K=U[2],ie=_.log,be=_.utils.getComputedStyle,Le=_.utils.secondsToMs;if(!P)return ie.error("No element was found with the `"+$+"` query selector.");if(K!=="video"&&K!=="audio")return ie.error("The element of `"+$+"` was not a media element.");P.mux&&(P.mux.destroy(),delete P.mux,ie.warn("Already monitoring this video element, replacing existing event listeners")),(x=Object.assign({automaticErrorTracking:!0},x)).data=Object.assign({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:_.VERSION},x.data),x.getPlayheadTime=function(){return Le(P.currentTime)},x.getStateData=function(){var me,Me,Ue=this.hlsjs&&this.hlsjs.url,yt=this.dashjs&&Kn(this.dashjs.getSource==="function")&&this.dashjs.getSource(),dt={player_is_paused:P.paused,player_playhead_time:Le(P.currentTime),player_width:parseInt(be(P,"width")),player_height:parseInt(be(P,"height")),player_autoplay_on:P.autoplay,player_preload_on:P.preload,player_language_code:P.lang,player_is_fullscreen:ri()&&!!(ri().fullscreenElement||ri().webkitFullscreenElement||ri().mozFullScreenElement||ri().msFullscreenElement),video_poster_url:P.poster,video_source_url:Ue||yt||P.currentSrc,video_source_duration:Le(P.duration),video_source_height:P.videoHeight,video_source_width:P.videoWidth,view_dropped_frame_count:(me=P)===null||me===void 0||(Me=me.getVideoPlaybackQuality)===null||Me===void 0?void 0:Me.call(me).droppedVideoFrames},At=x.getPlayheadTime();if(P.getStartDate&&At>0){var Bt=P.getStartDate();if(Bt&&typeof Bt.getTime=="function"&&Bt.getTime()){var Ye=Bt.getTime();if(dt.player_program_time=Ye+At,P.seekable.length>0){var Ge=Ye+P.seekable.end(P.seekable.length-1);dt.player_live_edge_program_time=Ge}}}return dt},P.mux=P.mux||{},P.mux.deleted=!1,P.mux.emit=function(me,Me){_.emit($,me,Me)};var De=function(){ie.error("The monitor for this video element has already been destroyed.")};P.mux.destroy=function(){Object.keys(P.mux.listeners).forEach(function(me){P.removeEventListener(me,P.mux.listeners[me],!1)}),delete P.mux.listeners,P.mux.destroy=De,P.mux.swapElement=De,P.mux.emit=De,P.mux.addHLSJS=De,P.mux.addDashJS=De,P.mux.removeHLSJS=De,P.mux.removeDashJS=De,P.mux.deleted=!0,_.emit($,"destroy")},P.mux.swapElement=function(me){var Me=za(re(me),3),Ue=Me[0],yt=Me[1],dt=Me[2];return Ue?dt!=="video"&&dt!=="audio"?_.log.error("The element of `"+yt+"` was not a media element."):(Ue.muxId=P.muxId,delete P.muxId,Ue.mux=Ue.mux||{},Ue.mux.listeners=Object.assign({},P.mux.listeners),delete P.mux.listeners,Object.keys(Ue.mux.listeners).forEach(function(At){P.removeEventListener(At,Ue.mux.listeners[At],!1),Ue.addEventListener(At,Ue.mux.listeners[At],!1)}),Ue.mux.swapElement=P.mux.swapElement,Ue.mux.destroy=P.mux.destroy,delete P.mux,void(P=Ue)):_.log.error("No element was found with the `"+yt+"` query selector.")},P.mux.addHLSJS=function(me){_.addHLSJS($,me)},P.mux.addDashJS=function(me){_.addDashJS($,me)},P.mux.removeHLSJS=function(){_.removeHLSJS($)},P.mux.removeDashJS=function(){_.removeDashJS($)},_.init($,x),_.emit($,"playerready"),P.paused||(_.emit($,"play"),P.readyState>2&&_.emit($,"playing")),P.mux.listeners={},So.forEach(function(me){(me!=="error"||x.automaticErrorTracking)&&(P.mux.listeners[me]=function(){var Me={};if(me==="error"){if(!P.error||P.error.code===1)return;Me.player_error_code=P.error.code,Me.player_error_message=Ao[P.error.code]||P.error.message}_.emit($,me,Me)},P.addEventListener(me,P.mux.listeners[me],!1))})}(Br,S,y)},destroyMonitor:function(S){var y=Ro(re(S),1)[0];y&&y.mux&&typeof y.mux.destroy=="function"?y.mux.destroy():pe.error("A video element monitor for `"+S+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(S,y){var _=j(S);Et[_]?Et[_].addHLSJS(y):pe.error("A monitor for `"+_+"` has not been initialized.")},addDashJS:function(S,y){var _=j(S);Et[_]?Et[_].addDashJS(y):pe.error("A monitor for `"+_+"` has not been initialized.")},removeHLSJS:function(S){var y=j(S);Et[y]?Et[y].removeHLSJS():pe.error("A monitor for `"+y+"` has not been initialized.")},removeDashJS:function(S){var y=j(S);Et[y]?Et[y].removeDashJS():pe.error("A monitor for `"+y+"` has not been initialized.")},init:function(S,y){xe()&&y&&y.respectDoNotTrack&&pe.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var _=j(S);Et[_]=new Vn(Br,_,y)},emit:function(S,y,_){var b=j(S);Et[b]?(Et[b].emit(y,_),y==="destroy"&&delete Et[b]):pe.error("A monitor for `"+b+"` has not been initialized.")},checkDoNotTrack:xe,log:pe,utils:ko,events:Yn,WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign(Br,vi),G()!==void 0&&typeof G().addEventListener=="function"&&G().addEventListener("pagehide",function(S){S.persisted||(Br.WINDOW_UNLOADING=!0)},!1);var un=Br},655:function(L,C,M){var V,G;function Y(Z){return Y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(j){return typeof j}:function(j){return j&&typeof Symbol=="function"&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":typeof j},Y(Z);/*!
* JavaScript Cookie v2.1.3
* https://github.com/js-cookie/js-cookie
*
* Copyright 2006, 2015 Klaus Hartl & Fagner Brack
* Released under the MIT license
*/}(function(Z){var j=!1;if((G=typeof(V=Z)=="function"?V.call(C,M,C,L):V)===void 0||(L.exports=G),j=!0,Y(C)==="object"&&(L.exports=Z(),j=!0),!j){var re=window.Cookies,ae=window.Cookies=Z();ae.noConflict=function(){return window.Cookies=re,ae}}})(function(){var Z=function(){for(var j=0,re={};j<arguments.length;j++){var ae=arguments[j];for(var ue in ae)re[ue]=ae[ue]}return re};return function j(re){function ae(ue,ce,pe){var xe;if(typeof document<"u"){if(arguments.length>1){if(typeof(pe=Z({path:"/"},ae.defaults,pe)).expires=="number"){var le=new Date;le.setMilliseconds(le.getMilliseconds()+864e5*pe.expires),pe.expires=le}try{xe=JSON.stringify(ce),/^[\{\[]/.test(xe)&&(ce=xe)}catch{}return ce=re.write?re.write(ce,ue):encodeURIComponent(String(ce)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),ue=(ue=(ue=encodeURIComponent(String(ue))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[ue,"=",ce,pe.expires?"; expires="+pe.expires.toUTCString():"",pe.path?"; path="+pe.path:"",pe.domain?"; domain="+pe.domain:"",pe.secure?"; secure":""].join("")}ue||(xe={});for(var w=document.cookie?document.cookie.split("; "):[],se=/(%[0-9A-Z]{2})+/g,W=0;W<w.length;W++){var z=w[W].split("="),ke=z.slice(1).join("=");ke.charAt(0)==='"'&&(ke=ke.slice(1,-1));try{var ye=z[0].replace(se,decodeURIComponent);if(ke=re.read?re.read(ke,ye):re(ke,ye)||ke.replace(se,decodeURIComponent),this.json)try{ke=JSON.parse(ke)}catch{}if(ue===ye){xe=ke;break}ue||(xe[ye]=ke)}catch{}}return xe}}return ae.set=ae,ae.get=function(ue){return ae.call(ae,ue)},ae.getJSON=function(){return ae.apply({json:!0},[].slice.call(arguments))},ae.defaults={},ae.remove=function(ue,ce){ae(ue,"",Z(ce,{expires:-1}))},ae.withConverter=j,ae}(function(){})})},153:function(L,C,M){var V,G=M.g!==void 0?M.g:typeof window<"u"?window:{},Y=M(558);typeof document<"u"?V=document:(V=G["__GLOBAL_DOCUMENT_CACHE@4"])||(V=G["__GLOBAL_DOCUMENT_CACHE@4"]=Y),L.exports=V},48:function(L,C,M){var V;V=typeof window<"u"?window:M.g!==void 0?M.g:typeof self<"u"?self:{},L.exports=V},640:function(L,C,M){var V,G;(function(Y,Z){V=function(){var j=function(){},re="undefined",ae=typeof window!==re&&typeof window.navigator!==re&&/Trident\/|MSIE /.test(window.navigator.userAgent),ue=["trace","debug","info","warn","error"];function ce(Ee,Ke){var Je=Ee[Ke];if(typeof Je.bind=="function")return Je.bind(Ee);try{return Function.prototype.bind.call(Je,Ee)}catch{return function(){return Function.prototype.apply.apply(Je,[Ee,arguments])}}}function pe(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function xe(Ee){return Ee==="debug"&&(Ee="log"),typeof console!==re&&(Ee==="trace"&&ae?pe:console[Ee]!==void 0?ce(console,Ee):console.log!==void 0?ce(console,"log"):j)}function le(Ee,Ke){for(var Je=0;Je<ue.length;Je++){var H=ue[Je];this[H]=Je<Ee?j:this.methodFactory(H,Ee,Ke)}this.log=this.debug}function w(Ee,Ke,Je){return function(){typeof console!==re&&(le.call(this,Ke,Je),this[Ee].apply(this,arguments))}}function se(Ee,Ke,Je){return xe(Ee)||w.apply(this,arguments)}function W(Ee,Ke,Je){var H,Ie=this;Ke=Ke??"WARN";var nt="loglevel";function Qe(Re){var st=(ue[Re]||"silent").toUpperCase();if(typeof window!==re&&nt){try{return void(window.localStorage[nt]=st)}catch{}try{window.document.cookie=encodeURIComponent(nt)+"="+st+";"}catch{}}}function Mt(){var Re;if(typeof window!==re&&nt){try{Re=window.localStorage[nt]}catch{}if(typeof Re===re)try{var st=window.document.cookie,Kt=st.indexOf(encodeURIComponent(nt)+"=");Kt!==-1&&(Re=/^([^;]+)/.exec(st.slice(Kt))[1])}catch{}return Ie.levels[Re]===void 0&&(Re=void 0),Re}}function xr(){if(typeof window!==re&&nt){try{return void window.localStorage.removeItem(nt)}catch{}try{window.document.cookie=encodeURIComponent(nt)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}typeof Ee=="string"?nt+=":"+Ee:typeof Ee=="symbol"&&(nt=void 0),Ie.name=Ee,Ie.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},Ie.methodFactory=Je||se,Ie.getLevel=function(){return H},Ie.setLevel=function(Re,st){if(typeof Re=="string"&&Ie.levels[Re.toUpperCase()]!==void 0&&(Re=Ie.levels[Re.toUpperCase()]),!(typeof Re=="number"&&Re>=0&&Re<=Ie.levels.SILENT))throw"log.setLevel() called with invalid level: "+Re;if(H=Re,st!==!1&&Qe(Re),le.call(Ie,Re,Ee),typeof console===re&&Re<Ie.levels.SILENT)return"No console available for logging"},Ie.setDefaultLevel=function(Re){Ke=Re,Mt()||Ie.setLevel(Re,!1)},Ie.resetLevel=function(){Ie.setLevel(Ke,!1),xr()},Ie.enableAll=function(Re){Ie.setLevel(Ie.levels.TRACE,Re)},Ie.disableAll=function(Re){Ie.setLevel(Ie.levels.SILENT,Re)};var Zt=Mt();Zt==null&&(Zt=Ke),Ie.setLevel(Zt,!1)}var z=new W,ke={};z.getLogger=function(Ee){if(typeof Ee!="symbol"&&typeof Ee!="string"||Ee==="")throw new TypeError("You must supply a name when creating a logger.");var Ke=ke[Ee];return Ke||(Ke=ke[Ee]=new W(Ee,z.getLevel(),z.methodFactory)),Ke};var ye=typeof window!==re?window.log:void 0;return z.noConflict=function(){return typeof window!==re&&window.log===z&&(window.log=ye),z},z.getLoggers=function(){return ke},z.default=z,z},(G=typeof V=="function"?V.call(C,M,C,L):V)===void 0||(L.exports=G)})()},375:function(L,C){var M=Object.prototype.hasOwnProperty;function V(Y){try{return decodeURIComponent(Y.replace(/\+/g," "))}catch{return null}}function G(Y){try{return encodeURIComponent(Y)}catch{return null}}C.stringify=function(Y,Z){Z=Z||"";var j,re,ae=[];for(re in typeof Z!="string"&&(Z="?"),Y)if(M.call(Y,re)){if((j=Y[re])||j!=null&&!isNaN(j)||(j=""),re=G(re),j=G(j),re===null||j===null)continue;ae.push(re+"="+j)}return ae.length?Z+ae.join("&"):""},C.parse=function(Y){for(var Z,j=/([^=?#&]+)=?([^&]*)/g,re={};Z=j.exec(Y);){var ae=V(Z[1]),ue=V(Z[2]);ae===null||ue===null||ae in re||(re[ae]=ue)}return re}},558:function(){}},v={};function T(L){var C=v[L];if(C!==void 0)return C.exports;var M=v[L]={exports:{}};return p[L].call(M.exports,M,M.exports,T),M.exports}return T.n=function(L){var C=L&&L.__esModule?function(){return L.default}:function(){return L};return T.d(C,{a:C}),C},T.d=function(L,C){for(var M in C)T.o(C,M)&&!T.o(L,M)&&Object.defineProperty(L,M,{enumerable:!0,get:C[M]})},T.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),T.o=function(L,C){return Object.prototype.hasOwnProperty.call(L,C)},T(80)}()},o.exports=u()})()})(ZE);var gu=YE(Zl),Jl={},JE={get exports(){return Jl},set exports(o){Jl=o}};(function(o,n){(function u(p){var v;v=function(){function T(l,a){var e=Object.keys(l);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(l);a&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(l,r).enumerable})),e.push.apply(e,t)}return e}function L(l){for(var a=1;a<arguments.length;a++){var e=arguments[a]!=null?arguments[a]:{};a%2?T(Object(e),!0).forEach(function(t){V(l,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(e)):T(Object(e)).forEach(function(t){Object.defineProperty(l,t,Object.getOwnPropertyDescriptor(e,t))})}return l}function C(l,a){for(var e=0;e<a.length;e++){var t=a[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(l,xe(t.key),t)}}function M(l,a,e){return a&&C(l.prototype,a),e&&C(l,e),Object.defineProperty(l,"prototype",{writable:!1}),l}function V(l,a,e){return(a=xe(a))in l?Object.defineProperty(l,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):l[a]=e,l}function G(){return G=Object.assign?Object.assign.bind():function(l){for(var a=1;a<arguments.length;a++){var e=arguments[a];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(l[t]=e[t])}return l},G.apply(this,arguments)}function Y(l,a){l.prototype=Object.create(a.prototype),l.prototype.constructor=l,j(l,a)}function Z(l){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Z(l)}function j(l,a){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},j(l,a)}function re(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ae(l,a,e){return ae=re()?Reflect.construct.bind():function(t,r,i){var s=[null];s.push.apply(s,r);var d=new(Function.bind.apply(t,s));return i&&j(d,i.prototype),d},ae.apply(null,arguments)}function ue(l){var a=typeof Map=="function"?new Map:void 0;return ue=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(a!==void 0){if(a.has(e))return a.get(e);a.set(e,r)}function r(){return ae(e,arguments,Z(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),j(r,e)},ue(l)}function ce(l,a){(a==null||a>l.length)&&(a=l.length);for(var e=0,t=new Array(a);e<a;e++)t[e]=l[e];return t}function pe(l,a){var e=typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(e)return(e=e.call(l)).next.bind(e);if(Array.isArray(l)||(e=function(r,i){if(r){if(typeof r=="string")return ce(r,i);var s=Object.prototype.toString.call(r).slice(8,-1);return s==="Object"&&r.constructor&&(s=r.constructor.name),s==="Map"||s==="Set"?Array.from(r):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?ce(r,i):void 0}}(l))||a&&l&&typeof l.length=="number"){e&&(l=e);var t=0;return function(){return t>=l.length?{done:!0}:{done:!1,value:l[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xe(l){var a=function(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}(l,"string");return typeof a=="symbol"?a:String(a)}var le={};(function(l,a){var e,t,r,i,s;e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,t=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(d,c,f){if(f=f||{},d=d.trim(),!(c=c.trim())){if(!f.alwaysNormalize)return d;var h=s.parseURL(d);if(!h)throw new Error("Error trying to parse base URL.");return h.path=s.normalizePath(h.path),s.buildURLFromParts(h)}var m=s.parseURL(c);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return f.alwaysNormalize?(m.path=s.normalizePath(m.path),s.buildURLFromParts(m)):c;var g=s.parseURL(d);if(!g)throw new Error("Error trying to parse base URL.");if(!g.netLoc&&g.path&&g.path[0]!=="/"){var E=t.exec(g.path);g.netLoc=E[1],g.path=E[2]}g.netLoc&&!g.path&&(g.path="/");var k={scheme:g.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(k.netLoc=g.netLoc,m.path[0]!=="/"))if(m.path){var R=g.path,D=R.substring(0,R.lastIndexOf("/")+1)+m.path;k.path=s.normalizePath(D)}else k.path=g.path,m.params||(k.params=g.params,m.query||(k.query=g.query));return k.path===null&&(k.path=f.alwaysNormalize?s.normalizePath(m.path):m.path),s.buildURLFromParts(k)},parseURL:function(d){var c=e.exec(d);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(r,"");d.length!==(d=d.replace(i,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}},l.exports=s})({get exports(){return le},set exports(l){le=l}});var w,se,W,z=Number.isFinite||function(l){return typeof l=="number"&&isFinite(l)};(function(l){l.MEDIA_ATTACHING="hlsMediaAttaching",l.MEDIA_ATTACHED="hlsMediaAttached",l.MEDIA_DETACHING="hlsMediaDetaching",l.MEDIA_DETACHED="hlsMediaDetached",l.BUFFER_RESET="hlsBufferReset",l.BUFFER_CODECS="hlsBufferCodecs",l.BUFFER_CREATED="hlsBufferCreated",l.BUFFER_APPENDING="hlsBufferAppending",l.BUFFER_APPENDED="hlsBufferAppended",l.BUFFER_EOS="hlsBufferEos",l.BUFFER_FLUSHING="hlsBufferFlushing",l.BUFFER_FLUSHED="hlsBufferFlushed",l.MANIFEST_LOADING="hlsManifestLoading",l.MANIFEST_LOADED="hlsManifestLoaded",l.MANIFEST_PARSED="hlsManifestParsed",l.LEVEL_SWITCHING="hlsLevelSwitching",l.LEVEL_SWITCHED="hlsLevelSwitched",l.LEVEL_LOADING="hlsLevelLoading",l.LEVEL_LOADED="hlsLevelLoaded",l.LEVEL_UPDATED="hlsLevelUpdated",l.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",l.LEVELS_UPDATED="hlsLevelsUpdated",l.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",l.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",l.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",l.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",l.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",l.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",l.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",l.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",l.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",l.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",l.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",l.CUES_PARSED="hlsCuesParsed",l.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",l.INIT_PTS_FOUND="hlsInitPtsFound",l.FRAG_LOADING="hlsFragLoading",l.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",l.FRAG_LOADED="hlsFragLoaded",l.FRAG_DECRYPTED="hlsFragDecrypted",l.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",l.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",l.FRAG_PARSING_METADATA="hlsFragParsingMetadata",l.FRAG_PARSED="hlsFragParsed",l.FRAG_BUFFERED="hlsFragBuffered",l.FRAG_CHANGED="hlsFragChanged",l.FPS_DROP="hlsFpsDrop",l.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",l.ERROR="hlsError",l.DESTROYING="hlsDestroying",l.KEY_LOADING="hlsKeyLoading",l.KEY_LOADED="hlsKeyLoaded",l.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",l.BACK_BUFFER_REACHED="hlsBackBufferReached"})(w||(w={})),function(l){l.NETWORK_ERROR="networkError",l.MEDIA_ERROR="mediaError",l.KEY_SYSTEM_ERROR="keySystemError",l.MUX_ERROR="muxError",l.OTHER_ERROR="otherError"}(se||(se={})),function(l){l.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_PARSING_ERROR="levelParsingError",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.FRAG_GAP="fragGap",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.UNKNOWN="unknown"}(W||(W={}));var ke=function(){},ye={trace:ke,debug:ke,log:ke,warn:ke,info:ke,error:ke},Ee=ye;function Ke(l){var a=self.console[l];return a?a.bind(self.console,"["+l+"] >"):ke}function Je(l,a){if(self.console&&l===!0||typeof l=="object"){(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach(function(s){Ee[s]=e[s]?e[s].bind(e):Ke(s)})})(l,"debug","log","info","warn","error");try{Ee.log('Debug logs enabled for "'+a+'" in hls.js version 1.4.0-beta.2')}catch{Ee=ye}}else Ee=ye}var H=Ee,Ie=/^(\d+)x(\d+)$/,nt=/(.+?)=(".*?"|.*?)(?:,|$)/g,Qe=function(){function l(e){for(var t in typeof e=="string"&&(e=l.parseAttrList(e)),e)e.hasOwnProperty(t)&&(t.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}var a=l.prototype;return a.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},a.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},a.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},a.decimalFloatingPoint=function(e){return parseFloat(this[e])},a.optionalFloat=function(e,t){var r=this[e];return r?parseFloat(r):t},a.enumeratedString=function(e){return this[e]},a.bool=function(e){return this[e]==="YES"},a.decimalResolution=function(e){var t=Ie.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},l.parseAttrList=function(e){var t,r={};for(nt.lastIndex=0;(t=nt.exec(e))!==null;){var i=t[2];i.indexOf('"')===0&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1].trim()]=i}return r},l}();function Mt(l){return l==="SCTE35-OUT"||l==="SCTE35-IN"}var xr=function(){function l(a,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){var t=e.attr;for(var r in t)if(Object.prototype.hasOwnProperty.call(a,r)&&a[r]!==t[r]){H.warn('DATERANGE tag attribute: "'+r+'" does not match for tags with ID: "'+a.ID+'"'),this._badValueForSameId=r;break}a=G(new Qe({}),t,a)}if(this.attr=a,this._startDate=new Date(a["START-DATE"]),"END-DATE"in this.attr){var i=new Date(this.attr["END-DATE"]);z(i.getTime())&&(this._endDate=i)}}return M(l,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var a=this.duration;return a!==null?new Date(this._startDate.getTime()+1e3*a):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var a=this.attr.decimalFloatingPoint("DURATION");if(z(a))return a}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&z(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),l}(),Zt=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},Re="audio",st="video",Kt="audiovideo",Zr=function(){function l(a){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[Re]=null,e[st]=null,e[Kt]=null,e),this.baseurl=a}return l.prototype.setByteRange=function(a,e){var t=a.split("@",2),r=[];t.length===1?r[0]=e?e.byteRangeEndOffset:0:r[0]=parseInt(t[1]),r[1]=parseInt(t[0])+r[0],this._byteRange=r},M(l,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=le.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(a){this._url=a}}]),l}(),Mr=function(l){function a(t,r){var i;return(i=l.call(this,r)||this)._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new Zt,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.type=t,i}Y(a,l);var e=a.prototype;return e.setKeyFormat=function(t){if(this.levelkeys){var r=this.levelkeys[t];r&&!this._decryptdata&&(this._decryptdata=r.getDecryptData(this.sn))}},e.abortRequests=function(){var t,r;(t=this.loader)==null||t.abort(),(r=this.keyLoader)==null||r.abort()},e.setElementaryStreamInfo=function(t,r,i,s,d,c){c===void 0&&(c=!1);var f=this.elementaryStreams,h=f[t];h?(h.startPTS=Math.min(h.startPTS,r),h.endPTS=Math.max(h.endPTS,i),h.startDTS=Math.min(h.startDTS,s),h.endDTS=Math.max(h.endDTS,d)):f[t]={startPTS:r,endPTS:i,startDTS:s,endDTS:d,partial:c}},e.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[Re]=null,t[st]=null,t[Kt]=null},M(a,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!z(this.programDateTime))return null;var t=z(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){var r=Object.keys(this.levelkeys),i=r.length;if(i>1||i===1&&this.levelkeys[r[0]].encrypted)return!0}return!1}}]),a}(Zr),Ci=function(l){function a(e,t,r,i,s){var d;(d=l.call(this,r)||this).fragOffset=0,d.duration=0,d.gap=!1,d.independent=!1,d.relurl=void 0,d.fragment=void 0,d.index=void 0,d.stats=new Zt,d.duration=e.decimalFloatingPoint("DURATION"),d.gap=e.bool("GAP"),d.independent=e.bool("INDEPENDENT"),d.relurl=e.enumeratedString("URI"),d.fragment=t,d.index=i;var c=e.enumeratedString("BYTERANGE");return c&&d.setByteRange(c,s),s&&(d.fragOffset=s.fragOffset+s.duration),d}return Y(a,l),M(a,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),a}(Zr),Wi=function(){function l(a){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=a}return l.prototype.reloaded=function(a){if(!a)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-a.lastPartSn,t=this.lastPartIndex-a.lastPartIndex;this.updated=this.endSN!==a.endSN||!!t||!!e,this.advanced=this.endSN>a.endSN||e>0||e===0&&t>0,this.updated||this.advanced?this.misses=Math.floor(.6*a.misses):this.misses=a.misses+1,this.availabilityDelay=a.availabilityDelay},M(l,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&z(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var a=this.driftEndTime-this.driftStartTime;return a>0?1e3*(this.driftEnd-this.driftStart)/a:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var a;return(a=this.partList)!=null&&a.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var a;return(a=this.fragments)!=null&&a.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var a;return(a=this.partList)!=null&&a.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var a;return(a=this.partList)!=null&&a.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),l}();function xi(l){return Uint8Array.from(atob(l),function(a){return a.charCodeAt(0)})}function Cn(l){var a,e,t=l.split(":"),r=null;if(t[0]==="data"&&t.length===2){var i=t[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){var d=s[0]==="base64",c=s[1];d?(i.splice(-1,1),r=xi(c)):(a=Pr(c).subarray(0,16),(e=new Uint8Array(16)).set(a,16-a.length),r=e)}}return r}function Pr(l){return Uint8Array.from(unescape(encodeURIComponent(l)),function(a){return a.charCodeAt(0)})}var ot={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},et="org.w3.clearkey",tt="com.apple.streamingkeydelivery",ft="com.microsoft.playready",ut="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function qt(l){switch(l){case tt:return ot.FAIRPLAY;case ft:return ot.PLAYREADY;case ut:return ot.WIDEVINE;case et:return ot.CLEARKEY}}var br="edef8ba979d64acea3c827dcd51d21ed";function pt(l){switch(l){case ot.FAIRPLAY:return tt;case ot.PLAYREADY:return ft;case ot.WIDEVINE:return ut;case ot.CLEARKEY:return et}}function gt(l){var a=l.drmSystems,e=l.widevineLicenseUrl,t=a?[ot.FAIRPLAY,ot.WIDEVINE,ot.PLAYREADY,ot.CLEARKEY].filter(function(r){return!!a[r]}):[];return!t[ot.WIDEVINE]&&e&&t.push(ot.WIDEVINE),t}var jt=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function ur(l,a,e){return Uint8Array.prototype.slice?l.slice(a,e):new Uint8Array(Array.prototype.slice.call(l,a,e))}var Jr,hi=function(l,a){return a+10<=l.length&&l[a]===73&&l[a+1]===68&&l[a+2]===51&&l[a+3]<255&&l[a+4]<255&&l[a+6]<128&&l[a+7]<128&&l[a+8]<128&&l[a+9]<128},Pt=function(l,a){return a+10<=l.length&&l[a]===51&&l[a+1]===68&&l[a+2]===73&&l[a+3]<255&&l[a+4]<255&&l[a+6]<128&&l[a+7]<128&&l[a+8]<128&&l[a+9]<128},Nt=function(l,a){for(var e=a,t=0;hi(l,a);)t+=10,t+=Or(l,a+6),Pt(l,a+10)&&(t+=10),a+=t;if(t>0)return l.subarray(e,e+t)},Or=function(l,a){var e=0;return e=(127&l[a])<<21,e|=(127&l[a+1])<<14,e|=(127&l[a+2])<<7,e|=127&l[a+3]},xn=function(l,a){return hi(l,a)&&Or(l,a+6)+10<=l.length-a},fi=function(l){return l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp"},La=function(l){var a=String.fromCharCode(l[0],l[1],l[2],l[3]),e=Or(l,4);return{type:a,size:e,data:l.subarray(10,10+e)}},Da=function(l){for(var a=0,e=[];hi(l,a);){for(var t=Or(l,a+6),r=(a+=10)+t;a+8<r;){var i=La(l.subarray(a)),s=ho(i);s&&e.push(s),a+=i.size+10}Pt(l,a)&&(a+=10)}return e},ho=function(l){return l.type==="PRIV"?Ca(l):l.type[0]==="W"?po(l):fo(l)},Ca=function(l){if(!(l.size<2)){var a=Jt(l.data,!0),e=new Uint8Array(l.data.subarray(a.length+1));return{key:l.type,info:a,data:e.buffer}}},fo=function(l){if(!(l.size<2)){if(l.type==="TXXX"){var a=1,e=Jt(l.data.subarray(a),!0);a+=e.length+1;var t=Jt(l.data.subarray(a));return{key:l.type,info:e,data:t}}var r=Jt(l.data.subarray(1));return{key:l.type,data:r}}},po=function(l){if(l.type==="WXXX"){if(l.size<2)return;var a=1,e=Jt(l.data.subarray(a),!0);a+=e.length+1;var t=Jt(l.data.subarray(a));return{key:l.type,info:e,data:t}}var r=Jt(l.data);return{key:l.type,data:r}},xa=function(l){if(l.data.byteLength===8){var a=new Uint8Array(l.data),e=1&a[3],t=(a[4]<<23)+(a[5]<<15)+(a[6]<<7)+a[7];return t/=45,e&&(t+=4772185884e-2),Math.round(t)}},Jt=function(l,a){a===void 0&&(a=!1);var e=mo();if(e){var t=e.decode(l);if(a){var r=t.indexOf("\0");return r!==-1?t.substring(0,r):t}return t.replace(/\0/g,"")}for(var i,s,d,c=l.length,f="",h=0;h<c;){if((i=l[h++])===0&&a)return f;if(i!==0&&i!==3)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:f+=String.fromCharCode(i);break;case 12:case 13:s=l[h++],f+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=l[h++],d=l[h++],f+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&d)<<0)}}return f};function mo(){return Jr||self.TextDecoder===void 0||(Jr=new self.TextDecoder("utf-8")),Jr}var er=function(l){for(var a="",e=0;e<l.length;e++){var t=l[e].toString(16);t.length<2&&(t="0"+t),a+=t}return a},$i=Math.pow(2,32)-1,vo=[].push,Mn={video:1,audio:2,id3:3,text:4};function St(l){return String.fromCharCode.apply(null,l)}function Ma(l,a){var e=l[a]<<8|l[a+1];return e<0?65536+e:e}function Fe(l,a){var e=Pa(l,a);return e<0?4294967296+e:e}function Pa(l,a){return l[a]<<24|l[a+1]<<16|l[a+2]<<8|l[a+3]}function Pn(l,a,e){l[a]=e>>24,l[a+1]=e>>16&255,l[a+2]=e>>8&255,l[a+3]=255&e}function Xe(l,a){var e=[];if(!a.length)return e;for(var t=l.byteLength,r=0;r<t;){var i=Fe(l,r),s=i>1?r+i:t;if(St(l.subarray(r+4,r+8))===a[0])if(a.length===1)e.push(l.subarray(r+8,s));else{var d=Xe(l.subarray(r+8,s),a.slice(1));d.length&&vo.apply(e,d)}r=s}return e}function go(l){var a=[],e=l[0],t=8,r=Fe(l,t);t+=4,t+=e===0?8:16,t+=2;var i=l.length+0,s=Ma(l,t);t+=2;for(var d=0;d<s;d++){var c=t,f=Fe(l,c);c+=4;var h=2147483647&f;if((2147483648&f)>>>31==1)return H.warn("SIDX has hierarchical references (not supported)"),null;var m=Fe(l,c);c+=4,a.push({referenceSize:h,subsegmentDuration:m,info:{duration:m/r,start:i,end:i+h-1}}),i+=h,t=c+=4}return{earliestPresentationTime:0,timescale:r,version:e,referencesCount:s,references:a}}function On(l){for(var a=[],e=Xe(l,["moov","trak"]),t=0;t<e.length;t++){var r=e[t],i=Xe(r,["tkhd"])[0];if(i){var s=i[0],d=s===0?12:20,c=Fe(i,d),f=Xe(r,["mdia","mdhd"])[0];if(f){var h=Fe(f,d=(s=f[0])===0?12:20),m=Xe(r,["mdia","hdlr"])[0];if(m){var g=St(m.subarray(8,12)),E={soun:Re,vide:st}[g];if(E){var k=Xe(r,["mdia","minf","stbl","stsd"])[0],R=void 0;k&&(R=St(k.subarray(12,16))),a[c]={timescale:h,type:E},a[E]={timescale:h,id:c,codec:R}}}}}}return Xe(l,["moov","mvex","trex"]).forEach(function(D){var A=Fe(D,4),I=a[A];I&&(I.default={duration:Fe(D,12),flags:Fe(D,20)})}),a}function Fn(l){var a=Xe(l,["schm"])[0];if(a){var e=St(a.subarray(4,8));if(e==="cbcs"||e==="cenc")return Xe(l,["schi","tenc"])[0]}return H.error("[eme] missing 'schm' box"),null}function Oa(l){var a=Fe(l,0),e=8;1&a&&(e+=4),4&a&&(e+=4);for(var t=0,r=Fe(l,4),i=0;i<r;i++)256&a&&(t+=Fe(l,e),e+=4),512&a&&(e+=4),1024&a&&(e+=4),2048&a&&(e+=4);return t}function Fr(l,a){var e=new Uint8Array(l.length+a.length);return e.set(l),e.set(a,l.length),e}function Fa(l,a){var e=[],t=a.samples,r=a.timescale,i=a.id,s=!1;return Xe(t,["moof"]).map(function(d){var c=d.byteOffset-8;Xe(d,["traf"]).map(function(f){var h=Xe(f,["tfdt"]).map(function(m){var g=m[0],E=Fe(m,4);return g===1&&(E*=Math.pow(2,32),E+=Fe(m,8)),E/r})[0];return h!==void 0&&(l=h),Xe(f,["tfhd"]).map(function(m){var g=Fe(m,4),E=16777215&Fe(m,0),k=0,R=(16&E)!=0,D=0,A=(32&E)!=0,I=8;g===i&&(1&E&&(I+=8),2&E&&(I+=4),8&E&&(k=Fe(m,I),I+=4),R&&(D=Fe(m,I),I+=4),A&&(I+=4),a.type==="video"&&(s=function(O){if(!O)return!1;var F=O.indexOf("."),q=F<0?O:O.substring(0,F);return q==="hvc1"||q==="hev1"||q==="dvh1"||q==="dvhe"}(a.codec)),Xe(f,["trun"]).map(function(O){var F=O[0],q=16777215&Fe(O,0),Q=(1&q)!=0,X=0,oe=(4&q)!=0,J=(256&q)!=0,te=0,fe=(512&q)!=0,de=0,_e=(1024&q)!=0,Oe=(2048&q)!=0,Se=0,Pe=Fe(O,4),Ae=8;Q&&(X=Fe(O,Ae),Ae+=4),oe&&(Ae+=4);for(var Ce=X+c,He=0;He<Pe;He++){if(J?(te=Fe(O,Ae),Ae+=4):te=k,fe?(de=Fe(O,Ae),Ae+=4):de=D,_e&&(Ae+=4),Oe&&(Se=F===0?Fe(O,Ae):Pa(O,Ae),Ae+=4),a.type===st)for(var $e=0;$e<de;){var qe=Fe(t,Ce);yo(s,t[Ce+=4])&&Nn(t.subarray(Ce,Ce+qe),s?2:1,l+Se/r,e),Ce+=qe,$e+=qe+4}l+=te/r}}))})})}),e}function yo(l,a){if(l){var e=a>>1&63;return e===39||e===40}return(31&a)==6}function Nn(l,a,e,t){var r=Un(l),i=0;i+=a;for(var s=0,d=0,c=!1,f=0;i<r.length;){s=0;do{if(i>=r.length)break;s+=f=r[i++]}while(f===255);d=0;do{if(i>=r.length)break;d+=f=r[i++]}while(f===255);var h=r.length-i;if(!c&&s===4&&i<r.length){if(c=!0,r[i++]===181){var m=Ma(r,i);if(i+=2,m===49){var g=Fe(r,i);if(i+=4,g===1195456820){var E=r[i++];if(E===3){var k=r[i++],R=64&k,D=R?2+3*(31&k):0,A=new Uint8Array(D);if(R){A[0]=k;for(var I=1;I<D;I++)A[I]=r[i++]}t.push({type:E,payloadType:s,pts:e,bytes:A})}}}}}else if(s===5&&d<h){if(c=!0,d>16){for(var O=[],F=0;F<16;F++){var q=r[i++].toString(16);O.push(q.length==1?"0"+q:q),F!==3&&F!==5&&F!==7&&F!==9||O.push("-")}for(var Q=d-16,X=new Uint8Array(Q),oe=0;oe<Q;oe++)X[oe]=r[i++];t.push({payloadType:s,pts:e,uuid:O.join(""),userData:Jt(X),userDataBytes:X})}}else if(d<h)i+=d;else if(d>h)break}}function Un(l){for(var a=l.byteLength,e=[],t=1;t<a-2;)l[t]===0&&l[t+1]===0&&l[t+2]===3?(e.push(t+2),t+=2):t++;if(e.length===0)return l;var r=a-e.length,i=new Uint8Array(r),s=0;for(t=0;t<r;s++,t++)s===e[0]&&(s++,e.shift()),i[t]=l[s];return i}function Eo(l,a,e){if(l.byteLength!==16)throw new RangeError("Invalid system id");var t,r,i;if(a){t=1,r=new Uint8Array(16*a.length);for(var s=0;s<a.length;s++){var d=a[s];if(d.byteLength!==16)throw new RangeError("Invalid key");r.set(d,16*s)}}else t=0,r=new Uint8Array;t>0?(i=new Uint8Array(4),a.length>0&&new DataView(i.buffer).setUint32(0,a.length,!1)):i=new Uint8Array;var c=new Uint8Array(4);return e&&e.byteLength>0&&new DataView(c.buffer).setUint32(0,e.byteLength,!1),function(f){for(var h=arguments.length,m=new Array(h>1?h-1:0),g=1;g<h;g++)m[g-1]=arguments[g];for(var E=m.length,k=8,R=E;R--;)k+=m[R].byteLength;var D=new Uint8Array(k);for(D[0]=k>>24&255,D[1]=k>>16&255,D[2]=k>>8&255,D[3]=255&k,D.set(f,4),R=0,k=8;R<E;R++)D.set(m[R],k),k+=m[R].byteLength;return D}([112,115,115,104],new Uint8Array([t,0,0,0]),l,i,r,c,e||new Uint8Array)}var Yi={},zi=function(){function l(e,t,r,i,s){i===void 0&&(i=[1]),s===void 0&&(s=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=s,this.encrypted=!!e&&e!=="NONE",this.isCommonEncryption=this.encrypted&&e!=="AES-128"}l.clearKeyUriToKeyIdMap=function(){Yi={}};var a=l.prototype;return a.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case tt:case ut:case ft:case et:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},a.getDecryptData=function(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method!=="AES-128"||this.iv||H.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),e=0);var t=function(D){for(var A=new Uint8Array(16),I=12;I<16;I++)A[I]=D>>8*(15-I)&255;return A}(e);return new l(this.method,this.uri,"identity",this.keyFormatVersions,t)}var r=Cn(this.uri);if(r)switch(this.keyFormat){case ut:this.pssh=r,r.length>=22&&(this.keyId=r.subarray(r.length-22,r.length-6));break;case ft:var i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Eo(i,null,r);var s=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),d=String.fromCharCode.apply(null,Array.from(s)),c=d.substring(d.indexOf("<"),d.length),f=new DOMParser().parseFromString(c,"text/xml").getElementsByTagName("KID")[0];if(f){var h=f.childNodes[0]?f.childNodes[0].nodeValue:f.getAttribute("VALUE");if(h){var m=xi(h).subarray(0,16);(function(D){var A=function(I,O,F){var q=I[O];I[O]=I[F],I[F]=q};A(D,0,3),A(D,1,2),A(D,4,5),A(D,6,7)})(m),this.keyId=m}}break;default:var g=r.subarray(0,16);if(g.length!==16){var E=new Uint8Array(16);E.set(g,16-g.length),g=E}this.keyId=g}if(!this.keyId||this.keyId.byteLength!==16){var k=Yi[this.uri];if(!k){var R=Object.keys(Yi).length%Number.MAX_SAFE_INTEGER;k=new Uint8Array(16),new DataView(k.buffer,12,4).setUint32(0,R),Yi[this.uri]=k}this.keyId=k}return this},l}(),Bn=/\{\$([a-zA-Z0-9-_]+)\}/g;function Qi(l){return Bn.test(l)}function Ut(l,a,e){if(l.variableList!==null||l.hasVariableRefs)for(var t=e.length;t--;){var r=e[t],i=a[r];i&&(a[r]=Gn(l,i))}}function Gn(l,a){if(l.variableList!==null||l.hasVariableRefs){var e=l.variableList;return a.replace(Bn,function(t){var r=t.substring(2,t.length-1),i=e==null?void 0:e[r];return i===void 0?(l.playlistParsingError||(l.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+r+'"')),t):i})}return a}function Na(l,a,e){var t,r,i=l.variableList;if(i||(l.variableList=i={}),"QUERYPARAM"in a){t=a.QUERYPARAM;try{var s=new self.URL(e).searchParams;if(!s.has(t))throw new Error('"'+t+'" does not match any query parameter in URI: "'+e+'"');r=s.get(t)}catch(d){l.playlistParsingError||(l.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+d.message))}}else t=a.NAME,r=a.VALUE;t in i?l.playlistParsingError||(l.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+t+'"')):i[t]=r||""}function _r(l,a,e){var t=a.IMPORT;if(e&&t in e){var r=l.variableList;r||(l.variableList=r={}),r[t]=e[t]}else l.playlistParsingError||(l.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+t+'"'))}var bo={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function Xi(l,a){return MediaSource.isTypeSupported((a||"video")+'/mp4;codecs="'+l+'"')}var Ua=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Ba=/#EXT-X-MEDIA:(.*)/g,Ga=/^#EXT(?:INF|-X-TARGETDURATION):/m,Hn=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),pi=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Tr=function(){function l(){}return l.findGroup=function(a,e){for(var t=0;t<a.length;t++){var r=a[t];if(r.id===e)return r}},l.convertAVC1ToAVCOTI=function(a){var e=a.split(".");if(e.length>2){var t=e.shift()+".";return t+=parseInt(e.shift()).toString(16),t+=("000"+parseInt(e.shift()).toString(16)).slice(-4)}return a},l.resolve=function(a,e){return le.buildAbsoluteURL(e,a,{alwaysNormalize:!0})},l.isMediaPlaylist=function(a){return Ga.test(a)},l.parseMasterPlaylist=function(a,e){var t,r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Qi(a)},i=[];for(Ua.lastIndex=0;(t=Ua.exec(a))!=null;)if(t[1]){var s,d=new Qe(t[1]);Ut(r,d,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var c=Gn(r,t[2]),f={attrs:d,bitrate:d.decimalInteger("AVERAGE-BANDWIDTH")||d.decimalInteger("BANDWIDTH"),name:d.NAME,url:l.resolve(c,e)},h=d.decimalResolution("RESOLUTION");h&&(f.width=h.width,f.height=h.height),Zi((d.CODECS||"").split(/[ ,]+/).filter(function(O){return O}),f),f.videoCodec&&f.videoCodec.indexOf("avc1")!==-1&&(f.videoCodec=l.convertAVC1ToAVCOTI(f.videoCodec)),(s=f.unknownCodecs)!=null&&s.length||i.push(f),r.levels.push(f)}else if(t[3]){var m=t[3],g=t[4];switch(m){case"SESSION-DATA":var E=new Qe(g);Ut(r,E,["DATA-ID","LANGUAGE","VALUE","URI"]);var k=E["DATA-ID"];k&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[k]=E);break;case"SESSION-KEY":var R=Ha(g,e,r);R.encrypted&&R.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(R)):H.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+g+'"');break;case"DEFINE":var D=new Qe(g);Ut(r,D,["NAME","VALUE","QUERYPARAM"]),Na(r,D,e);break;case"CONTENT-STEERING":var A=new Qe(g);Ut(r,A,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:l.resolve(A["SERVER-URI"],e),pathwayId:A["PATHWAY-ID"]||"."};break;case"START":r.startTimeOffset=Va(g)}}var I=i.length>0&&i.length<r.levels.length;return r.levels=I?i:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r},l.parseMasterPlaylistMedia=function(a,e,t){var r,i={},s=t.levels,d={AUDIO:s.map(function(R){return{id:R.attrs.AUDIO,audioCodec:R.audioCodec}}),SUBTITLES:s.map(function(R){return{id:R.attrs.SUBTITLES,textCodec:R.textCodec}}),"CLOSED-CAPTIONS":[]},c=0;for(Ba.lastIndex=0;(r=Ba.exec(a))!==null;){var f=new Qe(r[1]),h=f.TYPE;if(h){var m=d[h],g=i[h]||[];i[h]=g,Ut(t,f,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var E={attrs:f,bitrate:0,id:c++,groupId:f["GROUP-ID"]||"",instreamId:f["INSTREAM-ID"],name:f.NAME||f.LANGUAGE||"",type:h,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:f.LANGUAGE,url:f.URI?l.resolve(f.URI,e):""};if(m!=null&&m.length){var k=l.findGroup(m,E.groupId)||m[0];Ka(E,k,"audioCodec"),Ka(E,k,"textCodec")}g.push(E)}}return i},l.parseLevelPlaylist=function(a,e,t,r,i,s){var d,c,f,h=new Wi(e),m=h.fragments,g=null,E=0,k=0,R=0,D=0,A=null,I=new Mr(r,e),O=-1,F=!1;for(Hn.lastIndex=0,h.m3u8=a,h.hasVariableRefs=Qi(a);(d=Hn.exec(a))!==null;){F&&(F=!1,(I=new Mr(r,e)).start=R,I.sn=E,I.cc=D,I.level=t,g&&(I.initSegment=g,I.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null));var q=d[1];if(q){I.duration=parseFloat(q);var Q=(" "+d[2]).slice(1);I.title=Q||null,I.tagList.push(Q?["INF",q,Q]:["INF",q])}else if(d[3]){if(z(I.duration)){I.start=R,f&&Wa(I,f,h),I.sn=E,I.level=t,I.cc=D,I.urlId=i,m.push(I);var X=(" "+d[3]).slice(1);I.relurl=Gn(h,X),qa(I,A),A=I,R+=I.duration,E++,k=0,F=!0}}else if(d[4]){var oe=(" "+d[4]).slice(1);A?I.setByteRange(oe,A):I.setByteRange(oe)}else if(d[5])I.rawProgramDateTime=(" "+d[5]).slice(1),I.tagList.push(["PROGRAM-DATE-TIME",I.rawProgramDateTime]),O===-1&&(O=m.length);else{if(!(d=d[0].match(pi))){H.warn("No matches on slow regex match for level playlist!");continue}for(c=1;c<d.length&&d[c]===void 0;c++);var J=(" "+d[c]).slice(1),te=(" "+d[c+1]).slice(1),fe=d[c+2]?(" "+d[c+2]).slice(1):"";switch(J){case"PLAYLIST-TYPE":h.type=te.toUpperCase();break;case"MEDIA-SEQUENCE":E=h.startSN=parseInt(te);break;case"SKIP":var de=new Qe(te);Ut(h,de,["RECENTLY-REMOVED-DATERANGES"]);var _e=de.decimalInteger("SKIPPED-SEGMENTS");if(z(_e)){h.skippedSegments=_e;for(var Oe=_e;Oe--;)m.unshift(null);E+=_e}var Se=de.enumeratedString("RECENTLY-REMOVED-DATERANGES");Se&&(h.recentlyRemovedDateranges=Se.split("	"));break;case"TARGETDURATION":h.targetduration=Math.max(parseInt(te),1);break;case"VERSION":h.version=parseInt(te);break;case"EXTM3U":break;case"ENDLIST":h.live=!1;break;case"#":(te||fe)&&I.tagList.push(fe?[te,fe]:[te]);break;case"DISCONTINUITY":D++,I.tagList.push(["DIS"]);break;case"GAP":I.gap=!0,I.tagList.push([J]);break;case"BITRATE":I.tagList.push([J,te]);break;case"DATERANGE":var Pe=new Qe(te);Ut(h,Pe,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Ut(h,Pe,Pe.clientAttrs);var Ae=new xr(Pe,h.dateRanges[Pe.ID]);Ae.isValid||h.skippedSegments?h.dateRanges[Ae.id]=Ae:H.warn('Ignoring invalid DATERANGE tag: "'+te+'"'),I.tagList.push(["EXT-X-DATERANGE",te]);break;case"DEFINE":var Ce=new Qe(te);Ut(h,Ce,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in Ce?_r(h,Ce,s):Na(h,Ce,e);break;case"DISCONTINUITY-SEQUENCE":D=parseInt(te);break;case"KEY":var He=Ha(te,e,h);if(He.isSupported()){if(He.method==="NONE"){f=void 0;break}f||(f={}),f[He.keyFormat]&&(f=G({},f)),f[He.keyFormat]=He}else H.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+te+'"');break;case"START":h.startTimeOffset=Va(te);break;case"MAP":var $e=new Qe(te);if(Ut(h,$e,["BYTERANGE","URI"]),I.duration){var qe=new Mr(r,e);ja(qe,$e,t,f),g=qe,I.initSegment=g,g.rawProgramDateTime&&!I.rawProgramDateTime&&(I.rawProgramDateTime=g.rawProgramDateTime)}else ja(I,$e,t,f),g=I,F=!0;break;case"SERVER-CONTROL":var lt=new Qe(te);h.canBlockReload=lt.bool("CAN-BLOCK-RELOAD"),h.canSkipUntil=lt.optionalFloat("CAN-SKIP-UNTIL",0),h.canSkipDateRanges=h.canSkipUntil>0&&lt.bool("CAN-SKIP-DATERANGES"),h.partHoldBack=lt.optionalFloat("PART-HOLD-BACK",0),h.holdBack=lt.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Yt=new Qe(te);h.partTarget=Yt.decimalFloatingPoint("PART-TARGET");break;case"PART":var Rt=h.partList;Rt||(Rt=h.partList=[]);var Rr=k>0?Rt[Rt.length-1]:void 0,pr=k++,mr=new Qe(te);Ut(h,mr,["BYTERANGE","URI"]);var It=new Ci(mr,I,e,pr,Rr);Rt.push(It),I.duration+=It.duration;break;case"PRELOAD-HINT":var Ft=new Qe(te);Ut(h,Ft,["URI"]),h.preloadHint=Ft;break;case"RENDITION-REPORT":var Hr=new Qe(te);Ut(h,Hr,["URI"]),h.renditionReports=h.renditionReports||[],h.renditionReports.push(Hr);break;default:H.warn("line parsed but not handled: "+d)}}}A&&!A.relurl?(m.pop(),R-=A.duration,h.partList&&(h.fragmentHint=A)):h.partList&&(qa(I,A),I.cc=D,h.fragmentHint=I,f&&Wa(I,f,h));var yi=m.length,rr=m[0],Xn=m[yi-1];if((R+=h.skippedSegments*h.targetduration)>0&&yi&&Xn){h.averagetargetduration=R/yi;var Zn=Xn.sn;h.endSN=Zn!=="initSegment"?Zn:0,h.live||(Xn.endList=!0),rr&&(h.startCC=rr.cc)}else h.endSN=0,h.startCC=0;return h.fragmentHint&&(R+=h.fragmentHint.duration),h.totalduration=R,h.endCC=D,O>0&&function(ds,vn){for(var Hi=ds[vn],Jn=vn;Jn--;){var si=ds[Jn];if(!si)return;si.programDateTime=Hi.programDateTime-1e3*si.duration,Hi=si}}(m,O),h},l}();function Ha(l,a,e){var t,r,i=new Qe(l);Ut(e,i,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var s=(t=i.METHOD)!=null?t:"",d=i.URI,c=i.hexadecimalInteger("IV"),f=i.KEYFORMATVERSIONS,h=(r=i.KEYFORMAT)!=null?r:"identity";d&&i.IV&&!c&&H.error("Invalid IV: "+i.IV);var m=d?Tr.resolve(d,a):"",g=(f||"1").split("/").map(Number).filter(Number.isFinite);return new zi(s,m,h,g,c)}function Va(l){var a=new Qe(l).decimalFloatingPoint("TIME-OFFSET");return z(a)?a:null}function Zi(l,a){["video","audio","text"].forEach(function(e){var t=l.filter(function(i){return function(s,d){var c=bo[d];return!!c&&c[s.slice(0,4)]===!0}(i,e)});if(t.length){var r=t.filter(function(i){return i.lastIndexOf("avc1",0)===0||i.lastIndexOf("mp4a",0)===0});a[e+"Codec"]=r.length>0?r[0]:t[0],l=l.filter(function(i){return t.indexOf(i)===-1})}}),a.unknownCodecs=l}function Ka(l,a,e){var t=a[e];t&&(l[e]=t)}function qa(l,a){l.rawProgramDateTime?l.programDateTime=Date.parse(l.rawProgramDateTime):a!=null&&a.programDateTime&&(l.programDateTime=a.endProgramDateTime),z(l.programDateTime)||(l.programDateTime=null,l.rawProgramDateTime=null)}function ja(l,a,e,t){l.relurl=a.URI,a.BYTERANGE&&l.setByteRange(a.BYTERANGE),l.level=e,l.sn="initSegment",t&&(l.levelkeys=t),l.initSegment=null}function Wa(l,a,e){l.levelkeys=a;var t=e.encryptedFragments;t.length&&t[t.length-1].levelkeys===a||!Object.keys(a).some(function(r){return a[r].isCommonEncryption})||t.push(l)}var ei="manifest",ti="level",dr="audioTrack",cr="subtitleTrack",at="main",Sr="audio",Ar="subtitle";function $a(l){switch(l.type){case dr:return Sr;case cr:return Ar;default:return at}}function Ji(l,a){var e=l.url;return e!==void 0&&e.indexOf("data:")!==0||(e=a.url),e}var _o=function(){function l(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}var a=l.prototype;return a.startLoad=function(e){},a.stopLoad=function(){this.destroyInternalLoaders()},a.registerListeners=function(){var e=this.hls;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.LEVEL_LOADING,this.onLevelLoading,this),e.on(w.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(w.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},a.unregisterListeners=function(){var e=this.hls;e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.LEVEL_LOADING,this.onLevelLoading,this),e.off(w.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(w.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},a.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,i=t.loader,s=new(r||i)(t);return this.loaders[e.type]=s,s},a.getInternalLoader=function(e){return this.loaders[e.type]},a.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},a.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},a.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},a.onManifestLoading=function(e,t){var r=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ei,url:r,deliveryDirectives:null})},a.onLevelLoading=function(e,t){var r=t.id,i=t.level,s=t.url,d=t.deliveryDirectives;this.load({id:r,level:i,responseType:"text",type:ti,url:s,deliveryDirectives:d})},a.onAudioTrackLoading=function(e,t){var r=t.id,i=t.groupId,s=t.url,d=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:dr,url:s,deliveryDirectives:d})},a.onSubtitleTrackLoading=function(e,t){var r=t.id,i=t.groupId,s=t.url,d=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:cr,url:s,deliveryDirectives:d})},a.load=function(e){var t,r,i,s=this,d=this.hls.config,c=this.getInternalLoader(e);if(c){var f=c.context;if(f&&f.url===e.url)return void H.trace("[playlist-loader]: playlist request ongoing");H.log("[playlist-loader]: aborting previous loader for type: "+e.type),c.abort()}if(r=e.type===ei?d.manifestLoadPolicy.default:G({},d.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),c=this.createInternalLoader(e),(t=e.deliveryDirectives)!=null&&t.part&&(e.type===ti&&e.level!==null?i=this.hls.levels[e.level].details:e.type===dr&&e.id!==null?i=this.hls.audioTracks[e.id].details:e.type===cr&&e.id!==null&&(i=this.hls.subtitleTracks[e.id].details),i)){var h=i.partTarget,m=i.targetduration;if(h&&m){var g=1e3*Math.max(3*h,.8*m);r=G({},r,{maxTimeToFirstByteMs:Math.min(g,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(g,r.maxTimeToFirstByteMs)})}}var E=r.errorRetry||r.timeoutRetry||{},k={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:E.maxNumRetry||0,retryDelay:E.retryDelayMs||0,maxRetryDelay:E.maxRetryDelayMs||0},R={onSuccess:function(D,A,I,O){var F=s.getInternalLoader(I);s.resetInternalLoader(I.type);var q=D.data;q.indexOf("#EXTM3U")===0?(A.parsing.start=performance.now(),Tr.isMediaPlaylist(q)?s.handleTrackOrLevelPlaylist(D,A,I,O||null,F):s.handleMasterPlaylist(D,A,I,O)):s.handleManifestParsingError(D,I,new Error("no EXTM3U delimiter"),O||null,A)},onError:function(D,A,I,O){s.handleNetworkError(A,I,!1,D,O)},onTimeout:function(D,A,I){s.handleNetworkError(A,I,!0,void 0,D)}};c.load(e,k,R)},a.handleMasterPlaylist=function(e,t,r,i){var s=this.hls,d=e.data,c=Ji(e,r),f=Tr.parseMasterPlaylist(d,c);if(f.playlistParsingError)this.handleManifestParsingError(e,r,f.playlistParsingError,i,t);else{var h=f.contentSteering,m=f.levels,g=f.sessionData,E=f.sessionKeys,k=f.startTimeOffset,R=f.variableList;this.variableList=R;var D=Tr.parseMasterPlaylistMedia(d,c,f),A=D.AUDIO,I=A===void 0?[]:A,O=D.SUBTITLES,F=D["CLOSED-CAPTIONS"];I.length&&(I.some(function(q){return!q.url})||!m[0].audioCodec||m[0].attrs.AUDIO||(H.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),I.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Qe({}),bitrate:0,url:""}))),s.trigger(w.MANIFEST_LOADED,{levels:m,audioTracks:I,subtitles:O,captions:F,contentSteering:h,url:c,stats:t,networkDetails:i,sessionData:g,sessionKeys:E,startTimeOffset:k,variableList:R})}},a.handleTrackOrLevelPlaylist=function(e,t,r,i,s){var d=this.hls,c=r.id,f=r.level,h=r.type,m=Ji(e,r),g=z(c)?c:0,E=z(f)?f:g,k=$a(r),R=Tr.parseLevelPlaylist(e.data,m,E,k,g,this.variableList);if(h===ei){var D={attrs:new Qe({}),bitrate:0,details:R,name:"",url:m};d.trigger(w.MANIFEST_LOADED,{levels:[D],audioTracks:[],url:m,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=R,this.handlePlaylistLoaded(R,e,t,r,i,s)},a.handleManifestParsingError=function(e,t,r,i,s){this.hls.trigger(w.ERROR,{type:se.NETWORK_ERROR,details:W.MANIFEST_PARSING_ERROR,fatal:t.type===ei,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:s})},a.handleNetworkError=function(e,t,r,i,s){r===void 0&&(r=!1);var d="A network "+(r?"timeout":"error"+(i?" (status "+i.code+")":""))+" occurred while loading "+e.type;e.type===ti?d+=": "+e.level+" id: "+e.id:e.type!==dr&&e.type!==cr||(d+=" id: "+e.id+' group-id: "'+e.groupId+'"');var c=new Error(d);H.warn("[playlist-loader]: "+d);var f=W.UNKNOWN,h=!1,m=this.getInternalLoader(e);switch(e.type){case ei:f=r?W.MANIFEST_LOAD_TIMEOUT:W.MANIFEST_LOAD_ERROR,h=!0;break;case ti:f=r?W.LEVEL_LOAD_TIMEOUT:W.LEVEL_LOAD_ERROR,h=!1;break;case dr:f=r?W.AUDIO_TRACK_LOAD_TIMEOUT:W.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case cr:f=r?W.SUBTITLE_TRACK_LOAD_TIMEOUT:W.SUBTITLE_LOAD_ERROR,h=!1}m&&this.resetInternalLoader(e.type);var g={type:se.NETWORK_ERROR,details:f,fatal:h,url:e.url,loader:m,context:e,error:c,networkDetails:t,stats:s};if(i){var E=(t==null?void 0:t.url)||e.url;g.response=L({url:E,data:void 0},i)}this.hls.trigger(w.ERROR,g)},a.handlePlaylistLoaded=function(e,t,r,i,s,d){var c=this.hls,f=i.type,h=i.level,m=i.id,g=i.groupId,E=i.deliveryDirectives,k=Ji(t,i),R=$a(i),D=typeof i.level=="number"&&R===at?h:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var A=e.playlistParsingError;if(A)c.trigger(w.ERROR,{type:se.NETWORK_ERROR,details:W.LEVEL_PARSING_ERROR,fatal:!1,url:k,error:A,reason:A.message,response:t,context:i,level:D,parent:R,networkDetails:s,stats:r});else switch(e.live&&d&&(d.getCacheAge&&(e.ageHeader=d.getCacheAge()||0),d.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),f){case ei:case ti:c.trigger(w.LEVEL_LOADED,{details:e,level:D||0,id:m||0,stats:r,networkDetails:s,deliveryDirectives:E});break;case dr:c.trigger(w.AUDIO_TRACK_LOADED,{details:e,id:m||0,groupId:g||"",stats:r,networkDetails:s,deliveryDirectives:E});break;case cr:c.trigger(w.SUBTITLE_TRACK_LOADED,{details:e,id:m||0,groupId:g||"",stats:r,networkDetails:s,deliveryDirectives:E})}}else{var I=new Error("No Segments found in Playlist");c.trigger(w.ERROR,{type:se.NETWORK_ERROR,details:W.LEVEL_EMPTY_ERROR,fatal:!1,url:k,error:I,reason:I.message,response:t,context:i,level:D,parent:R,networkDetails:s,stats:r})}},l}();function en(l,a){var e;try{e=new Event("addtrack")}catch{(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=l,a.dispatchEvent(e)}function Ya(l,a){var e=l.mode;if(e==="disabled"&&(l.mode="hidden"),l.cues&&!l.cues.getCueById(a.id))try{if(l.addCue(a),!l.cues.getCueById(a.id))throw new Error("addCue is failed for: "+a)}catch(r){H.debug("[texttrack-utils]: "+r);var t=new self.TextTrackCue(a.startTime,a.endTime,a.text);t.id=a.id,l.addCue(t)}e==="disabled"&&(l.mode=e)}function mi(l){var a=l.mode;if(a==="disabled"&&(l.mode="hidden"),l.cues)for(var e=l.cues.length;e--;)l.removeCue(l.cues[e]);a==="disabled"&&(l.mode=a)}function mt(l,a,e,t){var r=l.mode;if(r==="disabled"&&(l.mode="hidden"),l.cues&&l.cues.length>0)for(var i=function(d,c,f){var h=[],m=function(R,D){if(D<R[0].startTime)return 0;var A=R.length-1;if(D>R[A].endTime)return-1;for(var I=0,O=A;I<=O;){var F=Math.floor((O+I)/2);if(D<R[F].startTime)O=F-1;else{if(!(D>R[F].startTime&&I<A))return F;I=F+1}}return R[I].startTime-D<D-R[O].startTime?I:O}(d,c);if(m>-1)for(var g=m,E=d.length;g<E;g++){var k=d[g];if(k.startTime>=c&&k.endTime<=f)h.push(k);else if(k.startTime>f)return h}return h}(l.cues,a,e),s=0;s<i.length;s++)t&&!t(i[s])||l.removeCue(i[s]);r==="disabled"&&(l.mode=r)}var Nr="org.id3",To="com.apple.quicktime.HLS",Mi="https://aomedia.org/emsg/ID3";function Vn(){if(typeof self<"u")return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var tn=function(){var l=Vn();try{new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function ri(l,a){return l.getTime()/1e3-a}var Kn=function(){function l(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var a=l.prototype;return a.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},a._registerListeners=function(){var e=this.hls;e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this)},a._unregisterListeners=function(){var e=this.hls;e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this)},a.onMediaAttached=function(e,t){this.media=t.media},a.onMediaDetaching=function(){this.id3Track&&(mi(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},a.onManifestLoading=function(){this.dateRangeCuesAppended={}},a.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},a.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if(r.kind==="metadata"&&r.label==="id3")return en(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},a.onFragParsingMetadata=function(e,t){if(this.media){var r=this.hls.config,i=r.enableEmsgMetadataCues,s=r.enableID3MetadataCues;if(i||s){var d=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var c=Vn(),f=0;f<d.length;f++){var h=d[f].type;if((h!==Mi||i)&&s){var m=Da(d[f].data);if(m){var g=d[f].pts,E=g+d[f].duration;E>tn&&(E=tn),E-g<=0&&(E=g+.25);for(var k=0;k<m.length;k++){var R=m[k];if(!fi(R)){this.updateId3CueEnds(g);var D=new c(g,E,"");D.value=R,h&&(D.type=h),this.id3Track.addCue(D)}}}}}}}},a.updateId3CueEnds=function(e){var t,r=(t=this.id3Track)==null?void 0:t.cues;if(r)for(var i=r.length;i--;){var s=r[i];s.startTime<e&&s.endTime===tn&&(s.endTime=e)}},a.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,s=t.type,d=this.id3Track,c=this.hls;if(c){var f=c.config,h=f.enableEmsgMetadataCues,m=f.enableID3MetadataCues;d&&(h||m)&&mt(d,r,i,s==="audio"?function(g){return g.type===Nr&&m}:s==="video"?function(g){return g.type===Mi&&h}:function(g){return g.type===Nr&&m||g.type===Mi&&h})}},a.onLevelUpdated=function(e,t){var r=this,i=t.details;if(this.media&&i.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var s=this.dateRangeCuesAppended,d=this.id3Track,c=i.dateRanges,f=Object.keys(c);if(d)for(var h=Object.keys(s).filter(function(I){return!f.includes(I)}),m=function(I){var O=h[I];Object.keys(s[O].cues).forEach(function(F){d.removeCue(s[O].cues[F])}),delete s[O]},g=h.length;g--;)m(g);var E=i.fragments[i.fragments.length-1];if(f.length!==0&&z(E==null?void 0:E.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var k=E.programDateTime/1e3-E.start,R=Vn(),D=function(I){var O=f[I],F=c[O],q=s[O],Q=(q==null?void 0:q.cues)||{},X=(q==null?void 0:q.durationKnown)||!1,oe=ri(F.startDate,k),J=tn,te=F.endDate;if(te)J=ri(te,k),X=!0;else if(F.endOnNext&&!X){var fe=f.reduce(function(He,$e){var qe=c[$e];return qe.class===F.class&&qe.id!==$e&&qe.startDate>F.startDate&&He.push(qe),He},[]).sort(function(He,$e){return He.startDate.getTime()-$e.startDate.getTime()})[0];fe&&(J=ri(fe.startDate,k),X=!0)}for(var de,_e,Oe=Object.keys(F.attr),Se=0;Se<Oe.length;Se++){var Pe=Oe[Se];if((_e=Pe)!=="ID"&&_e!=="CLASS"&&_e!=="START-DATE"&&_e!=="DURATION"&&_e!=="END-DATE"&&_e!=="END-ON-NEXT"){var Ae=Q[Pe];if(Ae)X&&!q.durationKnown&&(Ae.endTime=J);else{var Ce=F.attr[Pe];Ae=new R(oe,J,""),Mt(Pe)&&(de=Ce,Ce=Uint8Array.from(de.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),Ae.value={key:Pe,data:Ce},Ae.type=To,Ae.id=O,r.id3Track.addCue(Ae),Q[Pe]=Ae}}}s[O]={cues:Q,dateRange:F,durationKnown:X}},A=0;A<f.length;A++)D(A)}}},l}(),za=function(){function l(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var a=l.prototype;return a.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},a.registerListeners=function(){this.hls.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(w.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(w.ERROR,this.onError,this)},a.unregisterListeners=function(){this.hls.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(w.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(w.ERROR,this.onError,this)},a.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},a.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},a.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},a.onLevelUpdated=function(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},a.onError=function(e,t){var r;t.details===W.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&H.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},a.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var r=this.computeLatency();if(r!==null){this._latency=r;var i=this.config,s=i.lowLatencyMode,d=i.maxLiveSyncPlaybackRate;if(s&&d!==1){var c=this.targetLatency;if(c!==null){var f=r-c,h=f<Math.min(this.maxLatency,c+t.targetduration);if(t.live&&h&&f>.05&&this.forwardBufferLength>1){var m=Math.min(2,Math.max(1,d)),g=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20;e.playbackRate=Math.min(m,Math.max(1,g))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}}}}},a.estimateLiveEdge=function(){var e=this.levelDetails;return e===null?null:e.edge+e.age},a.computeLatency=function(){var e=this.estimateLiveEdge();return e===null?null:e-this.currentTime},M(l,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(e===null)return null;var t=e.holdBack,r=e.partHoldBack,i=e.targetduration,s=this.config,d=s.liveSyncDuration,c=s.liveSyncDurationCount,f=s.lowLatencyMode,h=this.hls.userConfig,m=f&&r||t;(h.liveSyncDuration||h.liveSyncDurationCount||m===0)&&(m=d!==void 0?d:c*i);var g=i;return m+Math.min(1*this.stallCount,g)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(e===null||t===null||r===null)return null;var i=r.edge,s=e-t-this.edgeStalled,d=i-r.totalduration,c=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(d,s),c)}},{key:"drift",get:function(){var e=this.levelDetails;return e===null?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(e===null)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}}]),l}(),rn=["NONE","TYPE-0","TYPE-1",null],Ur="",So="YES",Ao="v2",Qa=function(){function l(a,e,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=a,this.part=e,this.skip=t}return l.prototype.addDirectives=function(a){var e=new self.URL(a);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},l}(),nn=function(){function l(a){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[a.url],this._attrs=[a.attrs],this.bitrate=a.bitrate,a.details&&(this.details=a.details),this.id=a.id||0,this.name=a.name,this.width=a.width||0,this.height=a.height||0,this.audioCodec=a.audioCodec,this.videoCodec=a.videoCodec,this.unknownCodecs=a.unknownCodecs,this.codecSet=[a.videoCodec,a.audioCodec].filter(function(e){return e}).join(",").replace(/\.[^.,]+/g,"")}return l.prototype.addFallback=function(a){this.url.push(a.url),this._attrs.push(a.attrs)},M(l,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"attrs",get:function(){return this._attrs[this._urlId]}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(a){var e=a%this.url.length;this._urlId!==e&&(this.fragmentError=0,this.details=void 0,this._urlId=e)}},{key:"audioGroupId",get:function(){var a;return(a=this.audioGroupIds)==null?void 0:a[this.urlId]}},{key:"textGroupId",get:function(){var a;return(a=this.textGroupIds)==null?void 0:a[this.urlId]}}]),l}();function qn(l,a){var e=a.startPTS;if(z(e)){var t,r=0;a.sn>l.sn?(r=e-l.start,t=l):(r=l.start-e,t=a),t.duration!==r&&(t.duration=r)}else a.sn>l.sn?l.cc===a.cc&&l.minEndPTS?a.start=l.start+(l.minEndPTS-l.start):a.start=l.start+l.duration:a.start=Math.max(l.start-a.duration,0)}function Xa(l,a,e,t,r,i){t-e<=0&&(H.warn("Fragment should have a positive duration",a),t=e+a.duration,i=r+a.duration);var s=e,d=t,c=a.startPTS,f=a.endPTS;if(z(c)){var h=Math.abs(c-e);z(a.deltaPTS)?a.deltaPTS=Math.max(h,a.deltaPTS):a.deltaPTS=h,s=Math.max(e,c),e=Math.min(e,c),r=Math.min(r,a.startDTS),d=Math.min(t,f),t=Math.max(t,f),i=Math.max(i,a.endDTS)}a.duration=t-e;var m=e-a.start;a.start=a.startPTS=e,a.maxStartPTS=s,a.startDTS=r,a.endPTS=t,a.minEndPTS=d,a.endDTS=i;var g,E=a.sn;if(!l||E<l.startSN||E>l.endSN)return 0;var k=E-l.startSN,R=l.fragments;for(R[k]=a,g=k;g>0;g--)qn(R[g],R[g-1]);for(g=k;g<R.length-1;g++)qn(R[g],R[g+1]);return l.fragmentHint&&qn(R[R.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,m}function wo(l,a){for(var e=null,t=l.fragments,r=t.length-1;r>=0;r--){var i=t[r].initSegment;if(i){e=i;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;var s,d,c,f,h,m=0;if(function(A,I,O){for(var F=I.skippedSegments,q=Math.max(A.startSN,I.startSN)-I.startSN,Q=(A.fragmentHint?1:0)+(F?I.endSN:Math.min(A.endSN,I.endSN))-I.startSN,X=I.startSN-A.startSN,oe=I.fragmentHint?I.fragments.concat(I.fragmentHint):I.fragments,J=A.fragmentHint?A.fragments.concat(A.fragmentHint):A.fragments,te=q;te<=Q;te++){var fe=J[X+te],de=oe[te];F&&!de&&te<F&&(de=I.fragments[te]=fe),fe&&de&&O(fe,de)}}(l,a,function(A,I){A.relurl&&(m=A.cc-I.cc),z(A.startPTS)&&z(A.endPTS)&&(I.start=I.startPTS=A.startPTS,I.startDTS=A.startDTS,I.maxStartPTS=A.maxStartPTS,I.endPTS=A.endPTS,I.endDTS=A.endDTS,I.minEndPTS=A.minEndPTS,I.duration=A.endPTS-A.startPTS,I.duration&&(s=I),a.PTSKnown=a.alignedSliding=!0),I.elementaryStreams=A.elementaryStreams,I.loader=A.loader,I.stats=A.stats,I.urlId=A.urlId,A.initSegment&&(I.initSegment=A.initSegment,e=A.initSegment)}),e&&(a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments).forEach(function(A){var I;A.initSegment&&A.initSegment.relurl!==((I=e)==null?void 0:I.relurl)||(A.initSegment=e)}),a.skippedSegments)if(a.deltaUpdateFailed=a.fragments.some(function(A){return!A}),a.deltaUpdateFailed){H.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var g=a.skippedSegments;g--;)a.fragments.shift();a.startSN=a.fragments[0].sn,a.startCC=a.fragments[0].cc}else a.canSkipDateRanges&&(a.dateRanges=(d=l.dateRanges,c=a.dateRanges,f=a.recentlyRemovedDateranges,h=G({},d),f&&f.forEach(function(A){delete h[A]}),Object.keys(c).forEach(function(A){var I=new xr(c[A].attr,h[A]);I.isValid?h[A]=I:H.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(c[A].attr)+'"')}),h));var E=a.fragments;if(m){H.warn("discontinuity sliding from playlist, take drift into account");for(var k=0;k<E.length;k++)E[k].cc+=m}a.skippedSegments&&(a.startCC=a.fragments[0].cc),function(A,I,O){if(A&&I)for(var F=0,q=0,Q=A.length;q<=Q;q++){var X=A[q],oe=I[q+F];X&&oe&&X.index===oe.index&&X.fragment.sn===oe.fragment.sn?O(X,oe):F--}}(l.partList,a.partList,function(A,I){I.elementaryStreams=A.elementaryStreams,I.stats=A.stats}),s?Xa(a,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):Za(l,a),E.length&&(a.totalduration=a.edge-E[0].start),a.driftStartTime=l.driftStartTime,a.driftStart=l.driftStart;var R=a.advancedDateTime;if(a.advanced&&R){var D=a.edge;a.driftStart||(a.driftStartTime=R,a.driftStart=D),a.driftEndTime=R,a.driftEnd=D}else a.driftEndTime=l.driftEndTime,a.driftEnd=l.driftEnd,a.advancedDateTime=l.advancedDateTime}function Za(l,a){var e=a.startSN+a.skippedSegments-l.startSN,t=l.fragments;e<0||e>=t.length||jn(a,t[e].start)}function jn(l,a){if(a){for(var e=l.fragments,t=l.skippedSegments;t<e.length;t++)e[t].start+=a;l.fragmentHint&&(l.fragmentHint.start+=a)}}function Pi(l,a,e){var t;return l!=null&&l.details?an((t=l.details)==null?void 0:t.partList,a,e):null}function an(l,a,e){if(l)for(var t=l.length;t--;){var r=l[t];if(r.index===e&&r.fragment.sn===a)return r}return null}function Oi(l){switch(l.details){case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_TIMEOUT:case W.LEVEL_LOAD_TIMEOUT:case W.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function sn(l,a){var e=Oi(a);return l.default[(e?"timeout":"error")+"Retry"]}function Wn(l,a){var e=l.backoff==="linear"?1:Math.pow(2,a);return Math.min(e*l.retryDelayMs,l.maxRetryDelayMs)}function Ja(l){return L(L({},l),{errorRetry:null,timeoutRetry:null})}function on(l,a,e,t){return!!l&&a<l.maxNumRetry&&(function(r){return r===0&&navigator.onLine===!1||!!r&&(r<400||r>499)}(t)||!!e)}var es=function(l,a){for(var e=0,t=l.length-1,r=null,i=null;e<=t;){var s=a(i=l[r=(e+t)/2|0]);if(s>0)e=r+1;else{if(!(s<0))return i;t=r-1}}return null};function Fi(l,a,e,t){e===void 0&&(e=0),t===void 0&&(t=0);var r=null;if(l?r=a[l.sn-a[0].sn+1]||null:e===0&&a[0].start===0&&(r=a[0]),r&&$n(e,t,r)===0)return r;var i=es(a,$n.bind(null,e,t));return!i||i===l&&r?r:i}function $n(l,a,e){if(l===void 0&&(l=0),a===void 0&&(a=0),e.start<=l&&e.start+e.duration>l)return 0;var t=Math.min(a,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=l?1:e.start-t>l&&e.start?-1:0}function ko(l,a,e){var t=1e3*Math.min(a,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-t>l}var Yn,Ro=3e5,ln=0,Et=2,Br=5,vi=0,un=1,S=2,y=function(){function l(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=H.log.bind(H,"[info]:"),this.warn=H.warn.bind(H,"[warning]:"),this.error=H.error.bind(H,"[error]:"),this.registerListeners()}var a=l.prototype;return a.registerListeners=function(){var e=this.hls;e.on(w.ERROR,this.onError,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this)},a.unregisterListeners=function(){var e=this.hls;e&&(e.off(w.ERROR,this.onError,this),e.off(w.ERROR,this.onErrorOut,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this))},a.destroy=function(){this.unregisterListeners(),this.hls=null},a.startLoad=function(e){this.playlistError=0},a.stopLoad=function(){},a.getVariantLevelIndex=function(e){return(e==null?void 0:e.type)===at?e.level:this.hls.loadLevel},a.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},a.onError=function(e,t){var r;if(!t.fatal){var i=this.hls,s=t.context;switch(t.details){case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case W.FRAG_GAP:case W.FRAG_PARSING_ERROR:case W.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=Et);case W.LEVEL_EMPTY_ERROR:case W.LEVEL_PARSING_ERROR:var d,c,f=t.parent===at?t.level:i.loadLevel;return void(t.details===W.LEVEL_EMPTY_ERROR&&(d=t.context)!=null&&(c=d.levelDetails)!=null&&c.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f)));case W.LEVEL_LOAD_ERROR:case W.LEVEL_LOAD_TIMEOUT:return void(typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level)));case W.AUDIO_TRACK_LOAD_ERROR:case W.AUDIO_TRACK_LOAD_TIMEOUT:case W.SUBTITLE_LOAD_ERROR:case W.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){var h=i.levels[i.loadLevel];if(h&&(s.type===dr&&s.groupId===h.audioGroupId||s.type===cr&&s.groupId===h.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Et,void(t.errorAction.flags=un)}return;case W.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var m=i.levels[i.loadLevel],g=m==null?void 0:m.attrs["HDCP-LEVEL"];return void(g&&(t.errorAction={action:Et,flags:S,hdcpLevel:g}));case W.BUFFER_ADD_CODEC_ERROR:case W.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,(r=t.level)!=null?r:i.loadLevel));case W.INTERNAL_EXCEPTION:case W.BUFFER_APPENDING_ERROR:case W.BUFFER_APPEND_ERROR:case W.BUFFER_FULL_ERROR:case W.LEVEL_SWITCH_ERROR:case W.BUFFER_STALLED_ERROR:case W.BUFFER_SEEK_OVER_HOLE:case W.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:ln,flags:vi})}if(t.type===se.KEY_SYSTEM_ERROR){var E=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,E))}}},a.getPlaylistRetryOrSwitchAction=function(e,t){var r,i,s=sn(this.hls.config.playlistLoadPolicy,e),d=this.playlistError++,c=(r=e.response)==null?void 0:r.code;return on(s,d,Oi(e),c)?{action:Br,flags:vi,retryConfig:s,retryCount:d}:(i=e.context)!=null&&i.deliveryDirectives?{action:ln,flags:vi,retryConfig:s||{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},retryCount:d}:this.getLevelSwitchAction(e,t)},a.getFragRetryOrSwitchAction=function(e){var t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],s=t.config,d=s.fragLoadPolicy,c=s.keyLoadPolicy,f=sn(e.details.startsWith("key")?c:d,e),h=t.levels.reduce(function(k,R){return k+R.fragmentError},0);if(i){var m;e.details!==W.FRAG_GAP&&i.fragmentError++;var g=(m=e.response)==null?void 0:m.code;if(on(f,h,Oi(e),g))return{action:Br,flags:vi,retryConfig:f,retryCount:h}}var E=this.getLevelSwitchAction(e,r);return f&&(E.retryConfig=f,E.retryCount=h),E},a.getLevelSwitchAction=function(e,t){var r=this.hls;t==null&&(t=r.loadLevel);var i=this.hls.levels[t];if(i&&(e.details!==W.FRAG_GAP&&i.loadError++,r.autoLevelEnabled)){for(var s,d,c=-1,f=r.levels,h=(s=e.frag)==null?void 0:s.type,m=(d=e.context)!=null?d:{},g=m.type,E=m.groupId,k=f.length;k--;){var R=(k+r.loadLevel)%f.length;if(R!==r.loadLevel&&f[R].loadError===0){var D=f[R];if(e.details===W.FRAG_GAP&&e.frag){var A=f[R].details;if(A){var I=Fi(e.frag,A.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else if(g===dr&&E===D.audioGroupId||g===cr&&E===D.textGroupId||h===Sr&&i.audioGroupId===D.audioGroupId||h===Ar&&i.textGroupId===D.textGroupId)continue;c=R;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,{action:Et,flags:vi,nextAutoLevel:c}}return{action:Et,flags:un}},a.onErrorOut=function(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case ln:break;case Et:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===W.FRAG_GAP||(t.fatal=!0)}t.fatal&&this.hls.stopLoad()},a.sendAlternateToPenaltyBox=function(e){var t=this.hls,r=e.errorAction;if(r){var i=r.flags,s=r.hdcpLevel,d=r.nextAutoLevel;switch(i){case vi:this.switchLevel(e,d);break;case un:r.resolved||(r.resolved=this.redundantFailover(e));break;case S:s&&(t.maxHdcpLevel=rn[rn.indexOf(s)-1],r.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+t.maxHdcpLevel+'" or lower')}r.resolved||this.switchLevel(e,d)}},a.switchLevel=function(e,t){t!==void 0&&e.errorAction&&(this.warn("switching to level "+t+" after "+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},a.redundantFailover=function(e){var t=this,r=this.hls,i=this.penalizedRenditions,s=e.parent===at?e.level:r.loadLevel,d=r.levels[s],c=d.url.length;this.penalizeRendition(d,e);for(var f=function(g){var E=(d.urlId+g)%c,k=i[E];if(!k||function(R,D,A){if(performance.now()-R.lastErrorPerfMs>Ro)return!0;var I=R.details;if(D.details===W.FRAG_GAP&&I&&D.frag){var O=D.frag.start,F=Fi(null,I.fragments,O);if(F&&!F.gap)return!0}if(A&&R.errors.length<A.errors.length){var q=R.errors[R.errors.length-1];if(I&&q.frag&&D.frag&&Math.abs(q.frag.start-D.frag.start)>3*I.targetduration)return!0}return!1}(k,e,i[d.urlId]))return t.warn("Switching to Redundant Stream "+(E+1)+"/"+c+': "'+d.url[E]+'" after '+e.details),t.playlistError=0,r.levels.forEach(function(R){R.urlId=E}),r.nextLoadLevel=s,{v:!0}},h=1;h<c;h++){var m=f(h);if(typeof m=="object")return m.v}return!1},a.penalizeRendition=function(e,t){var r=this.penalizedRenditions,i=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};i.lastErrorPerfMs=performance.now(),i.errors.push(t),i.details=e.details,r[e.urlId]=i},l}(),_=function(){function l(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=H.log.bind(H,t+":"),this.warn=H.warn.bind(H,t+":"),this.hls=e}var a=l.prototype;return a.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},a.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},a.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},a.stopLoad=function(){this.canLoad=!1,this.clearTimer()},a.switchParams=function(e,t){var r=t==null?void 0:t.renditionReports;if(r){for(var i=-1,s=0;s<r.length;s++){var d=r[s],c=void 0;try{c=new self.URL(d.URI,t.url).href}catch(E){H.warn("Could not construct new URL for Rendition Report: "+E),c=d.URI||""}if(c===e){i=s;break}c===e.substring(0,c.length)&&(i=s)}if(i!==-1){var f=r[i],h=parseInt(f["LAST-MSN"])||(t==null?void 0:t.lastPartSn),m=parseInt(f["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var g=Math.min(t.age-t.partTarget,t.targetduration);m>=0&&g>t.partTarget&&(m+=1)}return new Qa(h,m>=0?m:void 0,Ur)}}},a.loadPlaylist=function(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},a.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},a.shouldReloadPlaylist=function(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)},a.playlistLoaded=function(e,t,r){var i=this,s=t.details,d=t.stats,c=self.performance.now(),f=d.loading.first?Math.max(0,c-d.loading.first):0;if(s.advancedDateTime=Date.now()-f,s.live||r!=null&&r.live){if(s.reloaded(r),r&&this.log("live playlist "+e+" "+(s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:"MISSED")),r&&s.fragments.length>0&&wo(r,s),!this.canLoad||!s.live)return;var h,m=void 0,g=void 0;if(s.canBlockReload&&s.endSN&&s.advanced){var E=this.hls.config.lowLatencyMode,k=s.lastPartSn,R=s.endSN,D=s.lastPartIndex,A=k===R;D!==-1?(m=A?R+1:k,g=A?E?0:D:D+1):m=R+1;var I=s.age,O=I+s.ageHeader,F=Math.min(O-s.partTarget,1.5*s.targetduration);if(F>0){if(r&&F>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+F+" with playlist age: "+s.age),F=0;else{var q=Math.floor(F/s.targetduration);m+=q,g!==void 0&&(g+=Math.round(F%s.targetduration/s.partTarget)),this.log("CDN Tune-in age: "+s.ageHeader+"s last advanced "+I.toFixed(2)+"s goal: "+F+" skip sn "+q+" to part "+g)}s.tuneInGoal=F}if(h=this.getDeliveryDirectives(s,t.deliveryDirectives,m,g),E||!A)return void this.loadPlaylist(h)}else s.canBlockReload&&(h=this.getDeliveryDirectives(s,t.deliveryDirectives,m,g));var Q=this.hls.mainForwardBufferInfo,X=Q?Q.end-Q.len:0,oe=function(te,fe){fe===void 0&&(fe=1/0);var de=1e3*te.targetduration;if(te.updated){var _e=te.fragments;if(_e.length&&4*de>fe){var Oe=1e3*_e[_e.length-1].duration;Oe<de&&(de=Oe)}}else de/=2;return Math.round(de)}(s,1e3*(s.edge-X));s.updated&&c>this.requestScheduled+oe&&(this.requestScheduled=d.loading.start),m!==void 0&&s.canBlockReload?this.requestScheduled=d.loading.first+oe-(1e3*s.partTarget||1e3):this.requestScheduled===-1||this.requestScheduled+oe<c?this.requestScheduled=c:this.requestScheduled-c<=0&&(this.requestScheduled+=oe);var J=this.requestScheduled-c;J=Math.max(0,J),this.log("reload live playlist "+e+" in "+Math.round(J)+" ms"),this.timer=self.setTimeout(function(){return i.loadPlaylist(h)},J)}else this.clearTimer()},a.getDeliveryDirectives=function(e,t,r,i){var s=function(d,c){var f=d.canSkipUntil,h=d.canSkipDateRanges,m=d.endSN;return f&&(c!==void 0?c-m:0)<f?h?Ao:So:Ur}(e,r);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,s=Ur),new Qa(r,i,s)},a.checkRetry=function(e){var t=this,r=e.details,i=Oi(e),s=e.errorAction,d=s||{},c=d.action,f=d.retryCount,h=f===void 0?0:f,m=d.retryConfig,g=c===Br&&!!s&&!!m;if(g){var E;if(this.requestScheduled=-1,i&&(E=e.context)!=null&&E.deliveryDirectives)this.warn("Retrying playlist loading "+(h+1)+"/"+m.maxNumRetry+' after "'+r+'" without delivery-directives'),this.loadPlaylist();else{var k=Wn(m,h);this.timer=self.setTimeout(function(){return t.loadPlaylist()},k),this.warn("Retrying playlist loading "+(h+1)+"/"+m.maxNumRetry+' after "'+r+'" in '+k+"ms")}e.levelRetry=!0,s.resolved=!0}return g},l}(),b=function(l){function a(t,r){var i;return(i=l.call(this,t,"[level-controller]")||this)._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=r,i._registerListeners(),i}Y(a,l);var e=a.prototype;return e._registerListeners=function(){var t=this.hls;t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(w.LEVEL_LOADED,this.onLevelLoaded,this),t.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(w.FRAG_LOADED,this.onFragLoaded,this),t.on(w.ERROR,this.onError,this)},e._unregisterListeners=function(){var t=this.hls;t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(w.LEVEL_LOADED,this.onLevelLoaded,this),t.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(w.FRAG_LOADED,this.onFragLoaded,this),t.off(w.ERROR,this.onError,this)},e.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),l.prototype.destroy.call(this)},e.startLoad=function(){this._levels.forEach(function(t){t.loadError=0,t.fragmentError=0}),l.prototype.startLoad.call(this)},e.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]},e.onManifestLoading=function(t,r){this.resetLevels()},e.onManifestLoaded=function(t,r){var i,s=[],d={};r.levels.forEach(function(c){var f,h=c.attrs;((f=c.audioCodec)==null?void 0:f.indexOf("mp4a.40.34"))!==-1&&(Yn||(Yn=/chrome|firefox/i.test(navigator.userAgent)),Yn&&(c.audioCodec=void 0));var m=h.AUDIO,g=h.CODECS,E=h["FRAME-RATE"],k=h["PATHWAY-ID"],R=h.RESOLUTION,D=h.SUBTITLES,A=(k||".")+"-"+c.bitrate+"-"+R+"-"+E+"-"+g;(i=d[A])?i.addFallback(c):(i=new nn(c),d[A]=i,s.push(i)),x(i,"audio",m),x(i,"text",D)}),this.filterAndSortMediaOptions(s,r)},e.filterAndSortMediaOptions=function(t,r){var i=this,s=[],d=[],c=!1,f=!1,h=!1,m=t.filter(function(I){var O=I.audioCodec,F=I.videoCodec,q=I.width,Q=I.height,X=I.unknownCodecs;return c||(c=!(!q||!Q)),f||(f=!!F),h||(h=!!O),!(X!=null&&X.length)&&(!O||Xi(O,"audio"))&&(!F||Xi(F,"video"))});if((c||f)&&h&&(m=m.filter(function(I){var O=I.videoCodec,F=I.width,q=I.height;return!!O||!(!F||!q)})),m.length!==0){r.audioTracks&&U(s=r.audioTracks.filter(function(I){return!I.audioCodec||Xi(I.audioCodec,"audio")})),r.subtitles&&U(d=r.subtitles);var g=m.slice(0);m.sort(function(I,O){return I.attrs["HDCP-LEVEL"]!==O.attrs["HDCP-LEVEL"]?(I.attrs["HDCP-LEVEL"]||"")>(O.attrs["HDCP-LEVEL"]||"")?1:-1:I.bitrate!==O.bitrate?I.bitrate-O.bitrate:I.attrs["FRAME-RATE"]!==O.attrs["FRAME-RATE"]?I.attrs.decimalFloatingPoint("FRAME-RATE")-O.attrs.decimalFloatingPoint("FRAME-RATE"):I.attrs.SCORE!==O.attrs.SCORE?I.attrs.decimalFloatingPoint("SCORE")-O.attrs.decimalFloatingPoint("SCORE"):c&&I.height!==O.height?I.height-O.height:0});var E=g[0];if(this.steering&&(m=this.steering.filterParsedLevels(m)).length!==g.length){for(var k=0;k<g.length;k++)if(g[k].pathwayId===m[0].pathwayId){E=g[k];break}}this._levels=m;for(var R=0;R<m.length;R++)if(m[R]===E){this._firstLevel=R,this.log("manifest loaded, "+m.length+" level(s) found, first bitrate: "+E.bitrate);break}var D=h&&!f,A={levels:m,audioTracks:s,subtitleTracks:d,sessionData:r.sessionData,sessionKeys:r.sessionKeys,firstLevel:this._firstLevel,stats:r.stats,audio:h,video:f,altAudio:!D&&s.some(function(I){return!!I.url})};this.hls.trigger(w.MANIFEST_PARSED,A),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then(function(){if(i.hls){var I=new Error("no level with compatible codecs found in manifest");i.hls.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,error:I,reason:I.message})}})},e.onError=function(t,r){!r.fatal&&r.context&&r.context.type===ti&&r.context.level===this.level&&this.checkRetry(r)},e.onFragLoaded=function(t,r){var i=r.frag;if(i!==void 0&&i.type===at){var s=this._levels[i.level];s!==void 0&&(s.loadError=0)}},e.onLevelLoaded=function(t,r){var i,s,d=r.level,c=r.details,f=this._levels[d];if(!f)return this.warn("Invalid level index "+d),void((s=r.deliveryDirectives)!=null&&s.skip&&(c.deltaUpdateFailed=!0));d===this.currentLevelIndex?(f.fragmentError===0&&(f.loadError=0),this.playlistLoaded(d,r,f.details)):(i=r.deliveryDirectives)!=null&&i.skip&&(c.deltaUpdateFailed=!0)},e.onAudioTrackSwitched=function(t,r){var i=this.currentLevel;if(i){var s=this.hls.audioTracks[r.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==s){for(var d=-1,c=0;c<i.audioGroupIds.length;c++)if(i.audioGroupIds[c]===s){d=c;break}d!==-1&&d!==i.urlId&&(i.urlId=d,this.canLoad&&this.startLoad())}}},e.loadPlaylist=function(t){l.prototype.loadPlaylist.call(this);var r=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){var s=i.urlId,d=i.uri;if(t)try{d=t.addDirectives(d)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}var c=i.attrs["PATHWAY-ID"];this.log("Loading level index "+r+((t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:"")+" with"+(c?" Pathway "+c:"")+" URI "+(s+1)+"/"+i.url.length+" "+d),this.clearTimer(),this.hls.trigger(w.LEVEL_LOADING,{url:d,level:r,id:s,deliveryDirectives:t||null})}},e.removeLevel=function(t,r){var i=this,s=function(c,f){return f!==r},d=this._levels.filter(function(c,f){return f!==t||(c.url.length>1&&r!==void 0?(c.url=c.url.filter(s),c.audioGroupIds&&(c.audioGroupIds=c.audioGroupIds.filter(s)),c.textGroupIds&&(c.textGroupIds=c.textGroupIds.filter(s)),c.urlId=0,!0):(i.steering&&i.steering.removeLevel(c),!1))});this.hls.trigger(w.LEVELS_UPDATED,{levels:d})},e.onLevelsUpdated=function(t,r){var i=r.levels;i.forEach(function(s,d){var c=s.details;c!=null&&c.fragments&&c.fragments.forEach(function(f){f.level=d})}),this._levels=i},M(a,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var r=this._levels;if(r.length!==0){if(t<0||t>=r.length){var i=new Error("invalid level idx"),s=t<0;if(this.hls.trigger(w.ERROR,{type:se.OTHER_ERROR,details:W.LEVEL_SWITCH_ERROR,level:t,fatal:s,error:i,reason:i.message}),s)return;t=Math.min(t,r.length-1)}var d=this.currentLevelIndex,c=this.currentLevel,f=c?c.attrs["PATHWAY-ID"]:void 0,h=r[t],m=h.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=h,d!==t||!h.details||!c||f!==m){this.log("Switching to level "+t+(m?" with Pathway "+m:"")+" from level "+d+(f?" with Pathway "+f:""));var g=G({},h,{level:t,maxBitrate:h.maxBitrate,attrs:h.attrs,uri:h.uri,urlId:h.urlId});delete g._attrs,delete g._urlId,this.hls.trigger(w.LEVEL_SWITCHING,g);var E=h.details;if(!E||E.live){var k=this.switchParams(h.uri,c==null?void 0:c.details);this.loadPlaylist(k)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var t=this.hls.config.startLevel;return t!==void 0?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}}]),a}(_);function x(l,a,e){e&&(a==="audio"?(l.audioGroupIds||(l.audioGroupIds=[]),l.audioGroupIds[l.url.length-1]=e):a==="text"&&(l.textGroupIds||(l.textGroupIds=[]),l.textGroupIds[l.url.length-1]=e))}function U(l){var a={};l.forEach(function(e){var t=e.groupId||"";e.id=a[t]=a[t]||0,a[t]++})}var P="NOT_LOADED",$="APPENDING",K="PARTIAL",ie="OK",be=function(){function l(e){this.mainFragEntity=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var a=l.prototype;return a._registerListeners=function(){var e=this.hls;e.on(w.BUFFER_APPENDED,this.onBufferAppended,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this),e.on(w.FRAG_LOADED,this.onFragLoaded,this)},a._unregisterListeners=function(){var e=this.hls;e.off(w.BUFFER_APPENDED,this.onBufferAppended,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this),e.off(w.FRAG_LOADED,this.onFragLoaded,this)},a.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.mainFragEntity=this.activeParts=null},a.getAppendedFrag=function(e,t){if(t===at){var r=this.mainFragEntity,i=this.activeParts;if(r){if(r&&i)for(var s=i.length;s--;){var d=i[s],c=d?d.end:r.appendedPTS;if(d.start<=e&&c!==null&&e<=c)return s>9&&(this.activeParts=i.slice(s-9)),d}else if(r.body.start<=e&&r.appendedPTS!==null&&e<=r.appendedPTS)return r.body}}return this.getBufferedFrag(e,t)},a.getBufferedFrag=function(e,t){for(var r=this.fragments,i=Object.keys(r),s=i.length;s--;){var d=r[i[s]];if((d==null?void 0:d.body.type)===t&&d.buffered){var c=d.body;if(c.start<=e&&e<=c.end)return c}}return null},a.detectEvictedFragments=function(e,t,r){var i=this;this.timeRanges&&(this.timeRanges[e]=t),Object.keys(this.fragments).forEach(function(s){var d=i.fragments[s];if(d)if(d.buffered||d.loaded){var c=d.range[e];c&&c.time.some(function(f){var h=!i.isTimeBuffered(f.startPTS,f.endPTS,t);return h&&i.removeFragment(d.body),h})}else d.body.type===r&&i.removeFragment(d.body)})},a.detectPartialFragments=function(e){var t=this,r=this.timeRanges,i=e.frag,s=e.part;if(r&&i.sn!=="initSegment"){var d=De(i),c=this.fragments[d];c&&(Object.keys(r).forEach(function(f){var h=i.elementaryStreams[f];if(h){var m=r[f],g=s!==null||h.partial===!0;c.range[f]=t.getBufferedTimes(i,s,g,m)}}),c.loaded=null,Object.keys(c.range).length?(c.buffered=!0,c.body.endList&&(this.endListFragments[c.body.type]=c)):this.removeFragment(c.body))}},a.fragBuffered=function(e,t){var r=De(e),i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)}),i&&(i.loaded=null,i.buffered=!0)},a.getBufferedTimes=function(e,t,r,i){for(var s={time:[],partial:r},d=t?t.start:e.start,c=t?t.end:e.end,f=e.minEndPTS||c,h=e.maxStartPTS||d,m=0;m<i.length;m++){var g=i.start(m)-this.bufferPadding,E=i.end(m)+this.bufferPadding;if(h>=g&&f<=E){s.time.push({startPTS:Math.max(d,i.start(m)),endPTS:Math.min(c,i.end(m))});break}if(d<E&&c>g)s.partial=!0,s.time.push({startPTS:Math.max(d,i.start(m)),endPTS:Math.min(c,i.end(m))});else if(c<=g)break}return s},a.getPartialFragment=function(e){var t,r,i,s=null,d=0,c=this.bufferPadding,f=this.fragments;return Object.keys(f).forEach(function(h){var m=f[h];m&&Le(m)&&(r=m.body.start-c,i=m.body.end+c,e>=r&&e<=i&&(t=Math.min(e-r,i-e),d<=t&&(s=m.body,d=t)))}),s},a.isEndListAppended=function(e){var t=this.endListFragments[e];return t!==void 0&&(t.buffered||Le(t))},a.getState=function(e){var t=De(e),r=this.fragments[t];return r?r.buffered?Le(r)?K:ie:$:P},a.isTimeBuffered=function(e,t,r){for(var i,s,d=0;d<r.length;d++){if(i=r.start(d)-this.bufferPadding,s=r.end(d)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1},a.onFragLoaded=function(e,t){var r=t.frag,i=t.part;if(r.sn!=="initSegment"&&!r.bitrateTest&&!i){var s=De(r);this.fragments[s]={body:r,appendedPTS:null,loaded:t,buffered:!1,range:Object.create(null)}}},a.onBufferAppended=function(e,t){var r=this,i=t.frag,s=t.part,d=t.timeRanges,c=this.mainFragEntity;if(i.type===at){var f=c?c.body:null;if(f!==i){c&&f&&f.sn!==i.sn&&(c.buffered=!0,this.fragments[De(f)]=c);var h=De(i);c=this.mainFragEntity=this.fragments[h]||{body:i,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)}}if(s){var m=this.activeParts;m||(this.activeParts=m=[]),m.push(s)}else this.activeParts=null}this.timeRanges=d,Object.keys(d).forEach(function(g){var E=d[g];if(r.detectEvictedFragments(g,E),!s&&c){var k=i.elementaryStreams[g];if(!k)return;for(var R=0;R<E.length;R++){var D=E.end(R);D<=k.endPTS&&D>k.startPTS?c.appendedPTS=Math.max(D,c.appendedPTS||0):c.appendedPTS=k.endPTS}}})},a.onFragBuffered=function(e,t){this.detectPartialFragments(t)},a.hasFragment=function(e){var t=De(e);return!!this.fragments[t]},a.removeFragmentsInRange=function(e,t,r){var i=this;Object.keys(this.fragments).forEach(function(s){var d=i.fragments[s];if(d&&d.buffered){var c=d.body;c.type===r&&c.start<t&&c.end>e&&i.removeFragment(c)}})},a.removeFragment=function(e){var t=De(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),this.mainFragEntity===this.fragments[t]&&(this.mainFragEntity=null),delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},a.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.mainFragEntity=null,this.activeParts=null},l}();function Le(l){var a,e;return l.buffered&&(l.body.gap||((a=l.range.video)==null?void 0:a.partial)||((e=l.range.audio)==null?void 0:e.partial))}function De(l){return l.type+"_"+l.level+"_"+l.urlId+"_"+l.sn}var me=Math.pow(2,17),Me=function(){function l(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var a=l.prototype;return a.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},a.abort=function(){this.loader&&this.loader.abort()},a.load=function(e,t){var r=this,i=e.url;if(!i)return Promise.reject(new dt({type:se.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();var s=this.config,d=s.fLoader,c=s.loader;return new Promise(function(f,h){if(r.loader&&r.loader.destroy(),e.gap)h(yt(e));else{var m=r.loader=e.loader=d?new d(s):new c(s),g=Ue(e),E=Ja(s.fragLoadPolicy.default),k={loadPolicy:E,timeout:E.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:me};e.stats=m.stats,m.load(g,k,{onSuccess:function(R,D,A,I){r.resetLoader(e,m);var O=R.data;A.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(O.slice(0,16)),O=O.slice(16)),f({frag:e,part:null,payload:O,networkDetails:I})},onError:function(R,D,A,I){r.resetLoader(e,m),h(new dt({type:se.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:L({url:i,data:void 0},R),error:new Error("HTTP Error "+R.code+" "+R.text),networkDetails:A,stats:I}))},onAbort:function(R,D,A){r.resetLoader(e,m),h(new dt({type:se.NETWORK_ERROR,details:W.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:A,stats:R}))},onTimeout:function(R,D,A){r.resetLoader(e,m),h(new dt({type:se.NETWORK_ERROR,details:W.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after "+k.timeout+"ms"),networkDetails:A,stats:R}))},onProgress:function(R,D,A,I){t&&t({frag:e,part:null,payload:A,networkDetails:I})}})}})},a.loadPart=function(e,t,r){var i=this;this.abort();var s=this.config,d=s.fLoader,c=s.loader;return new Promise(function(f,h){if(i.loader&&i.loader.destroy(),e.gap||t.gap)h(yt(e,t));else{var m=i.loader=e.loader=d?new d(s):new c(s),g=Ue(e,t),E=Ja(s.fragLoadPolicy.default),k={loadPolicy:E,timeout:E.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:me};t.stats=m.stats,m.load(g,k,{onSuccess:function(R,D,A,I){i.resetLoader(e,m),i.updateStatsFromPart(e,t);var O={frag:e,part:t,payload:R.data,networkDetails:I};r(O),f(O)},onError:function(R,D,A,I){i.resetLoader(e,m),h(new dt({type:se.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:L({url:g.url,data:void 0},R),error:new Error("HTTP Error "+R.code+" "+R.text),networkDetails:A,stats:I}))},onAbort:function(R,D,A){e.stats.aborted=t.stats.aborted,i.resetLoader(e,m),h(new dt({type:se.NETWORK_ERROR,details:W.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:A,stats:R}))},onTimeout:function(R,D,A){i.resetLoader(e,m),h(new dt({type:se.NETWORK_ERROR,details:W.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after "+k.timeout+"ms"),networkDetails:A,stats:R}))}})}})},a.updateStatsFromPart=function(e,t){var r=e.stats,i=t.stats,s=i.total;if(r.loaded+=i.loaded,s){var d=Math.round(e.duration/t.duration),c=Math.min(Math.round(r.loaded/s),d),f=(d-c)*Math.round(r.loaded/c);r.total=r.loaded+f}else r.total=Math.max(r.loaded,r.total);var h=r.loading,m=i.loading;h.start?h.first+=m.first-m.start:(h.start=m.start,h.first=m.first),h.end=m.end},a.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},l}();function Ue(l,a){a===void 0&&(a=null);var e=a||l,t={frag:l,part:a,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},r=e.byteRangeStartOffset,i=e.byteRangeEndOffset;if(z(r)&&z(i)){var s,d=r,c=i;if(l.sn==="initSegment"&&((s=l.decryptdata)==null?void 0:s.method)==="AES-128"){var f=i-r;f%16&&(c=i+(16-f%16)),r!==0&&(t.resetIV=!0,d=r-16)}t.rangeStart=d,t.rangeEnd=c}return t}function yt(l,a){var e=new Error("GAP "+(l.gap?"tag":"attribute")+" found"),t={type:se.MEDIA_ERROR,details:W.FRAG_GAP,fatal:!1,frag:l,error:e,networkDetails:null};return a&&(t.part=a),(a||l).stats.aborted=!0,new dt(t)}var dt=function(l){function a(e){var t;return(t=l.call(this,e.error.message)||this).data=void 0,t.data=e,t}return Y(a,l),a}(ue(Error)),At=function(){function l(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var a=l.prototype;return a.abort=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.abort()}},a.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},a.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},a.createKeyLoadError=function(e,t,r,i,s){return t===void 0&&(t=W.KEY_LOAD_ERROR),new dt({type:se.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:r,networkDetails:i})},a.loadClear=function(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var i=e.sn,s=e.cc,d=function(f){var h=t[f];if(s<=h.cc&&(i==="initSegment"||h.sn==="initSegment"||i<h.sn))return r.emeController.selectKeySystemFormat(h).then(function(m){h.setKeyFormat(m)}),"break"},c=0;c<t.length&&d(c)!=="break";c++);},a.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(function(r){return t.loadInternal(e,r)}):this.loadInternal(e)},a.loadInternal=function(e,t){var r,i;t&&e.setKeyFormat(t);var s=e.decryptdata;if(!s){var d=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,W.KEY_LOAD_ERROR,d))}var c=s.uri;if(!c)return Promise.reject(this.createKeyLoadError(e,W.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+c+'"')));var f,h=this.keyUriToKeyInfo[c];if((r=h)!=null&&r.decryptdata.key)return s.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if((i=h)!=null&&i.keyLoadPromise)switch((f=h.mediaKeySessionContext)==null?void 0:f.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return h.keyLoadPromise.then(function(m){return s.key=m.keyInfo.decryptdata.key,{frag:e,keyInfo:h}})}switch(h=this.keyUriToKeyInfo[c]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,W.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+s.method+'"')))}},a.loadKeyEME=function(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(function(s){return e.mediaKeySessionContext=s,r})).catch(function(s){throw e.keyLoadPromise=null,s})}return Promise.resolve(r)},a.loadKeyHTTP=function(e,t){var r=this,i=this.config,s=new i.loader(i);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise(function(d,c){var f={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},h=i.keyLoadPolicy.default,m={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:function(E,k,R,D){var A=R.frag,I=R.keyInfo,O=R.url;if(!A.decryptdata||I!==r.keyUriToKeyInfo[O])return c(r.createKeyLoadError(A,W.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),D));I.decryptdata.key=A.decryptdata.key=new Uint8Array(E.data),A.keyLoader=null,I.loader=null,d({frag:A,keyInfo:I})},onError:function(E,k,R,D){r.resetLoader(k),c(r.createKeyLoadError(t,W.KEY_LOAD_ERROR,new Error("HTTP Error "+E.code+" loading key "+E.text),R,L({url:f.url,data:void 0},E)))},onTimeout:function(E,k,R){r.resetLoader(k),c(r.createKeyLoadError(t,W.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),R))},onAbort:function(E,k,R){r.resetLoader(k),c(r.createKeyLoadError(t,W.INTERNAL_ABORTED,new Error("key loading aborted"),R))}};s.load(f,m,g)})},a.resetLoader=function(e){var t=e.frag,r=e.keyInfo,i=e.url,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()},l}(),Bt=function(){function l(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var a=l.prototype;return a.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},a.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},a.onHandlerDestroyed=function(){},a.hasInterval=function(){return!!this._tickInterval},a.hasNextTick=function(){return!!this._tickTimer},a.setInterval=function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},a.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},a.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},a.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},a.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},a.doTick=function(){},l}(),Ye={length:0,start:function(){return 0},end:function(){return 0}},Ge=function(){function l(){}return l.isBuffered=function(a,e){try{if(a){for(var t=l.getBuffered(a),r=0;r<t.length;r++)if(e>=t.start(r)&&e<=t.end(r))return!0}}catch{}return!1},l.bufferInfo=function(a,e,t){try{if(a){var r,i=l.getBuffered(a),s=[];for(r=0;r<i.length;r++)s.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(s,e,t)}}catch{}return{len:0,start:e,end:e,nextStart:void 0}},l.bufferedInfo=function(a,e,t){e=Math.max(0,e),a.sort(function(R,D){var A=R.start-D.start;return A||D.end-R.end});var r=[];if(t)for(var i=0;i<a.length;i++){var s=r.length;if(s){var d=r[s-1].end;a[i].start-d<t?a[i].end>d&&(r[s-1].end=a[i].end):r.push(a[i])}else r.push(a[i])}else r=a;for(var c,f=0,h=e,m=e,g=0;g<r.length;g++){var E=r[g].start,k=r[g].end;if(e+t>=E&&e<k)h=E,f=(m=k)-e;else if(e+t<E){c=E;break}}return{len:f,start:h||0,end:m||0,nextStart:c}},l.getBuffered=function(a){try{return a.buffered}catch(e){return H.log("failed to get media.buffered",e),Ye}},l}(),ze=function(l,a,e,t,r,i){t===void 0&&(t=0),r===void 0&&(r=-1),i===void 0&&(i=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=l,this.sn=a,this.id=e,this.size=t,this.part=r,this.partial=i};function he(l,a){for(var e=null,t=0,r=l.length;t<r;t++){var i=l[t];if(i&&i.cc===a){e=i;break}}return e}function we(l,a){if(l){var e=l.start+a;l.start=l.startPTS=e,l.endPTS=e+l.duration}}function ve(l,a){for(var e=a.fragments,t=0,r=e.length;t<r;t++)we(e[t],l);a.fragmentHint&&we(a.fragmentHint,l),a.alignedSliding=!0}function Ne(l,a,e){a&&(function(t,r,i){if(function(d,c,f){return!(!c.details||!(f.endCC>f.startCC||d&&d.cc<f.startCC))}(t,i,r)){var s=function(d,c,f){var h=d.fragments,m=c.fragments;if(m.length&&h.length){var g=he(h,m[0].cc);if(g&&(!g||g.startPTS))return g;H.log("No frag in previous level to align on")}else H.log("No fragments to align")}(i.details,r);s&&z(s.start)&&(H.log("Adjusting PTS using last level due to CC increase within current level "+r.url),ve(s.start,r))}}(l,e,a),!e.alignedSliding&&a.details&&function(t,r){if(r.fragments.length&&t.hasProgramDateTime&&r.hasProgramDateTime){var i=r.fragments[0].programDateTime,s=t.fragments[0].programDateTime,d=(s-i)/1e3+r.fragments[0].start;d&&z(d)&&(H.log("Adjusting PTS using programDateTime delta "+(s-i)+"ms, sliding:"+d.toFixed(3)+" "+t.url+" "),ve(d,t))}}(e,a.details),e.alignedSliding||!a.details||e.skippedSegments||Za(a.details,e))}function je(l,a){if(l.hasProgramDateTime&&a.hasProgramDateTime){var e=l.fragments,t=a.fragments;if(e.length&&t.length){var r=t[Math.round(t.length/2)-1],i=he(e,r.cc)||e[Math.round(e.length/2)-1],s=r.programDateTime,d=i.programDateTime;s!==null&&d!==null&&ve((d-s)/1e3-(i.start-r.start),l)}}}var vt=function(){function l(a,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=a,this.aesIV=e}return l.prototype.decrypt=function(a,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,a)},l}(),Gt=function(){function l(a,e){this.subtle=void 0,this.key=void 0,this.subtle=a,this.key=e}return l.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},l}(),wt=function(){function l(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var a=l.prototype;return a.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r},a.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],s=r[1],d=r[2],c=r[3],f=this.invSubMix,h=f[0],m=f[1],g=f[2],E=f[3],k=new Uint32Array(256),R=0,D=0,A=0;for(A=0;A<256;A++)k[A]=A<128?A<<1:A<<1^283;for(A=0;A<256;A++){var I=D^D<<1^D<<2^D<<3^D<<4;I=I>>>8^255&I^99,e[R]=I,t[I]=R;var O=k[R],F=k[O],q=k[F],Q=257*k[I]^16843008*I;i[R]=Q<<24|Q>>>8,s[R]=Q<<16|Q>>>16,d[R]=Q<<8|Q>>>24,c[R]=Q,Q=16843009*q^65537*F^257*O^16843008*R,h[I]=Q<<24|Q>>>8,m[I]=Q<<16|Q>>>16,g[I]=Q<<8|Q>>>24,E[I]=Q,R?(R=O^k[k[k[q^O]]],D^=k[k[D]]):R=D=1}},a.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);var d,c,f,h,m=this.ksRows=4*(s+6+1),g=this.keySchedule=new Uint32Array(m),E=this.invKeySchedule=new Uint32Array(m),k=this.sBox,R=this.rcon,D=this.invSubMix,A=D[0],I=D[1],O=D[2],F=D[3];for(d=0;d<m;d++)d<s?f=g[d]=t[d]:(h=f,d%s==0?(h=k[(h=h<<8|h>>>24)>>>24]<<24|k[h>>>16&255]<<16|k[h>>>8&255]<<8|k[255&h],h^=R[d/s|0]<<24):s>6&&d%s==4&&(h=k[h>>>24]<<24|k[h>>>16&255]<<16|k[h>>>8&255]<<8|k[255&h]),g[d]=f=(g[d-s]^h)>>>0);for(c=0;c<m;c++)d=m-c,h=3&c?g[d]:g[d-4],E[c]=c<4||d<=4?h:A[k[h>>>24]]^I[k[h>>>16&255]]^O[k[h>>>8&255]]^F[k[255&h]],E[c]=E[c]>>>0}},a.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},a.decrypt=function(e,t,r){for(var i,s,d,c,f,h,m,g,E,k,R,D,A,I,O=this.keySize+6,F=this.invKeySchedule,q=this.invSBox,Q=this.invSubMix,X=Q[0],oe=Q[1],J=Q[2],te=Q[3],fe=this.uint8ArrayToUint32Array_(r),de=fe[0],_e=fe[1],Oe=fe[2],Se=fe[3],Pe=new Int32Array(e),Ae=new Int32Array(Pe.length),Ce=this.networkToHostOrderSwap;t<Pe.length;){for(E=Ce(Pe[t]),k=Ce(Pe[t+1]),R=Ce(Pe[t+2]),D=Ce(Pe[t+3]),f=E^F[0],h=D^F[1],m=R^F[2],g=k^F[3],A=4,I=1;I<O;I++)i=X[f>>>24]^oe[h>>16&255]^J[m>>8&255]^te[255&g]^F[A],s=X[h>>>24]^oe[m>>16&255]^J[g>>8&255]^te[255&f]^F[A+1],d=X[m>>>24]^oe[g>>16&255]^J[f>>8&255]^te[255&h]^F[A+2],c=X[g>>>24]^oe[f>>16&255]^J[h>>8&255]^te[255&m]^F[A+3],f=i,h=s,m=d,g=c,A+=4;i=q[f>>>24]<<24^q[h>>16&255]<<16^q[m>>8&255]<<8^q[255&g]^F[A],s=q[h>>>24]<<24^q[m>>16&255]<<16^q[g>>8&255]<<8^q[255&f]^F[A+1],d=q[m>>>24]<<24^q[g>>16&255]<<16^q[f>>8&255]<<8^q[255&h]^F[A+2],c=q[g>>>24]<<24^q[f>>16&255]<<16^q[h>>8&255]<<8^q[255&m]^F[A+3],Ae[t]=Ce(i^de),Ae[t+1]=Ce(c^_e),Ae[t+2]=Ce(d^Oe),Ae[t+3]=Ce(s^Se),de=E,_e=k,Oe=R,Se=D,t+=4}return Ae.buffer},l}(),kt=function(){function l(e,t){var r=(t===void 0?{}:t).removePKCS7Padding,i=r===void 0||r;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var a=l.prototype;return a.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},a.isSync=function(){return this.useSoftware},a.flush=function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var r,i,s,d=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?(i=(r=d).byteLength,(s=i&&new DataView(r.buffer).getUint8(i-1))?ur(r,0,i-s):r):d},a.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},a.decrypt=function(e,t,r){var i=this;return this.useSoftware?new Promise(function(s,d){i.softwareDecrypt(new Uint8Array(e),t,r);var c=i.flush();c?s(c.buffer):d(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)},a.softwareDecrypt=function(e,t,r){var i=this.currentIV,s=this.currentResult,d=this.remainderData;this.logOnce("JS AES decrypt"),d&&(e=Fr(d,e),this.remainderData=null);var c=this.getValidChunk(e);if(!c.length)return null;i&&(r=i);var f=this.softwareDecrypter;f||(f=this.softwareDecrypter=new wt),f.expandKey(t);var h=s;return this.currentResult=f.decrypt(c.buffer,0,r),this.currentIV=ur(c,-16).buffer,h||null},a.webCryptoDecrypt=function(e,t,r){var i=this,s=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new Gt(s,t)),this.fastAesKey.expandKey().then(function(d){return s?(i.logOnce("WebCrypto AES decrypt"),new vt(s,new Uint8Array(r)).decrypt(e.buffer,d)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(d){return H.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+d.name+": "+d.message),i.onWebCryptoError(e,t,r)})},a.onWebCryptoError=function(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);var i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},a.getValidChunk=function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=ur(e,0,r),this.remainderData=ur(e,r)),t},a.logOnce=function(e){this.logEnabled&&(H.log("[decrypter]: "+e),this.logEnabled=!1)},l}(),bt=function(l){for(var a="",e=l.length,t=0;t<e;t++)a+="["+l.start(t).toFixed(3)+"-"+l.end(t).toFixed(3)+"]";return a},rt="STOPPED",Be="IDLE",ii="KEY_LOADING",$t="FRAG_LOADING",ct="FRAG_LOADING_WAITING_RETRY",wr="WAITING_TRACK",kr="PARSING",dn="PARSED",Ni="ENDED",cn="ERROR",zn="WAITING_INIT_PTS",hn="WAITING_LEVEL",Io=function(l){function a(t,r,i,s){var d;return(d=l.call(this)||this).hls=void 0,d.fragPrevious=null,d.fragCurrent=null,d.fragmentTracker=void 0,d.transmuxer=null,d._state=rt,d.media=null,d.mediaBuffer=null,d.config=void 0,d.bitrateTest=!1,d.lastCurrentTime=0,d.nextLoadPosition=0,d.startPosition=0,d.startTimeOffset=null,d.loadedmetadata=!1,d.retryDate=0,d.levels=null,d.fragmentLoader=void 0,d.keyLoader=void 0,d.levelLastLoaded=null,d.startFragRequested=!1,d.decrypter=void 0,d.initPTS=[],d.onvseeking=null,d.onvended=null,d.logPrefix="",d.log=void 0,d.warn=void 0,d.logPrefix=s,d.log=H.log.bind(H,s+":"),d.warn=H.warn.bind(H,s+":"),d.hls=t,d.fragmentLoader=new Me(t.config),d.keyLoader=i,d.fragmentTracker=r,d.config=t.config,d.decrypter=new kt(t.config),t.on(w.MANIFEST_LOADED,d.onManifestLoaded,function(c){if(c===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}(d)),d}Y(a,l);var e=a.prototype;return e.doTick=function(){this.onTickEnd()},e.onTickEnd=function(){},e.startLoad=function(t){},e.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=rt},e._streamEnded=function(t,r){if(r.live||t.nextStart||!t.end||!this.media)return!1;var i=r.partList;if(i!=null&&i.length){var s=i[i.length-1];return Ge.isBuffered(this.media,s.start+s.duration/2)}var d=r.fragments[r.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)},e.getLevelDetails=function(){var t;if(this.levels&&this.levelLastLoaded!==null)return(t=this.levels[this.levelLastLoaded])==null?void 0:t.details},e.onMediaAttached=function(t,r){var i=this.media=this.mediaBuffer=r.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);var s=this.config;this.levels&&s.autoStartLoad&&this.state===rt&&this.startLoad(s.startPosition)},e.onMediaDetaching=function(){var t=this.media;t!=null&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},e.onMediaSeeking=function(){var t=this.config,r=this.fragCurrent,i=this.media,s=this.mediaBuffer,d=this.state,c=i?i.currentTime:0,f=Ge.bufferInfo(s||i,c,t.maxBufferHole);if(this.log("media seeking to "+(z(c)?c.toFixed(3):c)+", state: "+d),this.state===Ni)this.resetLoadingState();else if(r){var h=t.maxFragLookUpTolerance,m=r.start-h,g=r.start+r.duration+h;if(!f.len||g<f.start||m>f.end){var E=c>g;(c<m||E)&&(E&&r.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),r.abortRequests()),this.resetLoadingState())}}i&&(this.lastCurrentTime=c),this.loadedmetadata||f.len||(this.nextLoadPosition=this.startPosition=c),this.tickImmediate()},e.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.onManifestLoaded=function(t,r){this.startTimeOffset=r.startTimeOffset},e.onHandlerDestroying=function(){this.stopLoad(),l.prototype.onHandlerDestroying.call(this)},e.onHandlerDestroyed=function(){this.state=rt,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,l.prototype.onHandlerDestroyed.call(this)},e.loadFragment=function(t,r,i){this._loadFragForPlayback(t,r,i)},e._loadFragForPlayback=function(t,r,i){var s=this;this._doFragLoad(t,r,i,function(d){if(s.fragContextChanged(t))return s.warn("Fragment "+t.sn+(d.part?" p: "+d.part.index:"")+" of level "+t.level+" was dropped during download."),void s.fragmentTracker.removeFragment(t);t.stats.chunkCount++,s._handleFragmentLoadProgress(d)}).then(function(d){if(d){var c=s.state;s.fragContextChanged(t)?(c===$t||!s.fragCurrent&&c===kr)&&(s.fragmentTracker.removeFragment(t),s.state=Be):("payload"in d&&(s.log("Loaded fragment "+t.sn+" of level "+t.level),s.hls.trigger(w.FRAG_LOADED,d)),s._handleFragmentLoadComplete(d))}}).catch(function(d){s.state!==rt&&s.state!==cn&&(s.warn(d),s.resetFragmentLoading(t))})},e.clearTrackerIfNeeded=function(t){var r;if(this.fragmentTracker.getState(t)===$){var i=t.type,s=this.getFwdBufferInfo(this.mediaBuffer,i),d=Math.max(t.duration,s?s.len:this.config.maxBufferLength);this.reduceMaxBufferLength(d)&&this.fragmentTracker.removeFragment(t)}else((r=this.mediaBuffer)==null?void 0:r.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},e.flushMainBuffer=function(t,r,i){if(i===void 0&&(i=null),t-r){var s={startOffset:t,endOffset:r,type:i};this.hls.trigger(w.BUFFER_FLUSHING,s)}},e._loadInitSegment=function(t,r){var i=this;this._doFragLoad(t,r).then(function(s){if(!s||i.fragContextChanged(t)||!i.levels)throw new Error("init load aborted");return s}).then(function(s){var d=i.hls,c=s.payload,f=t.decryptdata;if(c&&c.byteLength>0&&f&&f.key&&f.iv&&f.method==="AES-128"){var h=self.performance.now();return i.decrypter.decrypt(new Uint8Array(c),f.key.buffer,f.iv.buffer).catch(function(m){throw d.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.FRAG_DECRYPT_ERROR,fatal:!1,error:m,reason:m.message,frag:t}),m}).then(function(m){var g=self.performance.now();return d.trigger(w.FRAG_DECRYPTED,{frag:t,payload:m,stats:{tstart:h,tdecrypt:g}}),s.payload=m,s})}return s}).then(function(s){var d=i.fragCurrent,c=i.hls;if(!i.levels)throw new Error("init load aborted, missing levels");var f=t.stats;i.state=Be,r.fragmentError=0,t.data=new Uint8Array(s.payload),f.parsing.start=f.buffering.start=self.performance.now(),f.parsing.end=f.buffering.end=self.performance.now(),s.frag===d&&c.trigger(w.FRAG_BUFFERED,{stats:f,frag:d,part:null,id:t.type}),i.tick()}).catch(function(s){i.state!==rt&&i.state!==cn&&(i.warn(s),i.resetFragmentLoading(t))})},e.fragContextChanged=function(t){var r=this.fragCurrent;return!t||!r||t.level!==r.level||t.sn!==r.sn||t.urlId!==r.urlId},e.fragBufferedComplete=function(t,r){var i,s,d,c,f=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(r?" part: "+r.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+t.level+" (frag:["+((i=t.startPTS)!=null?i:NaN).toFixed(3)+"-"+((s=t.endPTS)!=null?s:NaN).toFixed(3)+"] > buffer:"+(f?bt(Ge.getBuffered(f)):"(detached)")+")"),this.state=Be,f&&(!this.loadedmetadata&&t.type==at&&f.buffered.length&&((d=this.fragCurrent)==null?void 0:d.sn)===((c=this.fragPrevious)==null?void 0:c.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},e.seekToStartPos=function(){},e._handleFragmentLoadComplete=function(t){var r=this.transmuxer;if(r){var i=t.frag,s=t.part,d=t.partsLoaded,c=!d||d.length===0||d.some(function(h){return!h}),f=new ze(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!c);r.flush(f)}},e._handleFragmentLoadProgress=function(t){},e._doFragLoad=function(t,r,i,s){var d,c=this;i===void 0&&(i=null);var f=r==null?void 0:r.details;if(!this.levels||!f)throw new Error("frag load aborted, missing level"+(f?"":" detail")+"s");var h=null;if(!t.encrypted||(d=t.decryptdata)!=null&&d.key?!t.encrypted&&f.encryptedFragments.length&&this.keyLoader.loadClear(t,f.encryptedFragments):(this.log("Loading key for "+t.sn+" of ["+f.startSN+"-"+f.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+t.level),this.state=ii,this.fragCurrent=t,h=this.keyLoader.load(t).then(function(A){if(!c.fragContextChanged(A.frag))return c.hls.trigger(w.KEY_LOADED,A),c.state===ii&&(c.state=Be),A}),this.hls.trigger(w.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(h=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(t.start,i||0),this.config.lowLatencyMode){var m=f.partList;if(m&&s){i>t.end&&f.fragmentHint&&(t=f.fragmentHint);var g=this.getNextPart(m,t,i);if(g>-1){var E,k=m[g];return this.log("Loading part sn: "+t.sn+" p: "+k.index+" cc: "+t.cc+" of playlist ["+f.startSN+"-"+f.endSN+"] parts [0-"+g+"-"+(m.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=k.start+k.duration,this.state=$t,E=h?h.then(function(A){return!A||c.fragContextChanged(A.frag)?null:c.doFragPartsLoad(t,k,r,s)}).catch(function(A){return c.handleFragLoadError(A)}):this.doFragPartsLoad(t,k,r,s).catch(function(A){return c.handleFragLoadError(A)}),this.hls.trigger(w.FRAG_LOADING,{frag:t,part:k,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}if(!t.url||this.loadedEndOfParts(m,i))return Promise.resolve(null)}}this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(f?"of ["+f.startSN+"-"+f.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),z(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=$t;var R,D=this.config.progressive;return R=D&&h?h.then(function(A){return!A||c.fragContextChanged(A==null?void 0:A.frag)?null:c.fragmentLoader.load(t,s)}).catch(function(A){return c.handleFragLoadError(A)}):Promise.all([this.fragmentLoader.load(t,D?s:void 0),h]).then(function(A){var I=A[0];return!D&&I&&s&&s(I),I}).catch(function(A){return c.handleFragLoadError(A)}),this.hls.trigger(w.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):R},e.doFragPartsLoad=function(t,r,i,s){var d=this;return new Promise(function(c,f){var h,m=[],g=(h=i.details)==null?void 0:h.partList;(function E(k){d.fragmentLoader.loadPart(t,k,s).then(function(R){m[k.index]=R;var D=R.part;d.hls.trigger(w.FRAG_LOADED,R);var A=Pi(i,t.sn,k.index+1)||an(g,t.sn,k.index+1);if(!A)return c({frag:t,part:D,partsLoaded:m});E(A)}).catch(f)})(r)})},e.handleFragLoadError=function(t){if("data"in t){var r=t.data;t.data&&r.details===W.INTERNAL_ABORTED?this.handleFragLoadAborted(r.frag,r.part):this.hls.trigger(w.ERROR,r)}else this.hls.trigger(w.ERROR,{type:se.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null},e._handleTransmuxerFlush=function(t){var r=this.getCurrentContext(t);if(r&&this.state===kr){var i=r.frag,s=r.part,d=r.level,c=self.performance.now();i.stats.parsing.end=c,s&&(s.stats.parsing.end=c),this.updateLevelTiming(i,s,d,t.partial)}else this.fragCurrent||this.state===rt||this.state===cn||(this.state=Be)},e.getCurrentContext=function(t){var r=this.levels,i=this.fragCurrent,s=t.level,d=t.sn,c=t.part;if(r==null||!r[s])return this.warn("Levels object was unset while buffering fragment "+d+" of level "+s+". The current chunk will not be buffered."),null;var f=r[s],h=c>-1?Pi(f,d,c):null,m=h?h.fragment:function(g,E,k){if(g==null||!g.details)return null;var R=g.details,D=R.fragments[E-R.startSN];return D||((D=R.fragmentHint)&&D.sn===E?D:E<R.startSN&&k&&k.sn===E?k:null)}(f,d,i);return m?(i&&i!==m&&(m.stats=i.stats),{frag:m,part:h,level:f}):null},e.bufferFragmentData=function(t,r,i,s){var d;if(t&&this.state===kr){var c=t.data1,f=t.data2,h=c;if(c&&f&&(h=Fr(c,f)),(d=h)!=null&&d.length){var m={type:t.type,frag:r,part:i,chunkMeta:s,parent:r.type,data:h};this.hls.trigger(w.BUFFER_APPENDING,m),t.dropped&&t.independent&&!i&&this.flushBufferGap(r)}}},e.flushBufferGap=function(t){var r=this.media;if(r)if(Ge.isBuffered(r,r.currentTime)){var i=r.currentTime,s=Ge.bufferInfo(r,i,0),d=t.duration,c=Math.min(2*this.config.maxFragLookUpTolerance,.25*d),f=Math.max(Math.min(t.start-c,s.end-c),i+c);t.start-f>c&&this.flushMainBuffer(f,t.start)}else this.flushMainBuffer(0,t.start)},e.getFwdBufferInfo=function(t,r){var i=this.getLoadPosition();return z(i)?this.getFwdBufferInfoAtPos(t,i,r):null},e.getFwdBufferInfoAtPos=function(t,r,i){var s=this.config.maxBufferHole,d=Ge.bufferInfo(t,r,s);if(d.len===0&&d.nextStart!==void 0){var c=this.fragmentTracker.getBufferedFrag(r,i);if(c&&d.nextStart<c.end)return Ge.bufferInfo(t,r,Math.max(d.nextStart,s))}return d},e.getMaxBufferLength=function(t){var r,i=this.config;return r=t?Math.max(8*i.maxBufferSize/t,i.maxBufferLength):i.maxBufferLength,Math.min(r,i.maxMaxBufferLength)},e.reduceMaxBufferLength=function(t){var r=this.config,i=t||r.maxBufferLength;return r.maxMaxBufferLength>=i&&(r.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+r.maxMaxBufferLength+"s"),!0)},e.getNextFragment=function(t,r){var i=r.fragments,s=i.length;if(!s)return null;var d,c=this.config,f=i[0].start;if(r.live){var h=c.initialLiveManifestSize;if(s<h)return this.warn("Not enough fragments to start playback (have: "+s+", need: "+h+")"),null;r.PTSKnown||this.startFragRequested||this.startPosition!==-1||(d=this.getInitialLiveFragment(r,i),this.startPosition=d?this.hls.liveSyncPosition||d.start:t)}else t<=f&&(d=i[0]);if(!d){var m=c.lowLatencyMode?r.partEnd:r.fragmentEnd;d=this.getFragmentAtPosition(t,m,r)}return this.mapToInitFragWhenRequired(d)},e.isLoopLoading=function(t,r){var i=this.fragmentTracker.getState(t);return(i===ie||i===K&&!!t.gap)&&this.nextLoadPosition>r},e.getNextFragmentLoopLoading=function(t,r,i,s,d){var c=t.gap,f=this.getNextFragment(this.nextLoadPosition,r);if(f===null)return f;if(t=f,c&&t&&!t.gap&&i.nextStart){var h=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s);if(h!==null&&i.len+h.len>=d)return this.log('buffer full after gaps in "'+s+'" playlist starting at sn: '+t.sn),null}return t},e.mapToInitFragWhenRequired=function(t){return t==null||!t.initSegment||t!=null&&t.initSegment.data||this.bitrateTest?t:t.initSegment},e.getNextPart=function(t,r,i){for(var s=-1,d=!1,c=!0,f=0,h=t.length;f<h;f++){var m=t[f];if(c=c&&!m.independent,s>-1&&i<m.start)break;var g=m.loaded;g?s=-1:(d||m.independent||c)&&m.fragment===r&&(s=f),d=g}return s},e.loadedEndOfParts=function(t,r){var i=t[t.length-1];return i&&r>i.start&&i.loaded},e.getInitialLiveFragment=function(t,r){var i=this.fragPrevious,s=null;if(i){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),s=function(h,m,g){if(m===null||!Array.isArray(h)||!h.length||!z(m)||m<(h[0].programDateTime||0)||m>=(h[h.length-1].endProgramDateTime||0))return null;g=g||0;for(var E=0;E<h.length;++E){var k=h[E];if(ko(m,g,k))return k}return null}(r,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){var d=i.sn+1;if(d>=t.startSN&&d<=t.endSN){var c=r[d-t.startSN];i.cc===c.cc&&(s=c,this.log("Live playlist, switching playlist, load frag with next SN: "+s.sn))}s||(s=function(h,m){return es(h,function(g){return g.cc<m?1:g.cc>m?-1:0})}(r,i.cc),s&&this.log("Live playlist, switching playlist, load frag with same CC: "+s.sn))}}else{var f=this.hls.liveSyncPosition;f!==null&&(s=this.getFragmentAtPosition(f,this.bitrateTest?t.fragmentEnd:t.edge,t))}return s},e.getFragmentAtPosition=function(t,r,i){var s,d=this.config,c=this.fragPrevious,f=i.fragments,h=i.endSN,m=i.fragmentHint,g=d.maxFragLookUpTolerance,E=!!(d.lowLatencyMode&&i.partList&&m);if(E&&m&&!this.bitrateTest&&(f=f.concat(m),h=m.sn),s=t<r?Fi(c,f,t,t>r-g?0:g):f[f.length-1]){var k=s.sn-i.startSN,R=this.fragmentTracker.getState(s);if((R===ie||R===K&&s.gap)&&(c=s),c&&s.sn===c.sn&&!E&&c&&s.level===c.level){var D=f[k+1];s=s.sn<h&&this.fragmentTracker.getState(D)!==ie?D:null}}return s},e.synchronizeToLiveEdge=function(t){var r=this.config,i=this.media;if(i){var s=this.hls.liveSyncPosition,d=i.currentTime,c=t.fragments[0].start,f=t.edge,h=d>=c-r.maxFragLookUpTolerance&&d<=f;if(s!==null&&i.duration>s&&(d<s||!h)){var m=r.liveMaxLatencyDuration!==void 0?r.liveMaxLatencyDuration:r.liveMaxLatencyDurationCount*t.targetduration;(!h&&i.readyState<4||d<f-m)&&(this.loadedmetadata||(this.nextLoadPosition=s),i.readyState&&(this.warn("Playback: "+d.toFixed(3)+" is located too far from the end of live sliding playlist: "+f+", reset currentTime to : "+s.toFixed(3)),i.currentTime=s))}}},e.alignPlaylists=function(t,r){var i=this.levels,s=this.levelLastLoaded,d=this.fragPrevious,c=s!==null?i[s]:null,f=t.fragments.length;if(!f)return this.warn("No fragments in live playlist"),0;var h=t.fragments[0].start,m=!r,g=t.alignedSliding&&z(h);if(m||!g&&!h){Ne(d,c,t);var E=t.fragments[0].start;return this.log("Live playlist sliding: "+E.toFixed(2)+" start-sn: "+(r?r.startSN:"na")+"->"+t.startSN+" prev-sn: "+(d?d.sn:"na")+" fragments: "+f),E}return h},e.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},e.setStartPosition=function(t,r){var i=this.startPosition;if(i<r&&(i=-1),i===-1||this.lastCurrentTime===-1){var s=this.startTimeOffset!==null,d=s?this.startTimeOffset:t.startTimeOffset;d!==null&&z(d)?(i=r+d,d<0&&(i+=t.totalduration),i=Math.min(Math.max(r,i),r+t.totalduration),this.log("Start time offset "+d+" found in "+(s?"multivariant":"media")+" playlist, adjust startPosition to "+i),this.startPosition=i):t.live?i=this.hls.liveSyncPosition||r:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i},e.getLoadPosition=function(){var t=this.media,r=0;return this.loadedmetadata&&t?r=t.currentTime:this.nextLoadPosition&&(r=this.nextLoadPosition),r},e.handleFragLoadAborted=function(t,r){this.transmuxer&&t.sn!=="initSegment"&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(r?" part"+r.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},e.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===ct)||(this.state=Be)},e.onFragmentOrKeyLoadError=function(t,r){if(r.chunkMeta&&!r.frag){var i=this.getCurrentContext(r.chunkMeta);i&&(r.frag=i.frag)}var s=r.frag;if(s&&s.type===t&&this.levels)if(this.fragContextChanged(s)){var d;this.warn("Frag load error must match current frag to retry "+s.url+" > "+((d=this.fragCurrent)==null?void 0:d.url))}else{var c=r.details===W.FRAG_GAP;c&&this.fragmentTracker.fragBuffered(s,!0);var f=r.errorAction,h=f||{},m=h.action,g=h.retryCount,E=g===void 0?0:g,k=h.retryConfig;if(f&&m===Br&&k){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var R=Wn(k,E);this.warn("Fragment "+s.sn+" of "+t+" "+s.level+" errored with "+r.details+", retrying loading "+(E+1)+"/"+k.maxNumRetry+" in "+R+"ms"),f.resolved=!0,this.retryDate=self.performance.now()+R,this.state=ct}else k&&f?(this.resetFragmentErrors(t),E<k.maxNumRetry?c||(f.resolved=!0):H.warn(r.details+" reached or exceeded max retry ("+E+")")):this.state=cn;this.tickImmediate()}},e.reduceLengthAndFlushBuffer=function(t){if(this.state===kr||this.state===dn){var r=t.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len);var d=!s;return d&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+r+" buffer"),t.frag&&(this.fragmentTracker.removeFragment(t.frag),this.nextLoadPosition=t.frag.start),this.resetLoadingState(),d}return!1},e.resetFragmentErrors=function(t){t===Sr&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==rt&&(this.state=Be)},e.afterBufferFlushed=function(t,r,i){if(t){var s=Ge.getBuffered(t);this.fragmentTracker.detectEvictedFragments(r,s,i),this.state===Ni&&this.resetLoadingState()}},e.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Be},e.resetStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var r=this.levels?this.levels[t].details:null;r!=null&&r.live?(this.startPosition=-1,this.setStartPosition(r,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},e.updateLevelTiming=function(t,r,i,s){var d,c=this,f=i.details;if(f){if(Object.keys(t.elementaryStreams).reduce(function(m,g){var E=t.elementaryStreams[g];if(E){var k=E.endPTS-E.startPTS;if(k<=0)return c.warn("Could not parse fragment "+t.sn+" "+g+" duration reliably ("+k+")"),m||!1;var R=s?0:Xa(f,t,E.startPTS,E.endPTS,E.startDTS,E.endDTS);return c.hls.trigger(w.LEVEL_PTS_UPDATED,{details:f,level:i,drift:R,type:g,frag:t,start:E.startPTS,end:E.endPTS}),!0}return m},!1))i.fragmentError=0;else if(((d=this.transmuxer)==null?void 0:d.error)===null){var h=new Error("Found no media in fragment "+t.sn+" of level "+i.id+" resetting transmuxer to fallback to playlist timing");if(this.warn(h.message),this.hls.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,error:h,frag:t,reason:"Found no media in msn "+t.sn+' of level "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=dn,this.hls.trigger(w.FRAG_PARSED,{frag:t,part:r})}else this.warn("level.details undefined")},e.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},e.recoverWorkerError=function(t){t.event==="demuxerWorker"&&(this.resetTransmuxer(),this.resetLoadingState())},M(a,[{key:"state",get:function(){return this._state},set:function(t){var r=this._state;r!==t&&(this._state=t,this.log(r+"->"+t))}}]),a}(Bt);function Lo(){if(typeof self<"u")return self.MediaSource||self.WebKitMediaSource}function Eu(){return self.SourceBuffer||self.WebKitSourceBuffer}function Gr(l,a){return l===void 0&&(l=""),a===void 0&&(a=9e4),{type:l,id:-1,pid:-1,inputTimeScale:a,sequenceNumber:-1,samples:[],dropped:0}}var bu=function(){function l(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var a=l.prototype;return a.resetInitSegment=function(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},a.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},a.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},a.canParse=function(e,t){return!1},a.appendFrame=function(e,t,r){},a.demux=function(e,t){this.cachedData&&(e=Fr(this.cachedData,e),this.cachedData=null);var r,i=Nt(e,0),s=i?i.length:0,d=this._audioTrack,c=this._id3Track,f=i?function(E){for(var k=Da(E),R=0;R<k.length;R++){var D=k[R];if(fi(D))return xa(D)}}(i):void 0,h=e.length;for((this.basePTS===null||this.frameIndex===0&&z(f))&&(this.basePTS=fp(f,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Nr,duration:Number.POSITIVE_INFINITY});s<h;){if(this.canParse(e,s)){var m=this.appendFrame(d,e,s);m?(this.frameIndex++,this.lastPTS=m.sample.pts,r=s+=m.length):s=h}else xn(e,s)?(i=Nt(e,s),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Nr,duration:Number.POSITIVE_INFINITY}),r=s+=i.length):s++;if(s===h&&r!==h){var g=ur(e,r);this.cachedData?this.cachedData=Fr(this.cachedData,g):this.cachedData=g}}return{audioTrack:d,videoTrack:Gr(),id3Track:c,textTrack:Gr()}},a.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},a.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Gr(),id3Track:this._id3Track,textTrack:Gr()}},a.destroy=function(){},l}(),fp=function(l,a,e){return z(l)?90*l:9e4*a+(e?9e4*e.baseTime/e.timescale:0)};function _u(l,a){return l[a]===255&&(246&l[a+1])==240}function Tu(l,a){return 1&l[a+1]?7:9}function Do(l,a){return(3&l[a+3])<<11|l[a+4]<<3|(224&l[a+5])>>>5}function ts(l,a){return a+1<l.length&&_u(l,a)}function pp(l,a){if(ts(l,a)){var e=Tu(l,a);if(a+e>=l.length)return!1;var t=Do(l,a);if(t<=e)return!1;var r=a+t;return r===l.length||ts(l,r)}return!1}function Su(l,a,e,t,r){if(!l.samplerate){var i=function(s,d,c,f){var h,m,g,E,k=navigator.userAgent.toLowerCase(),R=f,D=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];h=1+((192&d[c+2])>>>6);var A=(60&d[c+2])>>>2;if(!(A>D.length-1))return g=(1&d[c+2])<<2,g|=(192&d[c+3])>>>6,H.log("manifest codec:"+f+", ADTS type:"+h+", samplingIndex:"+A),/firefox/i.test(k)?A>=6?(h=5,E=new Array(4),m=A-3):(h=2,E=new Array(2),m=A):k.indexOf("android")!==-1?(h=2,E=new Array(2),m=A):(h=5,E=new Array(4),f&&(f.indexOf("mp4a.40.29")!==-1||f.indexOf("mp4a.40.5")!==-1)||!f&&A>=6?m=A-3:((f&&f.indexOf("mp4a.40.2")!==-1&&(A>=6&&g===1||/vivaldi/i.test(k))||!f&&g===1)&&(h=2,E=new Array(2)),m=A)),E[0]=h<<3,E[0]|=(14&A)>>1,E[1]|=(1&A)<<7,E[1]|=g<<3,h===5&&(E[1]|=(14&m)>>1,E[2]=(1&m)<<7,E[2]|=8,E[3]=0),{config:E,samplerate:D[A],channelCount:g,codec:"mp4a.40."+h,manifestCodec:R};s.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+A})}(a,e,t,r);if(!i)return;l.config=i.config,l.samplerate=i.samplerate,l.channelCount=i.channelCount,l.codec=i.codec,l.manifestCodec=i.manifestCodec,H.log("parsed codec:"+l.codec+", rate:"+i.samplerate+", channels:"+i.channelCount)}}function Au(l){return 9216e4/l}function wu(l,a,e,t,r){var i,s=t+r*Au(l.samplerate),d=function(k,R){var D=Tu(k,R);if(R+D<=k.length){var A=Do(k,R)-D;if(A>0)return{headerLength:D,frameLength:A}}}(a,e);if(d){var c=d.frameLength,f=d.headerLength,h=f+c,m=Math.max(0,e+h-a.length);m?(i=new Uint8Array(h-f)).set(a.subarray(e+f,a.length),0):i=a.subarray(e+f,e+h);var g={unit:i,pts:s};return m||l.samples.push(g),{sample:g,length:h,missing:m}}var E=a.length-e;return(i=new Uint8Array(E)).set(a.subarray(e,a.length),0),{sample:{unit:i,pts:s},length:E,missing:-1}}var mp=function(l){function a(t,r){var i;return(i=l.call(this)||this).observer=void 0,i.config=void 0,i.observer=t,i.config=r,i}Y(a,l);var e=a.prototype;return e.resetInitSegment=function(t,r,i,s){l.prototype.resetInitSegment.call(this,t,r,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:s,inputTimeScale:9e4,dropped:0}},a.probe=function(t){if(!t)return!1;for(var r=(Nt(t,0)||[]).length,i=t.length;r<i;r++)if(pp(t,r))return H.log("ADTS sync word found !"),!0;return!1},e.canParse=function(t,r){return function(i,s){return function(d,c){return c+5<d.length}(i,s)&&_u(i,s)&&Do(i,s)<=i.length-s}(t,r)},e.appendFrame=function(t,r,i){Su(t,this.observer,r,i,t.manifestCodec);var s=wu(t,r,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s},a}(bu),vp=/\/emsg[-/]ID3/i,gp=function(){function l(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var a=l.prototype;return a.resetTimeStamp=function(){},a.resetInitSegment=function(e,t,r,i){var s=this.videoTrack=Gr("video",1),d=this.audioTrack=Gr("audio",1),c=this.txtTrack=Gr("text",1);if(this.id3Track=Gr("id3",1),this.timeOffset=0,e!=null&&e.byteLength){var f=On(e);if(f.video){var h=f.video,m=h.id,g=h.timescale,E=h.codec;s.id=m,s.timescale=c.timescale=g,s.codec=E}if(f.audio){var k=f.audio,R=k.id,D=k.timescale,A=k.codec;d.id=R,d.timescale=D,d.codec=A}c.id=Mn.text,s.sampleDuration=0,s.duration=d.duration=i}},a.resetContiguity=function(){},l.probe=function(e){return Xe(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0},a.demux=function(e,t){this.timeOffset=t;var r=e,i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Fr(this.remainderData,e));var d=function(f){var h={valid:null,remainder:null},m=Xe(f,["moof"]);if(!m)return h;if(m.length<2)return h.remainder=f,h;var g=m[m.length-1];return h.valid=ur(f,0,g.byteOffset-8),h.remainder=ur(f,g.byteOffset-8),h}(r);this.remainderData=d.remainder,i.samples=d.valid||new Uint8Array}else i.samples=r;var c=this.extractID3Track(i,t);return s.samples=Fa(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:c,textTrack:this.txtTrack}},a.flush=function(){var e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(t,this.timeOffset);return r.samples=Fa(e,t),{videoTrack:t,audioTrack:Gr(),id3Track:i,textTrack:Gr()}},a.extractID3Track=function(e,t){var r=this.id3Track;if(e.samples.length){var i=Xe(e.samples,["emsg"]);i&&i.forEach(function(s){var d=function(m){var g=m[0],E="",k="",R=0,D=0,A=0,I=0,O=0,F=0;if(g===0){for(;St(m.subarray(F,F+1))!=="\0";)E+=St(m.subarray(F,F+1)),F+=1;for(E+=St(m.subarray(F,F+1)),F+=1;St(m.subarray(F,F+1))!=="\0";)k+=St(m.subarray(F,F+1)),F+=1;k+=St(m.subarray(F,F+1)),F+=1,R=Fe(m,12),D=Fe(m,16),I=Fe(m,20),O=Fe(m,24),F=28}else if(g===1){R=Fe(m,F+=4);var q=Fe(m,F+=4),Q=Fe(m,F+=4);for(F+=4,A=Math.pow(2,32)*q+Q,Number.isSafeInteger(A)||(A=Number.MAX_SAFE_INTEGER,H.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),I=Fe(m,F),O=Fe(m,F+=4),F+=4;St(m.subarray(F,F+1))!=="\0";)E+=St(m.subarray(F,F+1)),F+=1;for(E+=St(m.subarray(F,F+1)),F+=1;St(m.subarray(F,F+1))!=="\0";)k+=St(m.subarray(F,F+1)),F+=1;k+=St(m.subarray(F,F+1)),F+=1}return{schemeIdUri:E,value:k,timeScale:R,presentationTime:A,presentationTimeDelta:D,eventDuration:I,id:O,payload:m.subarray(F,m.byteLength)}}(s);if(vp.test(d.schemeIdUri)){var c=z(d.presentationTime)?d.presentationTime/d.timeScale:t+d.presentationTimeDelta/d.timeScale,f=d.eventDuration===4294967295?Number.POSITIVE_INFINITY:d.eventDuration/d.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);var h=d.payload;r.samples.push({data:h,len:h.byteLength,dts:c,pts:c,type:Mi,duration:f})}})}return r},a.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},a.destroy=function(){},l}(),rs=null,yp=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ep=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],bp=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_p=[0,1,1,4];function ku(l,a,e,t,r){if(!(e+24>a.length)){var i=Ru(a,e);if(i&&e+i.frameLength<=a.length){var s=t+r*(9e4*i.samplesPerFrame/i.sampleRate),d={unit:a.subarray(e,e+i.frameLength),pts:s,dts:s};return l.config=[],l.channelCount=i.channelCount,l.samplerate=i.sampleRate,l.samples.push(d),{sample:d,length:i.frameLength,missing:0}}}}function Ru(l,a){var e=l[a+1]>>3&3,t=l[a+1]>>1&3,r=l[a+2]>>4&15,i=l[a+2]>>2&3;if(e!==1&&r!==0&&r!==15&&i!==3){var s=l[a+2]>>1&1,d=l[a+3]>>6,c=1e3*yp[14*(e===3?3-t:t===3?3:4)+r-1],f=Ep[3*(e===3?0:e===2?1:2)+i],h=d===3?1:2,m=bp[e][t],g=_p[t],E=8*m*g,k=Math.floor(m*c/f+s)*g;if(rs===null){var R=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);rs=R?parseInt(R[1]):0}return rs&&rs<=87&&t===2&&c>=224e3&&d===0&&(l[a+3]=128|l[a+3]),{sampleRate:f,channelCount:h,frameLength:k,samplesPerFrame:E}}}function Co(l,a){return l[a]===255&&(224&l[a+1])==224&&(6&l[a+1])!=0}function Iu(l,a){return a+1<l.length&&Co(l,a)}function Tp(l,a){if(a+1<l.length&&Co(l,a)){var e=Ru(l,a),t=4;e!=null&&e.frameLength&&(t=e.frameLength);var r=a+t;return r===l.length||Iu(l,r)}return!1}var Lu=function(){function l(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var a=l.prototype;return a.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(r,r+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*s,this.bytesAvailable-=s},a.skipBits=function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},a.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32&&H.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r},a.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},a.skipUEG=function(){this.skipBits(1+this.skipLZ())},a.skipEG=function(){this.skipBits(1+this.skipLZ())},a.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},a.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},a.readBoolean=function(){return this.readBits(1)===1},a.readUByte=function(){return this.readBits(8)},a.readUShort=function(){return this.readBits(16)},a.readUInt=function(){return this.readBits(32)},a.skipScalingList=function(e){for(var t=8,r=8,i=0;i<e;i++)r!==0&&(r=(t+this.readEG()+256)%256),t=r===0?t:r},a.readSPS=function(){var e,t,r,i=0,s=0,d=0,c=0,f=this.readUByte.bind(this),h=this.readBits.bind(this),m=this.readUEG.bind(this),g=this.readBoolean.bind(this),E=this.skipBits.bind(this),k=this.skipEG.bind(this),R=this.skipUEG.bind(this),D=this.skipScalingList.bind(this);f();var A=f();if(h(5),E(3),f(),R(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){var I=m();if(I===3&&E(1),R(),R(),E(1),g())for(t=I!==3?8:12,r=0;r<t;r++)g()&&D(r<6?16:64)}R();var O=m();if(O===0)m();else if(O===1)for(E(1),k(),k(),e=m(),r=0;r<e;r++)k();R(),E(1);var F=m(),q=m(),Q=h(1);Q===0&&E(1),E(1),g()&&(i=m(),s=m(),d=m(),c=m());var X=[1,1];if(g()&&g())switch(f()){case 1:X=[1,1];break;case 2:X=[12,11];break;case 3:X=[10,11];break;case 4:X=[16,11];break;case 5:X=[40,33];break;case 6:X=[24,11];break;case 7:X=[20,11];break;case 8:X=[32,11];break;case 9:X=[80,33];break;case 10:X=[18,11];break;case 11:X=[15,11];break;case 12:X=[64,33];break;case 13:X=[160,99];break;case 14:X=[4,3];break;case 15:X=[3,2];break;case 16:X=[2,1];break;case 255:X=[f()<<8|f(),f()<<8|f()]}return{width:Math.ceil(16*(F+1)-2*i-2*s),height:(2-Q)*(q+1)*16-(Q?2:4)*(d+c),pixelRatio:X}},a.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},l}(),Sp=function(){function l(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new kt(t,{removePKCS7Padding:!1})}var a=l.prototype;return a.decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},a.decryptAacSample=function(e,t,r){var i=this,s=e[t].unit;if(!(s.length<=16)){var d=s.subarray(16,s.length-s.length%16),c=d.buffer.slice(d.byteOffset,d.byteOffset+d.length);this.decryptBuffer(c).then(function(f){var h=new Uint8Array(f);s.set(h,16),i.decrypter.isSync()||i.decryptAacSamples(e,t+1,r)})}},a.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}},a.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,s=32;s<e.length-16;s+=160,i+=16)r.set(e.subarray(s,s+16),i);return r},a.getAvcDecryptedUnit=function(e,t){for(var r=new Uint8Array(t),i=0,s=32;s<e.length-16;s+=160,i+=16)e.set(r.subarray(i,i+16),s);return e},a.decryptAvcSample=function(e,t,r,i,s){var d=this,c=Un(s.data),f=this.getAvcEncryptedData(c);this.decryptBuffer(f.buffer).then(function(h){s.data=d.getAvcDecryptedUnit(c,h),d.decrypter.isSync()||d.decryptAvcSamples(e,t,r+1,i)})},a.decryptAvcSamples=function(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();for(var s=e[t].units;!(r>=s.length);r++){var d=s[r];if(!(d.data.length<=48||d.type!==1&&d.type!==5||(this.decryptAvcSample(e,t,r,i,d),this.decrypter.isSync())))return}}},l}(),tr=188,Ap=function(){function l(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}l.probe=function(e){var t=l.syncOffset(e);return t>0&&H.warn("MPEG2-TS detected but first sync word found @ offset "+t),t!==-1},l.syncOffset=function(e){for(var t=e.length,r=Math.min(940,e.length-tr)+1,i=0;i<r;){for(var s=!1,d=i;d<t&&e[d]===71;d+=tr)if(s||xo(e,d)!==0||(s=!0),s&&d+tr>r)return i;i++}return-1},l.createTrack=function(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Mn[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}};var a=l.prototype;return a.resetInitSegment=function(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=l.createTrack("video"),this._audioTrack=l.createTrack("audio",i),this._id3Track=l.createTrack("id3"),this._txtTrack=l.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=i},a.resetTimeStamp=function(){},a.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},a.demux=function(e,t,r,i){var s;r===void 0&&(r=!1),i===void 0&&(i=!1),r||(this.sampleAes=null);var d=this._avcTrack,c=this._audioTrack,f=this._id3Track,h=this._txtTrack,m=d.pid,g=d.pesData,E=c.pid,k=f.pid,R=c.pesData,D=f.pesData,A=null,I=this.pmtParsed,O=this._pmtId,F=e.length;if(this.remainderData&&(F=(e=Fr(this.remainderData,e)).length,this.remainderData=null),F<tr&&!i)return this.remainderData=e,{audioTrack:c,videoTrack:d,id3Track:f,textTrack:h};var q=Math.max(0,l.syncOffset(e));(F-=(F-q)%tr)<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,F,e.buffer.byteLength-F));for(var Q=0,X=q;X<F;X+=tr)if(e[X]===71){var oe=!!(64&e[X+1]),J=xo(e,X),te=void 0;if((48&e[X+3])>>4>1){if((te=X+5+e[X+4])===X+tr)continue}else te=X+4;switch(J){case m:oe&&(g&&(s=fn(g))&&this.parseAVCPES(d,h,s,!1),g={data:[],size:0}),g&&(g.data.push(e.subarray(te,X+tr)),g.size+=X+tr-te);break;case E:if(oe){if(R&&(s=fn(R)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,s);break;case"mp3":this.parseMPEGPES(c,s)}R={data:[],size:0}}R&&(R.data.push(e.subarray(te,X+tr)),R.size+=X+tr-te);break;case k:oe&&(D&&(s=fn(D))&&this.parseID3PES(f,s),D={data:[],size:0}),D&&(D.data.push(e.subarray(te,X+tr)),D.size+=X+tr-te);break;case 0:oe&&(te+=e[te]+1),O=this._pmtId=wp(e,te);break;case O:oe&&(te+=e[te]+1);var fe=kp(e,te,this.typeSupported,r);(m=fe.avc)>0&&(d.pid=m),(E=fe.audio)>0&&(c.pid=E,c.segmentCodec=fe.segmentCodec),(k=fe.id3)>0&&(f.pid=k),A===null||I||(H.warn("MPEG-TS PMT found at "+X+" after unknown PID '"+A+"'. Backtracking to sync byte @"+q+" to parse all TS packets."),A=null,X=q-188),I=this.pmtParsed=!0;break;case 17:case 8191:break;default:A=J}}else Q++;if(Q>0){var de=new Error("Found "+Q+" TS packet/s that do not start with 0x47");this.observer.emit(w.ERROR,w.ERROR,{type:se.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,error:de,reason:de.message})}d.pesData=g,c.pesData=R,f.pesData=D;var _e={audioTrack:c,videoTrack:d,id3Track:f,textTrack:h};return i&&this.extractRemainingSamples(_e),_e},a.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},a.extractRemainingSamples=function(e){var t,r=e.audioTrack,i=e.videoTrack,s=e.id3Track,d=e.textTrack,c=i.pesData,f=r.pesData,h=s.pesData;if(c&&(t=fn(c))?(this.parseAVCPES(i,d,t,!0),i.pesData=null):i.pesData=c,f&&(t=fn(f))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,t);break;case"mp3":this.parseMPEGPES(r,t)}r.pesData=null}else f!=null&&f.size&&H.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=f;h&&(t=fn(h))?(this.parseID3PES(s,t),s.pesData=null):s.pesData=h},a.demuxSampleAes=function(e,t,r){var i=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new Sp(this.observer,this.config,t);return this.decrypt(i,s)},a.decrypt=function(e,t){return new Promise(function(r){var i=e.audioTrack,s=e.videoTrack;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,function(){s.samples?t.decryptAvcSamples(s.samples,0,0,function(){r(e)}):r(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,function(){r(e)})})},a.destroy=function(){this._duration=0},a.parseAVCPES=function(e,t,r,i){var s,d=this,c=this.parseAVCNALu(e,r.data),f=this.avcSample,h=!1;r.data=null,f&&c.length&&!e.audFound&&(Mo(f,e),f=this.avcSample=is(!1,r.pts,r.dts,"")),c.forEach(function(m){switch(m.type){case 1:s=!0,f||(f=d.avcSample=is(!0,r.pts,r.dts,"")),f.frame=!0;var g=m.data;if(h&&g.length>4){var E=new Lu(g).readSliceType();E!==2&&E!==4&&E!==7&&E!==9||(f.key=!0)}break;case 5:s=!0,f||(f=d.avcSample=is(!0,r.pts,r.dts,"")),f.key=!0,f.frame=!0;break;case 6:s=!0,Nn(m.data,1,r.pts,t.samples);break;case 7:if(s=!0,h=!0,!e.sps){var k=m.data,R=new Lu(k).readSPS();e.width=R.width,e.height=R.height,e.pixelRatio=R.pixelRatio,e.sps=[k],e.duration=d._duration;for(var D=k.subarray(1,4),A="avc1.",I=0;I<3;I++){var O=D[I].toString(16);O.length<2&&(O="0"+O),A+=O}e.codec=A}break;case 8:s=!0,e.pps||(e.pps=[m.data]);break;case 9:s=!1,e.audFound=!0,f&&Mo(f,e),f=d.avcSample=is(!1,r.pts,r.dts,"");break;case 12:s=!0;break;default:s=!1,f&&(f.debug+="unknown NAL "+m.type+" ")}f&&s&&f.units.push(m)}),i&&f&&(Mo(f,e),this.avcSample=null)},a.getLastNalUnit=function(e){var t,r,i=this.avcSample;if(i&&i.units.length!==0||(i=e[e.length-1]),(t=i)!=null&&t.units){var s=i.units;r=s[s.length-1]}return r},a.parseAVCNALu=function(e,t){var r,i,s=t.byteLength,d=e.naluState||0,c=d,f=[],h=0,m=-1,g=0;for(d===-1&&(m=0,g=31&t[0],d=0,h=1);h<s;)if(r=t[h++],d)if(d!==1)if(r)if(r===1){if(m>=0){var E={data:t.subarray(m,h-d-1),type:g};f.push(E)}else{var k=this.getLastNalUnit(e.samples);if(k&&(c&&h<=4-c&&k.state&&(k.data=k.data.subarray(0,k.data.byteLength-c)),(i=h-d-1)>0)){var R=new Uint8Array(k.data.byteLength+i);R.set(k.data,0),R.set(t.subarray(0,i),k.data.byteLength),k.data=R,k.state=0}}h<s?(m=h,g=31&t[h],d=0):d=-1}else d=0;else d=3;else d=r?0:2;else d=r?0:1;if(m>=0&&d>=0){var D={data:t.subarray(m,s),type:g,state:d};f.push(D)}if(f.length===0){var A=this.getLastNalUnit(e.samples);if(A){var I=new Uint8Array(A.data.byteLength+t.byteLength);I.set(A.data,0),I.set(t,A.data.byteLength),A.data=I}}return e.naluState=d,f},a.parseAACPES=function(e,t){var r,i,s,d=0,c=this.aacOverFlow,f=t.data;if(c){this.aacOverFlow=null;var h=c.missing,m=c.sample.unit.byteLength;if(h===-1){var g=new Uint8Array(m+f.byteLength);g.set(c.sample.unit,0),g.set(f,m),f=g}else{var E=m-h;c.sample.unit.set(f.subarray(0,h),E),e.samples.push(c.sample),d=c.missing}}for(r=d,i=f.length;r<i-1&&!ts(f,r);r++);if(r!==d){var k,R=r<i-1;k=R?"AAC PES did not start with ADTS header,offset:"+r:"No ADTS header found in AAC PES";var D=new Error(k);if(H.warn("parsing error: "+k),this.observer.emit(w.ERROR,w.ERROR,{type:se.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,levelRetry:R,error:D,reason:k}),!R)return}if(Su(e,this.observer,f,r,this.audioCodec),t.pts!==void 0)s=t.pts;else{if(!c)return void H.warn("[tsdemuxer]: AAC PES unknown PTS");var A=Au(e.samplerate);s=c.sample.pts+A}for(var I,O=0;r<i;){if(r+=(I=wu(e,f,r,s,O)).length,I.missing){this.aacOverFlow=I;break}for(O++;r<i-1&&!ts(f,r);r++);}},a.parseMPEGPES=function(e,t){var r=t.data,i=r.length,s=0,d=0,c=t.pts;if(c!==void 0)for(;d<i;)if(Iu(r,d)){var f=ku(e,r,d,c,s);if(!f)break;d+=f.length,s++}else d++;else H.warn("[tsdemuxer]: MPEG PES unknown PTS")},a.parseID3PES=function(e,t){if(t.pts!==void 0){var r=G({},t,{type:this._avcTrack?Mi:Nr,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}else H.warn("[tsdemuxer]: ID3 PES unknown PTS")},l}();function is(l,a,e,t){return{key:l,frame:!1,pts:a,dts:e,units:[],debug:t,length:0}}function xo(l,a){return((31&l[a+1])<<8)+l[a+2]}function wp(l,a){return(31&l[a+10])<<8|l[a+11]}function kp(l,a,e,t){var r={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},i=a+3+((15&l[a+1])<<8|l[a+2])-4;for(a+=12+((15&l[a+10])<<8|l[a+11]);a<i;){var s=xo(l,a);switch(l[a]){case 207:if(!t){H.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:r.audio===-1&&(r.audio=s);break;case 21:r.id3===-1&&(r.id3=s);break;case 219:if(!t){H.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:r.avc===-1&&(r.avc=s);break;case 3:case 4:e.mpeg!==!0&&e.mp3!==!0?H.log("MPEG audio found, not supported in this browser"):r.audio===-1&&(r.audio=s,r.segmentCodec="mp3");break;case 36:H.warn("Unsupported HEVC stream type found")}a+=5+((15&l[a+3])<<8|l[a+4])}return r}function fn(l){var a,e,t,r,i,s=0,d=l.data;if(!l||l.size===0)return null;for(;d[0].length<19&&d.length>1;){var c=new Uint8Array(d[0].length+d[1].length);c.set(d[0]),c.set(d[1],d[0].length),d[0]=c,d.splice(1,1)}if(((a=d[0])[0]<<16)+(a[1]<<8)+a[2]===1){if((e=(a[4]<<8)+a[5])&&e>l.size-6)return null;var f=a[7];192&f&&(r=536870912*(14&a[9])+4194304*(255&a[10])+16384*(254&a[11])+128*(255&a[12])+(254&a[13])/2,64&f?r-(i=536870912*(14&a[14])+4194304*(255&a[15])+16384*(254&a[16])+128*(255&a[17])+(254&a[18])/2)>54e5&&(H.warn(Math.round((r-i)/9e4)+"s delta between PTS and DTS, align them"),r=i):i=r);var h=(t=a[8])+9;if(l.size<=h)return null;l.size-=h;for(var m=new Uint8Array(l.size),g=0,E=d.length;g<E;g++){var k=(a=d[g]).byteLength;if(h){if(h>k){h-=k;continue}a=a.subarray(h),k-=h,h=0}m.set(a,s),s+=k}return e&&(e-=t+3),{data:m,pts:r,dts:i,len:e}}return null}function Mo(l,a){if(l.units.length&&l.frame){if(l.pts===void 0){var e=a.samples,t=e.length;if(!t)return void a.dropped++;var r=e[t-1];l.pts=r.pts,l.dts=r.dts}a.samples.push(l)}l.debug.length&&H.log(l.pts+"/"+l.dts+":"+l.debug)}var Rp=function(l){function a(){return l.apply(this,arguments)||this}Y(a,l);var e=a.prototype;return e.resetInitSegment=function(t,r,i,s){l.prototype.resetInitSegment.call(this,t,r,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:s,inputTimeScale:9e4,dropped:0}},a.probe=function(t){if(!t)return!1;for(var r=(Nt(t,0)||[]).length,i=t.length;r<i;r++)if(Tp(t,r))return H.log("MPEG Audio sync word found !"),!0;return!1},e.canParse=function(t,r){return function(i,s){return Co(i,s)&&4<=i.length-s}(t,r)},e.appendFrame=function(t,r,i){if(this.basePTS!==null)return ku(t,r,i,this.basePTS,this.frameIndex)},a}(bu),Du=function(){function l(){}return l.getSilentFrame=function(a,e){if(a==="mp4a.40.2"){if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},l}(),gi=Math.pow(2,32)-1,Ot=function(){function l(){}return l.init=function(){var a;for(a in l.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},l.types)l.types.hasOwnProperty(a)&&(l.types[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);l.HDLR_TYPES={video:e,audio:t};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);l.STTS=l.STSC=l.STCO=i,l.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),l.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),l.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),l.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);l.FTYP=l.box(l.types.ftyp,s,c,s,d),l.DINF=l.box(l.types.dinf,l.box(l.types.dref,r))},l.box=function(a){for(var e=8,t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var s=r.length,d=s;s--;)e+=r[s].byteLength;var c=new Uint8Array(e);for(c[0]=e>>24&255,c[1]=e>>16&255,c[2]=e>>8&255,c[3]=255&e,c.set(a,4),s=0,e=8;s<d;s++)c.set(r[s],e),e+=r[s].byteLength;return c},l.hdlr=function(a){return l.box(l.types.hdlr,l.HDLR_TYPES[a])},l.mdat=function(a){return l.box(l.types.mdat,a)},l.mdhd=function(a,e){e*=a;var t=Math.floor(e/(gi+1)),r=Math.floor(e%(gi+1));return l.box(l.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,a>>24&255,a>>16&255,a>>8&255,255&a,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},l.mdia=function(a){return l.box(l.types.mdia,l.mdhd(a.timescale,a.duration),l.hdlr(a.type),l.minf(a))},l.mfhd=function(a){return l.box(l.types.mfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a]))},l.minf=function(a){return a.type==="audio"?l.box(l.types.minf,l.box(l.types.smhd,l.SMHD),l.DINF,l.stbl(a)):l.box(l.types.minf,l.box(l.types.vmhd,l.VMHD),l.DINF,l.stbl(a))},l.moof=function(a,e,t){return l.box(l.types.moof,l.mfhd(a),l.traf(t,e))},l.moov=function(a){for(var e=a.length,t=[];e--;)t[e]=l.trak(a[e]);return l.box.apply(null,[l.types.moov,l.mvhd(a[0].timescale,a[0].duration)].concat(t).concat(l.mvex(a)))},l.mvex=function(a){for(var e=a.length,t=[];e--;)t[e]=l.trex(a[e]);return l.box.apply(null,[l.types.mvex].concat(t))},l.mvhd=function(a,e){e*=a;var t=Math.floor(e/(gi+1)),r=Math.floor(e%(gi+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,a>>24&255,a>>16&255,a>>8&255,255&a,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return l.box(l.types.mvhd,i)},l.sdtp=function(a){var e,t,r=a.samples||[],i=new Uint8Array(4+r.length);for(e=0;e<r.length;e++)t=r[e].flags,i[e+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return l.box(l.types.sdtp,i)},l.stbl=function(a){return l.box(l.types.stbl,l.stsd(a),l.box(l.types.stts,l.STTS),l.box(l.types.stsc,l.STSC),l.box(l.types.stsz,l.STSZ),l.box(l.types.stco,l.STCO))},l.avc1=function(a){var e,t,r,i=[],s=[];for(e=0;e<a.sps.length;e++)r=(t=a.sps[e]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(t));for(e=0;e<a.pps.length;e++)r=(t=a.pps[e]).byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(t));var d=l.box(l.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|a.sps.length].concat(i).concat([a.pps.length]).concat(s))),c=a.width,f=a.height,h=a.pixelRatio[0],m=a.pixelRatio[1];return l.box(l.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,f>>8&255,255&f,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,l.box(l.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),l.box(l.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,255&h,m>>24,m>>16&255,m>>8&255,255&m])))},l.esds=function(a){var e=a.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(a.config).concat([6,1,2]))},l.mp4a=function(a){var e=a.samplerate;return l.box(l.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),l.box(l.types.esds,l.esds(a)))},l.mp3=function(a){var e=a.samplerate;return l.box(l.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]))},l.stsd=function(a){return a.type==="audio"?a.segmentCodec==="mp3"&&a.codec==="mp3"?l.box(l.types.stsd,l.STSD,l.mp3(a)):l.box(l.types.stsd,l.STSD,l.mp4a(a)):l.box(l.types.stsd,l.STSD,l.avc1(a))},l.tkhd=function(a){var e=a.id,t=a.duration*a.timescale,r=a.width,i=a.height,s=Math.floor(t/(gi+1)),d=Math.floor(t%(gi+1));return l.box(l.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,d>>24,d>>16&255,d>>8&255,255&d,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))},l.traf=function(a,e){var t=l.sdtp(a),r=a.id,i=Math.floor(e/(gi+1)),s=Math.floor(e%(gi+1));return l.box(l.types.traf,l.box(l.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),l.box(l.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s])),l.trun(a,t.length+16+20+8+16+8+8),t)},l.trak=function(a){return a.duration=a.duration||4294967295,l.box(l.types.trak,l.tkhd(a),l.mdia(a))},l.trex=function(a){var e=a.id;return l.box(l.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},l.trun=function(a,e){var t,r,i,s,d,c,f=a.samples||[],h=f.length,m=12+16*h,g=new Uint8Array(m);for(e+=8+m,g.set([a.type==="video"?1:0,0,15,1,h>>>24&255,h>>>16&255,h>>>8&255,255&h,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),t=0;t<h;t++)i=(r=f[t]).duration,s=r.size,d=r.flags,c=r.cts,g.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,s>>>24&255,s>>>16&255,s>>>8&255,255&s,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,61440&d.degradPrio,15&d.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*t);return l.box(l.types.trun,g)},l.initSegment=function(a){l.types||l.init();var e=l.moov(a),t=new Uint8Array(l.FTYP.byteLength+e.byteLength);return t.set(l.FTYP),t.set(e,l.FTYP.byteLength),t},l}();function Po(l,a,e,t){e===void 0&&(e=1),t===void 0&&(t=!1);var r=l*a*e;return t?Math.round(r):r}function Qn(l,a){return a===void 0&&(a=!1),Po(l,1e3,1/9e4,a)}Ot.types=void 0,Ot.HDLR_TYPES=void 0,Ot.STTS=void 0,Ot.STSC=void 0,Ot.STCO=void 0,Ot.STSZ=void 0,Ot.VMHD=void 0,Ot.SMHD=void 0,Ot.STSD=void 0,Ot.FTYP=void 0,Ot.DINF=void 0;var ns=null,Oo=null,Fo=function(){function l(e,t,r,i){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,ns===null){var s=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ns=s?parseInt(s[1]):0}if(Oo===null){var d=navigator.userAgent.match(/Safari\/(\d+)/i);Oo=d?parseInt(d[1]):0}}var a=l.prototype;return a.destroy=function(){},a.resetTimeStamp=function(e){H.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},a.resetNextTimestamp=function(){H.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},a.resetInitSegment=function(){H.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},a.getVideoStartPts=function(e){var t=!1,r=e.reduce(function(i,s){var d=s.pts-i;return d<-4294967296?(t=!0,hr(i,s.pts)):d>0?i:s.pts},e[0].pts);return t&&H.debug("PTS rollover detected"),r},a.remux=function(e,t,r,i,s,d,c,f){var h,m,g,E,k,R,D=s,A=s,I=e.pid>-1,O=t.pid>-1,F=t.samples.length,q=e.samples.length>0,Q=c&&F>0||F>1;if((!I||q)&&(!O||Q)||this.ISGenerated||c){this.ISGenerated||(g=this.generateIS(e,t,s,d));var X,oe=this.isVideoContiguous,J=-1;if(Q&&(J=function(Oe){for(var Se=0;Se<Oe.length;Se++)if(Oe[Se].key)return Se;return-1}(t.samples),!oe&&this.config.forceKeyFrameOnDiscontinuity))if(R=!0,J>0){H.warn("[mp4-remuxer]: Dropped "+J+" out of "+F+" video samples due to a missing keyframe");var te=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(J),t.dropped+=J,X=A+=(t.samples[0].pts-te)/t.inputTimeScale}else J===-1&&(H.warn("[mp4-remuxer]: No keyframe found out of "+F+" video samples"),R=!1);if(this.ISGenerated){if(q&&Q){var fe=this.getVideoStartPts(t.samples),de=(hr(e.samples[0].pts,fe)-fe)/t.inputTimeScale;D+=Math.max(0,de),A+=Math.max(0,-de)}if(q){if(e.samplerate||(H.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),g=this.generateIS(e,t,s,d)),m=this.remuxAudio(e,D,this.isAudioContiguous,d,O||Q||f===Sr?A:void 0),Q){var _e=m?m.endPTS-m.startPTS:0;t.inputTimeScale||(H.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),g=this.generateIS(e,t,s,d)),h=this.remuxVideo(t,A,oe,_e)}}else Q&&(h=this.remuxVideo(t,A,oe,0));h&&(h.firstKeyFrame=J,h.independent=J!==-1,h.firstKeyFramePTS=X)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(k=Cu(r,s,this._initPTS,this._initDTS)),i.samples.length&&(E=xu(i,s,this._initPTS))),{audio:m,video:h,initSegment:g,independent:R,text:E,id3:k}},a.generateIS=function(e,t,r,i){var s,d,c,f=e.samples,h=t.samples,m=this.typeSupported,g={},E=this._initPTS,k=!E||i,R="audio/mp4";if(k&&(s=d=1/0),e.config&&f.length&&(e.timescale=e.samplerate,e.segmentCodec==="mp3"&&(m.mpeg?(R="audio/mpeg",e.codec=""):m.mp3&&(e.codec="mp3")),g.audio={id:"audio",container:R,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&m.mpeg?new Uint8Array(0):Ot.initSegment([e]),metadata:{channelCount:e.channelCount}},k&&(c=e.inputTimeScale,E&&c===E.timescale?k=!1:s=d=f[0].pts-Math.round(c*r))),t.sps&&t.pps&&h.length&&(t.timescale=t.inputTimeScale,g.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Ot.initSegment([t]),metadata:{width:t.width,height:t.height}},k))if(c=t.inputTimeScale,E&&c===E.timescale)k=!1;else{var D=this.getVideoStartPts(h),A=Math.round(c*r);d=Math.min(d,hr(h[0].dts,D)-A),s=Math.min(s,D-A)}if(Object.keys(g).length)return this.ISGenerated=!0,k?(this._initPTS={baseTime:s,timescale:c},this._initDTS={baseTime:d,timescale:c}):s=c=void 0,{tracks:g,initPTS:s,timescale:c}},a.remuxVideo=function(e,t,r,i){var s,d,c=e.inputTimeScale,f=e.samples,h=[],m=f.length,g=this._initPTS,E=this.nextAvcDts,k=8,R=this.videoSampleDuration,D=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,I=!1;r&&E!==null||(E=t*c-(f[0].pts-hr(f[0].dts,f[0].pts)));for(var O=g.baseTime*c/g.timescale,F=0;F<m;F++){var q=f[F];q.pts=hr(q.pts-O,E),q.dts=hr(q.dts-O,E),q.dts<f[F>0?F-1:F].dts&&(I=!0)}I&&f.sort(function(cs,hd){var Am=cs.dts-hd.dts,wm=cs.pts-hd.pts;return Am||wm}),s=f[0].dts;var Q=(d=f[f.length-1].dts)-s,X=Q?Math.round(Q/(m-1)):R||e.inputTimeScale/30;if(r){var oe=s-E,J=oe>X,te=oe<-1;if((J||te)&&(J?H.warn("AVC: "+Qn(oe,!0)+" ms ("+oe+"dts) hole between fragments detected, filling it"):H.warn("AVC: "+Qn(-oe,!0)+" ms ("+oe+"dts) overlapping between fragments detected"),!te||E>f[0].pts)){s=E;var fe=f[0].pts-oe;f[0].dts=s,f[0].pts=fe,H.log("Video: First PTS/DTS adjusted: "+Qn(fe,!0)+"/"+Qn(s,!0)+", delta: "+Qn(oe,!0)+" ms")}}s=Math.max(0,s);for(var de=0,_e=0,Oe=0;Oe<m;Oe++){for(var Se=f[Oe],Pe=Se.units,Ae=Pe.length,Ce=0,He=0;He<Ae;He++)Ce+=Pe[He].data.length;_e+=Ce,de+=Ae,Se.length=Ce,Se.dts=Math.max(Se.dts,s),D=Math.min(Se.pts,D),A=Math.max(Se.pts,A)}d=f[m-1].dts;var $e,qe=_e+4*de+8;try{$e=new Uint8Array(qe)}catch(cs){return void this.observer.emit(w.ERROR,w.ERROR,{type:se.MUX_ERROR,details:W.REMUX_ALLOC_ERROR,fatal:!1,error:cs,bytes:qe,reason:"fail allocating video mdat "+qe})}var lt=new DataView($e.buffer);lt.setUint32(0,qe),$e.set(Ot.types.mdat,4);for(var Yt=!1,Rt=Number.POSITIVE_INFINITY,Rr=Number.POSITIVE_INFINITY,pr=Number.NEGATIVE_INFINITY,mr=Number.NEGATIVE_INFINITY,It=0;It<m;It++){for(var Ft=f[It],Hr=Ft.units,yi=0,rr=0,Xn=Hr.length;rr<Xn;rr++){var Zn=Hr[rr],ds=Zn.data,vn=Zn.data.byteLength;lt.setUint32(k,vn),k+=4,$e.set(ds,k),k+=vn,yi+=4+vn}var Hi=void 0;if(It<m-1)R=f[It+1].dts-Ft.dts,Hi=f[It+1].pts-Ft.pts;else{var Jn=this.config,si=It>0?Ft.dts-f[It-1].dts:X;if(Hi=It>0?Ft.pts-f[It-1].pts:X,Jn.stretchShortVideoTrack&&this.nextAudioPts!==null){var Em=Math.floor(Jn.maxBufferHole*c),il=(i?D+i*c:this.nextAudioPts)-Ft.pts;il>Em?((R=il-si)<0?R=si:Yt=!0,H.log("[mp4-remuxer]: It is approximately "+il/90+" ms to the next segment; using duration "+R/90+" ms for the last video frame.")):R=si}else R=si}var bm=Math.round(Ft.pts-Ft.dts);Rt=Math.min(Rt,R),pr=Math.max(pr,R),Rr=Math.min(Rr,Hi),mr=Math.max(mr,Hi),h.push(new Mu(Ft.key,R,yi,bm))}if(h.length){if(ns){if(ns<70){var ud=h[0].flags;ud.dependsOn=2,ud.isNonSync=0}}else if(Oo&&mr-Rr<pr-Rt&&X/pr<.025&&h[0].cts===0){H.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var nl=s,Ir=0,dd=h.length;Ir<dd;Ir++){var cd=nl+h[Ir].duration,_m=nl+h[Ir].cts;if(Ir<dd-1){var Tm=cd+h[Ir+1].cts;h[Ir].duration=Tm-_m}else h[Ir].duration=Ir?h[Ir-1].duration:X;h[Ir].cts=0,nl=cd}}}R=Yt||!R?X:R,this.nextAvcDts=E=d+R,this.videoSampleDuration=R,this.isVideoContiguous=!0;var Sm={data1:Ot.moof(e.sequenceNumber++,s,G({},e,{samples:h})),data2:$e,startPTS:D/c,endPTS:(A+R)/c,startDTS:s/c,endDTS:E/c,type:"video",hasAudio:!1,hasVideo:!0,nb:h.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Sm},a.remuxAudio=function(e,t,r,i,s){var d=e.inputTimeScale,c=d/(e.samplerate?e.samplerate:d),f=e.segmentCodec==="aac"?1024:1152,h=f*c,m=this._initPTS,g=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,E=[],k=s!==void 0,R=e.samples,D=g?0:8,A=this.nextAudioPts||-1,I=t*d,O=m.baseTime*d/m.timescale;if(this.isAudioContiguous=r=r||R.length&&A>0&&(i&&Math.abs(I-A)<9e3||Math.abs(hr(R[0].pts-O,I)-A)<20*h),R.forEach(function(rr){rr.pts=hr(rr.pts-O,I)}),!r||A<0){if(R=R.filter(function(rr){return rr.pts>=0}),!R.length)return;A=s===0?0:i&&!k?Math.max(0,I):R[0].pts}if(e.segmentCodec==="aac")for(var F=this.config.maxAudioFramesDrift,q=0,Q=A;q<R.length;q++){var X=R[q],oe=X.pts,J=oe-Q,te=Math.abs(1e3*J/d);if(J<=-F*h&&k)q===0&&(H.warn("Audio frame @ "+(oe/d).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*J/d)+" ms."),this.nextAudioPts=A=Q=oe);else if(J>=F*h&&te<1e4&&k){var fe=Math.round(J/h);(Q=oe-fe*h)<0&&(fe--,Q+=h),q===0&&(this.nextAudioPts=A=Q),H.warn("[mp4-remuxer]: Injecting "+fe+" audio frame @ "+(Q/d).toFixed(3)+"s due to "+Math.round(1e3*J/d)+" ms gap.");for(var de=0;de<fe;de++){var _e=Math.max(Q,0),Oe=Du.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);Oe||(H.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Oe=X.unit.subarray()),R.splice(q,0,{unit:Oe,pts:_e}),Q+=h,q++}}X.pts=Q,Q+=h}for(var Se,Pe=null,Ae=null,Ce=0,He=R.length;He--;)Ce+=R[He].unit.byteLength;for(var $e=0,qe=R.length;$e<qe;$e++){var lt=R[$e],Yt=lt.unit,Rt=lt.pts;if(Ae!==null)E[$e-1].duration=Math.round((Rt-Ae)/c);else{if(r&&e.segmentCodec==="aac"&&(Rt=A),Pe=Rt,!(Ce>0))return;Ce+=D;try{Se=new Uint8Array(Ce)}catch(rr){return void this.observer.emit(w.ERROR,w.ERROR,{type:se.MUX_ERROR,details:W.REMUX_ALLOC_ERROR,fatal:!1,error:rr,bytes:Ce,reason:"fail allocating audio mdat "+Ce})}g||(new DataView(Se.buffer).setUint32(0,Ce),Se.set(Ot.types.mdat,4))}Se.set(Yt,D);var Rr=Yt.byteLength;D+=Rr,E.push(new Mu(!0,f,Rr,0)),Ae=Rt}var pr=E.length;if(pr){var mr=E[E.length-1];this.nextAudioPts=A=Ae+c*mr.duration;var It=g?new Uint8Array(0):Ot.moof(e.sequenceNumber++,Pe/c,G({},e,{samples:E}));e.samples=[];var Ft=Pe/d,Hr=A/d,yi={data1:It,data2:Se,startPTS:Ft,endPTS:Hr,startDTS:Ft,endDTS:Hr,type:"audio",hasAudio:!0,hasVideo:!1,nb:pr};return this.isAudioContiguous=!0,yi}},a.remuxEmptyAudio=function(e,t,r,i){var s=e.inputTimeScale,d=s/(e.samplerate?e.samplerate:s),c=this.nextAudioPts,f=this._initDTS,h=9e4*f.baseTime/f.timescale,m=(c!==null?c:i.startDTS*s)+h,g=i.endDTS*s+h,E=1024*d,k=Math.ceil((g-m)/E),R=Du.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(H.warn("[mp4-remuxer]: remux empty Audio"),R){for(var D=[],A=0;A<k;A++){var I=m+A*E;D.push({unit:R,pts:I,dts:I})}return e.samples=D,this.remuxAudio(e,t,r,!1)}H.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},l}();function hr(l,a){var e;if(a===null)return l;for(e=a<l?-8589934592:8589934592;Math.abs(l-a)>4294967296;)l+=e;return l}function Cu(l,a,e,t){var r=l.samples.length;if(r){for(var i=l.inputTimeScale,s=0;s<r;s++){var d=l.samples[s];d.pts=hr(d.pts-9e4*e.baseTime/e.timescale,a*i)/i,d.dts=hr(d.dts-9e4*t.baseTime/t.timescale,a*i)/i}var c=l.samples;return l.samples=[],{samples:c}}}function xu(l,a,e){var t=l.samples.length;if(t){for(var r=l.inputTimeScale,i=0;i<t;i++){var s=l.samples[i];s.pts=hr(s.pts-9e4*e.baseTime/e.timescale,a*r)/r}l.samples.sort(function(c,f){return c.pts-f.pts});var d=l.samples;return l.samples=[],{samples:d}}}var ni,Mu=function(l,a,e,t){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=a,this.size=e,this.cts=t,this.flags=new Ip(l)},Ip=function(l){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=l?2:1,this.isNonSync=l?0:1},Lp=function(){function l(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var a=l.prototype;return a.destroy=function(){},a.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},a.resetNextTimestamp=function(){this.lastEndTime=null},a.resetInitSegment=function(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(s,d){if(!s||!d)return s;var c=d.keyId;return c&&d.isCommonEncryption&&Xe(s,["moov","trak"]).forEach(function(f){var h=Xe(f,["mdia","minf","stbl","stsd"])[0].subarray(8),m=Xe(h,["enca"]),g=m.length>0;g||(m=Xe(h,["encv"])),m.forEach(function(E){Xe(g?E.subarray(28):E.subarray(78),["sinf"]).forEach(function(k){var R=Fn(k);if(R){var D=R.subarray(8,24);D.some(function(A){return A!==0})||(H.log("[eme] Patching keyId in 'enc"+(g?"a":"v")+">sinf>>tenc' box: "+er(D)+" -> "+er(c)),R.set(c,8))}})})}),s}(e,i)),this.emitInitSegment=!0},a.generateInitSegment=function(e){var t=this.audioCodec,r=this.videoCodec;if(e==null||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=On(e);t||(t=Pu(i.audio,Re)),r||(r=Pu(i.video,st));var s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?s.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:H.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s},a.remux=function(e,t,r,i,s,d){var c,f,h=this.initPTS,m=this.lastEndTime,g={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};z(m)||(m=this.lastEndTime=s||0);var E=t.samples;if(E==null||!E.length)return g;var k={initPTS:void 0,timescale:1},R=this.initData;if((c=R)!=null&&c.length||(this.generateInitSegment(E),R=this.initData),(f=R)==null||!f.length)return H.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),g;this.emitInitSegment&&(k.tracks=this.initTracks,this.emitInitSegment=!1);var D=function(J,te){return Xe(te,["moof","traf"]).reduce(function(fe,de){var _e=Xe(de,["tfdt"])[0],Oe=_e[0],Se=Xe(de,["tfhd"]).reduce(function(Pe,Ae){var Ce=Fe(Ae,4),He=J[Ce];if(He){var $e=Fe(_e,4);if(Oe===1){if($e===$i)return H.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),Pe;$e*=$i+1,$e+=Fe(_e,8)}var qe=$e/(He.timescale||9e4);if(isFinite(qe)&&(Pe===null||qe<Pe))return qe}return Pe},null);return Se!==null&&isFinite(Se)&&(fe===null||Se<fe)?Se:fe},null)}(R,E),A=D===null?s:D;(function(J,te,fe){if(J===null)return!0;var de=te-J.baseTime/J.timescale;return de<0&&Math.abs(de-fe)>1}(h,A,s)||k.timescale!==h.timescale&&d)&&(k.initPTS=A-s,this.initPTS=h={baseTime:k.initPTS,timescale:1});var I=function(J,te){for(var fe=0,de=0,_e=0,Oe=Xe(J,["moof","traf"]),Se=0;Se<Oe.length;Se++){var Pe=Oe[Se],Ae=Xe(Pe,["tfhd"])[0],Ce=te[Fe(Ae,4)];if(Ce){var He=Ce.default,$e=Fe(Ae,0)|(He==null?void 0:He.flags),qe=He==null?void 0:He.duration;8&$e&&(qe=Fe(Ae,2&$e?12:8));for(var lt=Ce.timescale||9e4,Yt=Xe(Pe,["trun"]),Rt=0;Rt<Yt.length;Rt++)!(fe=Oa(Yt[Rt]))&&qe&&(fe=qe*Fe(Yt[Rt],4)),Ce.type===st?de+=fe/lt:Ce.type===Re&&(_e+=fe/lt)}}if(de===0&&_e===0){for(var Rr=0,pr=Xe(J,["sidx"]),mr=0;mr<pr.length;mr++){var It=go(pr[mr]);It!=null&&It.references&&(Rr+=It.references.reduce(function(Ft,Hr){return Ft+Hr.info.duration||0},0))}return Rr}return de||_e}(E,R),O=e?A-h.baseTime/h.timescale:m,F=O+I;(function(J,te,fe){Xe(te,["moof","traf"]).forEach(function(de){Xe(de,["tfhd"]).forEach(function(_e){var Oe=Fe(_e,4),Se=J[Oe];if(Se){var Pe=Se.timescale||9e4;Xe(de,["tfdt"]).forEach(function(Ae){var Ce=Ae[0],He=Fe(Ae,4);if(Ce===0)He-=fe*Pe,Pn(Ae,4,He=Math.max(He,0));else{He*=Math.pow(2,32),He+=Fe(Ae,8),He-=fe*Pe,He=Math.max(He,0);var $e=Math.floor(He/($i+1)),qe=Math.floor(He%($i+1));Pn(Ae,4,$e),Pn(Ae,8,qe)}})}})})})(R,E,h.baseTime/h.timescale),I>0?this.lastEndTime=F:(H.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var q=!!R.audio,Q=!!R.video,X="";q&&(X+="audio"),Q&&(X+="video");var oe={data1:E,startPTS:O,startDTS:O,endPTS:F,endDTS:F,type:X,hasAudio:q,hasVideo:Q,nb:1,dropped:0};return g.audio=oe.type==="audio"?oe:void 0,g.video=oe.type!=="audio"?oe:void 0,g.initSegment=k,g.id3=Cu(r,s,h,h),i.samples.length&&(g.text=xu(i,s,h)),g},l}();function Pu(l,a){var e=l==null?void 0:l.codec;return e&&e.length>4?e:e==="hvc1"||e==="hev1"?"hvc1.1.c.L120.90":e==="av01"?"av01.0.04M.08":e==="avc1"||a===st?"avc1.42e01e":"mp4a.40.5"}try{ni=self.performance.now.bind(self.performance)}catch{H.debug("Unable to use Performance API on this environment"),ni=typeof self<"u"&&self.Date.now}var No=[{demux:gp,remux:Lp},{demux:Ap,remux:Fo},{demux:mp,remux:Fo},{demux:Rp,remux:Fo}],Uo=function(){function l(e,t,r,i,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=s}var a=l.prototype;return a.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},a.push=function(e,t,r,i){var s=this,d=r.transmuxing;d.executeStart=ni();var c=new Uint8Array(e),f=this.currentTransmuxState,h=this.transmuxConfig;i&&(this.currentTransmuxState=i);var m=i||f,g=m.contiguous,E=m.discontinuity,k=m.trackSwitch,R=m.accurateTimeOffset,D=m.timeOffset,A=m.initSegmentChange,I=h.audioCodec,O=h.videoCodec,F=h.defaultInitPts,q=h.duration,Q=h.initSegmentData,X=function(Oe,Se){var Pe=null;return Oe.byteLength>0&&Se!=null&&Se.key!=null&&Se.iv!==null&&Se.method!=null&&(Pe=Se),Pe}(c,t);if(X&&X.method==="AES-128"){var oe=this.getDecrypter();if(!oe.isSync())return this.decryptionPromise=oe.webCryptoDecrypt(c,X.key.buffer,X.iv.buffer).then(function(Oe){var Se=s.push(Oe,null,r);return s.decryptionPromise=null,Se}),this.decryptionPromise;var J=oe.softwareDecrypt(c,X.key.buffer,X.iv.buffer);if(r.part>-1&&(J=oe.flush()),!J)return d.executeEnd=ni(),Bo(r);c=new Uint8Array(J)}var te=this.needsProbing(E,k);if(te){var fe=this.configureTransmuxer(c);if(fe)return H.warn("[transmuxer] "+fe.message),this.observer.emit(w.ERROR,w.ERROR,{type:se.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,error:fe,reason:fe.message}),d.executeEnd=ni(),Bo(r)}(E||k||A||te)&&this.resetInitSegment(Q,I,O,q,t),(E||A||te)&&this.resetInitialTimestamp(F),g||this.resetContiguity();var de=this.transmux(c,X,D,R,r),_e=this.currentTransmuxState;return _e.contiguous=!0,_e.discontinuity=!1,_e.trackSwitch=!1,d.executeEnd=ni(),de},a.flush=function(e){var t=this,r=e.transmuxing;r.executeStart=ni();var i=this.decrypter,s=this.currentTransmuxState,d=this.decryptionPromise;if(d)return d.then(function(){return t.flush(e)});var c=[],f=s.timeOffset;if(i){var h=i.flush();h&&c.push(this.push(h,null,e))}var m=this.demuxer,g=this.remuxer;if(!m||!g)return r.executeEnd=ni(),[Bo(e)];var E=m.flush(f);return Ui(E)?E.then(function(k){return t.flushRemux(c,k,e),c}):(this.flushRemux(c,E,e),c)},a.flushRemux=function(e,t,r){var i=t.audioTrack,s=t.videoTrack,d=t.id3Track,c=t.textTrack,f=this.currentTransmuxState,h=f.accurateTimeOffset,m=f.timeOffset;H.log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var g=this.remuxer.remux(i,s,d,c,m,h,!0,this.id);e.push({remuxResult:g,chunkMeta:r}),r.transmuxing.executeEnd=ni()},a.resetInitialTimestamp=function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))},a.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},a.resetInitSegment=function(e,t,r,i,s){var d=this.demuxer,c=this.remuxer;d&&c&&(d.resetInitSegment(e,t,r,i),c.resetInitSegment(e,t,r,s))},a.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},a.transmux=function(e,t,r,i,s){return t&&t.method==="SAMPLE-AES"?this.transmuxSampleAes(e,t,r,i,s):this.transmuxUnencrypted(e,r,i,s)},a.transmuxUnencrypted=function(e,t,r,i){var s=this.demuxer.demux(e,t,!1,!this.config.progressive),d=s.audioTrack,c=s.videoTrack,f=s.id3Track,h=s.textTrack;return{remuxResult:this.remuxer.remux(d,c,f,h,t,r,!1,this.id),chunkMeta:i}},a.transmuxSampleAes=function(e,t,r,i,s){var d=this;return this.demuxer.demuxSampleAes(e,t,r).then(function(c){return{remuxResult:d.remuxer.remux(c.audioTrack,c.videoTrack,c.id3Track,c.textTrack,r,i,!1,d.id),chunkMeta:s}})},a.configureTransmuxer=function(e){for(var t,r=this.config,i=this.observer,s=this.typeSupported,d=this.vendor,c=0,f=No.length;c<f;c++)if(No[c].demux.probe(e)){t=No[c];break}if(!t)return new Error("Failed to find demuxer by probing fragment data");var h=this.demuxer,m=this.remuxer,g=t.remux,E=t.demux;m&&m instanceof g||(this.remuxer=new g(i,r,s,d)),h&&h instanceof E||(this.demuxer=new E(i,r,s),this.probe=E.probe)},a.needsProbing=function(e,t){return!this.demuxer||!this.remuxer||e||t},a.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new kt(this.config)),e},l}(),Bo=function(l){return{remuxResult:{},chunkMeta:l}};function Ui(l){return"then"in l&&l.then instanceof Function}var Dp=function(l,a,e,t,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=l,this.videoCodec=a,this.initSegmentData=e,this.duration=t,this.defaultInitPts=r||null},Cp=function(l,a,e,t,r,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=l,this.contiguous=a,this.accurateTimeOffset=e,this.trackSwitch=t,this.timeOffset=r,this.initSegmentChange=i},Go={};(function(l){var a=Object.prototype.hasOwnProperty,e="~";function t(){}function r(c,f,h){this.fn=c,this.context=f,this.once=h||!1}function i(c,f,h,m,g){if(typeof h!="function")throw new TypeError("The listener must be a function");var E=new r(h,m||c,g),k=e?e+f:f;return c._events[k]?c._events[k].fn?c._events[k]=[c._events[k],E]:c._events[k].push(E):(c._events[k]=E,c._eventsCount++),c}function s(c,f){--c._eventsCount==0?c._events=new t:delete c._events[f]}function d(){this._events=new t,this._eventsCount=0}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(e=!1)),d.prototype.eventNames=function(){var c,f,h=[];if(this._eventsCount===0)return h;for(f in c=this._events)a.call(c,f)&&h.push(e?f.slice(1):f);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(c)):h},d.prototype.listeners=function(c){var f=e?e+c:c,h=this._events[f];if(!h)return[];if(h.fn)return[h.fn];for(var m=0,g=h.length,E=new Array(g);m<g;m++)E[m]=h[m].fn;return E},d.prototype.listenerCount=function(c){var f=e?e+c:c,h=this._events[f];return h?h.fn?1:h.length:0},d.prototype.emit=function(c,f,h,m,g,E){var k=e?e+c:c;if(!this._events[k])return!1;var R,D,A=this._events[k],I=arguments.length;if(A.fn){switch(A.once&&this.removeListener(c,A.fn,void 0,!0),I){case 1:return A.fn.call(A.context),!0;case 2:return A.fn.call(A.context,f),!0;case 3:return A.fn.call(A.context,f,h),!0;case 4:return A.fn.call(A.context,f,h,m),!0;case 5:return A.fn.call(A.context,f,h,m,g),!0;case 6:return A.fn.call(A.context,f,h,m,g,E),!0}for(D=1,R=new Array(I-1);D<I;D++)R[D-1]=arguments[D];A.fn.apply(A.context,R)}else{var O,F=A.length;for(D=0;D<F;D++)switch(A[D].once&&this.removeListener(c,A[D].fn,void 0,!0),I){case 1:A[D].fn.call(A[D].context);break;case 2:A[D].fn.call(A[D].context,f);break;case 3:A[D].fn.call(A[D].context,f,h);break;case 4:A[D].fn.call(A[D].context,f,h,m);break;default:if(!R)for(O=1,R=new Array(I-1);O<I;O++)R[O-1]=arguments[O];A[D].fn.apply(A[D].context,R)}}return!0},d.prototype.on=function(c,f,h){return i(this,c,f,h,!1)},d.prototype.once=function(c,f,h){return i(this,c,f,h,!0)},d.prototype.removeListener=function(c,f,h,m){var g=e?e+c:c;if(!this._events[g])return this;if(!f)return s(this,g),this;var E=this._events[g];if(E.fn)E.fn!==f||m&&!E.once||h&&E.context!==h||s(this,g);else{for(var k=0,R=[],D=E.length;k<D;k++)(E[k].fn!==f||m&&!E[k].once||h&&E[k].context!==h)&&R.push(E[k]);R.length?this._events[g]=R.length===1?R[0]:R:s(this,g)}return this},d.prototype.removeAllListeners=function(c){var f;return c?(f=e?e+c:c,this._events[f]&&s(this,f)):(this._events=new t,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=e,d.EventEmitter=d,l.exports=d})({get exports(){return Go},set exports(l){Go=l}});var as=Go;function Ho(l,a){if(!((e=a.remuxResult).audio||e.video||e.text||e.id3||e.initSegment))return!1;var e,t=[],r=a.remuxResult,i=r.audio,s=r.video;return i&&Ou(t,i),s&&Ou(t,s),l.postMessage({event:"transmuxComplete",data:a},t),!0}function Ou(l,a){a.data1&&l.push(a.data1.buffer),a.data2&&l.push(a.data2.buffer)}function Fu(l,a,e){a.reduce(function(t,r){return Ho(l,r)||t},!1)||l.postMessage({event:"transmuxComplete",data:a[0]}),l.postMessage({event:"flush",data:e})}p!==void 0&&p&&function(l){var a=new as,e=function(r,i){l.postMessage({event:r,data:i})};a.on(w.FRAG_DECRYPTED,e),a.on(w.ERROR,e);var t=function(){var r=function(s){var d=function(c){e("workerLog",{logType:s,message:c})};H[s]=d};for(var i in H)r(i)};l.addEventListener("message",function(r){var i=r.data;switch(i.cmd){case"init":var s=JSON.parse(i.config);l.transmuxer=new Uo(a,i.typeSupported,s,i.vendor,i.id),Je(s.debug,i.id),t(),e("init",null);break;case"configure":l.transmuxer.configure(i.config);break;case"demux":var d=l.transmuxer.push(i.data,i.decryptdata,i.chunkMeta,i.state);Ui(d)?(l.transmuxer.async=!0,d.then(function(h){Ho(l,h)}).catch(function(h){e(w.ERROR,{type:se.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:h,err:h,reason:"transmuxer-worker push error"})})):(l.transmuxer.async=!1,Ho(l,d));break;case"flush":var c=i.chunkMeta,f=l.transmuxer.flush(c);Ui(f)||l.transmuxer.async?(Ui(f)||(f=Promise.resolve(f)),f.then(function(h){Fu(l,h,c)}).catch(function(h){e(w.ERROR,{type:se.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:h,err:h,reason:"transmuxer-worker flush error"})})):Fu(l,f,c)}})}(self);var Vo=Lo()||{isTypeSupported:function(){return!1}},Nu=function(){function l(e,t,r,i){var s=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var d=e.config;this.hls=e,this.id=t,this.useWorker=!!d.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;var c=function(D,A){(A=A||{}).frag=s.frag,A.id=s.id,D===w.ERROR&&(s.error=A.error),s.hls.trigger(D,A)};this.observer=new as,this.observer.on(w.FRAG_DECRYPTED,c),this.observer.on(w.ERROR,c);var f,h,m,g,E={mp4:Vo.isTypeSupported("video/mp4"),mpeg:Vo.isTypeSupported("audio/mpeg"),mp3:Vo.isTypeSupported('audio/mp4; codecs="mp3"')},k=navigator.vendor;if(!this.useWorker||typeof Worker>"u")this.transmuxer=new Uo(this.observer,E,d,k,t);else try{d.workerPath?(H.log("loading Web Worker "+d.workerPath+' for "'+t+'"'),this.workerContext=(m=d.workerPath,g=new self.URL(m,self.location.href).href,{worker:new self.Worker(g),scriptURL:g})):(H.log('injecting Web Worker for "'+t+'"'),this.workerContext=(f=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+u.toString()+")(true);"],{type:"text/javascript"}),h=self.URL.createObjectURL(f),{worker:new self.Worker(h),objectURL:h})),this.onwmsg=function(D){return s.onWorkerMessage(D)};var R=this.workerContext.worker;R.addEventListener("message",this.onwmsg),R.onerror=function(D){var A=new Error(D.message+"  ("+D.filename+":"+D.lineno+")");d.enableWorker=!1,H.warn('Error in "'+t+'" Web Worker, fallback to inline'),s.hls.trigger(w.ERROR,{type:se.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:A})},R.postMessage({cmd:"init",typeSupported:E,vendor:k,id:t,config:JSON.stringify(d)})}catch(D){H.warn('Error setting up "'+t+'" Web Worker, fallback to inline',D),this.resetWorker(),this.error=null,this.transmuxer=new Uo(this.observer,E,d,k,t)}}var a=l.prototype;return a.resetWorker=function(){if(this.workerContext){var e=this.workerContext,t=e.worker,r=e.objectURL;r&&self.URL.revokeObjectURL(r),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}},a.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},a.push=function(e,t,r,i,s,d,c,f,h,m){var g,E,k=this;h.transmuxing.start=self.performance.now();var R=this.transmuxer,D=d?d.start:s.start,A=s.decryptdata,I=this.frag,O=!(I&&s.cc===I.cc),F=!(I&&h.level===I.level),q=I?h.sn-I.sn:-1,Q=this.part?h.part-this.part.index:-1,X=q===0&&h.id>1&&h.id===(I==null?void 0:I.stats.chunkCount),oe=!F&&(q===1||q===0&&(Q===1||X&&Q<=0)),J=self.performance.now();(F||q||s.stats.parsing.start===0)&&(s.stats.parsing.start=J),!d||!Q&&oe||(d.stats.parsing.start=J);var te=!(I&&((g=s.initSegment)==null?void 0:g.url)===((E=I.initSegment)==null?void 0:E.url)),fe=new Cp(O,oe,f,F,D,te);if(!oe||O||te){H.log("[transmuxer-interface, "+s.type+"]: Starting new transmux session for sn: "+h.sn+" p: "+h.part+" level: "+h.level+" id: "+h.id+`
        discontinuity: `+O+`
        trackSwitch: `+F+`
        contiguous: `+oe+`
        accurateTimeOffset: `+f+`
        timeOffset: `+D+`
        initSegmentChange: `+te);var de=new Dp(r,i,t,c,m);this.configureTransmuxer(de)}if(this.frag=s,this.part=d,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:A,chunkMeta:h,state:fe},e instanceof ArrayBuffer?[e]:[]);else if(R){var _e=R.push(e,A,h,fe);Ui(_e)?(R.async=!0,_e.then(function(Oe){k.handleTransmuxComplete(Oe)}).catch(function(Oe){k.transmuxerError(Oe,h,"transmuxer-interface push error")})):(R.async=!1,this.handleTransmuxComplete(_e))}},a.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(r){var i=r.flush(e);Ui(i)||r.async?(Ui(i)||(i=Promise.resolve(i)),i.then(function(s){t.handleFlushResult(s,e)}).catch(function(s){t.transmuxerError(s,e,"transmuxer-interface flush error")})):this.handleFlushResult(i,e)}},a.transmuxerError=function(e,t,r){this.hls&&(this.error=e,this.hls.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))},a.handleFlushResult=function(e,t){var r=this;e.forEach(function(i){r.handleTransmuxComplete(i)}),this.onFlush(t)},a.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":var i,s=(i=this.workerContext)==null?void 0:i.objectURL;s&&self.URL.revokeObjectURL(s);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":H[t.data.logType]&&H[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},a.configureTransmuxer=function(e){var t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)},a.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},l}(),xp=function(){function l(e,t,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}var a=l.prototype;return a.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},a.poll=function(e,t){var r=this.config,i=this.media,s=this.stalled;if(i!==null){var d=i.currentTime,c=i.seeking,f=this.seeking&&!c,h=!this.seeking&&c;if(this.seeking=c,d===e){if(h||f)this.stalled=null;else if(!(i.paused&&!c||i.ended||i.playbackRate===0)&&Ge.getBuffered(i).length){var m=Ge.bufferInfo(i,d,0),g=m.len>0,E=m.nextStart||0;if(g||E){if(c){var k=m.len>2,R=!E||t&&t.start<=d||E-d>2&&!this.fragmentTracker.getPartialFragment(d);if(k||R)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var D,A=Math.max(E,m.start||0)-d,I=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,O=!(I==null||(D=I.details)==null)&&D.live?2*I.details.targetduration:2,F=this.fragmentTracker.getPartialFragment(d);if(A>0&&(A<=O||F))return void this._trySkipBufferHole(F)}var q=self.performance.now();if(s!==null){var Q=q-s;if(c||!(Q>=250)||(this._reportStall(m),this.media)){var X=Ge.bufferInfo(i,d,r.maxBufferHole);this._tryFixBufferStall(X,Q)}}else this.stalled=q}}}else if(this.moved=!0,s!==null){if(this.stallReported){var oe=self.performance.now()-s;H.warn("playback not stuck anymore @"+d+", after "+Math.round(oe)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},a._tryFixBufferStall=function(e,t){var r=this.config,i=this.fragmentTracker,s=this.media;if(s!==null){var d=s.currentTime,c=i.getPartialFragment(d);if(c&&(this._trySkipBufferHole(c)||!this.media))return;(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-d<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(H.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},a._reportStall=function(e){var t=this.hls,r=this.media;if(!this.stallReported&&r){this.stallReported=!0;var i=new Error("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(e)+")");H.warn(i.message),t.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len})}},a._trySkipBufferHole=function(e){var t=this.config,r=this.hls,i=this.media;if(i===null)return 0;var s=i.currentTime,d=Ge.bufferInfo(i,s,0),c=s<d.start?d.start:d.nextStart;if(c){var f=d.len<=t.maxBufferHole,h=d.len>0&&d.len<1&&i.readyState<3;if(s<c&&(f||h)){var m=Math.max(c+.05,s+.1);if(H.warn("skipping hole, adjusting currentTime from "+s+" to "+m),this.moved=!0,this.stalled=null,i.currentTime=m,e&&!e.gap){var g=new Error("fragment loaded with buffer holes, seeking from "+s+" to "+m);r.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:e})}return m}}return 0},a._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,i=this.nudgeRetry;if(r!==null){var s=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){var d=s+(i+1)*e.nudgeOffset,c=new Error("Nudging 'currentTime' from "+s+" to "+d);H.warn(c.message),r.currentTime=d,t.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1})}else{var f=new Error("Playhead still not moving while enough data buffered @"+s+" after "+e.nudgeMaxRetry+" nudges");H.error(f.message),t.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.BUFFER_STALLED_ERROR,error:f,fatal:!0})}}},l}(),Mp=function(l){function a(t,r,i){var s;return(s=l.call(this,t,r,i,"[stream-controller]")||this).audioCodecSwap=!1,s.gapController=null,s.level=-1,s._forceStartLoad=!1,s.altAudio=!1,s.audioOnly=!1,s.fragPlaying=null,s.onvplaying=null,s.onvseeked=null,s.fragLastKbps=0,s.couldBacktrack=!1,s.backtrackFragment=null,s.audioCodecSwitch=!1,s.videoBuffer=null,s._registerListeners(),s}Y(a,l);var e=a.prototype;return e._registerListeners=function(){var t=this.hls;t.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.MANIFEST_PARSED,this.onManifestParsed,this),t.on(w.LEVEL_LOADING,this.onLevelLoading,this),t.on(w.LEVEL_LOADED,this.onLevelLoaded,this),t.on(w.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(w.ERROR,this.onError,this),t.on(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(w.BUFFER_CREATED,this.onBufferCreated,this),t.on(w.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(w.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.MANIFEST_PARSED,this.onManifestParsed,this),t.off(w.LEVEL_LOADED,this.onLevelLoaded,this),t.off(w.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(w.ERROR,this.onError,this),t.off(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(w.BUFFER_CREATED,this.onBufferCreated,this),t.off(w.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(w.FRAG_BUFFERED,this.onFragBuffered,this)},e.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},e.startLoad=function(t){if(this.levels){var r=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.nextAutoLevel),this.level=i.nextLoadLevel=s,this.loadedmetadata=!1}r>0&&t===-1&&(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r),this.state=Be,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=rt},e.stopLoad=function(){this._forceStartLoad=!1,l.prototype.stopLoad.call(this)},e.doTick=function(){switch(this.state){case hn:var t,r=this.levels,i=this.level,s=r==null||(t=r[i])==null?void 0:t.details;if(s&&(!s.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(s))break;this.state=Be;break}break;case ct:var d,c=self.performance.now(),f=this.retryDate;(!f||c>=f||(d=this.media)!=null&&d.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=Be)}this.state===Be&&this.doTickIdle(),this.onTickEnd()},e.onTickEnd=function(){l.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},e.doTickIdle=function(){var t=this.hls,r=this.levelLastLoaded,i=this.levels,s=this.media,d=t.config,c=t.nextLoadLevel;if(r!==null&&(s||!this.startFragRequested&&d.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&i!=null&&i[c]){var f=i[c],h=this.getMainFwdBufferInfo();if(h!==null){var m=this.getLevelDetails();if(m&&this._streamEnded(h,m)){var g={};return this.altAudio&&(g.type="video"),this.hls.trigger(w.BUFFER_EOS,g),void(this.state=Ni)}this.level=t.nextLoadLevel=c;var E=f.details;if(!E||this.state===hn||E.live&&this.levelLastLoaded!==c)return this.level=c,void(this.state=hn);var k=h.len,R=this.getMaxBufferLength(f.maxBitrate);if(!(k>=R)){this.backtrackFragment&&this.backtrackFragment.start>h.end&&(this.backtrackFragment=null);var D=this.backtrackFragment?this.backtrackFragment.start:h.end,A=this.getNextFragment(D,E);if(this.couldBacktrack&&!this.fragPrevious&&A&&A.sn!=="initSegment"&&this.fragmentTracker.getState(A)!==ie){var I,O=((I=this.backtrackFragment)!=null?I:A).sn-E.startSN,F=E.fragments[O-1];F&&A.cc===F.cc&&(A=F,this.fragmentTracker.removeFragment(F))}else this.backtrackFragment&&h.len&&(this.backtrackFragment=null);if(A&&this.isLoopLoading(A,D)){if(!A.gap){var q=this.audioOnly&&!this.altAudio?Re:st,Q=(q===st?this.videoBuffer:this.mediaBuffer)||this.media;Q&&this.afterBufferFlushed(Q,q,at)}A=this.getNextFragmentLoopLoading(A,E,h,at,R)}A&&(!A.initSegment||A.initSegment.data||this.bitrateTest||(A=A.initSegment),this.loadFragment(A,f,D))}}}},e.loadFragment=function(t,r,i){var s=this.fragmentTracker.getState(t);this.fragCurrent=t,s===P?t.sn==="initSegment"?this._loadInitSegment(t,r):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,r)):(this.startFragRequested=!0,l.prototype.loadFragment.call(this,t,r,i)):this.clearTrackerIfNeeded(t)},e.getAppendedFrag=function(t){var r=this.fragmentTracker.getAppendedFrag(t,at);return r&&"fragment"in r?r.fragment:r},e.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,at)},e.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},e.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},e.nextLevelSwitch=function(){var t=this.levels,r=this.media;if(r!=null&&r.readyState){var i,s=this.getAppendedFrag(r.currentTime);if(s&&s.start>1&&this.flushMainBuffer(0,s.start-1),!r.paused&&t){var d=t[this.hls.nextLoadLevel],c=this.fragLastKbps;i=c&&this.fragCurrent?this.fragCurrent.duration*d.maxBitrate/(1e3*c)+1:0}else i=0;var f=this.getBufferedFrag(r.currentTime+i);if(f){var h=this.followingBufferedFrag(f);if(h){this.abortCurrentFrag();var m=h.maxStartPTS?h.maxStartPTS:h.start,g=h.duration,E=Math.max(f.end,m+Math.min(Math.max(g-this.config.maxFragLookUpTolerance,.5*g),.75*g));this.flushMainBuffer(E,Number.POSITIVE_INFINITY)}}}},e.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&t.abortRequests(),this.state){case ii:case $t:case ct:case kr:case dn:this.state=Be}this.nextLoadPosition=this.getLoadPosition()},e.flushMainBuffer=function(t,r){l.prototype.flushMainBuffer.call(this,t,r,this.altAudio?"video":null)},e.onMediaAttached=function(t,r){l.prototype.onMediaAttached.call(this,t,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new xp(this.config,i,this.fragmentTracker,this.hls)},e.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),l.prototype.onMediaDetaching.call(this)},e.onMediaPlaying=function(){this.tick()},e.onMediaSeeked=function(){var t=this.media,r=t?t.currentTime:null;z(r)&&this.log("Media seeked to "+r.toFixed(3));var i=this.getMainFwdBufferInfo();i!==null&&i.len!==0?this.tick():this.warn('Main forward buffer length on "seeked" event '+(i?i.len:"empty")+")")},e.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(w.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},e.onManifestParsed=function(t,r){var i,s,d,c=!1,f=!1;r.levels.forEach(function(h){(i=h.audioCodec)&&(i.indexOf("mp4a.40.2")!==-1&&(c=!0),i.indexOf("mp4a.40.5")!==-1&&(f=!0))}),this.audioCodecSwitch=c&&f&&typeof((d=Eu())==null||(s=d.prototype)==null?void 0:s.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startFragRequested=!1},e.onLevelLoading=function(t,r){var i=this.levels;if(i&&this.state===Be){var s=i[r.level];(!s.details||s.details.live&&this.levelLastLoaded!==r.level||this.waitForCdnTuneIn(s.details))&&(this.state=hn)}},e.onLevelLoaded=function(t,r){var i,s=this.levels,d=r.level,c=r.details,f=c.totalduration;if(s){this.log("Level "+d+" loaded ["+c.startSN+","+c.endSN+"], cc ["+c.startCC+", "+c.endCC+"] duration:"+f);var h=this.fragCurrent;!h||this.state!==$t&&this.state!==ct||h.level!==r.level&&h.loader&&this.abortCurrentFrag();var m=s[d],g=0;if(c.live||(i=m.details)!=null&&i.live){if(c.fragments[0]||(c.deltaUpdateFailed=!0),c.deltaUpdateFailed)return;g=this.alignPlaylists(c,m.details)}if(m.details=c,this.levelLastLoaded=d,this.hls.trigger(w.LEVEL_UPDATED,{details:c,level:d}),this.state===hn){if(this.waitForCdnTuneIn(c))return;this.state=Be}this.startFragRequested?c.live&&this.synchronizeToLiveEdge(c):this.setStartPosition(c,g),this.tick()}else this.warn("Levels were reset while loading level "+d)},e._handleFragmentLoadProgress=function(t){var r,i=t.frag,s=t.part,d=t.payload,c=this.levels;if(c){var f=c[i.level],h=f.details;if(h){var m=f.videoCodec,g=h.PTSKnown||!h.live,E=(r=i.initSegment)==null?void 0:r.data,k=this._getAudioCodec(f),R=this.transmuxer=this.transmuxer||new Nu(this.hls,at,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),D=s?s.index:-1,A=D!==-1,I=new ze(i.level,i.sn,i.stats.chunkCount,d.byteLength,D,A),O=this.initPTS[i.cc];R.push(d,E,k,m,i,s,h.totalduration,g,I,O)}else this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},e.onAudioTrackSwitching=function(t,r){var i=this.altAudio;if(!r.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var s=this.fragCurrent;s&&(this.log("Switching to main audio track, cancel main fragment load"),s.abortRequests(),this.fragmentTracker.removeFragment(s)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var d=this.hls;i&&(d.trigger(w.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),d.trigger(w.AUDIO_TRACK_SWITCHED,r)}},e.onAudioTrackSwitched=function(t,r){var i=r.id,s=!!this.hls.audioTracks[i].url;if(s){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=s,this.tick()},e.onBufferCreated=function(t,r){var i,s,d=r.tracks,c=!1;for(var f in d){var h=d[f];if(h.id==="main"){if(s=f,i=h,f==="video"){var m=d[f];m&&(this.videoBuffer=m.buffer)}}else c=!0}c&&i?(this.log("Alternate track found, use "+s+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},e.onFragBuffered=function(t,r){var i=r.frag,s=r.part;if(!i||i.type===at){if(this.fragContextChanged(i))return this.warn("Fragment "+i.sn+(s?" p: "+s.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===dn&&(this.state=Be));var d=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}},e.onError=function(t,r){var i;if(r.fatal)this.state=cn;else switch(r.details){case W.FRAG_GAP:case W.FRAG_PARSING_ERROR:case W.FRAG_DECRYPT_ERROR:case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(at,r);break;case W.LEVEL_LOAD_ERROR:case W.LEVEL_LOAD_TIMEOUT:case W.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==hn||((i=r.context)==null?void 0:i.type)!==ti||(this.state=Be);break;case W.BUFFER_FULL_ERROR:if(!r.parent||r.parent!=="main")return;this.reduceLengthAndFlushBuffer(r)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case W.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},e.checkBuffer=function(){var t=this.media,r=this.gapController;if(t&&r&&t.readyState){if(this.loadedmetadata||!Ge.getBuffered(t).length){var i=this.state!==Be?this.fragCurrent:null;r.poll(this.lastCurrentTime,i)}this.lastCurrentTime=t.currentTime}},e.onFragLoadEmergencyAborted=function(){this.state=Be,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},e.onBufferFlushed=function(t,r){var i=r.type;if(i!==Re||this.audioOnly&&!this.altAudio){var s=(i===st?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(s,i,at)}},e.onLevelsUpdated=function(t,r){this.levels=r.levels},e.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},e.seekToStartPos=function(){var t=this.media;if(t){var r=t.currentTime,i=this.startPosition;if(i>=0&&r<i){if(t.seeking)return void this.log("could not seek to "+i+", already seeking at "+r);var s=Ge.getBuffered(t),d=(s.length?s.start(0):0)-i;d>0&&(d<this.config.maxBufferHole||d<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+d+" to match buffer start"),i+=d,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+r),t.currentTime=i}}},e._getAudioCodec=function(t){var r=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&r&&(this.log("Swapping audio codec"),r=r.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),r},e._loadBitrateTestFrag=function(t,r){var i=this;t.bitrateTest=!0,this._doFragLoad(t,r).then(function(s){var d=i.hls;if(s&&!i.fragContextChanged(t)){r.fragmentError=0,i.state=Be,i.startFragRequested=!1,i.bitrateTest=!1;var c=t.stats;c.parsing.start=c.parsing.end=c.buffering.start=c.buffering.end=self.performance.now(),d.trigger(w.FRAG_LOADED,s),t.bitrateTest=!1}})},e._handleTransmuxComplete=function(t){var r,i="main",s=this.hls,d=t.remuxResult,c=t.chunkMeta,f=this.getCurrentContext(c);if(!f)return this.warn("The loading context changed while buffering fragment "+c.sn+" of level "+c.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(c.level);var h=f.frag,m=f.part,g=f.level,E=d.video,k=d.text,R=d.id3,D=d.initSegment,A=g.details,I=this.altAudio?void 0:d.audio;if(this.fragContextChanged(h))this.fragmentTracker.removeFragment(h);else{if(this.state=kr,D){D.tracks&&(this._bufferInitSegment(g,D.tracks,h,c),s.trigger(w.FRAG_PARSING_INIT_SEGMENT,{frag:h,id:i,tracks:D.tracks}));var O=D.initPTS,F=D.timescale;z(O)&&(this.initPTS[h.cc]={baseTime:O,timescale:F},s.trigger(w.INIT_PTS_FOUND,{frag:h,id:i,initPTS:O,timescale:F}))}if(E&&d.independent!==!1){if(A){var q=E.startPTS,Q=E.endPTS,X=E.startDTS,oe=E.endDTS;if(m)m.elementaryStreams[E.type]={startPTS:q,endPTS:Q,startDTS:X,endDTS:oe};else if(E.firstKeyFrame&&E.independent&&c.id===1&&(this.couldBacktrack=!0),E.dropped&&E.independent){var J=this.getMainFwdBufferInfo();if((J?J.end:this.getLoadPosition())+this.config.maxBufferHole<(E.firstKeyFramePTS?E.firstKeyFramePTS:q)-this.config.maxBufferHole)return void this.backtrack(h);h.setElementaryStreamInfo(E.type,h.start,Q,h.start,oe,!0)}h.setElementaryStreamInfo(E.type,q,Q,X,oe),this.backtrackFragment&&(this.backtrackFragment=h),this.bufferFragmentData(E,h,m,c)}}else if(d.independent===!1)return void this.backtrack(h);if(I){var te=I.startPTS,fe=I.endPTS,de=I.startDTS,_e=I.endDTS;m&&(m.elementaryStreams[Re]={startPTS:te,endPTS:fe,startDTS:de,endDTS:_e}),h.setElementaryStreamInfo(Re,te,fe,de,_e),this.bufferFragmentData(I,h,m,c)}if(A&&R!=null&&(r=R.samples)!=null&&r.length){var Oe={id:i,frag:h,details:A,samples:R.samples};s.trigger(w.FRAG_PARSING_METADATA,Oe)}if(A&&k){var Se={id:i,frag:h,details:A,samples:k.samples};s.trigger(w.FRAG_PARSING_USERDATA,Se)}}},e._bufferInitSegment=function(t,r,i,s){var d=this;if(this.state===kr){this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&delete r.audio;var c=r.audio,f=r.video,h=r.audiovideo;if(c){var m=t.audioCodec,g=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(m&&(m=m.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),c.metadata.channelCount!==1&&g.indexOf("firefox")===-1&&(m="mp4a.40.5")),g.indexOf("android")!==-1&&c.container!=="audio/mpeg"&&(m="mp4a.40.2",this.log("Android: force audio codec to "+m)),t.audioCodec&&t.audioCodec!==m&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+m+'"'),c.levelCodec=m,c.id="main",this.log("Init audio buffer, container:"+c.container+", codecs[selected/level/parsed]=["+(m||"")+"/"+(t.audioCodec||"")+"/"+c.codec+"]")}f&&(f.levelCodec=t.videoCodec,f.id="main",this.log("Init video buffer, container:"+f.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+f.codec+"]")),h&&this.log("Init audiovideo buffer, container:"+h.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+h.codec+"]"),this.hls.trigger(w.BUFFER_CODECS,r),Object.keys(r).forEach(function(E){var k=r[E].initSegment;k!=null&&k.byteLength&&d.hls.trigger(w.BUFFER_APPENDING,{type:E,data:k,frag:i,part:null,chunkMeta:s,parent:i.type})}),this.tick()}},e.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,at)},e.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=Be},e.checkFragmentChanged=function(){var t=this.media,r=null;if(t&&t.readyState>1&&t.seeking===!1){var i=t.currentTime;if(Ge.isBuffered(t,i)?r=this.getAppendedFrag(i):Ge.isBuffered(t,i+.1)&&(r=this.getAppendedFrag(i+.1)),r){this.backtrackFragment=null;var s=this.fragPlaying,d=r.level;s&&r.sn===s.sn&&s.level===d&&r.urlId===s.urlId||(this.fragPlaying=r,this.hls.trigger(w.FRAG_CHANGED,{frag:r}),s&&s.level===d||this.hls.trigger(w.LEVEL_SWITCHED,{level:d}))}}},M(a,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var r=t.currentTime,i=this.currentFrag;if(i&&z(r)&&z(i.programDateTime)){var s=i.programDateTime+1e3*(r-i.start);return new Date(s)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),a}(Io),pn=function(){function l(e,t,r){t===void 0&&(t=0),r===void 0&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}var a=l.prototype;return a.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},a.getTotalWeight=function(){return this.totalWeight_},a.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},l}(),Pp=function(){function l(e,t,r,i){i===void 0&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new pn(e),this.fast_=new pn(t),this.defaultTTFB_=i,this.ttfb_=new pn(e)}var a=l.prototype;return a.update=function(e,t){var r=this.slow_,i=this.fast_,s=this.ttfb_;r.halfLife!==e&&(this.slow_=new pn(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new pn(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new pn(e,s.getEstimate(),s.getTotalWeight()))},a.sample=function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/r;this.fast_.sample(r,i),this.slow_.sample(r,i)},a.sampleTTFB=function(e){var t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))},a.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},a.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},a.destroy=function(){},l}(),Op=function(){function l(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new Pp(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var a=l.prototype;return a.registerListeners=function(){var e=this.hls;e.on(w.FRAG_LOADING,this.onFragLoading,this),e.on(w.FRAG_LOADED,this.onFragLoaded,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this),e.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(w.LEVEL_LOADED,this.onLevelLoaded,this)},a.unregisterListeners=function(){var e=this.hls;e.off(w.FRAG_LOADING,this.onFragLoading,this),e.off(w.FRAG_LOADED,this.onFragLoaded,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this),e.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(w.LEVEL_LOADED,this.onLevelLoaded,this)},a.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},a.onFragLoading=function(e,t){var r,i=t.frag;this.ignoreFragment(i)||(this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))},a.onLevelSwitching=function(e,t){this.clearTimer()},a.getTimeToLoadFrag=function(e,t,r,i){return e+r/t+(i?this.lastLevelLoadSec:0)},a.onLevelLoaded=function(e,t){var r=this.hls.config,i=t.stats,s=i.total,d=i.bwEstimate;z(s)&&z(d)&&(this.lastLevelLoadSec=8*s/d),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},a._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.autoLevelEnabled,s=r.media;if(e&&s){var d=performance.now(),c=t?t.stats:e.stats,f=t?t.duration:e.duration,h=d-c.loading.start;if(c.aborted||c.loaded&&c.loaded===c.total||e.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!s.paused&&s.playbackRate&&s.readyState){var m=r.mainForwardBufferInfo;if(m!==null){var g=this.bwEstimator.getEstimateTTFB(),E=Math.abs(s.playbackRate);if(!(h<=Math.max(g,f/(2*E)*1e3))){var k=m.len/E;if(!(k>=2*f/E)){var R=c.loading.first?c.loading.first-c.loading.start:-1,D=c.loaded&&R>-1,A=this.bwEstimator.getEstimate(),I=r.levels,O=r.minAutoLevel,F=I[e.level],q=c.total||Math.max(c.loaded,Math.round(f*F.maxBitrate/8)),Q=h-R;Q<1&&D&&(Q=Math.min(h,8*c.loaded/A));var X=D?1e3*c.loaded/Q:0,oe=X?(q-c.loaded)/X:8*q/A+g/1e3;if(!(oe<=k)){var J,te=X?8*X:A,fe=Number.POSITIVE_INFINITY;for(J=e.level-1;J>O;J--){var de=I[J].maxBitrate;if((fe=this.getTimeToLoadFrag(g/1e3,te,f*de,!I[J].details))<k)break}fe>=oe||fe>10*f||(r.nextLoadLevel=J,D?this.bwEstimator.sample(h-Math.min(g,R),c.loaded):this.bwEstimator.sampleTTFB(h),this.clearTimer(),H.warn("[abr] Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+` is loading too slowly;
      Time to underbuffer: `+k.toFixed(3)+` s
      Estimated load time for current fragment: `+oe.toFixed(3)+` s
      Estimated load time for down switch fragment: `+fe.toFixed(3)+` s
      TTFB estimate: `+R+`
      Current BW estimate: `+(z(A)?(A/1024).toFixed(3):"Unknown")+` Kb/s
      New BW estimate: `+(this.bwEstimator.getEstimate()/1024).toFixed(3)+` Kb/s
      Aborting and switching to level `+J),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),r.trigger(w.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:c}))}}}}}}},a.onFragLoaded=function(e,t){var r=t.frag,i=t.part,s=i?i.stats:r.stats;if(r.type===at&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var d=i?i.duration:r.duration,c=this.hls.levels[r.level],f=(c.loaded?c.loaded.bytes:0)+s.loaded,h=(c.loaded?c.loaded.duration:0)+d;c.loaded={bytes:f,duration:h},c.realBitrate=Math.round(8*f/h)}if(r.bitrateTest){var m={stats:s,frag:r,part:i,id:r.type};this.onFragBuffered(w.FRAG_BUFFERED,m),r.bitrateTest=!1}}},a.onFragBuffered=function(e,t){var r=t.frag,i=t.part,s=i!=null&&i.stats.loaded?i.stats:r.stats;if(!s.aborted&&!this.ignoreFragment(r)){var d=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(d,s.loaded),s.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=d/1e3:this.bitrateTestDelay=0}},a.ignoreFragment=function(e){return e.type!==at||e.sn==="initSegment"},a.clearTimer=function(){self.clearInterval(this.timer)},a.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.maxAutoLevel,s=r.config,d=r.minAutoLevel,c=r.media,f=t?t.duration:e?e.duration:0,h=c&&c.playbackRate!==0?Math.abs(c.playbackRate):1,m=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,g=r.mainForwardBufferInfo,E=(g?g.len:0)/h,k=this.findBestLevel(m,d,i,E,s.abrBandWidthFactor,s.abrBandWidthUpFactor);if(k>=0)return k;H.trace("[abr] "+(E?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var R=f?Math.min(f,s.maxStarvationDelay):s.maxStarvationDelay,D=s.abrBandWidthFactor,A=s.abrBandWidthUpFactor;if(!E){var I=this.bitrateTestDelay;I&&(R=(f?Math.min(f,s.maxLoadingDelay):s.maxLoadingDelay)-I,H.trace("[abr] bitrate test took "+Math.round(1e3*I)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*R)+" ms"),D=A=1)}return k=this.findBestLevel(m,d,i,E+R,D,A),Math.max(k,0)},a.findBestLevel=function(e,t,r,i,s,d){for(var c,f=this.fragCurrent,h=this.partCurrent,m=this.lastLoadedFragLevel,g=this.hls.levels,E=g[m],k=!(E==null||(c=E.details)==null||!c.live),R=E==null?void 0:E.codecSet,D=h?h.duration:f?f.duration:0,A=this.bwEstimator.getEstimateTTFB()/1e3,I=t,O=-1,F=r;F>=t;F--){var q=g[F];if(!q||R&&q.codecSet!==R)q&&(I=Math.min(F,I),O=Math.max(F,O));else{O!==-1&&H.trace("[abr] Skipped level(s) "+I+"-"+O+' with CODECS:"'+g[O].attrs.CODECS+'"; not compatible with "'+E.attrs.CODECS+'"');var Q=q.details,X=(h?Q==null?void 0:Q.partTarget:Q==null?void 0:Q.averagetargetduration)||D,oe=void 0;oe=F<=m?s*e:d*e;var J=g[F].maxBitrate,te=this.getTimeToLoadFrag(A,oe,J*X,Q===void 0);if(H.trace("[abr] level:"+F+" adjustedbw-bitrate:"+Math.round(oe-J)+" avgDuration:"+X.toFixed(1)+" maxFetchDuration:"+i.toFixed(1)+" fetchDuration:"+te.toFixed(1)),oe>J&&(te===0||!z(te)||k&&!this.bitrateTestDelay||te<i))return F}}return-1},M(l,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(e!==-1&&!t.canEstimate())return e;var r=this.getNextABRAutoLevel();return e!==-1&&this.hls.levels[r].loadError?e:(e!==-1&&(r=Math.min(e,r)),r)},set:function(e){this._nextAutoLevel=e}}]),l}(),Uu=function(){function l(){this.chunks=[],this.dataLength=0}var a=l.prototype;return a.push=function(e){this.chunks.push(e),this.dataLength+=e.length},a.flush=function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=t.length===1?t[0]:function(i,s){for(var d=new Uint8Array(s),c=0,f=0;f<i.length;f++){var h=i[f];d.set(h,c),c+=h.length}return d}(t,r),this.reset(),e):new Uint8Array(0)},a.reset=function(){this.chunks.length=0,this.dataLength=0},l}(),Fp=function(l){function a(t,r,i){var s;return(s=l.call(this,t,r,i,"[audio-stream-controller]")||this).videoBuffer=null,s.videoTrackCC=-1,s.waitingVideoCC=-1,s.bufferedTrack=null,s.switchingTrack=null,s.trackId=-1,s.waitingData=null,s.mainDetails=null,s.bufferFlushed=!1,s.cachedTrackLoadedData=null,s._registerListeners(),s}Y(a,l);var e=a.prototype;return e.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null},e._registerListeners=function(){var t=this.hls;t.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.LEVEL_LOADED,this.onLevelLoaded,this),t.on(w.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(w.ERROR,this.onError,this),t.on(w.BUFFER_RESET,this.onBufferReset,this),t.on(w.BUFFER_CREATED,this.onBufferCreated,this),t.on(w.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(w.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(w.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.LEVEL_LOADED,this.onLevelLoaded,this),t.off(w.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(w.ERROR,this.onError,this),t.off(w.BUFFER_RESET,this.onBufferReset,this),t.off(w.BUFFER_CREATED,this.onBufferCreated,this),t.off(w.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(w.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(w.FRAG_BUFFERED,this.onFragBuffered,this)},e.onInitPtsFound=function(t,r){var i=r.frag,s=r.id,d=r.initPTS,c=r.timescale;if(s==="main"){var f=i.cc;this.initPTS[i.cc]={baseTime:d,timescale:c},this.log("InitPTS for cc: "+f+" found from main: "+d),this.videoTrackCC=f,this.state===zn&&this.tick()}},e.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=rt);var r=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),r>0&&t===-1?(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r,this.state=Be):(this.loadedmetadata=!1,this.state=wr),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},e.doTick=function(){switch(this.state){case Be:this.doTickIdle();break;case wr:var t,r=this.levels,i=this.trackId,s=r==null||(t=r[i])==null?void 0:t.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=zn}break;case ct:var d,c=performance.now(),f=this.retryDate;(!f||c>=f||(d=this.media)!=null&&d.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Be);break;case zn:var h=this.waitingData;if(h){var m=h.frag,g=h.part,E=h.cache,k=h.complete;if(this.initPTS[m.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=$t;var R={frag:m,part:g,payload:E.flush(),networkDetails:null};this._handleFragmentLoadProgress(R),k&&l.prototype._handleFragmentLoadComplete.call(this,R)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+m.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var D=this.getLoadPosition(),A=Ge.bufferInfo(this.mediaBuffer,D,this.config.maxBufferHole);$n(A.end,this.config.maxFragLookUpTolerance,m)<0&&(this.log("Waiting fragment cc ("+m.cc+") @ "+m.start+" cancelled because another fragment at "+A.end+" is needed"),this.clearWaitingFragment())}}else this.state=Be}this.onTickEnd()},e.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Be)},e.resetLoadingState=function(){this.clearWaitingFragment(),l.prototype.resetLoadingState.call(this)},e.onTickEnd=function(){var t=this.media;t!=null&&t.readyState&&(this.lastCurrentTime=t.currentTime)},e.doTickIdle=function(){var t=this.hls,r=this.levels,i=this.media,s=this.trackId,d=t.config;if(r!=null&&r[s]&&(i||!this.startFragRequested&&d.startFragPrefetch)){var c=r[s],f=c.details;if(!f||f.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(f))this.state=wr;else{var h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,Re,Sr));var m=this.getFwdBufferInfo(h,Sr);if(m!==null){var g=!!this.switchingTrack;if(!g&&this._streamEnded(m,f))return t.trigger(w.BUFFER_EOS,{type:"audio"}),void(this.state=Ni);var E=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,at),k=m.len,R=this.getMaxBufferLength(E==null?void 0:E.len);if(!(k>=R)||g){var D=f.fragments[0].start,A=m.end;if(g&&i){var I=this.getLoadPosition();A=I,f.PTSKnown&&I<D&&(m.end>D||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=D+.05)}var O=this.getNextFragment(A,f),F=!1;if(O&&this.isLoopLoading(O,A)&&(F=!!O.gap,O=this.getNextFragmentLoopLoading(O,f,m,at,R)),O){var q=E&&O.start>E.end+f.targetduration;if(q||(E==null||!E.len)&&m.len){var Q=this.fragmentTracker.getBufferedFrag(O.start,at);if(Q===null||(F||(F=!!Q.gap||!!q&&E.len===0),q&&!F||F&&m.nextStart&&m.nextStart<Q.end))return}this.loadFragment(O,c,A)}else this.bufferFlushed=!0}}}}},e.getMaxBufferLength=function(t){var r=l.prototype.getMaxBufferLength.call(this);return t?Math.min(Math.max(r,t),this.config.maxMaxBufferLength):r},e.onMediaDetaching=function(){this.videoBuffer=null,l.prototype.onMediaDetaching.call(this)},e.onAudioTracksUpdated=function(t,r){var i=r.audioTracks;this.resetTransmuxer(),this.levels=i.map(function(s){return new nn(s)})},e.onAudioTrackSwitching=function(t,r){var i=!!r.url;this.trackId=r.id;var s=this.fragCurrent;s&&(s.abortRequests(),this.fragmentTracker.removeFragment(s)),this.resetLoadingState(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.switchingTrack=r,this.state=Be):(this.switchingTrack=null,this.bufferedTrack=r,this.state=rt),this.tick()},e.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.bufferedTrack=null,this.switchingTrack=null},e.onLevelLoaded=function(t,r){this.mainDetails=r.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(w.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},e.onAudioTrackLoaded=function(t,r){var i;if(this.mainDetails!=null){var s=this.levels,d=r.details,c=r.id;if(s){this.log("Track "+c+" loaded ["+d.startSN+","+d.endSN+"],duration:"+d.totalduration);var f=s[c],h=0;if(d.live||(i=f.details)!=null&&i.live){var m=this.mainDetails;if(d.fragments[0]||(d.deltaUpdateFailed=!0),d.deltaUpdateFailed||!m)return;!f.details&&d.hasProgramDateTime&&m.hasProgramDateTime?(je(d,m),h=d.fragments[0].start):h=this.alignPlaylists(d,f.details)}f.details=d,this.levelLastLoaded=c,this.startFragRequested||!this.mainDetails&&d.live||this.setStartPosition(f.details,h),this.state!==wr||this.waitForCdnTuneIn(d)||(this.state=Be),this.tick()}else this.warn("Audio tracks were reset while loading level "+c)}else this.cachedTrackLoadedData=r},e._handleFragmentLoadProgress=function(t){var r,i=t.frag,s=t.part,d=t.payload,c=this.config,f=this.trackId,h=this.levels;if(h){var m=h[f];if(m){var g=m.details;if(g){var E=c.defaultAudioCodec||m.audioCodec||"mp4a.40.2",k=this.transmuxer;k||(k=this.transmuxer=new Nu(this.hls,Sr,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var R=this.initPTS[i.cc],D=(r=i.initSegment)==null?void 0:r.data;if(R!==void 0){var A=s?s.index:-1,I=A!==-1,O=new ze(i.level,i.sn,i.stats.chunkCount,d.byteLength,A,I);k.push(d,D,E,"",i,s,g.totalduration,!1,O,R)}else this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+g.startSN+" ,"+g.endSN+"],track "+f),(this.waitingData=this.waitingData||{frag:i,part:s,cache:new Uu,complete:!1}).cache.push(new Uint8Array(d)),this.waitingVideoCC=this.videoTrackCC,this.state=zn}else this.warn("Audio track details undefined on fragment load progress")}else this.warn("Audio track is defined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},e._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:l.prototype._handleFragmentLoadComplete.call(this,t)},e.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},e.onBufferCreated=function(t,r){var i=r.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),r.tracks.video&&(this.videoBuffer=r.tracks.video.buffer||null)},e.onFragBuffered=function(t,r){var i,s=r.frag,d=r.part;if(s.type===Sr)if(this.fragContextChanged(s))this.warn("Fragment "+s.sn+(d?" p: "+d.index:"")+" of level "+s.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));else{if(s.sn!=="initSegment"){this.fragPrevious=s;var c=this.switchingTrack;c&&(this.bufferedTrack=c,this.switchingTrack=null,this.hls.trigger(w.AUDIO_TRACK_SWITCHED,L({},c)))}this.fragBufferedComplete(s,d)}else this.loadedmetadata||s.type!==at||(i=this.videoBuffer||this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)},e.onError=function(t,r){var i;if(r.fatal)this.state=cn;else switch(r.details){case W.FRAG_GAP:case W.FRAG_PARSING_ERROR:case W.FRAG_DECRYPT_ERROR:case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Sr,r);break;case W.AUDIO_TRACK_LOAD_ERROR:case W.AUDIO_TRACK_LOAD_TIMEOUT:case W.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==wr||((i=r.context)==null?void 0:i.type)!==dr||(this.state=Be);break;case W.BUFFER_FULL_ERROR:if(!r.parent||r.parent!=="audio")return;this.reduceLengthAndFlushBuffer(r)&&(this.bufferedTrack=null,l.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case W.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},e.onBufferFlushed=function(t,r){r.type===Re&&(this.bufferFlushed=!0,this.state===Ni&&(this.state=Be))},e._handleTransmuxComplete=function(t){var r,i="audio",s=this.hls,d=t.remuxResult,c=t.chunkMeta,f=this.getCurrentContext(c);if(!f)return this.warn("The loading context changed while buffering fragment "+c.sn+" of level "+c.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(c.level);var h=f.frag,m=f.part,g=f.level.details,E=d.audio,k=d.text,R=d.id3,D=d.initSegment;if(!this.fragContextChanged(h)&&g){if(this.state=kr,this.switchingTrack&&E&&this.completeAudioSwitch(this.switchingTrack),D!=null&&D.tracks&&(this._bufferInitSegment(D.tracks,h,c),s.trigger(w.FRAG_PARSING_INIT_SEGMENT,{frag:h,id:i,tracks:D.tracks})),E){var A=E.startPTS,I=E.endPTS,O=E.startDTS,F=E.endDTS;m&&(m.elementaryStreams[Re]={startPTS:A,endPTS:I,startDTS:O,endDTS:F}),h.setElementaryStreamInfo(Re,A,I,O,F),this.bufferFragmentData(E,h,m,c)}if(R!=null&&(r=R.samples)!=null&&r.length){var q=G({id:i,frag:h,details:g},R);s.trigger(w.FRAG_PARSING_METADATA,q)}if(k){var Q=G({id:i,frag:h,details:g},k);s.trigger(w.FRAG_PARSING_USERDATA,Q)}}else this.fragmentTracker.removeFragment(h)},e._bufferInitSegment=function(t,r,i){if(this.state===kr){t.video&&delete t.video;var s=t.audio;if(s){s.levelCodec=s.codec,s.id="audio",this.log("Init audio buffer, container:"+s.container+", codecs[parsed]=["+s.codec+"]"),this.hls.trigger(w.BUFFER_CODECS,t);var d=s.initSegment;if(d!=null&&d.byteLength){var c={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:d};this.hls.trigger(w.BUFFER_APPENDING,c)}this.tick()}}},e.loadFragment=function(t,r,i){var s,d=this.fragmentTracker.getState(t);this.fragCurrent=t,this.switchingTrack||d===P||d===K?t.sn==="initSegment"?this._loadInitSegment(t,r):(s=r.details)!=null&&s.live&&!this.initPTS[t.cc]?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=zn):(this.startFragRequested=!0,l.prototype.loadFragment.call(this,t,r,i)):this.clearTrackerIfNeeded(t)},e.completeAudioSwitch=function(t){var r=this.hls,i=this.media,s=this.bufferedTrack,d=s==null?void 0:s.attrs,c=t.attrs;i&&d&&(d.CHANNELS!==c.CHANNELS||d.NAME!==c.NAME||d.LANGUAGE!==c.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),l.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=t,this.switchingTrack=null,r.trigger(w.AUDIO_TRACK_SWITCHED,L({},t))},a}(Io),Np=function(l){function a(t){var r;return(r=l.call(this,t,"[audio-track-controller]")||this).tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.registerListeners(),r}Y(a,l);var e=a.prototype;return e.registerListeners=function(){var t=this.hls;t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.MANIFEST_PARSED,this.onManifestParsed,this),t.on(w.LEVEL_LOADING,this.onLevelLoading,this),t.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(w.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.MANIFEST_PARSED,this.onManifestParsed,this),t.off(w.LEVEL_LOADING,this.onLevelLoading,this),t.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(w.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,l.prototype.destroy.call(this)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},e.onManifestParsed=function(t,r){this.tracks=r.audioTracks||[]},e.onAudioTrackLoaded=function(t,r){var i=r.id,s=r.groupId,d=r.details,c=this.tracksInGroup[i];if(c&&c.groupId===s){var f=c.details;c.details=r.details,this.log("audio-track "+i+' "'+c.name+'" lang:'+c.lang+" group:"+s+" loaded ["+d.startSN+"-"+d.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,r,f)}else this.warn("Track with id:"+i+" and group:"+s+" not found in active group "+c.groupId)},e.onLevelLoading=function(t,r){this.switchLevel(r.level)},e.onLevelSwitching=function(t,r){this.switchLevel(r.level)},e.switchLevel=function(t){var r=this.hls.levels[t];if(r!=null&&r.audioGroupIds){var i=r.audioGroupIds[r.urlId];if(this.groupId!==i){this.groupId=i||null;var s=this.tracks.filter(function(c){return!i||c.groupId===i});this.selectDefaultTrack&&!s.some(function(c){return c.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=s;var d={audioTracks:s};this.log("Updating audio tracks, "+s.length+" track(s) found in group:"+i),this.hls.trigger(w.AUDIO_TRACKS_UPDATED,d),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}},e.onError=function(t,r){!r.fatal&&r.context&&r.context.type===dr&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(r))},e.setAudioTrack=function(t){var r=this.tracksInGroup;if(t<0||t>=r.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var i=this.currentTrack,s=r[t],d=s.groupId,c=s.name;if(this.log("Switching to audio-track "+t+' "'+c+'" lang:'+s.lang+" group:"+d),this.trackId=t,this.currentTrack=s,this.selectDefaultTrack=!1,this.hls.trigger(w.AUDIO_TRACK_SWITCHING,L({},s)),!s.details||s.details.live){var f=this.switchParams(s.url,i==null?void 0:i.details);this.loadPlaylist(f)}}},e.selectInitialTrack=function(){var t=this.tracksInGroup,r=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(r!==-1)this.setAudioTrack(r);else{var i=new Error("No track found for running audio group-ID: "+this.groupId+" track count: "+t.length);this.warn(i.message),this.hls.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:i})}},e.findTrackId=function(t){for(var r=this.tracksInGroup,i=0;i<r.length;i++){var s=r[i];if((!this.selectDefaultTrack||s.default)&&(!t||t.attrs["STABLE-RENDITION-ID"]===s.attrs["STABLE-RENDITION-ID"]||t.name===s.name&&t.lang===s.lang))return s.id}return-1},e.loadPlaylist=function(t){l.prototype.loadPlaylist.call(this);var r=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(r)){var i=r.id,s=r.groupId,d=r.url;if(t)try{d=t.addDirectives(d)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("loading audio-track playlist "+i+' "'+r.name+'" lang:'+r.lang+" group:"+s),this.clearTimer(),this.hls.trigger(w.AUDIO_TRACK_LOADING,{url:d,id:i,groupId:s,deliveryDirectives:t||null})}},M(a,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}]),a}(_),Up=function(l){function a(t,r,i){var s;return(s=l.call(this,t,r,i,"[subtitle-stream-controller]")||this).levels=[],s.currentTrackId=-1,s.tracksBuffered=[],s.mainDetails=null,s._registerListeners(),s}Y(a,l);var e=a.prototype;return e.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},e._registerListeners=function(){var t=this.hls;t.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.LEVEL_LOADED,this.onLevelLoaded,this),t.on(w.ERROR,this.onError,this),t.on(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(w.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(w.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.LEVEL_LOADED,this.onLevelLoaded,this),t.off(w.ERROR,this.onError,this),t.off(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(w.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(w.FRAG_BUFFERED,this.onFragBuffered,this)},e.startLoad=function(t){this.stopLoad(),this.state=Be,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},e.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},e.onMediaDetaching=function(){this.tracksBuffered=[],l.prototype.onMediaDetaching.call(this)},e.onLevelLoaded=function(t,r){this.mainDetails=r.details},e.onSubtitleFragProcessed=function(t,r){var i=r.frag,s=r.success;if(this.fragPrevious=i,this.state=Be,s){var d=this.tracksBuffered[this.currentTrackId];if(d){for(var c,f=i.start,h=0;h<d.length;h++)if(f>=d[h].start&&f<=d[h].end){c=d[h];break}var m=i.start+i.duration;c?c.end=m:(c={start:f,end:m},d.push(c)),this.fragmentTracker.fragBuffered(i)}}},e.onBufferFlushing=function(t,r){var i=r.startOffset,s=r.endOffset;if(i===0&&s!==Number.POSITIVE_INFINITY){var d=this.currentTrackId,c=this.levels;if(!c.length||!c[d]||!c[d].details)return;var f=s-c[d].details.targetduration;if(f<=0)return;r.endOffsetSubtitles=Math.max(0,f),this.tracksBuffered.forEach(function(h){for(var m=0;m<h.length;)if(h[m].end<=f)h.shift();else{if(!(h[m].start<f))break;h[m].start=f,m++}}),this.fragmentTracker.removeFragmentsInRange(i,f,Ar)}},e.onFragBuffered=function(t,r){var i;this.loadedmetadata||r.frag.type!==at||(i=this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)},e.onError=function(t,r){var i=r.frag;(i==null?void 0:i.type)===Ar&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==rt&&(this.state=Be))},e.onSubtitleTracksUpdated=function(t,r){var i=this,s=r.subtitleTracks;this.tracksBuffered=[],this.levels=s.map(function(d){return new nn(d)}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ar),this.fragPrevious=null,this.levels.forEach(function(d){i.tracksBuffered[d.id]=[]}),this.mediaBuffer=null},e.onSubtitleTrackSwitch=function(t,r){if(this.currentTrackId=r.id,this.levels.length&&this.currentTrackId!==-1){var i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(500)}else this.clearInterval()},e.onSubtitleTrackLoaded=function(t,r){var i,s=r.details,d=r.id,c=this.currentTrackId,f=this.levels;if(f.length){var h=f[c];if(!(d>=f.length||d!==c)&&h){this.mediaBuffer=this.mediaBufferTimeRanges;var m=0;if(s.live||(i=h.details)!=null&&i.live){var g=this.mainDetails;if(s.deltaUpdateFailed||!g)return;var E=g.fragments[0];h.details?(m=this.alignPlaylists(s,h.details))===0&&E&&jn(s,m=E.start):s.hasProgramDateTime&&g.hasProgramDateTime?(je(s,g),m=s.fragments[0].start):E&&jn(s,m=E.start)}h.details=s,this.levelLastLoaded=d,this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(h.details,m),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===Be&&(Fi(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0))}}},e._handleFragmentLoadComplete=function(t){var r=this,i=t.frag,s=t.payload,d=i.decryptdata,c=this.hls;if(!this.fragContextChanged(i)&&s&&s.byteLength>0&&d&&d.key&&d.iv&&d.method==="AES-128"){var f=performance.now();this.decrypter.decrypt(new Uint8Array(s),d.key.buffer,d.iv.buffer).catch(function(h){throw c.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.FRAG_DECRYPT_ERROR,fatal:!1,error:h,reason:h.message,frag:i}),h}).then(function(h){var m=performance.now();c.trigger(w.FRAG_DECRYPTED,{frag:i,payload:h,stats:{tstart:f,tdecrypt:m}})}).catch(function(h){r.warn(h.name+": "+h.message),r.state=Be})}},e.doTick=function(){if(this.media){if(this.state===Be){var t=this.currentTrackId,r=this.levels,i=r[t];if(!r.length||!i||!i.details)return;var s=i.details,d=s.targetduration,c=this.config,f=this.getLoadPosition(),h=Ge.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],f-d,c.maxBufferHole),m=h.end,g=h.len,E=this.getFwdBufferInfo(this.media,at);if(g>this.getMaxBufferLength(E==null?void 0:E.len)+d)return;var k=s.fragments,R=k.length,D=s.edge,A=null,I=this.fragPrevious;if(m<D){var O=c.maxFragLookUpTolerance;!(A=Fi(I,k,Math.max(k[0].start,m),O))&&I&&I.start<k[0].start&&(A=k[0])}else A=k[R-1];if(!A)return;A=this.mapToInitFragWhenRequired(A),this.fragmentTracker.getState(A)===P&&this.loadFragment(A,i,m)}}else this.state=Be},e.getMaxBufferLength=function(t){var r=l.prototype.getMaxBufferLength.call(this);return t?Math.max(r,t):r},e.loadFragment=function(t,r,i){this.fragCurrent=t,t.sn==="initSegment"?this._loadInitSegment(t,r):(this.startFragRequested=!0,l.prototype.loadFragment.call(this,t,r,i))},M(a,[{key:"mediaBufferTimeRanges",get:function(){return new Bp(this.tracksBuffered[this.currentTrackId]||[])}}]),a}(Io),Bp=function(l){this.buffered=void 0;var a=function(e,t,r){if((t>>>=0)>r-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+r+")");return l[t][e]};this.buffered={get length(){return l.length},end:function(e){return a("end",e,l.length)},start:function(e){return a("start",e,l.length)}}},Gp=function(l){function a(t){var r;return(r=l.call(this,t,"[subtitle-track-controller]")||this).media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.registerListeners(),r}Y(a,l);var e=a.prototype;return e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,l.prototype.destroy.call(this)},e.registerListeners=function(){var t=this.hls;t.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.MANIFEST_PARSED,this.onManifestParsed,this),t.on(w.LEVEL_LOADING,this.onLevelLoading,this),t.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(w.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.MANIFEST_PARSED,this.onManifestParsed,this),t.off(w.LEVEL_LOADING,this.onLevelLoading,this),t.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(w.ERROR,this.onError,this)},e.onMediaAttached=function(t,r){this.media=r.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},e.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},e.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Ko(this.media.textTracks).forEach(function(t){mi(t)}),this.subtitleTrack=-1,this.media=null)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},e.onManifestParsed=function(t,r){this.tracks=r.subtitleTracks},e.onSubtitleTrackLoaded=function(t,r){var i=r.id,s=r.details,d=this.trackId,c=this.tracksInGroup[d];if(c){var f=c.details;c.details=r.details,this.log("subtitle track "+i+" loaded ["+s.startSN+"-"+s.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,r,f)}else this.warn("Invalid subtitle track id "+i)},e.onLevelLoading=function(t,r){this.switchLevel(r.level)},e.onLevelSwitching=function(t,r){this.switchLevel(r.level)},e.switchLevel=function(t){var r=this.hls.levels[t];if(r!=null&&r.textGroupIds){var i=r.textGroupIds[r.urlId],s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){var d=this.tracks.filter(function(h){return!i||h.groupId===i});this.tracksInGroup=d;var c=this.findTrackId(s==null?void 0:s.name)||this.findTrackId();this.groupId=i||null;var f={subtitleTracks:d};this.log("Updating subtitle tracks, "+d.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(w.SUBTITLE_TRACKS_UPDATED,f),c!==-1&&this.setSubtitleTrack(c,s)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId,s)}},e.findTrackId=function(t){for(var r=this.tracksInGroup,i=0;i<r.length;i++){var s=r[i];if((!this.selectDefaultTrack||s.default)&&(!t||t===s.name))return s.id}return-1},e.onError=function(t,r){!r.fatal&&r.context&&r.context.type===cr&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.checkRetry(r)},e.loadPlaylist=function(t){l.prototype.loadPlaylist.call(this);var r=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(r)){var i=r.id,s=r.groupId,d=r.url;if(t)try{d=t.addDirectives(d)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(w.SUBTITLE_TRACK_LOADING,{url:d,id:i,groupId:s,deliveryDirectives:t||null})}},e.toggleTrackModes=function(t){var r=this,i=this.media,s=this.trackId;if(i){var d=Ko(i.textTracks),c=d.filter(function(m){return m.groupId===r.groupId});if(t===-1)[].slice.call(d).forEach(function(m){m.mode="disabled"});else{var f=c[s];f&&(f.mode="disabled")}var h=c[t];h&&(h.mode=this.subtitleDisplay?"showing":"hidden")}},e.setSubtitleTrack=function(t,r){var i,s=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(i=s[t])!=null&&i.details)||t<-1||t>=s.length)){this.clearTimer();var d=s[t];if(this.log("Switching to subtitle-track "+t+(d?' "'+d.name+'" lang:'+d.lang+" group:"+d.groupId:"")),this.trackId=t,d){var c=d.id,f=d.groupId,h=f===void 0?"":f,m=d.name,g=d.type,E=d.url;this.hls.trigger(w.SUBTITLE_TRACK_SWITCH,{id:c,groupId:h,name:m,type:g,url:E});var k=this.switchParams(d.url,r==null?void 0:r.details);this.loadPlaylist(k)}else this.hls.trigger(w.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},e.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,r=Ko(this.media.textTracks),i=0;i<r.length;i++)if(r[i].mode==="hidden")t=i;else if(r[i].mode==="showing"){t=i;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},M(a,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,r)}}]),a}(_);function Ko(l){for(var a=[],e=0;e<l.length;e++){var t=l[e];t.kind!=="subtitles"&&t.kind!=="captions"||!t.label||a.push(l[e])}return a}var Hp=function(){function l(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var a=l.prototype;return a.append=function(e,t){var r=this.queues[t];r.push(e),r.length===1&&this.buffers[t]&&this.executeNext(t)},a.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},a.appendBlocker=function(e){var t,r=new Promise(function(s){t=s}),i={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,e),r},a.executeNext=function(e){var t=this.buffers,r=this.queues,i=t[e],s=r[e];if(s.length){var d=s[0];try{d.execute()}catch(c){H.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),d.onError(c),i!=null&&i.updating||(s.shift(),this.executeNext(e))}}},a.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},a.current=function(e){return this.queues[e][0]},l}(),Bu=Lo(),Gu=/([ha]vc.)(?:\.[^.,]+)+/,Vp=function(){function l(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=t.media,i=t.mediaSource;H.log("[buffer-controller]: Media source opened"),r&&(r.removeEventListener("emptied",t._onMediaEmptied),t.updateMediaElementDuration(),t.hls.trigger(w.MEDIA_ATTACHED,{media:r})),i&&i.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){H.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){H.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var r=t.media,i=t._objectUrl;r&&r.src!==i&&H.error("Media element src was set while attaching MediaSource ("+i+" > "+r.src+")")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var a=l.prototype;return a.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},a.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},a.registerListeners=function(){var e=this.hls;e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.BUFFER_RESET,this.onBufferReset,this),e.on(w.BUFFER_APPENDING,this.onBufferAppending,this),e.on(w.BUFFER_CODECS,this.onBufferCodecs,this),e.on(w.BUFFER_EOS,this.onBufferEos,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(w.FRAG_PARSED,this.onFragParsed,this),e.on(w.FRAG_CHANGED,this.onFragChanged,this)},a.unregisterListeners=function(){var e=this.hls;e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.BUFFER_RESET,this.onBufferReset,this),e.off(w.BUFFER_APPENDING,this.onBufferAppending,this),e.off(w.BUFFER_CODECS,this.onBufferCodecs,this),e.off(w.BUFFER_EOS,this.onBufferEos,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(w.FRAG_PARSED,this.onFragParsed,this),e.off(w.FRAG_CHANGED,this.onFragChanged,this)},a._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Hp(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},a.onManifestParsed=function(e,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,H.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},a.onMediaAttaching=function(e,t){var r=this.media=t.media;if(r&&Bu){var i=this.mediaSource=new Bu;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}},a.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(H.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(i){H.warn("[buffer-controller]: onMediaDetaching: "+i.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):H.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(w.MEDIA_DETACHED,void 0)},a.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var r=e.sourceBuffer[t];try{r&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[t]=void 0)}catch(i){H.warn("[buffer-controller]: Failed to reset the "+t+" buffer",i)}}),this._initSourceBuffer()},a.onBufferCodecs=function(e,t){var r=this,i=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(s){if(i){var d=r.tracks[s];if(d&&typeof d.buffer.changeType=="function"){var c=t[s],f=c.id,h=c.codec,m=c.levelCodec,g=c.container,E=c.metadata,k=(d.levelCodec||d.codec).replace(Gu,"$1"),R=(m||h).replace(Gu,"$1");if(k!==R){var D=g+";codecs="+(m||h);r.appendChangeType(s,D),H.log("[buffer-controller]: switching codec "+k+" to "+R),r.tracks[s]={buffer:d.buffer,codec:h,container:g,levelCodec:m,metadata:E,id:f}}}}else r.pendingTracks[s]=t[s]}),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},a.appendChangeType=function(e,t){var r=this,i=this.operationQueue,s={execute:function(){var d=r.sourceBuffer[e];d&&(H.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),d.changeType(t)),i.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(d){H.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",d)}};i.append(s,e)},a.onBufferAppending=function(e,t){var r=this,i=this.hls,s=this.operationQueue,d=this.tracks,c=t.data,f=t.type,h=t.frag,m=t.part,g=t.chunkMeta,E=g.buffering[f],k=self.performance.now();E.start=k;var R=h.stats.buffering,D=m?m.stats.buffering:null;R.start===0&&(R.start=k),D&&D.start===0&&(D.start=k);var A=d.audio,I=!1;f==="audio"&&(A==null?void 0:A.container)==="audio/mpeg"&&(I=!this.lastMpegAudioChunk||g.id===1||this.lastMpegAudioChunk.sn!==g.sn,this.lastMpegAudioChunk=g);var O=h.start,F={execute:function(){if(E.executeStart=self.performance.now(),I){var q=r.sourceBuffer[f];if(q){var Q=O-q.timestampOffset;Math.abs(Q)>=.1&&(H.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+O+" (delta: "+Q+") sn: "+h.sn+")"),q.timestampOffset=O)}}r.appendExecutor(c,f)},onStart:function(){},onComplete:function(){var q=self.performance.now();E.executeEnd=E.end=q,R.first===0&&(R.first=q),D&&D.first===0&&(D.first=q);var Q=r.sourceBuffer,X={};for(var oe in Q)X[oe]=Ge.getBuffered(Q[oe]);r.appendError=0,r.hls.trigger(w.BUFFER_APPENDED,{type:f,frag:h,part:m,chunkMeta:g,parent:h.type,timeRanges:X})},onError:function(q){H.error("[buffer-controller]: Error encountered while trying to append to the "+f+" SourceBuffer",q);var Q={type:se.MEDIA_ERROR,parent:h.type,details:W.BUFFER_APPEND_ERROR,frag:h,part:m,chunkMeta:g,error:q,err:q,fatal:!1};q.code===DOMException.QUOTA_EXCEEDED_ERR?Q.details=W.BUFFER_FULL_ERROR:(r.appendError++,Q.details=W.BUFFER_APPEND_ERROR,r.appendError>i.config.appendErrorMaxRetry&&(H.error("[buffer-controller]: Failed "+i.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),Q.fatal=!0)),i.trigger(w.ERROR,Q)}};s.append(F,f)},a.onBufferFlushing=function(e,t){var r=this,i=this.operationQueue,s=function(d){return{execute:r.removeExecutor.bind(r,d,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(w.BUFFER_FLUSHED,{type:d})},onError:function(c){H.warn("[buffer-controller]: Failed to remove from "+d+" SourceBuffer",c)}}};t.type?i.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(function(d){i.append(s(d),d)})},a.onFragParsed=function(e,t){var r=this,i=t.frag,s=t.part,d=[],c=s?s.elementaryStreams:i.elementaryStreams;c[Kt]?d.push("audiovideo"):(c[Re]&&d.push("audio"),c[st]&&d.push("video")),d.length===0&&H.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers(function(){var f=self.performance.now();i.stats.buffering.end=f,s&&(s.stats.buffering.end=f);var h=s?s.stats:i.stats;r.hls.trigger(w.FRAG_BUFFERED,{frag:i,part:s,stats:h,id:i.type})},d)},a.onFragChanged=function(e,t){this.flushBackBuffer()},a.onBufferEos=function(e,t){var r=this;this.getSourceBufferTypes().reduce(function(i,s){var d=r.sourceBuffer[s];return!d||t.type&&t.type!==s||(d.ending=!0,d.ended||(d.ended=!0,H.log("[buffer-controller]: "+s+" sourceBuffer now EOS"))),i&&!(d&&!d.ended)},!0)&&(H.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){r.getSourceBufferTypes().forEach(function(s){var d=r.sourceBuffer[s];d&&(d.ending=!1)});var i=r.mediaSource;i&&i.readyState==="open"?(H.log("[buffer-controller]: Calling mediaSource.endOfStream()"),i.endOfStream()):i&&H.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+i.readyState)}))},a.onLevelUpdated=function(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},a.flushBackBuffer=function(){var e=this.hls,t=this.details,r=this.media,i=this.sourceBuffer;if(r&&t!==null){var s=this.getSourceBufferTypes();if(s.length){var d=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(z(d)&&!(d<0)){var c=r.currentTime,f=t.levelTargetDuration,h=Math.max(d,f),m=Math.floor(c/f)*f-h;s.forEach(function(g){var E=i[g];if(E){var k=Ge.getBuffered(E);if(k.length>0&&m>k.start(0)){if(e.trigger(w.BACK_BUFFER_REACHED,{bufferEnd:m}),t.live)e.trigger(w.LIVE_BACK_BUFFER_REACHED,{bufferEnd:m});else if(E.ended&&k.end(k.length-1)-c<2*f)return void H.info("[buffer-controller]: Cannot flush "+g+" back buffer while SourceBuffer is in ended state");e.trigger(w.BUFFER_FLUSHING,{startOffset:0,endOffset:m,type:g})}}})}}}},a.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,t=this.hls,r=this.media,i=this.mediaSource,s=e.fragments[0].start+e.totalduration,d=r.duration,c=z(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(H.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(e)):(s>c&&s>d||!z(d))&&(H.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),i.duration=s)}},a.updateSeekableRange=function(e){var t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&t!=null&&t.setLiveSeekableRange){var i=Math.max(0,r[0].start),s=Math.max(i,i+e.totalduration);t.setLiveSeekableRange(i,s)}},a.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;if(i&&!e||i===2){this.createSourceBuffers(r),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length)this.hls.trigger(w.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(function(c){t.executeNext(c)});else{var d=new Error("could not create source buffer for media codec(s)");this.hls.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:d,reason:d.message})}}},a.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(var i in e)if(!t[i]){var s=e[i];if(!s)throw Error("source buffer exists for track "+i+", however track does not");var d=s.levelCodec||s.codec,c=s.container+";codecs="+d;H.log("[buffer-controller]: creating sourceBuffer("+c+")");try{var f=t[i]=r.addSourceBuffer(c),h=i;this.addBufferListener(h,"updatestart",this._onSBUpdateStart),this.addBufferListener(h,"updateend",this._onSBUpdateEnd),this.addBufferListener(h,"error",this._onSBUpdateError),this.tracks[i]={buffer:f,codec:d,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id}}catch(m){H.error("[buffer-controller]: error while trying to add sourceBuffer: "+m.message),this.hls.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,mimeType:c})}}},a._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},a._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},a._onSBUpdateError=function(e,t){var r=new Error(e+" SourceBuffer error");H.error("[buffer-controller]: "+r,t),this.hls.trigger(w.ERROR,{type:se.MEDIA_ERROR,details:W.BUFFER_APPENDING_ERROR,error:r,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},a.removeExecutor=function(e,t,r){var i=this.media,s=this.mediaSource,d=this.operationQueue,c=this.sourceBuffer[e];if(!i||!s||!c)return H.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void d.shiftAndExecuteNext(e);var f=z(i.duration)?i.duration:1/0,h=z(s.duration)?s.duration:1/0,m=Math.max(0,t),g=Math.min(r,f,h);g>m&&!c.ending?(c.ended=!1,H.log("[buffer-controller]: Removing ["+m+","+g+"] from the "+e+" SourceBuffer"),c.remove(m,g)):d.shiftAndExecuteNext(e)},a.appendExecutor=function(e,t){var r=this.operationQueue,i=this.sourceBuffer[t];if(!i)return H.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t);i.ended=!1,i.appendBuffer(e)},a.blockBuffers=function(e,t){var r=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length)return H.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var i=this.operationQueue,s=t.map(function(d){return i.appendBlocker(d)});Promise.all(s).then(function(){e(),t.forEach(function(d){var c=r.sourceBuffer[d];c!=null&&c.updating||i.shiftAndExecuteNext(d)})})},a.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},a.addBufferListener=function(e,t,r){var i=this.sourceBuffer[e];if(i){var s=r.bind(this,e);this.listeners[e].push({event:t,listener:s}),i.addEventListener(t,s)}},a.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(r){t.removeEventListener(r.event,r.listener)})},l}(),Hu={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Vu=function(l){var a=l;return Hu.hasOwnProperty(l)&&(a=Hu[l]),String.fromCharCode(a)},Bi=15,ai=100,Kp={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},qp={17:2,18:4,21:6,22:8,23:10,19:13,20:15},jp={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Wp={25:2,26:4,29:6,30:8,31:10,27:13,28:15},$p=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Yp=function(){function l(){this.time=null,this.verboseLevel=0}return l.prototype.log=function(a,e){if(this.verboseLevel>=a){var t=typeof e=="function"?e():e;H.log(this.time+" ["+a+"] "+t)}},l}(),Gi=function(l){for(var a=[],e=0;e<l.length;e++)a.push(l[e].toString(16));return a},Ku=function(){function l(e,t,r,i,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=i||"black",this.flash=s||!1}var a=l.prototype;return a.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}},a.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},a.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},a.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},a.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},l}(),zp=function(){function l(e,t,r,i,s,d){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Ku(t,r,i,s,d)}var a=l.prototype;return a.reset=function(){this.uchar=" ",this.penState.reset()},a.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},a.setPenState=function(e){this.penState.copy(e)},a.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},a.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},a.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},l}(),Qp=function(){function l(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<ai;t++)this.chars.push(new zp);this.logger=e,this.pos=0,this.currPenState=new Ku}var a=l.prototype;return a.equals=function(e){for(var t=!0,r=0;r<ai;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},a.copy=function(e){for(var t=0;t<ai;t++)this.chars[t].copy(e.chars[t])},a.isEmpty=function(){for(var e=!0,t=0;t<ai;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},a.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ai&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ai)},a.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},a.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.insertChar=function(e){var t=this;e>=144&&this.backSpace();var r=Vu(e);this.pos>=ai?this.logger.log(0,function(){return"Cannot insert "+e.toString(16)+" ("+r+") at position "+t.pos+". Skipping it!"}):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))},a.clearFromPos=function(e){var t;for(t=e;t<ai;t++)this.chars[t].reset()},a.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.getTextString=function(){for(var e=[],t=!0,r=0;r<ai;r++){var i=this.chars[r].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")},a.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},l}(),qo=function(){function l(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<Bi;t++)this.rows.push(new Qp(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var a=l.prototype;return a.reset=function(){for(var e=0;e<Bi;e++)this.rows[e].clear();this.currRow=14},a.equals=function(e){for(var t=!0,r=0;r<Bi;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},a.copy=function(e){for(var t=0;t<Bi;t++)this.rows[t].copy(e.rows[t])},a.isEmpty=function(){for(var e=!0,t=0;t<Bi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},a.backSpace=function(){this.rows[this.currRow].backSpace()},a.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},a.insertChar=function(e){this.rows[this.currRow].insertChar(e)},a.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},a.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},a.setCursor=function(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},a.setPAC=function(e){this.logger.log(2,function(){return"pacData = "+JSON.stringify(e)});var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<Bi;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var d=s.rows[i].cueStartTime,c=this.logger.time;if(d&&c!==null&&d<c)for(var f=0;f<this.nrRollUpRows;f++)this.rows[t-this.nrRollUpRows+f+1].copy(s.rows[i+f])}}this.currRow=t;var h=this.rows[this.currRow];if(e.indent!==null){var m=e.indent,g=Math.max(m-1,0);h.setCursor(e.indent),e.color=h.chars[g].penState.foreground}var E={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(E)},a.setBkgData=function(e){this.logger.log(2,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},a.setRollUpRows=function(e){this.nrRollUpRows=e},a.rollUp=function(){var e=this;if(this.nrRollUpRows!==null){this.logger.log(1,function(){return e.getDisplayText()});var t=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(t,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")},a.getDisplayText=function(e){e=e||!1;for(var t=[],r="",i=-1,s=0;s<Bi;s++){var d=this.rows[s].getTextString();d&&(i=s+1,e?t.push("Row "+i+": '"+d+"'"):t.push(d.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join(`
`)),r},a.getTextAndFormat=function(){return this.rows},l}(),qu=function(){function l(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new qo(r),this.nonDisplayedMemory=new qo(r),this.lastOutputScreen=new qo(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var a=l.prototype;return a.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},a.getHandler=function(){return this.outputFilter},a.setHandler=function(e){this.outputFilter=e},a.setPAC=function(e){this.writeScreen.setPAC(e)},a.setBkgData=function(e){this.writeScreen.setBkgData(e)},a.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(2,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},a.insertChars=function(e){for(var t=this,r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return i+": "+t.writeScreen.getDisplayText(!0)}),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(1,function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},a.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.ccBS=function(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.ccAOF=function(){},a.ccAON=function(){},a.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.ccRU=function(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},a.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},a.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},a.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.ccEOC=function(){var e=this;if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},a.ccTO=function(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},a.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},a.outputDataUpdate=function(e){e===void 0&&(e=!1);var t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},a.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},l}(),ju=function(){function l(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new Yp;this.channels=[null,new qu(e,t,i),new qu(e+1,r,i)],this.cmdHistory={a:null,b:null},this.logger=i}var a=l.prototype;return a.getHandler=function(e){return this.channels[e].getHandler()},a.setHandler=function(e,t){this.channels[e].setHandler(t)},a.addData=function(e,t){var r,i,s,d=!1;this.logger.time=e;for(var c=0;c<t.length;c+=2)if(i=127&t[c],s=127&t[c+1],i!==0||s!==0){if(this.logger.log(3,"["+Gi([t[c],t[c+1]])+"] -> ("+Gi([i,s])+")"),(r=this.parseCmd(i,s))||(r=this.parseMidrow(i,s)),r||(r=this.parsePAC(i,s)),r||(r=this.parseBackgroundAttributes(i,s)),!r&&(d=this.parseChars(i,s))){var f=this.currentChannel;f&&f>0?this.channels[f].insertChars(d):this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||d||this.logger.log(2,"Couldn't parse cleaned data "+Gi([i,s])+" orig: "+Gi([t[c],t[c+1]]))}},a.parseCmd=function(e,t){var r=this.cmdHistory;if(!((e===20||e===28||e===21||e===29)&&t>=32&&t<=47||(e===23||e===31)&&t>=33&&t<=35))return!1;if(Wu(e,t,r))return mn(null,null,r),this.logger.log(3,"Repeated command ("+Gi([e,t])+") is dropped"),!0;var i=e===20||e===21||e===23?1:2,s=this.channels[i];return e===20||e===21||e===28||e===29?t===32?s.ccRCL():t===33?s.ccBS():t===34?s.ccAOF():t===35?s.ccAON():t===36?s.ccDER():t===37?s.ccRU(2):t===38?s.ccRU(3):t===39?s.ccRU(4):t===40?s.ccFON():t===41?s.ccRDC():t===42?s.ccTR():t===43?s.ccRTD():t===44?s.ccEDM():t===45?s.ccCR():t===46?s.ccENM():t===47&&s.ccEOC():s.ccTO(t-32),mn(e,t,r),this.currentChannel=i,!0},a.parseMidrow=function(e,t){var r=0;if((e===17||e===25)&&t>=32&&t<=47){if((r=e===17?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[r];return!!i&&(i.ccMIDROW(t),this.logger.log(3,"MIDROW ("+Gi([e,t])+")"),!0)}return!1},a.parsePAC=function(e,t){var r,i=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(e===16||e===24)&&t>=64&&t<=95))return!1;if(Wu(e,t,i))return mn(null,null,i),!0;var s=e<=23?1:2;r=t>=64&&t<=95?s===1?Kp[e]:jp[e]:s===1?qp[e]:Wp[e];var d=this.channels[s];return!!d&&(d.setPAC(this.interpretPAC(r,t)),mn(e,t,i),this.currentChannel=s,!0)},a.interpretPAC=function(e,t){var r,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=(1&r)==1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},a.parseChars=function(e,t){var r,i,s=null,d=null;if(e>=25?(r=2,d=e-8):(r=1,d=e),d>=17&&d<=19?(i=d===17?t+80:d===18?t+112:t+144,this.logger.log(2,"Special char '"+Vu(i)+"' in channel "+r),s=[i]):e>=32&&e<=127&&(s=t===0?[e]:[e,t]),s){var c=Gi(s);this.logger.log(3,"Char codes =  "+c.join(",")),mn(e,t,this.cmdHistory)}return s},a.parseBackgroundAttributes=function(e,t){var r;if(!((e===16||e===24)&&t>=32&&t<=47||(e===23||e===31)&&t>=45&&t<=47))return!1;var i={};e===16||e===24?(r=Math.floor((t-32)/2),i.background=$p[r],t%2==1&&(i.background=i.background+"_semi")):t===45?i.background="transparent":(i.foreground="black",t===47&&(i.underline=!0));var s=e<=23?1:2;return this.channels[s].setBkgData(i),mn(e,t,this.cmdHistory),!0},a.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},a.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}},l}();function mn(l,a,e){e.a=l,e.b=a}function Wu(l,a,e){return e.a===l&&e.b===a}var ss=function(){function l(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var a=l.prototype;return a.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},a.newCue=function(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},a.reset=function(){this.cueRanges=[],this.startTime=null},l}(),jo=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var l=["","lr","rl"],a=["start","middle","end","left","right"];function e(s,d){if(typeof d!="string"||!Array.isArray(s))return!1;var c=d.toLowerCase();return!!~s.indexOf(c)&&c}function t(s){return e(a,s)}function r(s){for(var d=arguments.length,c=new Array(d>1?d-1:0),f=1;f<d;f++)c[f-1]=arguments[f];for(var h=1;h<arguments.length;h++){var m=arguments[h];for(var g in m)s[g]=m[g]}return s}function i(s,d,c){var f=this,h={enumerable:!0};f.hasBeenReset=!1;var m="",g=!1,E=s,k=d,R=c,D=null,A="",I=!0,O="auto",F="start",q=50,Q="middle",X=50,oe="middle";Object.defineProperty(f,"id",r({},h,{get:function(){return m},set:function(J){m=""+J}})),Object.defineProperty(f,"pauseOnExit",r({},h,{get:function(){return g},set:function(J){g=!!J}})),Object.defineProperty(f,"startTime",r({},h,{get:function(){return E},set:function(J){if(typeof J!="number")throw new TypeError("Start time must be set to a number.");E=J,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",r({},h,{get:function(){return k},set:function(J){if(typeof J!="number")throw new TypeError("End time must be set to a number.");k=J,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",r({},h,{get:function(){return R},set:function(J){R=""+J,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",r({},h,{get:function(){return D},set:function(J){D=J,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",r({},h,{get:function(){return A},set:function(J){var te=function(fe){return e(l,fe)}(J);if(te===!1)throw new SyntaxError("An invalid or illegal string was specified.");A=te,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",r({},h,{get:function(){return I},set:function(J){I=!!J,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",r({},h,{get:function(){return O},set:function(J){if(typeof J!="number"&&J!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");O=J,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",r({},h,{get:function(){return F},set:function(J){var te=t(J);if(!te)throw new SyntaxError("An invalid or illegal string was specified.");F=te,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",r({},h,{get:function(){return q},set:function(J){if(J<0||J>100)throw new Error("Position must be between 0 and 100.");q=J,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",r({},h,{get:function(){return Q},set:function(J){var te=t(J);if(!te)throw new SyntaxError("An invalid or illegal string was specified.");Q=te,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",r({},h,{get:function(){return X},set:function(J){if(J<0||J>100)throw new Error("Size must be between 0 and 100.");X=J,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",r({},h,{get:function(){return oe},set:function(J){var te=t(J);if(!te)throw new SyntaxError("An invalid or illegal string was specified.");oe=te,this.hasBeenReset=!0}})),f.displayState=void 0}return i.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},i}(),Xp=function(){function l(){}return l.prototype.decode=function(a,e){if(!a)return"";if(typeof a!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))},l}();function $u(l){function a(t,r,i,s){return 3600*(0|t)+60*(0|r)+(0|i)+parseFloat(s||0)}var e=l.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?a(e[2],e[3],0,e[4]):a(e[1],e[2],e[3],e[4]):null}var Zp=function(){function l(){this.values=Object.create(null)}var a=l.prototype;return a.set=function(e,t){this.get(e)||t===""||(this.values[e]=t)},a.get=function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},a.has=function(e){return e in this.values},a.alt=function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},a.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},a.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1},l}();function Yu(l,a,e,t){var r=t?l.split(t):[l];for(var i in r)if(typeof r[i]=="string"){var s=r[i].split(e);s.length===2&&a(s[0],s[1])}}var Wo=new jo(0,0,""),os=Wo.align==="middle"?"middle":"center";function Jp(l,a,e){var t=l;function r(){var s=$u(l);if(s===null)throw new Error("Malformed timestamp: "+t);return l=l.replace(/^[^\sa-zA-Z-]+/,""),s}function i(){l=l.replace(/^\s+/,"")}if(i(),a.startTime=r(),i(),l.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);l=l.slice(3),i(),a.endTime=r(),i(),function(s,d){var c=new Zp;Yu(s,function(m,g){var E;switch(m){case"region":for(var k=e.length-1;k>=0;k--)if(e[k].id===g){c.set(m,e[k].region);break}break;case"vertical":c.alt(m,g,["rl","lr"]);break;case"line":E=g.split(","),c.integer(m,E[0]),c.percent(m,E[0])&&c.set("snapToLines",!1),c.alt(m,E[0],["auto"]),E.length===2&&c.alt("lineAlign",E[1],["start",os,"end"]);break;case"position":E=g.split(","),c.percent(m,E[0]),E.length===2&&c.alt("positionAlign",E[1],["start",os,"end","line-left","line-right","auto"]);break;case"size":c.percent(m,g);break;case"align":c.alt(m,g,["start",os,"end","left","right"])}},/:/,/\s/),d.region=c.get("region",null),d.vertical=c.get("vertical","");var f=c.get("line","auto");f==="auto"&&Wo.line===-1&&(f=-1),d.line=f,d.lineAlign=c.get("lineAlign","start"),d.snapToLines=c.get("snapToLines",!0),d.size=c.get("size",100),d.align=c.get("align",os);var h=c.get("position","auto");h==="auto"&&Wo.position===50&&(h=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=h}(l,a)}function zu(l){return l.replace(/<br(?: \/)?>/gi,`
`)}var em=function(){function l(){this.state="INITIAL",this.buffer="",this.decoder=new Xp,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var a=l.prototype;return a.parse=function(e){var t=this;function r(){var f=t.buffer,h=0;for(f=zu(f);h<f.length&&f[h]!=="\r"&&f[h]!==`
`;)++h;var m=f.slice(0,h);return f[h]==="\r"&&++h,f[h]===`
`&&++h,t.buffer=f.slice(h),m}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var s=(i=r()).match(/^()?WEBVTT([ \t].*)?$/);if(s==null||!s[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var d=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(d?d=!1:i=r(),t.state){case"HEADER":/:/.test(i)?Yu(i,function(f,h){},/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new jo(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Jp(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var c=i.indexOf("-->")!==-1;if(!i||c&&(d=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},a.flush=function(){var e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},l}(),tm=/\r\n|\n\r|\n|\r/g,$o=function(l,a,e){return e===void 0&&(e=0),l.slice(e,e+a.length)===a},Yo=function(l){for(var a=5381,e=l.length;e;)a=33*a^l.charCodeAt(--e);return(a>>>0).toString()};function zo(l,a,e){return Yo(l.toString())+Yo(a.toString())+Yo(e)}function rm(l,a,e,t,r,i,s){var d,c,f,h=new em,m=Jt(new Uint8Array(l)).trim().replace(tm,`
`).split(`
`),g=[],E=(d=a.baseTime,(c=a.timescale)===void 0&&(c=1),Po(d,9e4,1/c)),k="00:00.000",R=0,D=0,A=!0;h.oncue=function(I){var O=e[t],F=e.ccOffset,q=(R-E)/9e4;O!=null&&O.new&&(D!==void 0?F=e.ccOffset=O.start:function(J,te,fe){var de=J[te],_e=J[de.prevCC];if(!_e||!_e.new&&de.new)return J.ccOffset=J.presentationOffset=de.start,void(de.new=!1);for(;(Oe=_e)!=null&&Oe.new;){var Oe;J.ccOffset+=de.start-_e.start,de.new=!1,_e=J[(de=_e).prevCC]}J.presentationOffset=fe}(e,t,q)),q&&(F=q-e.presentationOffset);var Q=I.endTime-I.startTime,X=hr(9e4*(I.startTime+F-D),9e4*r)/9e4;I.startTime=Math.max(X,0),I.endTime=Math.max(X+Q,0);var oe=I.text.trim();I.text=decodeURIComponent(encodeURIComponent(oe)),I.id||(I.id=zo(I.startTime,I.endTime,oe)),I.endTime>0&&g.push(I)},h.onparsingerror=function(I){f=I},h.onflush=function(){f?s(f):i(g)},m.forEach(function(I){if(A){if($o(I,"X-TIMESTAMP-MAP=")){A=!1,I.slice(16).split(",").forEach(function(O){$o(O,"LOCAL:")?k=O.slice(6):$o(O,"MPEGTS:")&&(R=parseInt(O.slice(7)))});try{D=function(O){var F=parseInt(O.slice(-3)),q=parseInt(O.slice(-6,-4)),Q=parseInt(O.slice(-9,-7)),X=O.length>9?parseInt(O.substring(0,O.indexOf(":"))):0;if(!(z(F)&&z(q)&&z(Q)&&z(X)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+O);return F+=1e3*q,(F+=6e4*Q)+36e5*X}(k)/1e3}catch(O){f=O}return}I===""&&(A=!1)}h.parse(I+`
`)}),h.flush()}var Qo="stpp.ttml.im1t",Qu=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Xu=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,im={left:"start",center:"center",right:"end",start:"start",end:"end"};function Zu(l,a,e,t){var r=Xe(new Uint8Array(l),["mdat"]);if(r.length!==0){var i,s,d,c,f=r.map(function(m){return Jt(m)}),h=(i=a.baseTime,s=1,(d=a.timescale)===void 0&&(d=1),c===void 0&&(c=!1),Po(i,s,1/d,c));try{f.forEach(function(m){return e(function(g,E){var k=new DOMParser().parseFromString(g,"text/xml").getElementsByTagName("tt")[0];if(!k)throw new Error("Invalid ttml");var R={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},D=Object.keys(R).reduce(function(q,Q){return q[Q]=k.getAttribute("ttp:"+Q)||R[Q],q},{}),A=k.getAttribute("xml:space")!=="preserve",I=Ju(Xo(k,"styling","style")),O=Ju(Xo(k,"layout","region")),F=Xo(k,"body","[begin]");return[].map.call(F,function(q){var Q=ed(q,A);if(!Q||!q.hasAttribute("begin"))return null;var X=Jo(q.getAttribute("begin"),D),oe=Jo(q.getAttribute("dur"),D),J=Jo(q.getAttribute("end"),D);if(X===null)throw td(q);if(J===null){if(oe===null)throw td(q);J=X+oe}var te=new jo(X-E,J-E,Q);te.id=zo(te.startTime,te.endTime,te.text);var fe=function(Oe,Se,Pe){var Ae="http://www.w3.org/ns/ttml#styling",Ce=null,He=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],$e=Oe!=null&&Oe.hasAttribute("style")?Oe.getAttribute("style"):null;return $e&&Pe.hasOwnProperty($e)&&(Ce=Pe[$e]),He.reduce(function(qe,lt){var Yt=Zo(Se,Ae,lt)||Zo(Oe,Ae,lt)||Zo(Ce,Ae,lt);return Yt&&(qe[lt]=Yt),qe},{})}(O[q.getAttribute("region")],I[q.getAttribute("style")],I),de=fe.textAlign;if(de){var _e=im[de];_e&&(te.lineAlign=_e),te.align=de}return G(te,fe),te}).filter(function(q){return q!==null})}(m,h))})}catch(m){t(m)}}else t(new Error("Could not parse IMSC1 mdat"))}function Xo(l,a,e){var t=l.getElementsByTagName(a)[0];return t?[].slice.call(t.querySelectorAll(e)):[]}function Ju(l){return l.reduce(function(a,e){var t=e.getAttribute("xml:id");return t&&(a[t]=e),a},{})}function ed(l,a){return[].slice.call(l.childNodes).reduce(function(e,t,r){var i;return t.nodeName==="br"&&r?e+`
`:(i=t.childNodes)!=null&&i.length?ed(t,a):a?e+t.textContent.trim().replace(/\s+/g," "):e+t.textContent},"")}function Zo(l,a,e){return l&&l.hasAttributeNS(a,e)?l.getAttributeNS(a,e):null}function td(l){return new Error("Could not parse ttml timestamp "+l)}function Jo(l,a){if(!l)return null;var e=$u(l);return e===null&&(Qu.test(l)?e=function(t,r){var i=Qu.exec(t),s=(0|i[4])+(0|i[5])/r.subFrameRate;return 3600*(0|i[1])+60*(0|i[2])+(0|i[3])+s/r.frameRate}(l,a):Xu.test(l)&&(e=function(t,r){var i=Xu.exec(t),s=Number(i[1]);switch(i[2]){case"h":return 3600*s;case"m":return 60*s;case"ms":return 1e3*s;case"f":return s/r.frameRate;case"t":return s/r.tickRate}return s}(l,a))),e}var nm=function(){function l(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new ss(this,"textTrack1"),r=new ss(this,"textTrack2"),i=new ss(this,"textTrack3"),s=new ss(this,"textTrack4");this.cea608Parser1=new ju(1,t,r),this.cea608Parser2=new ju(3,i,s)}e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(w.FRAG_LOADING,this.onFragLoading,this),e.on(w.FRAG_LOADED,this.onFragLoaded,this),e.on(w.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(w.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(w.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(w.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this)}var a=l.prototype;return a.destroy=function(){var e=this.hls;e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(w.FRAG_LOADING,this.onFragLoading,this),e.off(w.FRAG_LOADED,this.onFragLoaded,this),e.off(w.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(w.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(w.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(w.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},a.addCues=function(e,t,r,i,s){for(var d,c,f,h,m=!1,g=s.length;g--;){var E=s[g],k=(d=E[0],c=E[1],f=t,h=r,Math.min(c,h)-Math.max(d,f));if(k>=0&&(E[0]=Math.min(E[0],t),E[1]=Math.max(E[1],r),m=!0,k/(r-t)>.5))return}if(m||s.push([t,r]),this.config.renderTextTracksNatively){var R=this.captionsTracks[e];this.Cues.newCue(R,t,r,i)}else{var D=this.Cues.newCue(null,t,r,i);this.hls.trigger(w.CUES_PARSED,{type:"captions",cues:D,track:e})}},a.onInitPtsFound=function(e,t){var r=this,i=t.frag,s=t.id,d=t.initPTS,c=t.timescale,f=this.unparsedVttFrags;s==="main"&&(this.initPTS[i.cc]={baseTime:d,timescale:c}),f.length&&(this.unparsedVttFrags=[],f.forEach(function(h){r.onFragLoaded(w.FRAG_LOADED,h)}))},a.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r];if(i[e])return i}return null},a.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},a.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,r=this.captionsTracks,i=this.media,s=t[e],d=s.label,c=s.languageCode,f=this.getExistingTrack(e);if(f)r[e]=f,mi(r[e]),en(r[e],i);else{var h=this.createTextTrack("captions",d,c);h&&(h[e]=!0,r[e]=h)}}},a.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(w.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},a.createTextTrack=function(e,t,r){var i=this.media;if(i)return i.addTextTrack(e,t,r)},a.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},a.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(t){mi(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}},a.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},a._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)mi(t[r])}},a.onSubtitleTracksUpdated=function(e,t){var r=this;this.textTracks=[];var i=t.subtitleTracks||[],s=i.some(function(h){return h.textCodec===Qo});if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var d=this.tracks&&i&&this.tracks.length===i.length;if(this.tracks=i||[],this.config.renderTextTracksNatively){var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(h,m){var g;if(m<c.length){for(var E=null,k=0;k<c.length;k++)if(am(c[k],h)){E=c[k];break}E&&(g=E)}if(g)mi(g);else{var R=r._captionsOrSubtitlesFromCharacteristics(h);(g=r.createTextTrack(R,h.name,h.lang))&&(g.mode="disabled")}g&&(g.groupId=h.groupId,r.textTracks.push(g))})}else if(!d&&this.tracks&&this.tracks.length){var f=this.tracks.map(function(h){return{label:h.name,kind:h.type.toLowerCase(),default:h.default,subtitleTrack:h}});this.hls.trigger(w.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:f})}}},a._captionsOrSubtitlesFromCharacteristics=function(e){var t;if((t=e.attrs)!=null&&t.CHARACTERISTICS){var r=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(r&&i)return"captions"}return"subtitles"},a.onManifestLoaded=function(e,t){var r=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(i){var s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(s){var d="textTrack"+s[1],c=r.captionsProperties[d];c&&(c.label=i.name,i.lang&&(c.languageCode=i.lang),c.media=i)}})},a.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]},a.onFragLoading=function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2,s=this.lastSn,d=this.lastPartIndex;if(this.enabled&&r&&i&&t.frag.type===at){var c,f,h=t.frag.sn,m=(c=t==null||(f=t.part)==null?void 0:f.index)!=null?c:-1;h===s+1||h===s&&m===d+1||(r.reset(),i.reset()),this.lastSn=h,this.lastPartIndex=m}},a.onFragLoaded=function(e,t){var r=t.frag,i=t.payload,s=this.initPTS,d=this.unparsedVttFrags;if(r.type===Ar)if(i.byteLength){if(!s[r.cc])return d.push(t),void(s.length&&this.hls.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var c=r.decryptdata,f="stats"in t;if(c==null||!c.encrypted||f){var h=this.tracks[r.level],m=this.vttCCs;m[r.cc]||(m[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),h&&h.textCodec===Qo?this._parseIMSC1(r,i):this._parseVTTs(r,i,m)}}else this.hls.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},a._parseIMSC1=function(e,t){var r=this,i=this.hls;Zu(t,this.initPTS[e.cc],function(s){r._appendCues(s,e.level),i.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(s){H.log("Failed to parse IMSC1: "+s),i.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})},a._parseVTTs=function(e,t,r){var i,s=this,d=this.hls;rm((i=e.initSegment)!=null&&i.data?Fr(e.initSegment.data,new Uint8Array(t)):t,this.initPTS[e.cc],r,e.cc,e.start,function(c){s._appendCues(c,e.level),d.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(c){s._fallbackToIMSC1(e,t),H.log("Failed to parse VTT cue: "+c),d.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:c})})},a._fallbackToIMSC1=function(e,t){var r=this,i=this.tracks[e.level];i.textCodec||Zu(t,this.initPTS[e.cc],function(){i.textCodec=Qo,r._parseIMSC1(e,t)},function(){i.textCodec="wvtt"})},a._appendCues=function(e,t){var r=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(function(c){return Ya(i,c)})}else{var s=this.tracks[t];if(!s)return;var d=s.default?"default":"subtitles"+t;r.trigger(w.CUES_PARSED,{type:"subtitles",cues:e,track:d})}},a.onFragDecrypted=function(e,t){var r=t.frag;if(r.type===Ar){if(!this.initPTS[r.cc])return void this.unparsedVttFrags.push(t);this.onFragLoaded(w.FRAG_LOADED,t)}},a.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},a.onFragParsingUserdata=function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&r&&i){var s=t.frag,d=t.samples;if(s.type!==at||this.closedCaptionsForLevel(s)!=="NONE")for(var c=0;c<d.length;c++){var f=d[c].bytes;if(f){var h=this.extractCea608Data(f);r.addData(d[c].pts,h[0]),i.addData(d[c].pts,h[1])}}}},a.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,s=t.endOffsetSubtitles,d=t.type,c=this.media;if(c&&!(c.currentTime<i)){if(!d||d==="video"){var f=this.captionsTracks;Object.keys(f).forEach(function(m){return mt(f[m],r,i)})}if(this.config.renderTextTracksNatively&&r===0&&s!==void 0){var h=this.textTracks;Object.keys(h).forEach(function(m){return mt(h[m],r,s)})}}},a.extractCea608Data=function(e){for(var t=[[],[]],r=31&e[0],i=2,s=0;s<r;s++){var d=e[i++],c=127&e[i++],f=127&e[i++];if((c!==0||f!==0)&&4&d){var h=3&d;h!==0&&h!==1||(t[h].push(c),t[h].push(f))}}return t},l}();function am(l,a){return l&&l.label===a.name&&!(l.textTrack1||l.textTrack2)}var sm=function(){function l(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var a=l.prototype;return a.setStreamController=function(e){this.streamController=e},a.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},a.registerListeners=function(){var e=this.hls;e.on(w.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.BUFFER_CODECS,this.onBufferCodecs,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this)},a.unregisterListener=function(){var e=this.hls;e.off(w.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.BUFFER_CODECS,this.onBufferCodecs,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this)},a.onFpsDropLevelCapping=function(e,t){var r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})},a.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null},a.onManifestParsed=function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onMediaDetaching=function(){this.stopCapping()},a.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},a.getMaxLevel=function(e){var t=this,r=this.hls.levels;if(!r.length)return-1;var i=r.filter(function(s,d){return t.isLevelAllowed(s)&&d<=e});return this.clientRect=null,l.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},a.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},a.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},a.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t},a.isLevelAllowed=function(e){return!this.restrictedLevels.some(function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height})},l.getMaxLevelByMediaSize=function(e,t,r){if(e==null||!e.length)return-1;for(var i,s,d=e.length-1,c=0;c<e.length;c+=1){var f=e[c];if((f.width>=t||f.height>=r)&&(i=f,!(s=e[c+1])||i.width!==s.width||i.height!==s.height)){d=c;break}}return d},M(l,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}}]),l}(),om=function(){function l(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var a=l.prototype;return a.setStreamController=function(e){this.streamController=e},a.registerListeners=function(){this.hls.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this)},a.unregisterListeners=function(){this.hls.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this)},a.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},a.onMediaAttaching=function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},a.checkFPS=function(e,t,r){var i=performance.now();if(t){if(this.lastTime){var s=i-this.lastTime,d=r-this.lastDroppedFrames,c=t-this.lastDecodedFrames,f=1e3*d/s,h=this.hls;if(h.trigger(w.FPS_DROP,{currentDropped:d,currentDecoded:c,totalDroppedFrames:r}),f>0&&d>h.config.fpsDroppedMonitoringThreshold*c){var m=h.currentLevel;H.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=m)&&(m-=1,h.trigger(w.FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:h.currentLevel}),h.autoLevelCapping=m,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},a.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},l}(),ls="[eme]",rd=function(){function l(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=l.CDMCleanupPromise?[l.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=H.debug.bind(H,ls),this.log=H.log.bind(H,ls),this.warn=H.warn.bind(H,ls),this.error=H.error.bind(H,ls),this.hls=e,this.config=e.config,this.registerListeners()}var a=l.prototype;return a.destroy=function(){this.unregisterListeners(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null},a.registerListeners=function(){this.hls.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(w.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(w.MANIFEST_LOADED,this.onManifestLoaded,this)},a.unregisterListeners=function(){this.hls.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(w.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(w.MANIFEST_LOADED,this.onManifestLoaded,this)},a.getLicenseServerUrl=function(e){var t=this.config,r=t.drmSystems,i=t.widevineLicenseUrl,s=r[e];if(s)return s.licenseUrl;if(e===ot.WIDEVINE&&i)return i;throw new Error('no license server URL configured for key-system "'+e+'"')},a.getServerCertificateUrl=function(e){var t=this.config.drmSystems[e];if(t)return t.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},a.attemptKeySystemAccess=function(e){var t=this,r=this.hls.levels,i=function(c,f,h){return!!c&&h.indexOf(c)===f},s=r.map(function(c){return c.audioCodec}).filter(i),d=r.map(function(c){return c.videoCodec}).filter(i);return s.length+d.length===0&&d.push("avc1.42e01e"),new Promise(function(c,f){(function h(m){var g=m.shift();t.getMediaKeysPromise(g,s,d).then(function(E){return c({keySystem:g,mediaKeys:E})}).catch(function(E){m.length?h(m):f(E instanceof fr?E:new fr({type:se.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_ACCESS,error:E,fatal:!0},E.message))})})(e)})},a.requestMediaKeySystemAccess=function(e,t){var r=this.config.requestMediaKeySystemAccessFunc;if(typeof r!="function"){var i="Configured requestMediaKeySystemAccess is not a function "+r;return jt===null&&self.location.protocol==="http:"&&(i="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(i))}return r(e,t)},a.getMediaKeysPromise=function(e,t,r){var i=this,s=function(h,m,g,E){var k;switch(h){case ot.FAIRPLAY:k=["cenc","sinf"];break;case ot.WIDEVINE:case ot.PLAYREADY:k=["cenc"];break;case ot.CLEARKEY:k=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+h)}return function(R,D,A,I){return[{initDataTypes:R,persistentState:I.persistentState||"not-allowed",distinctiveIdentifier:I.distinctiveIdentifier||"not-allowed",sessionTypes:I.sessionTypes||[I.sessionType||"temporary"],audioCapabilities:D.map(function(O){return{contentType:'audio/mp4; codecs="'+O+'"',robustness:I.audioRobustness||"",encryptionScheme:I.audioEncryptionScheme||null}}),videoCapabilities:A.map(function(O){return{contentType:'video/mp4; codecs="'+O+'"',robustness:I.videoRobustness||"",encryptionScheme:I.videoEncryptionScheme||null}})}]}(k,m,g,E)}(e,t,r,this.config.drmSystemOptions),d=this.keySystemAccessPromises[e],c=d==null?void 0:d.keySystemAccess;if(!c){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(s)),c=this.requestMediaKeySystemAccess(e,s);var f=this.keySystemAccessPromises[e]={keySystemAccess:c};return c.catch(function(h){i.log('Failed to obtain access to key-system "'+e+'": '+h)}),c.then(function(h){i.log('Access for key-system "'+h.keySystem+'" obtained');var m=i.fetchServerCertificate(e);return i.log('Create media-keys for "'+e+'"'),f.mediaKeys=h.createMediaKeys().then(function(g){return i.log('Media-keys created for "'+e+'"'),m.then(function(E){return E?i.setMediaKeysServerCertificate(g,e,E):g})}),f.mediaKeys.catch(function(g){i.error('Failed to create media-keys for "'+e+'"}: '+g)}),f.mediaKeys})}return c.then(function(){return d.mediaKeys})},a.createMediaKeySessionContext=function(e){var t=e.decryptdata,r=e.keySystem,i=e.mediaKeys;this.log('Creating key-system session "'+r+'" keyId: '+er(t.keyId||[]));var s=i.createSession(),d={decryptdata:t,keySystem:r,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(d),d},a.renewKeySession=function(e){var t=e.decryptdata;if(t.pssh){var r=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t);this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},a.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return er(e.keyId)},a.updateKeySession=function(e,t){var r,i=e.mediaKeysSession;return this.log('Updating key-session "'+i.sessionId+'" for keyID '+er(((r=e.decryptdata)==null?void 0:r.keyId)||[])+`
      } (data length: `+(t&&t.byteLength)+")"),i.update(t)},a.selectKeySystemFormat=function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},a.getKeyFormatPromise=function(e){var t=this;return new Promise(function(r,i){var s=gt(t.config),d=e.map(qt).filter(function(c){return!!c&&s.indexOf(c)!==-1});return t.getKeySystemSelectionPromise(d).then(function(c){var f=c.keySystem,h=pt(f);h?r(h):i(new Error('Unable to find format for key-system "'+f+'"'))}).catch(i)})},a.loadKey=function(e){var t=this,r=e.keyInfo.decryptdata,i=this.getKeyIdString(r),s="(keyId: "+i+' format: "'+r.keyFormat+'" method: '+r.method+" uri: "+r.uri+")";this.log("Starting session for key "+s);var d=this.keyIdToKeySessionPromise[i];return d||(d=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(r).then(function(c){var f=c.keySystem,h=c.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+s),t.attemptSetMediaKeys(f,h).then(function(){t.throwIfDestroyed();var m=t.createMediaKeySessionContext({keySystem:f,mediaKeys:h,decryptdata:r});return t.generateRequestWithPreferredKeySession(m,"cenc",r.pssh,"playlist-key")})})).catch(function(c){return t.handleError(c)}),d},a.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},a.handleError=function(e){this.hls&&(this.error(e.message),e instanceof fr?this.hls.trigger(w.ERROR,e.data):this.hls.trigger(w.ERROR,{type:se.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},a.getKeySystemForKeyPromise=function(e){var t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){var i=qt(e.keyFormat),s=i?[i]:gt(this.config);return this.attemptKeySystemAccess(s)}return r},a.getKeySystemSelectionPromise=function(e){if(e.length||(e=gt(this.config)),e.length===0)throw new fr({type:se.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},a._onMediaEncrypted=function(e){var t=this,r=e.initDataType,i=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+r+'"'),i!==null){var s,d;if(r==="sinf"&&this.config.drmSystems[ot.FAIRPLAY]){var c=St(new Uint8Array(i));try{var f=xi(JSON.parse(c).sinf),h=Fn(new Uint8Array(f));if(!h)return;s=h.subarray(8,24),d=ot.FAIRPLAY}catch{return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var m=function(O){if(!(O instanceof ArrayBuffer)||O.byteLength<32)return null;var F={version:0,systemId:"",kids:null,data:null},q=new DataView(O),Q=q.getUint32(0);if(O.byteLength!==Q&&Q>44||q.getUint32(4)!==1886614376||(F.version=q.getUint32(8)>>>24,F.version>1))return null;F.systemId=er(new Uint8Array(O,12,16));var X=q.getUint32(28);if(F.version===0){if(Q-32<X)return null;F.data=new Uint8Array(O,32,X)}else if(F.version===1){F.kids=[];for(var oe=0;oe<X;oe++)F.kids.push(new Uint8Array(O,32+16*oe,16))}return F}(i);if(m===null)return;m.version===0&&m.systemId===br&&m.data&&(s=m.data.subarray(8,24)),d=function(O){if(O===br)return ot.WIDEVINE}(m.systemId)}if(d&&s){for(var g=er(s),E=this.keyIdToKeySessionPromise,k=this.mediaKeySessions,R=E[g],D=function(O){var F=k[O],q=F.decryptdata;if(q.pssh||!q.keyId)return"continue";var Q=er(q.keyId);return g===Q||q.uri.replace(/-/g,"").indexOf(g)!==-1?(R=E[Q],delete E[Q],q.pssh=new Uint8Array(i),q.keyId=s,R=E[g]=R.then(function(){return t.generateRequestWithPreferredKeySession(F,r,i,"encrypted-event-key-match")}),"break"):void 0},A=0;A<k.length;A++){var I=D(A);if(I!=="continue"&&I==="break")break}R||(R=E[g]=this.getKeySystemSelectionPromise([d]).then(function(O){var F,q=O.keySystem,Q=O.mediaKeys;t.throwIfDestroyed();var X=new zi("ISO-23001-7",g,(F=pt(q))!=null?F:"");return X.pssh=new Uint8Array(i),X.keyId=s,t.attemptSetMediaKeys(q,Q).then(function(){t.throwIfDestroyed();var oe=t.createMediaKeySessionContext({decryptdata:X,keySystem:q,mediaKeys:Q});return t.generateRequestWithPreferredKeySession(oe,r,i,"encrypted-event-no-match")})})),R.catch(function(O){return t.handleError(O)})}}},a._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},a.attemptSetMediaKeys=function(e,t){var r=this,i=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var s=Promise.all(i).then(function(){if(!r.media)throw new Error("Attempted to set mediaKeys without media element attached");return r.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(s),s.then(function(){r.log('Media-keys set for "'+e+'"'),i.push(s),r.setMediaKeysQueue=r.setMediaKeysQueue.filter(function(d){return i.indexOf(d)===-1})})},a.generateRequestWithPreferredKeySession=function(e,t,r,i){var s,d,c=this,f=(s=this.config.drmSystems)==null||(d=s[e.keySystem])==null?void 0:d.generateRequest;if(f)try{var h=f.call(this.hls,t,r,e);if(!h)throw new Error("Invalid response from configured generateRequest filter");t=h.initDataType,r=e.decryptdata.pssh=h.initData?new Uint8Array(h.initData):null}catch(R){var m;if(this.warn(R.message),(m=this.hls)!=null&&m.config.debug)throw R}if(r===null)return this.log('Skipping key-session request for "'+i+'" (no initData)'),Promise.resolve(e);var g=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+i+'": '+g+" (init data type: "+t+" length: "+(r?r.byteLength:null)+")");var E=new as;e.mediaKeysSession.onmessage=function(R){var D=e.mediaKeysSession;if(D){var A=R.messageType,I=R.message;c.log('"'+A+'" message event for session "'+D.sessionId+'" message size: '+I.byteLength),A==="license-request"||A==="license-renewal"?c.renewLicense(e,I).catch(function(O){c.handleError(O),E.emit("error",O)}):A==="license-release"?e.keySystem===ot.FAIRPLAY&&(c.updateKeySession(e,Pr("acknowledged")),c.removeSession(e)):c.warn('unhandled media key message type "'+A+'"')}else E.emit("error",new Error("invalid state"))},e.mediaKeysSession.onkeystatuseschange=function(R){if(e.mediaKeysSession){c.onKeyStatusChange(e);var D=e.keyStatus;E.emit("keyStatus",D),D==="expired"&&(c.warn(e.keySystem+" expired for key "+g),c.renewKeySession(e))}else E.emit("error",new Error("invalid state"))};var k=new Promise(function(R,D){E.on("error",D),E.on("keyStatus",function(A){A.startsWith("usable")?R():A==="output-restricted"?D(new fr({type:se.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):A==="internal-error"?D(new fr({type:se.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+A+'"')):A==="expired"?D(new Error("key expired while generating request")):c.warn('unhandled key status change "'+A+'"')})});return e.mediaKeysSession.generateRequest(t,r).then(function(){var R;c.log('Request generated for key-session "'+((R=e.mediaKeysSession)==null?void 0:R.sessionId)+'" keyId: '+g)}).catch(function(R){throw new fr({type:se.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_SESSION,error:R,fatal:!1},"Error generating key-session request: "+R)}).then(function(){return k}).catch(function(R){throw E.removeAllListeners(),c.removeSession(e),R}).then(function(){return E.removeAllListeners(),e})},a.onKeyStatusChange=function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach(function(r,i){t.log('key status change "'+r+'" for keyStatuses keyId: '+er("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))+" session keyId: "+er(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=r})},a.fetchServerCertificate=function(e){var t=this.config,r=new t.loader(t),i=this.getServerCertificateUrl(e);return i?(this.log('Fetching serverCertificate for "'+e+'"'),new Promise(function(s,d){var c={responseType:"arraybuffer",url:i},f=t.certLoadPolicy.default,h={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:function(g,E,k,R){s(g.data)},onError:function(g,E,k,R){d(new fr({type:se.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:k,response:L({url:c.url,data:void 0},g)},'"'+e+'" certificate request failed ('+i+"). Status: "+g.code+" ("+g.text+")"))},onTimeout:function(g,E,k){d(new fr({type:se.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:k,response:{url:c.url,data:void 0}},'"'+e+'" certificate request timed out ('+i+")"))},onAbort:function(g,E,k){d(new Error("aborted"))}};r.load(c,h,m)})):Promise.resolve()},a.setMediaKeysServerCertificate=function(e,t,r){var i=this;return new Promise(function(s,d){e.setServerCertificate(r).then(function(c){i.log("setServerCertificate "+(c?"success":"not supported by CDM")+" ("+(r==null?void 0:r.byteLength)+') on "'+t+'"'),s(e)}).catch(function(c){d(new fr({type:se.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:c,fatal:!0},c.message))})})},a.renewLicense=function(e,t){var r=this;return this.requestLicense(e,new Uint8Array(t)).then(function(i){return r.updateKeySession(e,new Uint8Array(i)).catch(function(s){throw new fr({type:se.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)})})},a.setupLicenseXHR=function(e,t,r,i){var s=this,d=this.config.licenseXhrSetup;return d?Promise.resolve().then(function(){if(!r.decryptdata)throw new Error("Key removed");return d.call(s.hls,e,t,r,i)}).catch(function(c){if(!r.decryptdata)throw c;return e.open("POST",t,!0),d.call(s.hls,e,t,r,i)}).then(function(c){return e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:c||i}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))},a.requestLicense=function(e,t){var r=this,i=this.config.keyLoadPolicy.default;return new Promise(function(s,d){var c=r.getLicenseServerUrl(e.keySystem);r.log("Sending license request to URL: "+c);var f=new XMLHttpRequest;f.responseType="arraybuffer",f.onreadystatechange=function(){if(!r.hls||!e.mediaKeysSession)return d(new Error("invalid state"));if(f.readyState===4)if(f.status===200){r._requestLicenseFailureCount=0;var h=f.response;r.log("License received "+(h instanceof ArrayBuffer?h.byteLength:h));var m=r.config.licenseResponseCallback;if(m)try{h=m.call(r.hls,f,c,e)}catch(R){r.error(R)}s(h)}else{var g=i.errorRetry,E=g?g.maxNumRetry:0;if(r._requestLicenseFailureCount++,r._requestLicenseFailureCount>E||f.status>=400&&f.status<500)d(new fr({type:se.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:f,response:{url:c,data:void 0,code:f.status,text:f.statusText}},"License Request XHR failed ("+c+"). Status: "+f.status+" ("+f.statusText+")"));else{var k=E-r._requestLicenseFailureCount+1;r.warn("Retrying license request, "+k+" attempts left"),r.requestLicense(e,t).then(s,d)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=f,r.setupLicenseXHR(f,c,e,t).then(function(h){var m=h.xhr,g=h.licenseChallenge;m.send(g)})})},a.onMediaAttached=function(e,t){if(this.config.emeEnabled){var r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}},a.onMediaDetached=function(){var e=this,t=this.media,r=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},zi.clearKeyUriToKeyIdMap();var i=r.length;l.CDMCleanupPromise=Promise.all(r.map(function(s){return e.removeSession(s)}).concat(t==null?void 0:t.setMediaKeys(null).catch(function(s){e.log("Could not clear media keys: "+s+". media.src: "+(t==null?void 0:t.src))}))).then(function(){i&&(e.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(function(s){e.log("Could not close sessions and clear media keys: "+s+". media.src: "+(t==null?void 0:t.src))})},a.onManifestLoaded=function(e,t){var r=t.sessionKeys;if(r&&this.config.emeEnabled&&!this.keyFormatPromise){var i=r.reduce(function(s,d){return s.indexOf(d.keyFormat)===-1&&s.push(d.keyFormat),s},[]);this.log("Selecting key-system from session-keys "+i.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(i)}},a.removeSession=function(e){var t=this,r=e.mediaKeysSession,i=e.licenseXhr;if(r){this.log("Remove licenses and keys and close session "+r.sessionId),r.onmessage=null,r.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var s=this.mediaKeySessions.indexOf(e);return s>-1&&this.mediaKeySessions.splice(s,1),r.remove().catch(function(d){t.log("Could not remove session: "+d)}).then(function(){return r.close()}).catch(function(d){t.log("Could not close session: "+d)})}},l}();rd.CDMCleanupPromise=void 0;var fr=function(l){function a(e,t){var r;return(r=l.call(this,t)||this).data=void 0,e.error||(e.error=new Error(t)),r.data=e,e.err=e.error,r}return Y(a,l),a}(ue(Error)),lm="m",us="a",el="v",tl="av",id="i",um="tt",dm=function(){function l(e){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(s){try{t.apply(s,{ot:lm,su:!t.initialized})}catch(d){H.warn("Could not generate manifest CMCD data.",d)}},this.applyFragmentData=function(s){try{var d=s.frag,c=t.hls.levels[d.level],f=t.getObjectType(d),h={d:1e3*d.duration,ot:f};f!==el&&f!==us&&f!=tl||(h.br=c.bitrate/1e3,h.tb=t.getTopBandwidth(f)/1e3,h.bl=t.getBufferLength(f)),t.apply(s,h)}catch(m){H.warn("Could not generate segment CMCD data.",m)}},this.hls=e;var r=this.config=e.config,i=r.cmcd;i!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||l.uuid(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.registerListeners())}var a=l.prototype;return a.registerListeners=function(){var e=this.hls;e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHED,this.onMediaDetached,this),e.on(w.BUFFER_CREATED,this.onBufferCreated,this)},a.unregisterListeners=function(){var e=this.hls;e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHED,this.onMediaDetached,this),e.off(w.BUFFER_CREATED,this.onBufferCreated,this)},a.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},a.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},a.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},a.onBufferCreated=function(e,t){var r,i;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer},a.createData=function(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},a.apply=function(e,t){t===void 0&&(t={}),G(t,this.createData());var r=t.ot===id||t.ot===el||t.ot===tl;if(this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering),this.useHeaders){var i=l.toHeaders(t);if(!Object.keys(i).length)return;e.headers||(e.headers={}),G(e.headers,i)}else{var s=l.toQuery(t);if(!s)return;e.url=l.appendQueryToUri(e.url,s)}},a.getObjectType=function(e){var t=e.type;return t==="subtitle"?um:e.sn==="initSegment"?id:t==="audio"?us:t==="main"?this.hls.audioTracks.length?el:tl:void 0},a.getTopBandwidth=function(e){var t,r=0,i=this.hls;if(e===us)t=i.audioTracks;else{var s=i.maxAutoLevel,d=s>-1?s+1:i.levels.length;t=i.levels.slice(0,d)}for(var c,f=pe(t);!(c=f()).done;){var h=c.value;h.bitrate>r&&(r=h.bitrate)}return r>0?r:NaN},a.getBufferLength=function(e){var t=this.hls.media,r=e===us?this.audioBuffer:this.videoBuffer;return r&&t?1e3*Ge.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN},a.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,r=e||this.config.loader;return function(){function i(d){this.loader=void 0,this.loader=new r(d)}var s=i.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(d,c,f){t(d),this.loader.load(d,c,f)},M(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},a.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,r=e||this.config.loader;return function(){function i(d){this.loader=void 0,this.loader=new r(d)}var s=i.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(d,c,f){t(d),this.loader.load(d,c,f)},M(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},l.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},l.serialize=function(e){for(var t,r=[],i=function(R){return!Number.isNaN(R)&&R!=null&&R!==""&&R!==!1},s=function(R){return Math.round(R)},d=function(R){return 100*s(R/100)},c={br:s,d:s,bl:d,dl:d,mtp:d,nor:function(R){return encodeURIComponent(R)},rtp:d,tb:s},f=pe(Object.keys(e||{}).sort());!(t=f()).done;){var h=t.value,m=e[h];if(i(m)&&!(h==="v"&&m===1||h=="pr"&&m===1)){var g=c[h];g&&(m=g(m));var E=typeof m,k=void 0;k=h==="ot"||h==="sf"||h==="st"?h+"="+m:E==="boolean"?h:E==="number"?h+"="+m:h+"="+JSON.stringify(m),r.push(k)}}return r.join(",")},l.toHeaders=function(e){for(var t={},r=["Object","Request","Session","Status"],i=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},d=0,c=Object.keys(e);d<c.length;d++){var f=c[d];i[s[f]!=null?s[f]:1][f]=e[f]}for(var h=0;h<i.length;h++){var m=l.serialize(i[h]);m&&(t["CMCD-"+r[h]]=m)}return t},l.toQuery=function(e){return"CMCD="+encodeURIComponent(l.serialize(e))},l.appendQueryToUri=function(e,t){if(!t)return e;var r=e.includes("?")?"&":"?";return""+e+r+t},l}(),cm=function(){function l(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=H.log.bind(H,"[content-steering]:"),this.registerListeners()}var a=l.prototype;return a.registerListeners=function(){var e=this.hls;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.ERROR,this.onError,this)},a.unregisterListeners=function(){var e=this.hls;e&&(e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.ERROR,this.onError,this))},a.startLoad=function(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){var e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)},a.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)},a.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},a.removeLevel=function(e){var t=this.levels;t&&(this.levels=t.filter(function(r){return r!==e}))},a.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},a.onManifestLoaded=function(e,t){var r=t.contentSteering;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())},a.onManifestParsed=function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks},a.onError=function(e,t){var r=t.errorAction;if((r==null?void 0:r.action)===Et&&r.flags===un){var i=this.pathwayPriority,s=this.pathwayId;this.penalizedPathways[s]||(this.penalizedPathways[s]=performance.now()),!i&&this.levels&&(i=this.levels.reduce(function(d,c){return d.indexOf(c.pathwayId)===-1&&d.push(c.pathwayId),d},[])),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==s)}},a.filterParsedLevels=function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){var r=e[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+r+'"'),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log("Found "+t.length+"/"+e.length+' levels in Pathway "'+this.pathwayId+'"'),t):e},a.getLevelsForPathway=function(e){return this.levels===null?[]:this.levels.filter(function(t){return e===t.pathwayId})},a.updatePathwayPriority=function(e){var t;this.pathwayPriority=e;var r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(function(m){i-r[m]>3e5&&delete r[m]});for(var s=0;s<e.length;s++){var d=e[s];if(!r[d]){if(d===this.pathwayId)return;var c=this.hls.nextLoadLevel,f=this.hls.levels[c];if((t=this.getLevelsForPathway(d)).length>0){this.log('Setting Pathway to "'+d+'"'),this.pathwayId=d,this.hls.trigger(w.LEVELS_UPDATED,{levels:t});var h=this.hls.levels[c];f&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==f.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==f.bitrate&&this.log("Unstable Pathways change from bitrate "+f.bitrate+" to "+h.bitrate),this.hls.nextLoadLevel=c);break}}}},a.clonePathways=function(e){var t=this,r=this.levels;if(r){var i={},s={};e.forEach(function(d){var c=d.ID,f=d["BASE-ID"],h=d["URI-REPLACEMENT"];if(!r.some(function(g){return g.pathwayId===c})){var m=t.getLevelsForPathway(f).map(function(g){var E=G({},g);E.details=void 0,E.url=ad(g.uri,g.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h);var k=new Qe(g.attrs);k["PATHWAY-ID"]=c;var R=k.AUDIO&&k.AUDIO+"_clone_"+c,D=k.SUBTITLES&&k.SUBTITLES+"_clone_"+c;R&&(i[k.AUDIO]=R,k.AUDIO=R),D&&(s[k.SUBTITLES]=D,k.SUBTITLES=D),E.attrs=k;var A=new nn(E);return x(A,"audio",R),x(A,"text",D),A});r.push.apply(r,m),nd(t.audioTracks,i,h,c),nd(t.subtitleTracks,s,h,c)}})}},a.loadSteeringManifest=function(e){var t,r=this,i=this.hls.config,s=i.loader;this.loader&&this.loader.destroy(),this.loader=new s(i);try{t=new self.URL(e)}catch{return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+e)}if(t.protocol!=="data:"){var d=0|(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+d)}var c={responseType:"json",url:t.href},f=i.steeringManifestLoadPolicy.default,h=f.errorRetry||f.timeoutRetry||{},m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},g={onSuccess:function(E,k,R,D){r.log('Loaded steering manifest: "'+t+'"');var A=E.data;if(A.VERSION===1){r.updated=performance.now(),r.timeToLoad=A.TTL;var I=A["RELOAD-URI"],O=A["PATHWAY-CLONES"],F=A["PATHWAY-PRIORITY"];if(I)try{r.uri=new self.URL(I,t).href}catch{return r.enabled=!1,void r.log("Failed to parse Steering Manifest RELOAD-URI: "+I)}r.scheduleRefresh(r.uri||R.url),O&&r.clonePathways(O),F&&r.updatePathwayPriority(F)}else r.log("Steering VERSION "+A.VERSION+" not supported!")},onError:function(E,k,R,D){if(r.log("Error loading steering manifest: "+E.code+" "+E.text+" ("+k.url+")"),r.stopLoad(),E.code===410)return r.enabled=!1,void r.log("Steering manifest "+k.url+" no longer available");var A=1e3*r.timeToLoad;if(E.code!==429)r.scheduleRefresh(r.uri||k.url,A);else{var I=r.loader;if(typeof(I==null?void 0:I.getResponseHeader)=="function"){var O=I.getResponseHeader("Retry-After");O&&(A=1e3*parseFloat(O))}r.log("Steering manifest "+k.url+" rate limited")}},onTimeout:function(E,k,R){r.log("Timeout loading steering manifest ("+k.url+")"),r.scheduleRefresh(r.uri||k.url)}};this.log("Requesting steering manifest: "+t),this.loader.load(c,m,g)},a.scheduleRefresh=function(e,t){var r=this;t===void 0&&(t=1e3*this.timeToLoad),self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(function(){r.loadSteeringManifest(e)},t)},l}();function nd(l,a,e,t){l&&Object.keys(a).forEach(function(r){var i=l.filter(function(s){return s.groupId===r}).map(function(s){var d=G({},s);return d.details=void 0,d.attrs=new Qe(d.attrs),d.url=d.attrs.URI=ad(s.url,s.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),d.groupId=d.attrs["GROUP-ID"]=a[r],d.attrs["PATHWAY-ID"]=t,d});l.push.apply(l,i)})}function ad(l,a,e,t){var r,i=t.HOST,s=t.PARAMS,d=t[e];a&&(r=d==null?void 0:d[a])&&(l=r);var c=new self.URL(l);return i&&!r&&(c.host=i),s&&Object.keys(s).sort().forEach(function(f){f&&c.searchParams.set(f,s[f])}),c.href}var hm=/^age:\s*[\d.]+\s*$/im,sd=function(){function l(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Zt,this.retryDelay=0}var a=l.prototype;return a.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},a.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},a.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},a.load=function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()},a.loadInternal=function(){var e=this,t=this.config,r=this.context;if(t){var i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0;var d=this.xhrSetup;d?Promise.resolve().then(function(){if(!e.stats.aborted)return d(i,r.url)}).catch(function(c){return i.open("GET",r.url,!0),d(i,r.url)}).then(function(){e.stats.aborted||e.openAndSendXhr(i,r,t)}).catch(function(c){e.callbacks.onError({code:i.status,text:c.message},r,i,s)}):this.openAndSendXhr(i,r,t)}},a.openAndSendXhr=function(e,t,r){e.readyState||e.open("GET",t.url,!0);var i=this.context.headers;if(i)for(var s in i)e.setRequestHeader(s,i[s]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxTimeToFirstByteMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxTimeToFirstByteMs),e.send()},a.readystatechange=function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var i=t.readyState,s=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var d=t.status,c=t.responseType!=="text";if(d>=200&&d<300&&(c&&t.response||t.responseText!==null)){r.loading.end=Math.max(self.performance.now(),r.loading.first);var f=c?t.response:t.responseText,h=t.responseType==="arraybuffer"?f.byteLength:f.length;if(r.loaded=r.total=h,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;var m=this.callbacks.onProgress;if(m&&m(r,e,f,t),!this.callbacks)return;var g={url:t.responseURL,data:f,code:d};this.callbacks.onSuccess(g,r,e,t)}else{var E=s.loadPolicy.errorRetry;on(E,r.retry,!1,d)?this.retry(E):(H.error(d+" while loading "+e.url),this.callbacks.onError({code:d,text:t.statusText},e,t,r))}}}},a.loadtimeout=function(){var e,t=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry;if(on(t,this.stats.retry,!0))this.retry(t);else{H.warn("timeout while loading "+this.context.url);var r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}},a.retry=function(e){var t=this.context,r=this.stats;this.retryDelay=Wn(e,r.retry),r.retry++,H.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+t.url+", retrying "+r.retry+"/"+e.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},a.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},a.getCacheAge=function(){var e=null;if(this.loader&&hm.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},a.getResponseHeader=function(e){return this.loader&&new RegExp("^"+e+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null},l}(),fm=/(\d+)-(\d+)\/(\d+)/,od=function(){function l(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||pm,this.controller=new self.AbortController,this.stats=new Zt}var a=l.prototype;return a.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},a.abortInternal=function(){var e=this.response;e!=null&&e.ok||(this.stats.aborted=!0,this.controller.abort())},a.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},a.load=function(e,t,r){var i=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var d=function(m,g){var E={method:"GET",mode:"cors",credentials:"same-origin",signal:g,headers:new self.Headers(G({},m.headers))};return m.rangeEnd&&E.headers.set("Range","bytes="+m.rangeStart+"-"+String(m.rangeEnd-1)),E}(e,this.controller.signal),c=r.onProgress,f=e.responseType==="arraybuffer",h=f?"byteLength":"length";this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,d),self.clearTimeout(this.requestTimeout),t.timeout=t.loadPolicy.maxTimeToFirstByteMs,this.requestTimeout=self.setTimeout(function(){i.abortInternal(),r.onTimeout(s,e,i.response)},t.timeout),self.fetch(this.request).then(function(m){i.response=i.loader=m;var g=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(i.requestTimeout),t.timeout=t.loadPolicy.maxLoadTimeMs,i.requestTimeout=self.setTimeout(function(){i.abortInternal(),r.onTimeout(s,e,i.response)},t.loadPolicy.maxLoadTimeMs-(g-s.loading.start)),!m.ok){var E=m.status,k=m.statusText;throw new mm(k||"fetch, bad network response",E,m)}return s.loading.first=g,s.total=function(R){var D=R.get("Content-Range");if(D){var A=function(O){var F=fm.exec(O);if(F)return parseInt(F[2])-parseInt(F[1])+1}(D);if(z(A))return A}var I=R.get("Content-Length");if(I)return parseInt(I)}(m.headers)||s.total,c&&z(t.highWaterMark)?i.loadProgressively(m,s,e,t.highWaterMark,c):f?m.arrayBuffer():e.responseType==="json"?m.json():m.text()}).then(function(m){var g=i.response;self.clearTimeout(i.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var E=m[h];E&&(s.loaded=s.total=E);var k={url:g.url,data:m,code:g.status};c&&!z(t.highWaterMark)&&c(s,e,m,g),r.onSuccess(k,s,e,g)}).catch(function(m){if(self.clearTimeout(i.requestTimeout),!s.aborted){var g=m&&m.code||0,E=m?m.message:null;r.onError({code:g,text:E},e,m?m.details:null,s)}})},a.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},a.getResponseHeader=function(e){return this.response?this.response.headers.get(e):null},a.loadProgressively=function(e,t,r,i,s){i===void 0&&(i=0);var d=new Uu,c=e.body.getReader();return function f(){return c.read().then(function(h){if(h.done)return d.dataLength&&s(t,r,d.flush(),e),Promise.resolve(new ArrayBuffer(0));var m=h.value,g=m.length;return t.loaded+=g,g<i||d.dataLength?(d.push(m),d.dataLength>=i&&s(t,r,d.flush(),e)):s(t,r,m,e),f()}).catch(function(){return Promise.reject()})}()},l}();function pm(l,a){return new self.Request(l.url,a)}var mm=function(l){function a(e,t,r){var i;return(i=l.call(this,e)||this).code=void 0,i.details=void 0,i.code=t,i.details=r,i}return Y(a,l),a}(ue(Error)),vm=/\s/,gm=L(L({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:sd,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Op,bufferController:Vp,capLevelController:sm,errorController:y,fpsController:om,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:jt,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:{newCue:function(l,a,e,t){for(var r,i,s,d,c,f=[],h=self.VTTCue||self.TextTrackCue,m=0;m<t.rows.length;m++)if(s=!0,d=0,c="",!(r=t.rows[m]).isEmpty()){for(var g,E=0;E<r.chars.length;E++)vm.test(r.chars[E].uchar)&&s?d++:(c+=r.chars[E].uchar,s=!1);r.cueStartTime=a,a===e&&(e+=1e-4),d>=16?d--:d++;var k=zu(c.trim()),R=zo(a,e,k);l!=null&&(g=l.cues)!=null&&g.getCueById(R)||((i=new h(a,e,k)).id=R,i.line=m+1,i.align="left",i.position=10+Math.min(80,10*Math.floor(8*d/32)),f.push(i))}return l&&f.length&&(f.sort(function(D,A){return D.line==="auto"||A.line==="auto"?0:D.line>8&&A.line>8?A.line-D.line:D.line-A.line}),f.forEach(function(D){return Ya(l,D)})),f}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Up,subtitleTrackController:Gp,timelineController:nm,audioStreamController:Fp,audioTrackController:Np,emeController:rd,cmcdController:dm,contentSteeringController:cm});function rl(l){return l&&typeof l=="object"?Array.isArray(l)?l.map(rl):Object.keys(l).reduce(function(a,e){return a[e]=rl(l[e]),a},{}):l}function ym(l){var a=l.loader;a!==od&&a!==sd?(H.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(l.loader=od,l.progressive=!0,l.enableSoftwareAES=!0,H.log("[config]: Progressive streaming enabled, using FetchLoader"))}var ld=function(){function l(e){e===void 0&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new as,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,Je(e.debug||!1,"Hls instance");var t=this.config=function(fe,de){if((de.liveSyncDurationCount||de.liveMaxLatencyDurationCount)&&(de.liveSyncDuration||de.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(de.liveMaxLatencyDurationCount!==void 0&&(de.liveSyncDurationCount===void 0||de.liveMaxLatencyDurationCount<=de.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(de.liveMaxLatencyDuration!==void 0&&(de.liveSyncDuration===void 0||de.liveMaxLatencyDuration<=de.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var _e=rl(fe),Oe=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(function(Se){var Pe=(Se==="level"?"playlist":Se)+"LoadPolicy",Ae=de[Pe]===void 0,Ce=[];Oe.forEach(function(He){var $e=Se+"Loading"+He,qe=de[$e];if(qe!==void 0&&Ae){Ce.push($e);var lt=_e[Pe].default;switch(de[Pe]={default:lt},He){case"TimeOut":lt.maxLoadTimeMs=qe,lt.maxTimeToFirstByteMs=qe;break;case"MaxRetry":lt.errorRetry.maxNumRetry=qe,lt.timeoutRetry.maxNumRetry=qe;break;case"RetryDelay":lt.errorRetry.retryDelayMs=qe,lt.timeoutRetry.retryDelayMs=qe;break;case"MaxRetryTimeout":lt.errorRetry.maxRetryDelayMs=qe,lt.timeoutRetry.maxRetryDelayMs=qe}}}),Ce.length&&H.warn('hls.js config: "'+Ce.join('", "')+'" setting(s) are deprecated, use "'+Pe+'": '+JSON.stringify(de[Pe]))}),L(L({},_e),de)}(l.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&ym(t);var r=t.abrController,i=t.bufferController,s=t.capLevelController,d=t.errorController,c=t.fpsController,f=new d(this),h=this.abrController=new r(this),m=this.bufferController=new i(this),g=this.capLevelController=new s(this),E=new c(this),k=new _o(this),R=new Kn(this),D=t.contentSteeringController,A=D?new D(this):null,I=this.levelController=new b(this,A),O=new be(this),F=new At(this.config),q=this.streamController=new Mp(this,O,F);g.setStreamController(q),E.setStreamController(q);var Q=[k,I,q];A&&Q.splice(1,0,A),this.networkControllers=Q;var X=[h,m,g,E,R,O];this.audioTrackController=this.createController(t.audioTrackController,Q);var oe=t.audioStreamController;oe&&Q.push(new oe(this,O,F)),this.subtitleTrackController=this.createController(t.subtitleTrackController,Q);var J=t.subtitleStreamController;J&&Q.push(new J(this,O,F)),this.createController(t.timelineController,X),F.emeController=this.emeController=this.createController(t.emeController,X),this.cmcdController=this.createController(t.cmcdController,X),this.latencyController=this.createController(za,X),this.coreComponents=X,Q.push(f);var te=f.onErrorOut;typeof te=="function"&&this.on(w.ERROR,te,f)}l.isSupported=function(){return function(){var e=Lo();if(!e)return!1;var t=Eu(),r=e&&typeof e.isTypeSupported=="function"&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function";return!!r&&!!i}()};var a=l.prototype;return a.createController=function(e,t){if(e){var r=new e(this);return t&&t.push(r),r}return null},a.on=function(e,t,r){r===void 0&&(r=this),this._emitter.on(e,t,r)},a.once=function(e,t,r){r===void 0&&(r=this),this._emitter.once(e,t,r)},a.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},a.off=function(e,t,r,i){r===void 0&&(r=this),this._emitter.off(e,t,r,i)},a.listeners=function(e){return this._emitter.listeners(e)},a.emit=function(e,t,r){return this._emitter.emit(e,t,r)},a.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){H.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(w.ERROR,{type:se.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,fatal:!1,event:e,error:r})}return!1},a.listenerCount=function(e){return this._emitter.listenerCount(e)},a.destroy=function(){H.log("destroy"),this.trigger(w.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null},a.attachMedia=function(e){H.log("attachMedia"),this._media=e,this.trigger(w.MEDIA_ATTACHING,{media:e})},a.detachMedia=function(){H.log("detachMedia"),this.trigger(w.MEDIA_DETACHING,void 0),this._media=null},a.loadSource=function(e){this.stopLoad();var t=this.media,r=this.url,i=this.url=le.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});H.log("loadSource:"+i),t&&r&&r!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(w.MANIFEST_LOADING,{url:e})},a.startLoad=function(e){e===void 0&&(e=-1),H.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},a.stopLoad=function(){H.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},a.swapAudioCodec=function(){H.log("swapAudioCodec"),this.streamController.swapAudioCodec()},a.recoverMediaError=function(){H.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},a.removeLevel=function(e,t){t===void 0&&(t=0),this.levelController.removeLevel(e,t)},M(l,[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){H.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){H.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){H.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){H.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){H.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(H.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){rn.indexOf(e)>-1&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,r=this.autoLevelCapping,i=this.maxHdcpLevel;if(e=r===-1&&t&&t.length?t.length-1:r,i)for(var s=e;s--;){var d=t[s].attrs["HDCP-LEVEL"];if(d&&d<=i)return s}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.4.0-beta.2"}},{key:"Events",get:function(){return w}},{key:"ErrorTypes",get:function(){return se}},{key:"ErrorDetails",get:function(){return W}},{key:"DefaultConfig",get:function(){return l.defaultConfig?l.defaultConfig:gm},set:function(e){l.defaultConfig=e}}]),l}();return ld.defaultConfig=void 0,ld},o.exports=v()})(!1)})(JE);var eb=Jl,tb=eb,sr=tb,ha=class extends Error{constructor(o){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ha.MEDIA_ERR_CUSTOM,u=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0;var v;super(o),this.name="MediaError",this.code=n,this.context=p,this.fatal=u??(n>=ha.MEDIA_ERR_NETWORK&&n<=ha.MEDIA_ERR_ENCRYPTED),this.message||(this.message=(v=ha.defaultMessages[this.code])!=null?v:"")}},ar=ha;ar.MEDIA_ERR_ABORTED=1,ar.MEDIA_ERR_NETWORK=2,ar.MEDIA_ERR_DECODE=3,ar.MEDIA_ERR_SRC_NOT_SUPPORTED=4,ar.MEDIA_ERR_ENCRYPTED=5,ar.MEDIA_ERR_CUSTOM=100,ar.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var rb=o=>o==null,Qf=(o,n)=>rb(n)?!1:o in n,eu={ANY:"any",MUTED:"muted"},fa={VOD:"on-demand",ON_DEMAND:"on-demand",LIVE:"live",LL_LIVE:"ll-live",DVR:"live:dvr",LL_DVR:"ll-live:dvr"},tu={MSE:"mse",NATIVE:"native"},ru={HEADER:"header",QUERY:"query",NONE:"none"};Object.values(ru);var Dn={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},Cc={HLS:Dn.M3U8},ib=[...Object.values(Dn),"hls","HLS"],qi=function(o,n,u,p){let v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:o;v.addEventListener(n,u,p),o.addEventListener("teardown",()=>{v.removeEventListener(n,u)},{once:!0})};function nb(o,n,u){n&&u>n&&(u=n);for(let p=0;p<o.length;p++)if(o.start(p)<=u&&o.end(p)>=u)return!0;return!1}var ab=o=>{let n=o.indexOf("?");if(n<0)return[o];let u=o.slice(0,n),p=o.slice(n);return[u,p]},Xf=o=>{let n=o.type;if(n){let p=n.toUpperCase();return Qf(p,Cc)?Cc[p]:n}let{src:u}=o;return u?sb(u):""},sb=o=>{let n="";try{n=new URL(o).pathname}catch{console.error("invalid url")}let u=n.lastIndexOf(".");if(u<0)return"";let p=n.slice(u+1).toUpperCase();return Qf(p,Dn)?Dn[p]:""},ob=Object.values(eu),xc=o=>typeof o=="boolean"||typeof o=="string"&&ob.includes(o),lb=(o,n,u)=>{let{autoplay:p}=o,v=!1,T=!1,L=xc(p)?p:!!p,C=()=>{v||qi(n,"playing",()=>{v=!0},{once:!0})};if(C(),qi(n,"loadstart",()=>{v=!1,C(),wl(n,L)},{once:!0}),qi(n,"loadstart",()=>{u||(T=!Number.isFinite(n.duration)),wl(n,L)},{once:!0}),u&&u.once(sr.Events.LEVEL_LOADED,(M,V)=>{var G;T=(G=V.details.live)!=null?G:!1}),!L){let M=()=>{!T||(u!=null&&u.liveSyncPosition?n.currentTime=u.liveSyncPosition:Number.isFinite(n.seekable.end(0))&&(n.currentTime=n.seekable.end(0)))};u&&qi(n,"play",()=>{n.preload==="metadata"?u.once(sr.Events.LEVEL_UPDATED,M):M()},{once:!0})}return M=>{v||(L=xc(M)?M:!!M,wl(n,L))}},wl=(o,n)=>{if(!n)return;let u=o.muted,p=()=>o.muted=u;switch(n){case eu.ANY:o.play().catch(()=>{o.muted=!0,o.play().catch(p)});break;case eu.MUTED:o.muted=!0,o.play().catch(p);break;default:o.play().catch(()=>{});break}},ub=(o,n,u)=>{let{preload:p,src:v}=o,T=Z=>{Z!=null&&["","none","metadata","auto"].includes(Z)?n.setAttribute("preload",Z):n.removeAttribute("preload")};if(!u)return T(p),T;let L=!1,C=!1,M=u.config.maxBufferLength,V=u.config.maxBufferSize,G=Z=>{T(Z);let j=Z??n.preload;C||j==="none"||(j==="metadata"?(u.config.maxBufferLength=1,u.config.maxBufferSize=1):(u.config.maxBufferLength=M,u.config.maxBufferSize=V),Y())},Y=()=>{!L&&v&&(L=!0,u.loadSource(v))};return qi(n,"play",()=>{C=!0,u.config.maxBufferLength=M,u.config.maxBufferSize=V,Y()},{once:!0}),G(p),G};function db(o,n){n.on(sr.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(v,T)=>{let{tracks:L}=T;L.forEach(C=>{var M;let V=(M=C.subtitleTrack)!=null?M:C.closedCaptions,G=n.subtitleTracks.findIndex(Y=>{let{lang:Z,name:j,type:re}=Y;return Z==(V==null?void 0:V.lang)&&j===C.label&&re.toLowerCase()===C.kind});Zf(o,C.kind,C.label,V==null?void 0:V.lang,"".concat(C.kind).concat(G))})});let u=()=>{var v;if(!n.subtitleTracks.length)return;let T=Array.from(o.textTracks).find(C=>C.id&&C.mode==="showing"&&["subtitles","captions"].includes(C.kind)),L="".concat((v=n.subtitleTracks[n.subtitleTrack])==null?void 0:v.type.toLowerCase()).concat(n.subtitleTrack);if(T&&(n.subtitleTrack<0||(T==null?void 0:T.id)!==L)){let C=n.subtitleTracks.findIndex(M=>{let{lang:V,name:G,type:Y}=M;return V==T.language&&G===T.label&&Y.toLowerCase()===T.kind});n.subtitleTrack=C}T&&(T==null?void 0:T.id)===L&&T.cues&&Array.from(T.cues).forEach(C=>{T.addCue(C)})};o.textTracks.addEventListener("change",u),n.on(sr.Events.CUES_PARSED,(v,T)=>{let{track:L,cues:C}=T,M=o.textTracks.getTrackById(L);if(!M)return;let V=M.mode==="disabled";V&&(M.mode="hidden"),C.forEach(G=>{var Y;(Y=M.cues)!=null&&Y.getCueById(G.id)||M.addCue(G)}),V&&(M.mode="disabled")}),n.once(sr.Events.DESTROYING,()=>{o.textTracks.removeEventListener("change",u),o.querySelectorAll("track[data-removeondestroy]").forEach(v=>{v.remove()})});let p=()=>{Array.from(o.textTracks).forEach(v=>{var T,L;if(!["subtitles","caption"].includes(v.kind)&&v.label==="thumbnails"){if(!((T=v.cues)!=null&&T.length)){let C=o.querySelector('track[label="thumbnails"]'),M=(L=C==null?void 0:C.getAttribute("src"))!=null?L:"";C==null||C.removeAttribute("src"),setTimeout(()=>{C==null||C.setAttribute("src",M)},0)}v.mode!=="hidden"&&(v.mode="hidden")}})};n.once(sr.Events.MANIFEST_LOADED,p),n.once(sr.Events.MEDIA_ATTACHED,p)}function Zf(o,n,u,p,v){let T=document.createElement("track");return T.kind=n,T.label=u,p&&(T.srclang=p),v&&(T.id=v),T.track.mode=["subtitles","captions"].includes(n)?"disabled":"hidden",T.setAttribute("data-removeondestroy",""),o.append(T),T.track}var co="cuepoints",yu=Object.freeze({label:co}),Jf=function(o){let{label:n=co}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yu;var u;return(u=Array.from(o.querySelectorAll("track")).find(p=>p.track.label===n&&p.track.kind==="metadata"))==null?void 0:u.track};async function cb(o,n){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:yu,p=Jf(o,u);if(!p){let{label:v=co}=u;p=Zf(o,"metadata",v),p.mode="hidden",await new Promise(T=>setTimeout(()=>T(void 0),0))}return p.mode!=="hidden"&&(p.mode="hidden"),[...n].sort((v,T)=>{let{time:L}=v,{time:C}=T;return C-L}).forEach(v=>{let{time:T,value:L}=v;var C,M;let V=Array.prototype.findIndex.call(p==null?void 0:p.cues,re=>re.startTime>=T),G=(C=p==null?void 0:p.cues)==null?void 0:C[V],Y=G?G.startTime:Number.isFinite(o.duration)?o.duration:Number.MAX_SAFE_INTEGER,Z=(M=p==null?void 0:p.cues)==null?void 0:M[V-1];Z&&(Z.endTime=T);let j=new VTTCue(T,Y,JSON.stringify(L??null));p.addCue(j)}),p}var hb=o=>({time:o.startTime,value:JSON.parse(o.text)});function fb(o){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{label:co};var u,p;let v=Jf(o,n);if(!((u=v==null?void 0:v.activeCues)!=null&&u.length))return;let{currentTime:T}=o,L=Array.prototype.find.call((p=v.activeCues)!=null?p:[],C=>{let{startTime:M,endTime:V}=C;return M<=T&&V>T});return hb(L)}async function pb(o){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yu;return new Promise(u=>{qi(o,"loadstart",async()=>{let p=await cb(o,[],n);qi(o,"cuechange",()=>{let v=fb(o);if(v){let T=new CustomEvent("cuepointchange",{composed:!0,bubbles:!0,detail:v});o.dispatchEvent(T)}},{},p),u(p)})})}var Mc,Pc,mb=(Pc=(Mc=globalThis==null?void 0:globalThis.navigator)==null?void 0:Mc.userAgent)!=null?Pc:"",vb=mb.toLowerCase().indexOf("android")!==-1,Ia=new WeakMap,ep="mux.com",Oc,Fc,tp=(Fc=(Oc=sr).isSupported)==null?void 0:Fc.call(Oc),gb=vb,yb=()=>gu.utils.now(),Eb=gu.utils.generateUUID,Nc=function(o){let{domain:n=ep,maxResolution:u=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!o)return;let[p,v=""]=ab(o),T=new URL("https://stream.".concat(n,"/").concat(p,".m3u8").concat(v));return u&&T.searchParams.set("max_resolution",u),T.toString()},bb=o=>{if(!o)return;let[n]=o.split("?");return n||void 0},_b=o=>{if(!o||!o.startsWith("https://stream."))return;let[n]=new URL(o).pathname.slice(1).split(".m3u8");return n||void 0},Tb=o=>{var n,u,p;return(n=o==null?void 0:o.metadata)!=null&&n.video_id?o.metadata.video_id:np(o)&&(p=(u=bb(o.playbackId))!=null?u:_b(o.src))!=null?p:o.src},Sb=(o,n,u)=>{rp(n,u);let{metadata:p={}}=o,{view_session_id:v=Eb()}=p,T=Tb(o);p.view_session_id=v,p.video_id=T,o.metadata=p,Ia.set(n,{});let L=Ab(o,n);kb(o,n,L),Rb(o,n,L),pb(n);let C=lb(o,n,L),M=ub(o,n,L);return{engine:L,setAutoplay:C,setPreload:M}},rp=(o,n)=>{let u=n==null?void 0:n.engine;u&&(u.detachMedia(),u.destroy()),o!=null&&o.mux&&!o.mux.deleted&&(o.mux.destroy(),delete o.mux),o&&(o.removeAttribute("src"),o.load(),o.removeEventListener("error",sp),o.removeEventListener("error",iu),o.removeEventListener("durationchange",ap),Ia.delete(o),o.dispatchEvent(new Event("teardown")))};function ip(o,n){var u;let p=Xf(o);if(p!==Dn.M3U8)return!0;let v=!p||((u=n.canPlayType(p))!=null?u:!0),{preferPlayback:T}=o,L=T===tu.MSE,C=T===tu.NATIVE;return v&&(C||!(tp&&(L||gb)))}var Ab=(o,n)=>{let{debug:u,streamType:p,startTime:v=-1,metadata:T,preferCmcd:L}=o,C=Xf(o)===Dn.M3U8,M=ip(o,n);if(C&&!M&&tp){let V={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0,capLevelToPlayerSize:!0,capLevelOnFPSDrop:!0},G=wb(p),Y=L!==ru.NONE?{useHeaders:L===ru.HEADER,sessionId:T==null?void 0:T.view_session_id,contentId:T==null?void 0:T.video_id}:void 0;return new sr({debug:u,startPosition:v,cmcd:Y,...V,...G})}},wb=o=>[fa.LIVE,fa.DVR].includes(o)?{backBufferLength:8}:[fa.LL_LIVE,fa.LL_DVR].includes(o)?{backBufferLength:4,maxFragLookUpTolerance:.001,abrBandWidthUpFactor:.95}:{},np=o=>{let{playbackId:n,src:u,customDomain:p}=o;if(n)return!0;if(typeof u!="string")return!1;let v=window==null?void 0:window.location.href,T=new URL(u,v).hostname.toLocaleLowerCase();return T.includes(ep)||!!p&&T.includes(p.toLocaleLowerCase())},kb=(o,n,u)=>{var p;let{envKey:v}=o,T=np(o);if(v||T){let{playerInitTime:L,playerSoftwareName:C,playerSoftwareVersion:M,beaconCollectionDomain:V,debug:G,disableCookies:Y}=o,Z={...o.metadata,video_title:((p=o==null?void 0:o.metadata)==null?void 0:p.video_title)||void 0},j=re=>typeof re.player_error_code=="string"?!1:typeof o.errorTranslator=="function"?o.errorTranslator(re):re;gu.monitor(n,{debug:G,beaconCollectionDomain:V,hlsjs:u,Hls:u?sr:void 0,automaticErrorTracking:!1,errorTranslator:j,disableCookies:Y,data:{...v?{env_key:v}:{},player_software_name:C,player_software:C,player_software_version:M,player_init_time:L,...Z}})}},Rb=(o,n,u)=>{var p;let v=ip(o,n),{src:T}=o;n&&v?(typeof T=="string"?(n.setAttribute("src",T),o.startTime&&(((p=Ia.get(n))!=null?p:{}).startTime=o.startTime,n.addEventListener("durationchange",ap,{once:!0}))):n.removeAttribute("src"),n.addEventListener("error",sp),n.addEventListener("error",iu),n.addEventListener("emptied",()=>{n.querySelectorAll("track[data-removeondestroy]").forEach(L=>{L.remove()})},{once:!0})):u&&T?(u.on(sr.Events.ERROR,(L,C)=>{let M={[sr.ErrorTypes.NETWORK_ERROR]:ar.MEDIA_ERR_NETWORK,[sr.ErrorTypes.MEDIA_ERROR]:ar.MEDIA_ERR_DECODE},V=new ar("",M[C.type]);V.fatal=C.fatal,V.data=C,n.dispatchEvent(new CustomEvent("error",{detail:V}))}),n.addEventListener("error",iu),db(n,u),u.attachMedia(n)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function ap(o){var n;let u=o.target,p=(n=Ia.get(u))==null?void 0:n.startTime;if(p&&nb(u.seekable,u.duration,p)){let v=u.preload==="auto";v&&(u.preload="none"),u.currentTime=p,v&&(u.preload="auto")}}async function sp(o){if(!o.isTrusted)return;o.stopImmediatePropagation();let n=o.target;if(!(n!=null&&n.error))return;let{message:u,code:p}=n.error,v=new ar(u,p);if(n.src&&(p!==ar.MEDIA_ERR_DECODE||p!==void 0))try{let{status:T}=await fetch(n.src);v.data={response:{code:T}}}catch{}n.dispatchEvent(new CustomEvent("error",{detail:v}))}function iu(o){var n,u;if(!(o instanceof CustomEvent)||!(o.detail instanceof ar))return;let p=o.target,v=o.detail;!v||!v.fatal||(((n=Ia.get(p))!=null?n:{}).error=v,(u=p.mux)==null||u.emit("error",{player_error_code:v.code,player_error_message:v.message,player_error_context:v.context}))}var Ib=function(){for(var o=arguments.length,n=new Array(o),u=0;u<o;u++)n[u]=arguments[u];let p=ee.useRef(null);return ee.useEffect(()=>{n.forEach(v=>{!v||(typeof v=="function"?v(p.current):v.current=p.current)})},[n]),p},Lb=()=>{try{return"0.7.8"}catch{}return"UNKNOWN"},Db=Lb(),Cb=()=>Db,xb=Cb(),Mb="mux-video-react",op=ge.forwardRef((o,n)=>{var u;let{playbackId:p,src:v,children:T,autoPlay:L,preload:C,...M}=o,[V]=ee.useState(yb()),[G,Y]=ee.useState((u=Nc(p))!=null?u:v),Z=ee.useRef(void 0),j=ee.useRef(null),re=Ib(j,n);return ee.useEffect(()=>{var ae;Y((ae=Nc(p))!=null?ae:v)},[v,p]),ee.useEffect(()=>{let ae={...o,src:G,playerInitTime:V,playerSoftwareName:Mb,playerSoftwareVersion:xb,autoplay:L},ue=re.current;return ue&&(Z.current=Sb(ae,ue,Z.current)),()=>{rp(ue,Z.current),ue=void 0,Z.current=void 0}},[G]),ee.useEffect(()=>{var ae;(ae=Z.current)==null||ae.setAutoplay(L)},[L]),ee.useEffect(()=>{var ae;(ae=Z.current)==null||ae.setPreload(C)},[C]),ge.createElement("video",{ref:re,...M},T)});op.propTypes={envKey:nr.string,debug:nr.bool,disableCookies:nr.bool,metadata:nr.any,beaconCollectionDomain:nr.string,playbackId:nr.string,playerInitTime:nr.number,preferPlayback:nr.oneOf(Object.values(tu)),type:nr.oneOf(ib),streamType:nr.oneOf(Object.values(fa)),startTime:nr.number};var Pb=op;const Ob=(o,n)=>{const u=Xr();return ee.useCallback(()=>{o&&(n(to.from(Kc())),o.assetId&&$f(u,o.assetId),o._id&&u.delete(o._id))},[o,u,n])};function Fb(o){let{asset:n,client:u}=o;const p=Jc(n),v=new URLSearchParams;if(ou(n)==="signed"){const T=eh(u,p,"v");v.set("token",T)}return"https://stream.mux.com/".concat(p,".m3u8?").concat(v)}var Nb="sanity-plugin-mux-input",Ub="2.0.17",Bb="An input component that integrates Sanity Studio with Mux video encoding/hosting service.",Gb=["sanity","video","mux","input","plugin","sanity-plugin","media"],Hb="https://github.com/sanity-io/sanity-plugin-mux-input#readme",Vb={url:"https://github.com/sanity-io/sanity-plugin-mux-input/issues"},Kb={type:"git",url:"git@github.com:sanity-io/sanity-plugin-mux-input.git"},qb="MIT",jb="Sanity.io <hello@sanity.io>",Wb=!1,$b="module",Yb={".":{types:"./lib/index.d.ts",source:"./src/index.ts",require:"./lib/index.cjs",node:{import:"./lib/index.cjs.js",require:"./lib/index.cjs"},import:"./lib/index.js",default:"./lib/index.js"},"./package.json":"./package.json"},zb="./lib/index.cjs",Qb="./lib/index.js",Xb="./src/index.ts",Zb="./lib/index.d.ts",Jb=["lib","sanity.json","src","v2-incompatible.js"],e_={build:"run-s clean && plugin-kit verify-package --silent && pkg-utils build --strict && pkg-utils --strict",clean:"rimraf lib",dev:"next dev","link-watch":"plugin-kit link-watch",lint:"eslint .",prepare:"husky install || true",prepublishOnly:"run-s build",test:"npm run lint && npm run type-check && npm run build","type-check":"tsc --noEmit",watch:"pkg-utils watch --strict",format:"prettier --write --cache --ignore-unknown ."},t_={"@mux/mux-video-react":"^0.7.7","@mux/upchunk":"^3","@sanity/icons":"^2","@sanity/incompatible-plugin":"^1","@sanity/ui":"^1","@sanity/uuid":"^3",classnames:"^2.3.2","jsonwebtoken-esm":"^1.0.5","media-chrome":"^0.20.0",motion:"^10",rxjs:"^7","scroll-into-view-if-needed":"^3","suspend-react":"^0.0.9",swr:"^2.1.0","use-device-pixel-ratio":"^1.1.2","use-error-boundary":"^2.0.6"},r_={"@commitlint/cli":"^17.4.4","@commitlint/config-conventional":"^17.4.4","@sanity/pkg-utils":"^2.2.13","@sanity/plugin-kit":"^3.1.7","@sanity/semantic-release-preset":"^4.0.0","@sanity/vision":"^3.6.0","@types/react":"^18.0.28","@types/styled-components":"^5.1.26","@typescript-eslint/eslint-plugin":"^5.54.1","@typescript-eslint/parser":"^5.54.1","cz-conventional-changelog":"^3.3.0",eslint:"^8.36.0","eslint-config-prettier":"^8.7.0","eslint-config-react-app":"^7.0.1","eslint-config-sanity":"^6.0.0","eslint-plugin-import":"^2.27.5","eslint-plugin-prettier":"^4.2.1","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-simple-import-sort":"^10.0.0",husky:"^8.0.3","lint-staged":"^13.2.0",next:"^13.2.4","next-sanity":"^4.1.5","npm-run-all":"^4.1.5",prettier:"^2.8.4","prettier-plugin-packagejson":"^2.4.3",react:"^18.2.0","react-dom":"^18.2.0","react-is":"^18.2.0",rimraf:"^4.4.0",sanity:"^3.6.0","styled-components":"^5.3.9","type-fest":"^3.6.1",typescript:"^5.0.2"},i_={react:"^18","react-is":"^18",sanity:"^3","styled-components":"^5.2"},n_={node:">=14"},a_={access:"public"},s_="https://www.sanity.io/plugins/sanity-plugin-mux-input",o_={name:Nb,version:Ub,description:Bb,keywords:Gb,homepage:Hb,bugs:Vb,repository:Kb,license:qb,author:jb,sideEffects:Wb,type:$b,exports:Yb,main:zb,module:Qb,source:Xb,types:Zb,files:Jb,scripts:e_,dependencies:t_,devDependencies:r_,peerDependencies:i_,engines:n_,publishConfig:a_,sanityExchangeUrl:s_};function l_(o){let{asset:n,getCurrentTime:u,setDialogState:p}=o;const v=Xr(),T="EditThumbnailDialog".concat(ee.useId()),L=ee.useMemo(()=>u(),[u]),C=ee.useMemo(()=>({...n,thumbTime:L}),[n,L]),[M,V]=ee.useState(!1),[G,Y]=ee.useState(null),Z=ee.useCallback(()=>{V(!0),v.patch(n._id).set({thumbTime:L}).commit({returnDocuments:!1}).then(()=>void p(!1)).catch(Y).finally(()=>void V(!1))},[v,n._id,L,p]),j=300*su({maxDpr:2});if(G)throw G;return B(ro,{id:T,header:"Edit thumbnail",onClose:()=>p(!1),footer:B(or,{padding:3,children:B(Wt,{mode:"ghost",tone:"primary",loading:M,onClick:Z,text:"Set new thumbnail"},"thumbnail")}),children:Te(or,{space:3,padding:3,children:[Te(or,{space:2,children:[B(Tt,{size:1,weight:"semibold",children:"Current:"}),B(Ws,{asset:n,width:j})]}),Te(or,{space:2,children:[B(Tt,{size:1,weight:"semibold",children:"New:"}),B(Ws,{asset:C,width:j})]})]})})}function u_(o){let{asset:n,client:u}=o;const p=Jc(n),v=new URLSearchParams;if(ou(n)==="signed"){const T=eh(u,p,"s");v.set("token",T)}return"https://image.mux.com/".concat(p,"/storyboard.vtt?").concat(v)}const d_=Lt(Xt)(cc||(cc=Dt([`
  position: relative;
  min-height: 150px;
  aspect-ratio: 16 / 9;
  overflow: hidden;
  border-radius: 1px;
  media-airplay-button[media-airplay-unavailable] {
    display: none;
  }
  media-volume-range[media-volume-unavailable] {
    display: none;
  }
  media-pip-button[media-pip-unavailable] {
    display: none;
  }
  media-controller {
    --media-control-background: transparent;
    --media-control-hover-background: transparent;
    --media-range-track-background-color: rgba(255, 255, 255, 0.5);
    --media-range-track-border-radius: 3px;
    width: 100%;
    height: 100%;
    background-color: transparent;
  }
  media-control-bar {
    --media-button-icon-width: 18px;
    --media-preview-time-margin: 0px;
  }
  media-control-bar:not([slot]) :is([role='button'], [role='switch'], button) {
    height: 44px;
  }
  .size-extra-small media-control-bar [role='button'],
  .size-extra-small media-control-bar [role='switch'] {
    height: auto;
    padding: 4.4% 3.2%;
  }
  .mxp-spacer {
    flex-grow: 1;
    height: 100%;
    background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
  }
  media-controller::part(vertical-layer) {
    transition: background-color 1s;
  }
  media-controller:is([media-paused], :not([user-inactive]))::part(vertical-layer) {
    background-color: rgba(0, 0, 0, 0.6);
    transition: background-color 0.25s;
  }
  .mxp-center-controls {
    --media-background-color: transparent;
    --media-button-icon-width: 100%;
    --media-button-icon-height: auto;
    pointer-events: none;
    width: 100%;
    display: flex;
    flex-flow: row;
    align-items: center;
    justify-content: center;
  }
  .mxp-center-controls media-play-button {
    --media-control-background: transparent;
    --media-control-hover-background: transparent;
    padding: 0;
    width: max(27px, min(9%, 90px));
  }
  .mxp-center-controls media-seek-backward-button,
  .mxp-center-controls media-seek-forward-button {
    --media-control-background: transparent;
    --media-control-hover-background: transparent;
    padding: 0;
    margin: 0 10%;
    width: min(7%, 70px);
  }
  media-loading-indicator {
    --media-loading-icon-width: 100%;
    --media-button-icon-height: auto;
    pointer-events: none;
    position: absolute;
    width: min(15%, 150px);
    display: flex;
    flex-flow: row;
    align-items: center;
    justify-content: center;
  }
  /* Intentionally don't target the div for transition but the children
 of the div. Prevents messing with media-chrome's autohide feature. */
  media-loading-indicator + div * {
    transition: opacity 0.15s;
    opacity: 1;
  }
  media-loading-indicator[media-loading]:not([media-paused]) ~ div > * {
    opacity: 0;
    transition-delay: 400ms;
  }
  media-volume-range {
    width: min(100%, 100px);
  }
  media-time-display {
    white-space: nowrap;
  }
  :is(media-time-display, media-text-display, media-playback-rate-button) {
    color: inherit;
  }
  media-controller:fullscreen media-control-bar[slot='top-chrome'] {
    /* Hide menus and buttons that trigger modals when in full-screen */
    display: none;
  }
  video {
    background: transparent;
  }
  media-controller:not(:fullscreen) video {
    aspect-ratio: 16 / 9;
  }
  media-controller:not(:-webkit-full-screen) video {
    aspect-ratio: 16 / 9;
  }
`]))),c_=Lt.div(hc||(hc=Dt([`
  && {
    --media-background-color: transparent;
    --media-button-icon-width: 100%;
    --media-button-icon-height: auto;
    pointer-events: none;
    width: 100%;
    display: flex;
    flex-flow: row;
    align-items: center;
    justify-content: center;
    media-play-button {
      --media-control-background: transparent;
      --media-control-hover-background: transparent;
      padding: 0;
      width: max(27px, min(9%, 90px));
    }
  }
`]))),h_=Lt(Wf)(fc||(fc=Dt([`
  justify-content: flex-end;
  button {
    height: auto;
  }
`])));function f_(o){let{asset:n}=o;const u=Xr(),p=ee.useRef(null),v=ee.useMemo(()=>nv({client:u,asset:n,width:1920,height:1080}),[u,n]);return ee.useEffect(()=>{var T;if(p.current){const L=document.createElement("style");L.innerHTML="img { object-fit: contain; }",(T=p.current)!=null&&T.shadowRoot&&p.current.shadowRoot.appendChild(L)}},[]),B(fE,{ref:p,slot:"poster",src:v})}function p_(o){let{asset:n}=o;const u=Xr(),[p]=ee.useState(()=>u_({asset:n,client:u}));return B("track",{label:"thumbnails",default:!0,kind:"metadata",src:p})}const m_=Lt(Xt)(pc||(pc=Dt([`
  min-height: 82px;
  box-sizing: border-box;
`]))),v_=Lt(Vt)(mc||(mc=Dt([`
  text-overflow: ellipsis;
  overflow: hidden;
`]))),g_=Lt(or)(vc||(vc=Dt([`
  position: relative;
  width: 60%;
`]))),y_=Lt(Hc)(gc||(gc=Dt([`
  position: relative;
  width: 100%;

  code {
    overflow: hidden;
    text-overflow: ellipsis;
    position: relative;
    max-width: 200px;
  }
`]))),lp=o=>{let{progress:n=100,onCancel:u,filename:p,text:v="Uploading"}=o;return B(m_,{tone:"primary",padding:4,border:!0,height:"fill",children:Te(v_,{align:"center",justify:"space-between",height:"fill",direction:"row",gap:2,children:[Te(g_,{children:[B(Vt,{justify:"center",gap:[3,3,2,2],direction:["column","column","row"],children:B(Tt,{size:1,children:Te(ji,{space:2,children:[v,B(y_,{size:1,children:p||"..."})]})})}),B(Xt,{marginTop:3,radius:5,shadow:1,children:B(Xm,{value:n})})]}),u?B(Wt,{fontSize:2,text:"Cancel upload",mode:"ghost",tone:"critical",onClick:u}):null]})})},E_=o=>{let{asset:n,buttons:u,readOnly:p,onChange:v,dialogState:T,setDialogState:L}=o;var C,M,V,G;const Y=Xr(),Z=ee.useMemo(()=>(n==null?void 0:n.status)==="preparing"?"Preparing the video":(n==null?void 0:n.status)==="waiting_for_upload"?"Waiting for upload to start":(n==null?void 0:n.status)==="waiting"?"Processing upload":!((n==null?void 0:n.status)==="ready"||typeof(n==null?void 0:n.status)>"u"),[n]),j=ee.useMemo(()=>{var z,ke,ye,Ee;return((ke=(z=n==null?void 0:n.data)==null?void 0:z.static_renditions)==null?void 0:ke.status)==="preparing"?!0:(((Ee=(ye=n==null?void 0:n.data)==null?void 0:ye.static_renditions)==null?void 0:Ee.status)==="ready",!1)},[(M=(C=n==null?void 0:n.data)==null?void 0:C.static_renditions)==null?void 0:M.status]),re=ee.useMemo(()=>n.playbackId&&Fb({client:Y,asset:n}),[n,Y]),[ae,ue]=ee.useState(null),ce=ee.useCallback(z=>ue(z.currentTarget.error),[]),pe=ee.useRef(null),xe=ee.useRef(null),le=ee.useRef(null),w=ee.useCallback(()=>{var z,ke;return(ke=(z=le.current)==null?void 0:z.currentTime)!=null?ke:0},[le]),se=Ob(n,v);ee.useEffect(()=>{var z,ke;const ye=document.createElement("style");ye.innerHTML="button svg { vertical-align: middle; }",(z=pe.current)!=null&&z.shadowRoot&&pe.current.shadowRoot.appendChild(ye),(ke=xe==null?void 0:xe.current)!=null&&ke.shadowRoot&&xe.current.shadowRoot.appendChild(ye.cloneNode(!0))},[]),ee.useEffect(()=>{var z,ke,ye;if((n==null?void 0:n.status)==="errored")throw se(),new Error((ye=(ke=(z=n.data)==null?void 0:z.errors)==null?void 0:ke.messages)==null?void 0:ye.join(" "))},[(G=(V=n.data)==null?void 0:V.errors)==null?void 0:G.messages,n==null?void 0:n.status,se]);const W=ee.useMemo(()=>{try{return new URL(re).searchParams.get("token")}catch{return!1}},[re]);if(ae)throw ae;return!n||!n.status?null:Z?B(lp,{progress:100,filename:n==null?void 0:n.filename,text:Z!==!0&&Z||"Waiting for Mux to complete the file",onCancel:p?void 0:()=>se()}):Te(Ri,{children:[Te(d_,{shadow:1,tone:"transparent",scheme:"dark",children:[Te(oE,{children:[B(Pb,{playsInline:!0,ref:le,playbackId:"".concat(n.playbackId).concat(W?"?token=".concat(W):""),onError:ce,slot:"media",preload:"metadata",crossOrigin:"anonymous",metadata:{player_name:"Sanity Admin Dashboard",player_version:o_.version,page_type:"Preview Player"},children:B(p_,{asset:n})}),B(f_,{asset:n}),B(mE,{slot:"centered-chrome",noAutoHide:!0}),B(c_,{slot:"centered-chrome",children:B(hE,{})}),u&&B(h_,{slot:"top-chrome",children:u}),Te(Wf,{children:[B(cE,{}),B(uE,{}),B(pE,{}),B(lE,{}),B(dE,{})]})]}),j&&B(Xt,{padding:2,radius:1,style:{background:"var(--card-fg-color)",position:"absolute",top:"0.5em",left:"0.5em"},children:B(Tt,{size:1,style:{color:"var(--card-bg-color)"},children:"MUX is preparing static renditions, please stand by"})})]}),T==="edit-thumbnail"&&B(l_,{asset:n,getCurrentTime:w,setDialogState:L})]})};function up(o){return"inset 0 0 0 ".concat(o.width,"px ").concat(o.color)}function dp(o){const{base:n,border:u,focusRing:p}=o,v=p.offset+p.width,T=0-p.offset,L=n?n.bg:"var(--card-bg-color)";return[T>0&&"inset 0 0 0 ".concat(T,"px var(--card-focus-ring-color)"),u&&up(u),T<0&&"0 0 0 ".concat(0-T,"px ").concat(L),v>0&&"0 0 0 ".concat(v,"px var(--card-focus-ring-color)")].filter(Boolean).join(",")}const b_=Lt(pa)(o=>{let{theme:n}=o;const{focusRing:u}=n.sanity,p=n.sanity.color.base,v={width:1,color:"var(--card-border-color)"};return Vc(yc||(yc=Dt([`
    position: relative;

    &:not([data-disabled='true']) {
      &:focus-within {
        box-shadow: `,`;
      }
    }

    & input {
      overflow: hidden;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      position: absolute;
      min-width: 0;
      display: block;
      appearance: none;
      padding: 0;
      margin: 0;
      border: 0;
      opacity: 0;
    }
  `])),dp({base:p,border:v,focusRing:u}))}),__=ge.forwardRef(function(n,u){const{icon:p,id:v,accept:T,capture:L,fontSize:C,multiple:M,onSelect:V,padding:G=3,space:Y=3,textAlign:Z,text:j,disabled:re,...ae}=n,ue=ee.useId(),ce=v||ue,pe=ge.useCallback(le=>{V&&le.target.files&&V(Array.from(le.target.files))},[V]),xe=Te(Vt,{align:"center",justify:"flex-start",padding:G,children:[p&&B(Dr,{marginRight:j?Y:void 0,children:Te(Tt,{size:C,children:[ee.isValidElement(p)&&p,Rm.isValidElementType(p)&&ee.createElement(p)]})}),j&&B(Tt,{align:Z,size:C,textOverflow:"ellipsis",children:j})]});return Te(b_,{...ae,htmlFor:ce,padding:0,fontSize:2,disabled:re,ref:u,children:[xe,B("input",{"data-testid":"file-button-input",accept:T,capture:L,id:ce,multiple:M,onChange:pe,type:"file",value:"",disabled:re})]})}),T_=Lt(Xt)(Ec||(Ec=Dt([`
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0.6;
  mix-blend-mode: screen;
  background: transparent;
`]))),S_=Lt(Wt)(bc||(bc=Dt([`
  background: transparent;
  color: white;
`])));function A_(o){const{asset:n,readOnly:u,dialogState:p,setDialogState:v,onChange:T,onUpload:L}=o,[C,M]=ee.useState(!1),[V,G]=ee.useState(null),Y=ee.useMemo(()=>ou(n)==="signed",[n]),Z=ee.useCallback(()=>T(to.from(Kc([]))),[T]);return ee.useEffect(()=>{C&&p&&M(!1)},[p,C]),qc(ee.useCallback(()=>M(!1),[]),[V]),Te(ji,{space:1,padding:2,children:[Y&&B(Im,{content:B(Dr,{padding:2,children:B(Tt,{muted:!0,size:1,children:"Signed playback policy"})}),placement:"right",portal:!0,children:B(T_,{radius:2,margin:2,scheme:"dark",tone:"positive",children:B(S_,{icon:Lm,mode:"bleed",tone:"positive"})})}),!u&&B(Wt,{icon:Dm,mode:"ghost",onClick:()=>v("edit-thumbnail")}),B(Cm,{content:Te(jc,{ref:G,children:[B(Dr,{padding:2,children:B(xm,{muted:!0,size:1,children:"Replace"})}),B(__,{accept:"video/*",icon:Wc,mode:"bleed",onSelect:L,text:"Upload",disabled:u,fontSize:2}),B(pa,{icon:$c,text:"Browse",onClick:()=>v("select-video")}),B(fd,{}),B(pa,{icon:nu,text:"Configure API",onClick:()=>v("secrets")}),B(fd,{}),B(pa,{tone:"critical",icon:Mm,text:"Clear field",onClick:Z,disabled:u})]}),portal:!0,open:C,children:B(Wt,{icon:Yc,mode:"ghost",onClick:()=>{v(!1),M(!0)}})})]})}var w_=ee.memo(A_);function k_(o){return Lt(o)(n=>{const u={width:n.$border?1:0,color:"var(--card-border-color)"};return Vc(_c||(_c=Dt([`
        --card-focus-box-shadow: `,`;

        border-radius: `,`;
        outline: none;
        box-shadow: var(--card-focus-box-shadow);

        &:focus {
          --card-focus-box-shadow: `,`;
        }
      `])),up(u),Pm(n.theme.sanity.radius[1]),dp({base:n.theme.sanity.color.base,border:u,focusRing:n.theme.sanity.focusRing}))})}const Uc=17,Bc=91,R_=k_(Xt),I_=ee.forwardRef((o,n)=>{let{children:u,tone:p,onPaste:v,onDrop:T,onDragEnter:L,onDragLeave:C,onDragOver:M}=o;const V=ee.useRef(!1),G=ee.useRef(null),Y=ee.useCallback(j=>{(j.keyCode==Uc||j.keyCode==Bc)&&(V.current=!0);const re=86;V.current&&j.keyCode==re&&G.current.focus()},[]),Z=ee.useCallback(j=>{(j.keyCode==Uc||j.keyCode==Bc)&&(V.current=!1)},[]);return Te(R_,{tone:p,height:"fill",ref:n,padding:0,radius:2,shadow:0,tabIndex:0,onKeyDown:Y,onKeyUp:Z,onPaste:v,onDrop:T,onDragEnter:L,onDragLeave:C,onDragOver:M,children:[B(L_,{ref:G,onPaste:v}),u]})}),L_=Lt.input.attrs({type:"text"})(Tc||(Tc=Dt([`
  position: absolute;
  border: 0;
  color: white;
  opacity: 0;

  &:focus {
    outline: none;
  }
`]))),D_=Lt.input(Sc||(Sc=Dt([`
  overflow: hidden;
  width: 0.1px;
  height: 0.1px;
  opacity: 0;
  position: absolute;
  z-index: -1;
`]))),C_=Lt.label(Ac||(Ac=Dt([`
  position: relative;
`]))),x_=o=>{let{onSelect:n,...u}=o;const p="FileSelect".concat(ee.useId()),v=ee.useRef(null),T=ee.useCallback(C=>{n&&n(C.target.files)},[n]),L=ee.useCallback(()=>{var C;return(C=v.current)==null?void 0:C.click()},[]);return Te(C_,{htmlFor:p,children:[B(D_,{accept:"video/*",ref:v,tabIndex:0,type:"file",id:p,onChange:T,value:""}),B(Wt,{onClick:L,mode:"default",tone:"primary",style:{width:"100%"},...u})]})},M_=Lt(Xt)(wc||(wc=Dt([`
  && {
    border-style: dashed;
  }
`]))),P_=Lt(Dr)(kc||(kc=Dt([`
  position: absolute;
  top: 0;
  right: 0;
`])));function O_(o){const{setDialogState:n,readOnly:u,onSelect:p,hovering:v,needsSetup:T}=o,L=ee.useCallback(()=>n("select-video"),[n]),C=ee.useCallback(()=>n("secrets"),[n]);return B(Dr,{style:{padding:1,position:"relative"},height:"stretch",children:Te(M_,{sizing:"border",height:"fill",tone:u?"transparent":"inherit",border:!0,padding:3,style:v?{borderColor:"transparent"}:void 0,children:[B(P_,{padding:3,children:B(Wt,{padding:3,radius:3,tone:T?"critical":void 0,onClick:C,icon:nu,mode:"bleed"})}),Te(Vt,{align:"center",justify:"space-between",gap:4,direction:["column","column","row"],paddingY:[2,2,0],sizing:"border",height:"fill",children:[Te(Vt,{align:"center",justify:"center",gap:2,flex:1,children:[B(Vt,{justify:"center",children:B(Tt,{muted:!0,children:B(Zm,{})})}),B(Vt,{justify:"center",children:B(Tt,{size:1,muted:!0,children:"Drag video or paste URL here"})})]}),Te(ji,{space:2,children:[B(x_,{mode:"ghost",tone:"default",icon:Wc,text:"Upload",onSelect:p}),B(Wt,{mode:"ghost",icon:$c,text:"Select",onClick:L})]})]})]})})}class F_ extends ee.Component{constructor(){super(...arguments),this.state={isDraggingOver:!1,invalidPaste:!1,invalidFile:!1,uploadProgress:null,fileInfo:null,uuid:null,error:null,url:null},this.dragEnteredEls=[],this.ctrlDown=!1,this.upload=null,this.container=ge.createRef(),this.handleProgress=n=>{this.setState({uploadProgress:n.percent})},this.onUpload=n=>{this.setState({uploadProgress:0,fileInfo:null,uuid:null}),this.upload=RE(this.props.config,this.props.client,n[0],{enableSignedUrls:this.props.secrets.enableSignedUrls}).pipe(qm(this.onCancelUploadButtonClick$.pipe(jm(()=>{this.state.uuid&&this.props.client.delete(this.state.uuid)})))).subscribe({complete:()=>{this.setState({error:null,uploadProgress:null,uuid:null})},next:u=>{this.handleUploadEvent(u)},error:u=>{this.setState({error:u,uploadProgress:null,uuid:null})}})},this.handleUploadEvent=n=>{switch(n.type){case"success":return this.handleUploadSuccess(n.asset);case"progress":return this.handleProgress(n);case"file":return this.setState({fileInfo:n.file});case"uuid":return this.setState({uuid:n.uuid});case"url":return this.setState({url:n.url,uploadProgress:100});default:return null}},this.handleUploadSuccess=n=>{this.setState({uploadProgress:100}),this.props.onChange(to.from([Qc({asset:{}}),Xc({_type:"reference",_weak:!0,_ref:n._id},["asset"])]))},this.handlePaste=n=>{const p=(n.clipboardData||window.clipboardData).getData("text"),v={enableSignedUrls:this.props.secrets.enableSignedUrls};this.upload=kE(this.props.config,this.props.client,p,v).subscribe({complete:()=>{this.setState({error:null,uploadProgress:null,url:null})},next:T=>{this.handleUploadEvent(T)},error:T=>{let L;T.message.toLowerCase().match("invalid url")||(L=T),this.setState({invalidPaste:!0,error:L},()=>{setTimeout(()=>{this.setState({invalidPaste:!1,uploadProgress:null})},2e3)})}})},this.handleDrop=n=>{this.setState({isDraggingOver:!1}),n.preventDefault(),n.stopPropagation(),PE(n.nativeEvent.dataTransfer).then(u=>{u&&this.onUpload(u)})},this.handleDragOver=n=>{n.preventDefault(),n.stopPropagation()},this.handleDragEnter=n=>{var u,p;n.stopPropagation(),this.dragEnteredEls.push(n.target),this.setState({isDraggingOver:!0});const v=(p=(u=n.dataTransfer.items)==null?void 0:u[0])==null?void 0:p.type;this.setState({invalidFile:!v.startsWith("video/")})},this.handleDragLeave=n=>{n.stopPropagation();const u=this.dragEnteredEls.indexOf(n.target);u>-1&&this.dragEnteredEls.splice(u,1),this.dragEnteredEls.length===0&&this.setState({isDraggingOver:!1})}}componentWillUnmount(){this.unSubscribeToUpload()}componentDidMount(){const n=new Wm;this.onCancelUploadButtonClick$=n.asObservable(),this.handleCancelUploadButtonClick=u=>n.next(u)}unSubscribeToUpload(){this.upload&&!this.upload.closed&&this.upload.unsubscribe()}render(){var n;if(this.state.uploadProgress!==null)return B(lp,{onCancel:this.handleCancelUploadButtonClick,progress:this.state.uploadProgress,filename:((n=this.state.fileInfo)==null?void 0:n.name)||this.state.url});if(this.state.error)throw this.state.error;return Te(Ri,{children:[B(I_,{tone:this.state.isDraggingOver&&(this.state.invalidPaste||this.state.invalidFile)?"critical":this.state.isDraggingOver?"positive":void 0,onDrop:this.handleDrop,onDragOver:this.handleDragOver,onDragLeave:this.handleDragLeave,onDragEnter:this.handleDragEnter,onPaste:this.handlePaste,ref:this.container,children:this.props.asset?B(E_,{readOnly:this.props.readOnly,asset:this.props.asset,onChange:this.props.onChange,dialogState:this.props.dialogState,setDialogState:this.props.setDialogState,buttons:B(w_,{asset:this.props.asset,dialogState:this.props.dialogState,setDialogState:this.props.setDialogState,onChange:this.props.onChange,onUpload:this.onUpload,readOnly:this.props.readOnly})}):B(O_,{hovering:this.state.isDraggingOver,onSelect:this.onUpload,readOnly:this.props.readOnly,setDialogState:this.props.setDialogState,needsSetup:this.props.needsSetup})}),this.props.dialogState==="select-video"&&B($E,{asset:this.props.asset,onChange:this.props.onChange,setDialogState:this.props.setDialogState})]})}}const N_=(o,n)=>ee.useCallback(async u=>{let{token:p,secretKey:v,enableSignedUrls:T}=u,{signingKeyId:L,signingKeyPrivate:C}=n;try{await Ic(o,p,v,T,L,C);const M=await SE(o);if(!(M!=null&&M.status)&&p&&v)throw new Error("Invalid secrets")}catch(M){throw console.error("Error while trying to save secrets:",M),M}if(T&&!await AE(o,L,C))try{const{data:V}=await TE(o);L=V.id,C=V.private_key,await Ic(o,p,v,T,L,C)}catch(V){throw console.log("Error while creating and saving signing key:",V==null?void 0:V.message),V}return{token:p,secretKey:v,enableSignedUrls:T,signingKeyId:L,signingKeyPrivate:C}},[o,n]);function cp(o){let{token:n,secretKey:u,enableSignedUrls:p}=o;return{submitting:!1,error:null,token:n??"",secretKey:u??"",enableSignedUrls:p??!1}}function U_(o,n){switch(n==null?void 0:n.type){case"submit":return{...o,submitting:!0,error:null};case"error":return{...o,submitting:!1,error:n.payload};case"reset":return cp(n.payload);case"change":return{...o,[n.payload.name]:n.payload.value};default:throw new Error("Unknown action type: ".concat(n==null?void 0:n.type))}}const B_=o=>ee.useReducer(U_,o,cp),G_=["title","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r"];function hp(o){let{height:n=26}=o;const u=ee.useId(),[p,v,T,L,C,M,V,G,Y,Z,j,re,ae,ue,ce,pe,xe,le,w]=ee.useMemo(()=>G_.map(se=>"".concat(u,"-").concat(se)),[u]);return Te("svg",{"aria-labelledby":p,role:"img",xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",viewBox:"92.08878326416016 102.66712188720703 692.76123046875 219.99948120117188",style:{height:"".concat(n,"px")},children:[B("title",{id:p,children:"Mux Logo"}),Te("defs",{children:[Te("linearGradient",{id:L,spreadMethod:"pad",gradientTransform:"matrix(528.38055 0 0 -528.38055 63.801 159.5)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[B("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),B("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),Te("linearGradient",{id:C,spreadMethod:"pad",gradientTransform:"matrix(523.66766 0 0 -523.66766 67.897 159.5)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[B("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),B("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),Te("linearGradient",{id:G,spreadMethod:"pad",gradientTransform:"rotate(180 296.075 79.75) scale(524.84045)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[B("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),B("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),Te("linearGradient",{id:Z,spreadMethod:"pad",gradientTransform:"matrix(524.84045 0 0 -524.84045 63.801 159.5)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[B("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),B("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),Te("linearGradient",{id:j,spreadMethod:"pad",gradientTransform:"matrix(523.08514 0 0 -523.08514 67.897 224.446)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[B("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),B("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),Te("linearGradient",{id:re,spreadMethod:"pad",gradientTransform:"matrix(524.84045 0 0 -524.84045 63.801 94.553)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[B("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),B("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),Te("linearGradient",{id:ae,spreadMethod:"pad",gradientTransform:"matrix(524.84045 0 0 -524.84045 63.801 159.5)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[B("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),B("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),Te("linearGradient",{id:ue,spreadMethod:"pad",gradientTransform:"matrix(524.84045 0 0 -524.84045 63.801 94.554)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[B("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),B("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),Te("linearGradient",{id:xe,spreadMethod:"pad",gradientTransform:"matrix(521.97632 0 0 -521.97632 69.067 191.973)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[B("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),B("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),Te("linearGradient",{id:le,spreadMethod:"pad",gradientTransform:"matrix(523.09039 0 0 -523.09039 67.312 191.973)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[B("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),B("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),Te("linearGradient",{id:w,spreadMethod:"pad",gradientTransform:"matrix(524.84045 0 0 -524.84045 63.801 159.5)",gradientUnits:"userSpaceOnUse",y2:0,x2:1,y1:0,x1:0,children:[B("stop",{offset:0,style:{stopOpacity:1,stopColor:"#ff4e00"}}),B("stop",{offset:1,style:{stopOpacity:1,stopColor:"#ff1791"}})]}),B("clipPath",{id:v,clipPathUnits:"userSpaceOnUse",children:B("path",{d:"M0 319h657.706V0H0Z"})}),B("clipPath",{id:T,clipPathUnits:"userSpaceOnUse",children:B("path",{d:"M423.64 242h164.999V77H423.64Z"})}),B("clipPath",{id:M,clipPathUnits:"userSpaceOnUse",children:B("path",{d:"M0 319h657.706V0H0Z"})}),B("clipPath",{id:V,clipPathUnits:"userSpaceOnUse",children:B("path",{d:"M311.3 242h93.031V77H311.3Z"})}),B("clipPath",{id:Y,clipPathUnits:"userSpaceOnUse",children:B("path",{d:"M198.96 242h35.106V77H198.96Z"})}),B("clipPath",{id:ce,clipPathUnits:"userSpaceOnUse",children:B("path",{d:"M0 319h657.706V0H0Z"})}),B("clipPath",{id:pe,clipPathUnits:"userSpaceOnUse",children:B("path",{d:"M69.067 242H169.12V141.947H69.067Z"})})]}),B("g",{clipPath:"url(#".concat(v,")"),transform:"matrix(1.33333 0 0 -1.33333 0 425.333)",children:B("g",{style:{opacity:.69999701},clipPath:"url(#".concat(T,")"),children:B("path",{style:{fill:"url(#".concat(L,")"),stroke:"none"},d:"M558.674 82.142c6.855-6.855 17.969-6.855 24.824 0 6.854 6.855 6.854 17.969 0 24.823L453.605 236.858c-6.855 6.855-17.969 6.855-24.824 0s-6.855-17.969 0-24.823z"})})}),B("path",{style:{fill:"url(#".concat(C,")"),stroke:"none"},d:"M558.674 236.858 428.781 106.966c-6.855-6.855-6.855-17.969 0-24.825 6.855-6.854 17.969-6.854 24.823 0l129.894 129.894c6.854 6.855 6.854 17.968 0 24.823A17.498 17.498 0 0 1 571.086 242a17.495 17.495 0 0 1-12.412-5.142",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),Te("g",{clipPath:"url(#".concat(M,")"),transform:"matrix(1.33333 0 0 -1.33333 0 425.333)",children:[B("g",{style:{opacity:.69999701},clipPath:"url(#".concat(V,")"),children:B("path",{style:{fill:"url(#".concat(G,")"),stroke:"none"},d:"M328.853 112.107c22.297 0 40.372 18.075 40.372 40.372v71.315c0 10.054 7.505 18.206 17.554 18.206 10.048 0 17.552-8.152 17.552-18.206v-71.315c0-41.686-33.793-75.479-75.478-75.479-9.694 0-17.553 7.859-17.553 17.554 0 9.694 7.859 17.553 17.553 17.553"})}),B("g",{style:{opacity:.69999701},clipPath:"url(#".concat(Y,")"),children:B("path",{style:{fill:"url(#".concat(Z,")"),stroke:"none"},d:"M216.513 242c-10.049 0-17.553-8.152-17.553-18.206V95.206c0-10.054 7.504-18.206 17.553-18.206 10.048 0 17.553 8.152 17.553 18.206v128.588c0 10.054-7.505 18.206-17.553 18.206"})})]}),B("path",{style:{fill:"url(#".concat(j,")"),stroke:"none"},d:"M369.225 224.447c0-9.694 7.859-17.553 17.553-17.553 9.695 0 17.553 7.859 17.553 17.553s-7.858 17.552-17.553 17.552c-9.694 0-17.553-7.858-17.553-17.552",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),B("path",{style:{fill:"url(#".concat(re,")"),stroke:"none"},d:"M553.532 94.554c0-9.695 7.859-17.554 17.553-17.554 9.695 0 17.554 7.859 17.554 17.554 0 9.694-7.859 17.552-17.554 17.552-9.694 0-17.553-7.858-17.553-17.552",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),B("path",{style:{fill:"url(#".concat(ae,")"),stroke:"none"},d:"M69.067 223.794V95.206C69.067 85.152 76.571 77 86.62 77c10.048 0 17.553 8.152 17.553 18.206v128.588c0 10.055-7.505 18.205-17.553 18.205-10.049 0-17.553-8.15-17.553-18.205",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),B("path",{style:{fill:"url(#".concat(ue,")"),stroke:"none"},d:"M198.96 94.554c0-9.695 7.859-17.554 17.553-17.554 9.695 0 17.554 7.859 17.554 17.554 0 9.694-7.859 17.553-17.554 17.553-9.694 0-17.553-7.859-17.553-17.553",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),B("g",{clipPath:"url(#".concat(ce,")"),transform:"matrix(1.33333 0 0 -1.33333 0 425.333)",children:B("g",{style:{opacity:.69999701},clipPath:"url(#".concat(pe,")"),children:B("path",{style:{fill:"url(#".concat(xe,")"),stroke:"none"},d:"M139.155 147.088c6.855-6.855 17.969-6.855 24.824 0s6.855 17.969 0 24.824l-64.947 64.946c-6.855 6.855-17.969 6.855-24.824 0s-6.855-17.969 0-24.823z"})})}),B("path",{style:{fill:"url(#".concat(le,")"),stroke:"none"},d:"m204.101 236.858-64.947-64.946c-6.854-6.855-6.854-17.969 0-24.824 6.856-6.855 17.97-6.855 24.824 0l64.947 64.947c6.855 6.855 6.855 17.968 0 24.823A17.495 17.495 0 0 1 216.513 242a17.498 17.498 0 0 1-12.412-5.142",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"}),B("path",{style:{fill:"url(#".concat(w,")"),stroke:"none"},d:"M253.374 223.794v-71.315c0-41.685 33.793-75.479 75.479-75.479 9.695 0 17.553 7.859 17.553 17.554 0 9.694-7.858 17.553-17.553 17.553-22.297 0-40.372 18.075-40.372 40.372v71.315c0 10.055-7.505 18.205-17.554 18.205s-17.553-8.15-17.553-18.205",transform:"matrix(1.33333 0 0 -1.33333 0 425.333)"})]})}const H_=Lt.span(Rc||(Rc=Dt([`
  display: inline-block;
  height: 0.8em;
  margin-right: 1em;
  transform: translate(0.3em, -0.2em);
`]))),V_=()=>Te(Ri,{children:[B(H_,{children:B(hp,{height:13})}),"API Credentials"]});function K_(o){const{children:n,title:u,description:p,inputId:v}=o;return Te(or,{space:1,children:[B(Vt,{align:"flex-end",children:B(Dr,{flex:1,paddingY:2,children:B(or,{space:2,children:Te(Vt,{children:[B(Tt,{as:"label",htmlFor:v,weight:"semibold",size:1,children:u||B("em",{children:"Untitled"})}),p&&B(Tt,{muted:!0,size:1,children:p})]})})})}),B("div",{children:n})]})}var Gc=ee.memo(K_);const q_=["token","secretKey","enableSignedUrls"];function j_(o){let{secrets:n,setDialogState:u}=o;var p,v;const T=Xr(),[L,C]=B_(n),M=ee.useMemo(()=>n.token&&n.secretKey,[n]),V=ee.useCallback(()=>u(!1),[u]),G=ee.useMemo(()=>n.token!==L.token||n.secretKey!==L.secretKey||n.enableSignedUrls!==L.enableSignedUrls,[n,L]),Y="ConfigureApi".concat(ee.useId()),[Z,j,re]=ee.useMemo(()=>q_.map(se=>"".concat(Y,"-").concat(se)),[Y]),ae=ee.useRef(null),ue=N_(T,n),ce=ee.useRef(!1),pe=ee.useCallback(se=>{if(se.preventDefault(),!ce.current&&se.currentTarget.reportValidity()){ce.current=!0,C({type:"submit"});const{token:W,secretKey:z,enableSignedUrls:ke}=L;ue({token:W,secretKey:z,enableSignedUrls:ke}).then(ye=>{const{projectId:Ee,dataset:Ke}=T.config();Om([md,vd,Ee,Ke]),Fm(()=>Promise.resolve(ye),[md,vd,Ee,Ke]),u(!1)}).catch(ye=>C({type:"error",payload:ye.message})).finally(()=>{ce.current=!1})}},[T,C,ue,u,L]),xe=ee.useCallback(se=>{C({type:"change",payload:{name:"token",value:se.currentTarget.value}})},[C]),le=ee.useCallback(se=>{C({type:"change",payload:{name:"secretKey",value:se.currentTarget.value}})},[C]),w=ee.useCallback(se=>{C({type:"change",payload:{name:"enableSignedUrls",value:se.currentTarget.checked}})},[C]);return ee.useEffect(()=>{ae.current&&ae.current.focus()},[ae]),B(ro,{id:Y,onClose:V,header:B(V_,{}),width:0,children:B(Dr,{padding:4,style:{position:"relative"},children:B("form",{onSubmit:pe,noValidate:!0,children:Te(or,{space:4,children:[!M&&B(Xt,{padding:[3,3,3],radius:2,shadow:1,tone:"primary",children:Te(or,{space:3,children:[Te(Tt,{size:1,children:["To set up a new access token, go to your"," ",B("a",{href:"https://dashboard.mux.com/settings/access-tokens",target:"_blank",rel:"noreferrer noopener",children:"account on mux.com"}),"."]}),Te(Tt,{size:1,children:["The access token needs permissions: ",B("strong",{children:"Mux Video "}),"(Full Access) and ",B("strong",{children:"Mux Data"})," (Read)",B("br",{}),"The credentials will be stored safely in a hidden document only available to editors."]})]})}),B(Gc,{title:"Access Token",inputId:Z,children:B(pd,{id:Z,ref:ae,onChange:xe,type:"text",value:(p=L.token)!=null?p:"",required:!!L.secretKey||L.enableSignedUrls})}),B(Gc,{title:"Secret Key",inputId:j,children:B(pd,{id:j,onChange:le,type:"text",value:(v=L.secretKey)!=null?v:"",required:!!L.token||L.enableSignedUrls})}),Te(or,{space:4,children:[Te(Vt,{align:"center",children:[B(kl,{id:re,onChange:w,checked:L.enableSignedUrls,style:{display:"block"}}),B(Dr,{flex:1,paddingLeft:3,children:B(Tt,{children:B("label",{htmlFor:re,children:"Enable Signed Urls"})})})]}),n.signingKeyId&&L.enableSignedUrls?B(Xt,{padding:[3,3,3],radius:2,shadow:1,tone:"caution",children:Te(or,{space:3,children:[B(Tt,{size:1,children:"The signing key ID that Sanity will use is:"}),B(Hc,{size:1,children:n.signingKeyId}),Te(Tt,{size:1,children:["This key is only used for previewing content in the Sanity UI.",B("br",{}),"You should generate a different key to use in your application server."]})]})}):null]}),Te(ji,{space:2,children:[B(Wt,{text:"Save",disabled:!G,loading:L.submitting,tone:"primary",mode:"default",type:"submit"}),B(Wt,{disabled:L.submitting,text:"Cancel",mode:"bleed",onClick:V})]}),L.error&&B(Xt,{padding:[3,3,3],radius:2,shadow:1,tone:"critical",children:B(Tt,{children:L.error})})]})})})})}var W_=ee.memo(j_);function $_(o){const{setDialogState:n}=o,u=ee.useCallback(()=>n("secrets"),[n]);return B(Ri,{children:B("div",{style:{padding:2},children:B(Xt,{display:"flex",sizing:"border",style:{aspectRatio:"16/9",width:"100%",boxShadow:"var(--card-bg-color) 0 0 0 2px"},paddingX:[2,3,4,4],radius:1,tone:"transparent",children:B(Vt,{justify:"flex-start",align:"center",children:Te(Rl,{columns:1,gap:[2,3,4,4],children:[B(ji,{paddingY:1,children:B("div",{style:{height:"32px"},children:B(hp,{})})}),B(ji,{paddingY:1,children:B($m,{size:[0,1,2,2],children:"Upload and preview videos directly from your studio."})}),B(ji,{paddingY:1,children:B(Wt,{mode:"ghost",icon:nu,text:"Configure API",onClick:u})})]})})})})})}const Y_=o=>{var n;const u=Xr(),p=EE(),v=iv((n=o.value)==null?void 0:n.asset),T=gE(o.readOnly?void 0:(v==null?void 0:v.value)||void 0),[L,C]=vE(),M=p.error||v.error||T.error;if(M)throw M;const V=p.isLoading||v.isLoading;return B(Ri,{children:V?B(Nm,{}):Te(Ri,{children:[p.value.needsSetup&&!v.value?B($_,{setDialogState:C}):B(F_,{...o,config:o.config,onChange:o.onChange,client:u,secrets:p.value.secrets,asset:v.value,dialogState:L,setDialogState:C,needsSetup:p.value.needsSetup}),L==="secrets"&&B(W_,{setDialogState:C,secrets:p.value.secrets})]})})};var gT=ee.memo(Y_);export{gT as default};
